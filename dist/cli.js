#!/usr/bin/env node
// @bun
var b0=Object.create;var{getPrototypeOf:O0,defineProperty:Hf,getOwnPropertyNames:y0}=Object;var C0=Object.prototype.hasOwnProperty;var k0=(f,$,P)=>{P=f!=null?b0(O0(f)):{};let z=$||!f||!f.__esModule?Hf(P,"default",{value:f,enumerable:!0}):P;for(let E of y0(f))if(!C0.call(z,E))Hf(z,E,{get:()=>f[E],enumerable:!0});return z};var H=(f,$)=>()=>($||f(($={exports:{}}).exports,$),$.exports);var C=import.meta.require;var k=H((v0)=>{class Yf extends Error{constructor(f,$,P){super(P);Error.captureStackTrace(this,this.constructor),this.name=this.constructor.name,this.code=$,this.exitCode=f,this.nestedError=void 0}}class qf extends Yf{constructor(f){super(1,"commander.invalidArgument",f);Error.captureStackTrace(this,this.constructor),this.name=this.constructor.name}}v0.CommanderError=Yf;v0.InvalidArgumentError=qf});var i=H((g0)=>{var{InvalidArgumentError:h0}=k();class wf{constructor(f,$){switch(this.description=$||"",this.variadic=!1,this.parseArg=void 0,this.defaultValue=void 0,this.defaultValueDescription=void 0,this.argChoices=void 0,f[0]){case"<":this.required=!0,this._name=f.slice(1,-1);break;case"[":this.required=!1,this._name=f.slice(1,-1);break;default:this.required=!0,this._name=f;break}if(this._name.length>3&&this._name.slice(-3)==="...")this.variadic=!0,this._name=this._name.slice(0,-3)}name(){return this._name}_concatValue(f,$){if($===this.defaultValue||!Array.isArray($))return[f];return $.concat(f)}default(f,$){return this.defaultValue=f,this.defaultValueDescription=$,this}argParser(f){return this.parseArg=f,this}choices(f){return this.argChoices=f.slice(),this.parseArg=($,P)=>{if(!this.argChoices.includes($))throw new h0(`Allowed choices are ${this.argChoices.join(", ")}.`);if(this.variadic)return this._concatValue($,P);return $},this}argRequired(){return this.required=!0,this}argOptional(){return this.required=!1,this}}function c0(f){let $=f.name()+(f.variadic===!0?"...":"");return f.required?"<"+$+">":"["+$+"]"}g0.Argument=wf;g0.humanReadableArgName=c0});var Sf=H((t0)=>{var{humanReadableArgName:m0}=i();class Af{constructor(){this.helpWidth=void 0,this.sortSubcommands=!1,this.sortOptions=!1,this.showGlobalOptions=!1}visibleCommands(f){let $=f.commands.filter((z)=>!z._hidden),P=f._getHelpCommand();if(P&&!P._hidden)$.push(P);if(this.sortSubcommands)$.sort((z,E)=>{return z.name().localeCompare(E.name())});return $}compareOptions(f,$){let P=(z)=>{return z.short?z.short.replace(/^-/,""):z.long.replace(/^--/,"")};return P(f).localeCompare(P($))}visibleOptions(f){let $=f.options.filter((z)=>!z.hidden),P=f._getHelpOption();if(P&&!P.hidden){let z=P.short&&f._findOption(P.short),E=P.long&&f._findOption(P.long);if(!z&&!E)$.push(P);else if(P.long&&!E)$.push(f.createOption(P.long,P.description));else if(P.short&&!z)$.push(f.createOption(P.short,P.description))}if(this.sortOptions)$.sort(this.compareOptions);return $}visibleGlobalOptions(f){if(!this.showGlobalOptions)return[];let $=[];for(let P=f.parent;P;P=P.parent){let z=P.options.filter((E)=>!E.hidden);$.push(...z)}if(this.sortOptions)$.sort(this.compareOptions);return $}visibleArguments(f){if(f._argsDescription)f.registeredArguments.forEach(($)=>{$.description=$.description||f._argsDescription[$.name()]||""});if(f.registeredArguments.find(($)=>$.description))return f.registeredArguments;return[]}subcommandTerm(f){let $=f.registeredArguments.map((P)=>m0(P)).join(" ");return f._name+(f._aliases[0]?"|"+f._aliases[0]:"")+(f.options.length?" [options]":"")+($?" "+$:"")}optionTerm(f){return f.flags}argumentTerm(f){return f.name()}longestSubcommandTermLength(f,$){return $.visibleCommands(f).reduce((P,z)=>{return Math.max(P,$.subcommandTerm(z).length)},0)}longestOptionTermLength(f,$){return $.visibleOptions(f).reduce((P,z)=>{return Math.max(P,$.optionTerm(z).length)},0)}longestGlobalOptionTermLength(f,$){return $.visibleGlobalOptions(f).reduce((P,z)=>{return Math.max(P,$.optionTerm(z).length)},0)}longestArgumentTermLength(f,$){return $.visibleArguments(f).reduce((P,z)=>{return Math.max(P,$.argumentTerm(z).length)},0)}commandUsage(f){let $=f._name;if(f._aliases[0])$=$+"|"+f._aliases[0];let P="";for(let z=f.parent;z;z=z.parent)P=z.name()+" "+P;return P+$+" "+f.usage()}commandDescription(f){return f.description()}subcommandDescription(f){return f.summary()||f.description()}optionDescription(f){let $=[];if(f.argChoices)$.push(`choices: ${f.argChoices.map((P)=>JSON.stringify(P)).join(", ")}`);if(f.defaultValue!==void 0){if(f.required||f.optional||f.isBoolean()&&typeof f.defaultValue==="boolean")$.push(`default: ${f.defaultValueDescription||JSON.stringify(f.defaultValue)}`)}if(f.presetArg!==void 0&&f.optional)$.push(`preset: ${JSON.stringify(f.presetArg)}`);if(f.envVar!==void 0)$.push(`env: ${f.envVar}`);if($.length>0)return`${f.description} (${$.join(", ")})`;return f.description}argumentDescription(f){let $=[];if(f.argChoices)$.push(`choices: ${f.argChoices.map((P)=>JSON.stringify(P)).join(", ")}`);if(f.defaultValue!==void 0)$.push(`default: ${f.defaultValueDescription||JSON.stringify(f.defaultValue)}`);if($.length>0){let P=`(${$.join(", ")})`;if(f.description)return`${f.description} ${P}`;return P}return f.description}formatHelp(f,$){let P=$.padWidth(f,$),z=$.helpWidth||80,E=2,Q=2;function Y(W,M){if(M){let L=`${W.padEnd(P+2)}${M}`;return $.wrap(L,z-2,P+2)}return W}function J(W){return W.join(`
`).replace(/^/gm," ".repeat(2))}let S=[`Usage: ${$.commandUsage(f)}`,""],X=$.commandDescription(f);if(X.length>0)S=S.concat([$.wrap(X,z,0),""]);let Z=$.visibleArguments(f).map((W)=>{return Y($.argumentTerm(W),$.argumentDescription(W))});if(Z.length>0)S=S.concat(["Arguments:",J(Z),""]);let N=$.visibleOptions(f).map((W)=>{return Y($.optionTerm(W),$.optionDescription(W))});if(N.length>0)S=S.concat(["Options:",J(N),""]);if(this.showGlobalOptions){let W=$.visibleGlobalOptions(f).map((M)=>{return Y($.optionTerm(M),$.optionDescription(M))});if(W.length>0)S=S.concat(["Global Options:",J(W),""])}let R=$.visibleCommands(f).map((W)=>{return Y($.subcommandTerm(W),$.subcommandDescription(W))});if(R.length>0)S=S.concat(["Commands:",J(R),""]);return S.join(`
`)}padWidth(f,$){return Math.max($.longestOptionTermLength(f,$),$.longestGlobalOptionTermLength(f,$),$.longestSubcommandTermLength(f,$),$.longestArgumentTermLength(f,$))}wrap(f,$,P,z=40){let Q=new RegExp(`[\\n][${" \\f\\t\\v\xA0\u1680\u2000-\u200A\u202F\u205F\u3000\uFEFF"}]+`);if(f.match(Q))return f;let Y=$-P;if(Y<z)return f;let J=f.slice(0,P),S=f.slice(P).replace(`\r
`,`
`),X=" ".repeat(P),N=`\\s${"\u200B"}`,R=new RegExp(`
|.{1,${Y-1}}([${N}]|$)|[^${N}]+?([${N}]|$)`,"g"),W=S.match(R)||[];return J+W.map((M,L)=>{if(M===`
`)return"";return(L>0?X:"")+M.trimEnd()}).join(`
`)}}t0.Help=Af});var Xf=H((o0)=>{var{InvalidArgumentError:d0}=k();class xf{constructor(f,$){this.flags=f,this.description=$||"",this.required=f.includes("<"),this.optional=f.includes("["),this.variadic=/\w\.\.\.[>\]]$/.test(f),this.mandatory=!1;let P=n0(f);if(this.short=P.shortFlag,this.long=P.longFlag,this.negate=!1,this.long)this.negate=this.long.startsWith("--no-");this.defaultValue=void 0,this.defaultValueDescription=void 0,this.presetArg=void 0,this.envVar=void 0,this.parseArg=void 0,this.hidden=!1,this.argChoices=void 0,this.conflictsWith=[],this.implied=void 0}default(f,$){return this.defaultValue=f,this.defaultValueDescription=$,this}preset(f){return this.presetArg=f,this}conflicts(f){return this.conflictsWith=this.conflictsWith.concat(f),this}implies(f){let $=f;if(typeof f==="string")$={[f]:!0};return this.implied=Object.assign(this.implied||{},$),this}env(f){return this.envVar=f,this}argParser(f){return this.parseArg=f,this}makeOptionMandatory(f=!0){return this.mandatory=!!f,this}hideHelp(f=!0){return this.hidden=!!f,this}_concatValue(f,$){if($===this.defaultValue||!Array.isArray($))return[f];return $.concat(f)}choices(f){return this.argChoices=f.slice(),this.parseArg=($,P)=>{if(!this.argChoices.includes($))throw new d0(`Allowed choices are ${this.argChoices.join(", ")}.`);if(this.variadic)return this._concatValue($,P);return $},this}name(){if(this.long)return this.long.replace(/^--/,"");return this.short.replace(/^-/,"")}attributeName(){return p0(this.name().replace(/^no-/,""))}is(f){return this.short===f||this.long===f}isBoolean(){return!this.required&&!this.optional&&!this.negate}}class bf{constructor(f){this.positiveOptions=new Map,this.negativeOptions=new Map,this.dualOptions=new Set,f.forEach(($)=>{if($.negate)this.negativeOptions.set($.attributeName(),$);else this.positiveOptions.set($.attributeName(),$)}),this.negativeOptions.forEach(($,P)=>{if(this.positiveOptions.has(P))this.dualOptions.add(P)})}valueFromOption(f,$){let P=$.attributeName();if(!this.dualOptions.has(P))return!0;let z=this.negativeOptions.get(P).presetArg,E=z!==void 0?z:!1;return $.negate===(E===f)}}function p0(f){return f.split("-").reduce(($,P)=>{return $+P[0].toUpperCase()+P.slice(1)})}function n0(f){let $,P,z=f.split(/[ |,]+/);if(z.length>1&&!/^[[<]/.test(z[1]))$=z.shift();if(P=z.shift(),!$&&/^-[^-]$/.test(P))$=P,P=void 0;return{shortFlag:$,longFlag:P}}o0.Option=xf;o0.DualOptions=bf});var Of=H((P1)=>{function f1(f,$){if(Math.abs(f.length-$.length)>3)return Math.max(f.length,$.length);let P=[];for(let z=0;z<=f.length;z++)P[z]=[z];for(let z=0;z<=$.length;z++)P[0][z]=z;for(let z=1;z<=$.length;z++)for(let E=1;E<=f.length;E++){let Q=1;if(f[E-1]===$[z-1])Q=0;else Q=1;if(P[E][z]=Math.min(P[E-1][z]+1,P[E][z-1]+1,P[E-1][z-1]+Q),E>1&&z>1&&f[E-1]===$[z-2]&&f[E-2]===$[z-1])P[E][z]=Math.min(P[E][z],P[E-2][z-2]+1)}return P[f.length][$.length]}function $1(f,$){if(!$||$.length===0)return"";$=Array.from(new Set($));let P=f.startsWith("--");if(P)f=f.slice(2),$=$.map((Y)=>Y.slice(2));let z=[],E=3,Q=0.4;if($.forEach((Y)=>{if(Y.length<=1)return;let J=f1(f,Y),S=Math.max(f.length,Y.length);if((S-J)/S>Q){if(J<E)E=J,z=[Y];else if(J===E)z.push(Y)}}),z.sort((Y,J)=>Y.localeCompare(J)),P)z=z.map((Y)=>`--${Y}`);if(z.length>1)return`
(Did you mean one of ${z.join(", ")}?)`;if(z.length===1)return`
(Did you mean ${z[0]}?)`;return""}P1.suggestSimilar=$1});var vf=H((X1)=>{var E1=C("events").EventEmitter,Zf=C("child_process"),_=C("path"),Nf=C("fs"),T=C("process"),{Argument:Q1,humanReadableArgName:J1}=i(),{CommanderError:Wf}=k(),{Help:Y1}=Sf(),{Option:yf,DualOptions:S1}=Xf(),{suggestSimilar:Cf}=Of();class Rf extends E1{constructor(f){super();this.commands=[],this.options=[],this.parent=null,this._allowUnknownOption=!1,this._allowExcessArguments=!0,this.registeredArguments=[],this._args=this.registeredArguments,this.args=[],this.rawArgs=[],this.processedArgs=[],this._scriptPath=null,this._name=f||"",this._optionValues={},this._optionValueSources={},this._storeOptionsAsProperties=!1,this._actionHandler=null,this._executableHandler=!1,this._executableFile=null,this._executableDir=null,this._defaultCommandName=null,this._exitCallback=null,this._aliases=[],this._combineFlagAndOptionalValue=!0,this._description="",this._summary="",this._argsDescription=void 0,this._enablePositionalOptions=!1,this._passThroughOptions=!1,this._lifeCycleHooks={},this._showHelpAfterError=!1,this._showSuggestionAfterError=!0,this._outputConfiguration={writeOut:($)=>T.stdout.write($),writeErr:($)=>T.stderr.write($),getOutHelpWidth:()=>T.stdout.isTTY?T.stdout.columns:void 0,getErrHelpWidth:()=>T.stderr.isTTY?T.stderr.columns:void 0,outputError:($,P)=>P($)},this._hidden=!1,this._helpOption=void 0,this._addImplicitHelpCommand=void 0,this._helpCommand=void 0,this._helpConfiguration={}}copyInheritedSettings(f){return this._outputConfiguration=f._outputConfiguration,this._helpOption=f._helpOption,this._helpCommand=f._helpCommand,this._helpConfiguration=f._helpConfiguration,this._exitCallback=f._exitCallback,this._storeOptionsAsProperties=f._storeOptionsAsProperties,this._combineFlagAndOptionalValue=f._combineFlagAndOptionalValue,this._allowExcessArguments=f._allowExcessArguments,this._enablePositionalOptions=f._enablePositionalOptions,this._showHelpAfterError=f._showHelpAfterError,this._showSuggestionAfterError=f._showSuggestionAfterError,this}_getCommandAndAncestors(){let f=[];for(let $=this;$;$=$.parent)f.push($);return f}command(f,$,P){let z=$,E=P;if(typeof z==="object"&&z!==null)E=z,z=null;E=E||{};let[,Q,Y]=f.match(/([^ ]+) *(.*)/),J=this.createCommand(Q);if(z)J.description(z),J._executableHandler=!0;if(E.isDefault)this._defaultCommandName=J._name;if(J._hidden=!!(E.noHelp||E.hidden),J._executableFile=E.executableFile||null,Y)J.arguments(Y);if(this._registerCommand(J),J.parent=this,J.copyInheritedSettings(this),z)return this;return J}createCommand(f){return new Rf(f)}createHelp(){return Object.assign(new Y1,this.configureHelp())}configureHelp(f){if(f===void 0)return this._helpConfiguration;return this._helpConfiguration=f,this}configureOutput(f){if(f===void 0)return this._outputConfiguration;return Object.assign(this._outputConfiguration,f),this}showHelpAfterError(f=!0){if(typeof f!=="string")f=!!f;return this._showHelpAfterError=f,this}showSuggestionAfterError(f=!0){return this._showSuggestionAfterError=!!f,this}addCommand(f,$){if(!f._name)throw Error(`Command passed to .addCommand() must have a name
- specify the name in Command constructor or using .name()`);if($=$||{},$.isDefault)this._defaultCommandName=f._name;if($.noHelp||$.hidden)f._hidden=!0;return this._registerCommand(f),f.parent=this,f._checkForBrokenPassThrough(),this}createArgument(f,$){return new Q1(f,$)}argument(f,$,P,z){let E=this.createArgument(f,$);if(typeof P==="function")E.default(z).argParser(P);else E.default(P);return this.addArgument(E),this}arguments(f){return f.trim().split(/ +/).forEach(($)=>{this.argument($)}),this}addArgument(f){let $=this.registeredArguments.slice(-1)[0];if($&&$.variadic)throw Error(`only the last argument can be variadic '${$.name()}'`);if(f.required&&f.defaultValue!==void 0&&f.parseArg===void 0)throw Error(`a default value for a required argument is never used: '${f.name()}'`);return this.registeredArguments.push(f),this}helpCommand(f,$){if(typeof f==="boolean")return this._addImplicitHelpCommand=f,this;f=f??"help [command]";let[,P,z]=f.match(/([^ ]+) *(.*)/),E=$??"display help for command",Q=this.createCommand(P);if(Q.helpOption(!1),z)Q.arguments(z);if(E)Q.description(E);return this._addImplicitHelpCommand=!0,this._helpCommand=Q,this}addHelpCommand(f,$){if(typeof f!=="object")return this.helpCommand(f,$),this;return this._addImplicitHelpCommand=!0,this._helpCommand=f,this}_getHelpCommand(){if(this._addImplicitHelpCommand??(this.commands.length&&!this._actionHandler&&!this._findCommand("help"))){if(this._helpCommand===void 0)this.helpCommand(void 0,void 0);return this._helpCommand}return null}hook(f,$){let P=["preSubcommand","preAction","postAction"];if(!P.includes(f))throw Error(`Unexpected value for event passed to hook : '${f}'.
Expecting one of '${P.join("', '")}'`);if(this._lifeCycleHooks[f])this._lifeCycleHooks[f].push($);else this._lifeCycleHooks[f]=[$];return this}exitOverride(f){if(f)this._exitCallback=f;else this._exitCallback=($)=>{if($.code!=="commander.executeSubCommandAsync")throw $};return this}_exit(f,$,P){if(this._exitCallback)this._exitCallback(new Wf(f,$,P));T.exit(f)}action(f){let $=(P)=>{let z=this.registeredArguments.length,E=P.slice(0,z);if(this._storeOptionsAsProperties)E[z]=this;else E[z]=this.opts();return E.push(this),f.apply(this,E)};return this._actionHandler=$,this}createOption(f,$){return new yf(f,$)}_callParseArg(f,$,P,z){try{return f.parseArg($,P)}catch(E){if(E.code==="commander.invalidArgument"){let Q=`${z} ${E.message}`;this.error(Q,{exitCode:E.exitCode,code:E.code})}throw E}}_registerOption(f){let $=f.short&&this._findOption(f.short)||f.long&&this._findOption(f.long);if($){let P=f.long&&this._findOption(f.long)?f.long:f.short;throw Error(`Cannot add option '${f.flags}'${this._name&&` to command '${this._name}'`} due to conflicting flag '${P}'
-  already used by option '${$.flags}'`)}this.options.push(f)}_registerCommand(f){let $=(z)=>{return[z.name()].concat(z.aliases())},P=$(f).find((z)=>this._findCommand(z));if(P){let z=$(this._findCommand(P)).join("|"),E=$(f).join("|");throw Error(`cannot add command '${E}' as already have command '${z}'`)}this.commands.push(f)}addOption(f){this._registerOption(f);let $=f.name(),P=f.attributeName();if(f.negate){let E=f.long.replace(/^--no-/,"--");if(!this._findOption(E))this.setOptionValueWithSource(P,f.defaultValue===void 0?!0:f.defaultValue,"default")}else if(f.defaultValue!==void 0)this.setOptionValueWithSource(P,f.defaultValue,"default");let z=(E,Q,Y)=>{if(E==null&&f.presetArg!==void 0)E=f.presetArg;let J=this.getOptionValue(P);if(E!==null&&f.parseArg)E=this._callParseArg(f,E,J,Q);else if(E!==null&&f.variadic)E=f._concatValue(E,J);if(E==null)if(f.negate)E=!1;else if(f.isBoolean()||f.optional)E=!0;else E="";this.setOptionValueWithSource(P,E,Y)};if(this.on("option:"+$,(E)=>{let Q=`error: option '${f.flags}' argument '${E}' is invalid.`;z(E,Q,"cli")}),f.envVar)this.on("optionEnv:"+$,(E)=>{let Q=`error: option '${f.flags}' value '${E}' from env '${f.envVar}' is invalid.`;z(E,Q,"env")});return this}_optionEx(f,$,P,z,E){if(typeof $==="object"&&$ instanceof yf)throw Error("To add an Option object use addOption() instead of option() or requiredOption()");let Q=this.createOption($,P);if(Q.makeOptionMandatory(!!f.mandatory),typeof z==="function")Q.default(E).argParser(z);else if(z instanceof RegExp){let Y=z;z=(J,S)=>{let X=Y.exec(J);return X?X[0]:S},Q.default(E).argParser(z)}else Q.default(z);return this.addOption(Q)}option(f,$,P,z){return this._optionEx({},f,$,P,z)}requiredOption(f,$,P,z){return this._optionEx({mandatory:!0},f,$,P,z)}combineFlagAndOptionalValue(f=!0){return this._combineFlagAndOptionalValue=!!f,this}allowUnknownOption(f=!0){return this._allowUnknownOption=!!f,this}allowExcessArguments(f=!0){return this._allowExcessArguments=!!f,this}enablePositionalOptions(f=!0){return this._enablePositionalOptions=!!f,this}passThroughOptions(f=!0){return this._passThroughOptions=!!f,this._checkForBrokenPassThrough(),this}_checkForBrokenPassThrough(){if(this.parent&&this._passThroughOptions&&!this.parent._enablePositionalOptions)throw Error(`passThroughOptions cannot be used for '${this._name}' without turning on enablePositionalOptions for parent command(s)`)}storeOptionsAsProperties(f=!0){if(this.options.length)throw Error("call .storeOptionsAsProperties() before adding options");if(Object.keys(this._optionValues).length)throw Error("call .storeOptionsAsProperties() before setting option values");return this._storeOptionsAsProperties=!!f,this}getOptionValue(f){if(this._storeOptionsAsProperties)return this[f];return this._optionValues[f]}setOptionValue(f,$){return this.setOptionValueWithSource(f,$,void 0)}setOptionValueWithSource(f,$,P){if(this._storeOptionsAsProperties)this[f]=$;else this._optionValues[f]=$;return this._optionValueSources[f]=P,this}getOptionValueSource(f){return this._optionValueSources[f]}getOptionValueSourceWithGlobals(f){let $;return this._getCommandAndAncestors().forEach((P)=>{if(P.getOptionValueSource(f)!==void 0)$=P.getOptionValueSource(f)}),$}_prepareUserArgs(f,$){if(f!==void 0&&!Array.isArray(f))throw Error("first parameter to parse must be array or undefined");if($=$||{},f===void 0&&$.from===void 0){if(T.versions?.electron)$.from="electron";let z=T.execArgv??[];if(z.includes("-e")||z.includes("--eval")||z.includes("-p")||z.includes("--print"))$.from="eval"}if(f===void 0)f=T.argv;this.rawArgs=f.slice();let P;switch($.from){case void 0:case"node":this._scriptPath=f[1],P=f.slice(2);break;case"electron":if(T.defaultApp)this._scriptPath=f[1],P=f.slice(2);else P=f.slice(1);break;case"user":P=f.slice(0);break;case"eval":P=f.slice(1);break;default:throw Error(`unexpected parse option { from: '${$.from}' }`)}if(!this._name&&this._scriptPath)this.nameFromFilename(this._scriptPath);return this._name=this._name||"program",P}parse(f,$){let P=this._prepareUserArgs(f,$);return this._parseCommand([],P),this}async parseAsync(f,$){let P=this._prepareUserArgs(f,$);return await this._parseCommand([],P),this}_executeSubCommand(f,$){$=$.slice();let P=!1,z=[".js",".ts",".tsx",".mjs",".cjs"];function E(X,Z){let N=_.resolve(X,Z);if(Nf.existsSync(N))return N;if(z.includes(_.extname(Z)))return;let R=z.find((W)=>Nf.existsSync(`${N}${W}`));if(R)return`${N}${R}`;return}this._checkForMissingMandatoryOptions(),this._checkForConflictingOptions();let Q=f._executableFile||`${this._name}-${f._name}`,Y=this._executableDir||"";if(this._scriptPath){let X;try{X=Nf.realpathSync(this._scriptPath)}catch(Z){X=this._scriptPath}Y=_.resolve(_.dirname(X),Y)}if(Y){let X=E(Y,Q);if(!X&&!f._executableFile&&this._scriptPath){let Z=_.basename(this._scriptPath,_.extname(this._scriptPath));if(Z!==this._name)X=E(Y,`${Z}-${f._name}`)}Q=X||Q}P=z.includes(_.extname(Q));let J;if(T.platform!=="win32")if(P)$.unshift(Q),$=kf(T.execArgv).concat($),J=Zf.spawn(T.argv[0],$,{stdio:"inherit"});else J=Zf.spawn(Q,$,{stdio:"inherit"});else $.unshift(Q),$=kf(T.execArgv).concat($),J=Zf.spawn(T.execPath,$,{stdio:"inherit"});if(!J.killed)["SIGUSR1","SIGUSR2","SIGTERM","SIGINT","SIGHUP"].forEach((Z)=>{T.on(Z,()=>{if(J.killed===!1&&J.exitCode===null)J.kill(Z)})});let S=this._exitCallback;J.on("close",(X)=>{if(X=X??1,!S)T.exit(X);else S(new Wf(X,"commander.executeSubCommandAsync","(close)"))}),J.on("error",(X)=>{if(X.code==="ENOENT"){let Z=Y?`searched for local subcommand relative to directory '${Y}'`:"no directory for search for local subcommand, use .executableDir() to supply a custom directory",N=`'${Q}' does not exist
 - if '${f._name}' is not meant to be an executable command, remove description parameter from '.command()' and use '.description()' instead
 - if the default executable name is not suitable, use the executableFile option to supply a custom name or path
 - ${Z}`;throw Error(N)}else if(X.code==="EACCES")throw Error(`'${Q}' not executable`);if(!S)T.exit(1);else{let Z=new Wf(1,"commander.executeSubCommandAsync","(error)");Z.nestedError=X,S(Z)}}),this.runningCommand=J}_dispatchSubcommand(f,$,P){let z=this._findCommand(f);if(!z)this.help({error:!0});let E;return E=this._chainOrCallSubCommandHook(E,z,"preSubcommand"),E=this._chainOrCall(E,()=>{if(z._executableHandler)this._executeSubCommand(z,$.concat(P));else return z._parseCommand($,P)}),E}_dispatchHelpCommand(f){if(!f)this.help();let $=this._findCommand(f);if($&&!$._executableHandler)$.help();return this._dispatchSubcommand(f,[],[this._getHelpOption()?.long??this._getHelpOption()?.short??"--help"])}_checkNumberOfArguments(){if(this.registeredArguments.forEach((f,$)=>{if(f.required&&this.args[$]==null)this.missingArgument(f.name())}),this.registeredArguments.length>0&&this.registeredArguments[this.registeredArguments.length-1].variadic)return;if(this.args.length>this.registeredArguments.length)this._excessArguments(this.args)}_processArguments(){let f=(P,z,E)=>{let Q=z;if(z!==null&&P.parseArg){let Y=`error: command-argument value '${z}' is invalid for argument '${P.name()}'.`;Q=this._callParseArg(P,z,E,Y)}return Q};this._checkNumberOfArguments();let $=[];this.registeredArguments.forEach((P,z)=>{let E=P.defaultValue;if(P.variadic){if(z<this.args.length){if(E=this.args.slice(z),P.parseArg)E=E.reduce((Q,Y)=>{return f(P,Y,Q)},P.defaultValue)}else if(E===void 0)E=[]}else if(z<this.args.length){if(E=this.args[z],P.parseArg)E=f(P,E,P.defaultValue)}$[z]=E}),this.processedArgs=$}_chainOrCall(f,$){if(f&&f.then&&typeof f.then==="function")return f.then(()=>$());return $()}_chainOrCallHooks(f,$){let P=f,z=[];if(this._getCommandAndAncestors().reverse().filter((E)=>E._lifeCycleHooks[$]!==void 0).forEach((E)=>{E._lifeCycleHooks[$].forEach((Q)=>{z.push({hookedCommand:E,callback:Q})})}),$==="postAction")z.reverse();return z.forEach((E)=>{P=this._chainOrCall(P,()=>{return E.callback(E.hookedCommand,this)})}),P}_chainOrCallSubCommandHook(f,$,P){let z=f;if(this._lifeCycleHooks[P]!==void 0)this._lifeCycleHooks[P].forEach((E)=>{z=this._chainOrCall(z,()=>{return E(this,$)})});return z}_parseCommand(f,$){let P=this.parseOptions($);if(this._parseOptionsEnv(),this._parseOptionsImplied(),f=f.concat(P.operands),$=P.unknown,this.args=f.concat($),f&&this._findCommand(f[0]))return this._dispatchSubcommand(f[0],f.slice(1),$);if(this._getHelpCommand()&&f[0]===this._getHelpCommand().name())return this._dispatchHelpCommand(f[1]);if(this._defaultCommandName)return this._outputHelpIfRequested($),this._dispatchSubcommand(this._defaultCommandName,f,$);if(this.commands.length&&this.args.length===0&&!this._actionHandler&&!this._defaultCommandName)this.help({error:!0});this._outputHelpIfRequested(P.unknown),this._checkForMissingMandatoryOptions(),this._checkForConflictingOptions();let z=()=>{if(P.unknown.length>0)this.unknownOption(P.unknown[0])},E=`command:${this.name()}`;if(this._actionHandler){z(),this._processArguments();let Q;if(Q=this._chainOrCallHooks(Q,"preAction"),Q=this._chainOrCall(Q,()=>this._actionHandler(this.processedArgs)),this.parent)Q=this._chainOrCall(Q,()=>{this.parent.emit(E,f,$)});return Q=this._chainOrCallHooks(Q,"postAction"),Q}if(this.parent&&this.parent.listenerCount(E))z(),this._processArguments(),this.parent.emit(E,f,$);else if(f.length){if(this._findCommand("*"))return this._dispatchSubcommand("*",f,$);if(this.listenerCount("command:*"))this.emit("command:*",f,$);else if(this.commands.length)this.unknownCommand();else z(),this._processArguments()}else if(this.commands.length)z(),this.help({error:!0});else z(),this._processArguments()}_findCommand(f){if(!f)return;return this.commands.find(($)=>$._name===f||$._aliases.includes(f))}_findOption(f){return this.options.find(($)=>$.is(f))}_checkForMissingMandatoryOptions(){this._getCommandAndAncestors().forEach((f)=>{f.options.forEach(($)=>{if($.mandatory&&f.getOptionValue($.attributeName())===void 0)f.missingMandatoryOptionValue($)})})}_checkForConflictingLocalOptions(){let f=this.options.filter((P)=>{let z=P.attributeName();if(this.getOptionValue(z)===void 0)return!1;return this.getOptionValueSource(z)!=="default"});f.filter((P)=>P.conflictsWith.length>0).forEach((P)=>{let z=f.find((E)=>P.conflictsWith.includes(E.attributeName()));if(z)this._conflictingOption(P,z)})}_checkForConflictingOptions(){this._getCommandAndAncestors().forEach((f)=>{f._checkForConflictingLocalOptions()})}parseOptions(f){let $=[],P=[],z=$,E=f.slice();function Q(J){return J.length>1&&J[0]==="-"}let Y=null;while(E.length){let J=E.shift();if(J==="--"){if(z===P)z.push(J);z.push(...E);break}if(Y&&!Q(J)){this.emit(`option:${Y.name()}`,J);continue}if(Y=null,Q(J)){let S=this._findOption(J);if(S){if(S.required){let X=E.shift();if(X===void 0)this.optionMissingArgument(S);this.emit(`option:${S.name()}`,X)}else if(S.optional){let X=null;if(E.length>0&&!Q(E[0]))X=E.shift();this.emit(`option:${S.name()}`,X)}else this.emit(`option:${S.name()}`);Y=S.variadic?S:null;continue}}if(J.length>2&&J[0]==="-"&&J[1]!=="-"){let S=this._findOption(`-${J[1]}`);if(S){if(S.required||S.optional&&this._combineFlagAndOptionalValue)this.emit(`option:${S.name()}`,J.slice(2));else this.emit(`option:${S.name()}`),E.unshift(`-${J.slice(2)}`);continue}}if(/^--[^=]+=/.test(J)){let S=J.indexOf("="),X=this._findOption(J.slice(0,S));if(X&&(X.required||X.optional)){this.emit(`option:${X.name()}`,J.slice(S+1));continue}}if(Q(J))z=P;if((this._enablePositionalOptions||this._passThroughOptions)&&$.length===0&&P.length===0){if(this._findCommand(J)){if($.push(J),E.length>0)P.push(...E);break}else if(this._getHelpCommand()&&J===this._getHelpCommand().name()){if($.push(J),E.length>0)$.push(...E);break}else if(this._defaultCommandName){if(P.push(J),E.length>0)P.push(...E);break}}if(this._passThroughOptions){if(z.push(J),E.length>0)z.push(...E);break}z.push(J)}return{operands:$,unknown:P}}opts(){if(this._storeOptionsAsProperties){let f={},$=this.options.length;for(let P=0;P<$;P++){let z=this.options[P].attributeName();f[z]=z===this._versionOptionName?this._version:this[z]}return f}return this._optionValues}optsWithGlobals(){return this._getCommandAndAncestors().reduce((f,$)=>Object.assign(f,$.opts()),{})}error(f,$){if(this._outputConfiguration.outputError(`${f}
`,this._outputConfiguration.writeErr),typeof this._showHelpAfterError==="string")this._outputConfiguration.writeErr(`${this._showHelpAfterError}
`);else if(this._showHelpAfterError)this._outputConfiguration.writeErr(`
`),this.outputHelp({error:!0});let P=$||{},z=P.exitCode||1,E=P.code||"commander.error";this._exit(z,E,f)}_parseOptionsEnv(){this.options.forEach((f)=>{if(f.envVar&&f.envVar in T.env){let $=f.attributeName();if(this.getOptionValue($)===void 0||["default","config","env"].includes(this.getOptionValueSource($)))if(f.required||f.optional)this.emit(`optionEnv:${f.name()}`,T.env[f.envVar]);else this.emit(`optionEnv:${f.name()}`)}})}_parseOptionsImplied(){let f=new S1(this.options),$=(P)=>{return this.getOptionValue(P)!==void 0&&!["default","implied"].includes(this.getOptionValueSource(P))};this.options.filter((P)=>P.implied!==void 0&&$(P.attributeName())&&f.valueFromOption(this.getOptionValue(P.attributeName()),P)).forEach((P)=>{Object.keys(P.implied).filter((z)=>!$(z)).forEach((z)=>{this.setOptionValueWithSource(z,P.implied[z],"implied")})})}missingArgument(f){let $=`error: missing required argument '${f}'`;this.error($,{code:"commander.missingArgument"})}optionMissingArgument(f){let $=`error: option '${f.flags}' argument missing`;this.error($,{code:"commander.optionMissingArgument"})}missingMandatoryOptionValue(f){let $=`error: required option '${f.flags}' not specified`;this.error($,{code:"commander.missingMandatoryOptionValue"})}_conflictingOption(f,$){let P=(Q)=>{let Y=Q.attributeName(),J=this.getOptionValue(Y),S=this.options.find((Z)=>Z.negate&&Y===Z.attributeName()),X=this.options.find((Z)=>!Z.negate&&Y===Z.attributeName());if(S&&(S.presetArg===void 0&&J===!1||S.presetArg!==void 0&&J===S.presetArg))return S;return X||Q},z=(Q)=>{let Y=P(Q),J=Y.attributeName();if(this.getOptionValueSource(J)==="env")return`environment variable '${Y.envVar}'`;return`option '${Y.flags}'`},E=`error: ${z(f)} cannot be used with ${z($)}`;this.error(E,{code:"commander.conflictingOption"})}unknownOption(f){if(this._allowUnknownOption)return;let $="";if(f.startsWith("--")&&this._showSuggestionAfterError){let z=[],E=this;do{let Q=E.createHelp().visibleOptions(E).filter((Y)=>Y.long).map((Y)=>Y.long);z=z.concat(Q),E=E.parent}while(E&&!E._enablePositionalOptions);$=Cf(f,z)}let P=`error: unknown option '${f}'${$}`;this.error(P,{code:"commander.unknownOption"})}_excessArguments(f){if(this._allowExcessArguments)return;let $=this.registeredArguments.length,P=$===1?"":"s",E=`error: too many arguments${this.parent?` for '${this.name()}'`:""}. Expected ${$} argument${P} but got ${f.length}.`;this.error(E,{code:"commander.excessArguments"})}unknownCommand(){let f=this.args[0],$="";if(this._showSuggestionAfterError){let z=[];this.createHelp().visibleCommands(this).forEach((E)=>{if(z.push(E.name()),E.alias())z.push(E.alias())}),$=Cf(f,z)}let P=`error: unknown command '${f}'${$}`;this.error(P,{code:"commander.unknownCommand"})}version(f,$,P){if(f===void 0)return this._version;this._version=f,$=$||"-V, --version",P=P||"output the version number";let z=this.createOption($,P);return this._versionOptionName=z.attributeName(),this._registerOption(z),this.on("option:"+z.name(),()=>{this._outputConfiguration.writeOut(`${f}
`),this._exit(0,"commander.version",f)}),this}description(f,$){if(f===void 0&&$===void 0)return this._description;if(this._description=f,$)this._argsDescription=$;return this}summary(f){if(f===void 0)return this._summary;return this._summary=f,this}alias(f){if(f===void 0)return this._aliases[0];let $=this;if(this.commands.length!==0&&this.commands[this.commands.length-1]._executableHandler)$=this.commands[this.commands.length-1];if(f===$._name)throw Error("Command alias can't be the same as its name");let P=this.parent?._findCommand(f);if(P){let z=[P.name()].concat(P.aliases()).join("|");throw Error(`cannot add alias '${f}' to command '${this.name()}' as already have command '${z}'`)}return $._aliases.push(f),this}aliases(f){if(f===void 0)return this._aliases;return f.forEach(($)=>this.alias($)),this}usage(f){if(f===void 0){if(this._usage)return this._usage;let $=this.registeredArguments.map((P)=>{return J1(P)});return[].concat(this.options.length||this._helpOption!==null?"[options]":[],this.commands.length?"[command]":[],this.registeredArguments.length?$:[]).join(" ")}return this._usage=f,this}name(f){if(f===void 0)return this._name;return this._name=f,this}nameFromFilename(f){return this._name=_.basename(f,_.extname(f)),this}executableDir(f){if(f===void 0)return this._executableDir;return this._executableDir=f,this}helpInformation(f){let $=this.createHelp();if($.helpWidth===void 0)$.helpWidth=f&&f.error?this._outputConfiguration.getErrHelpWidth():this._outputConfiguration.getOutHelpWidth();return $.formatHelp(this,$)}_getHelpContext(f){f=f||{};let $={error:!!f.error},P;if($.error)P=(z)=>this._outputConfiguration.writeErr(z);else P=(z)=>this._outputConfiguration.writeOut(z);return $.write=f.write||P,$.command=this,$}outputHelp(f){let $;if(typeof f==="function")$=f,f=void 0;let P=this._getHelpContext(f);this._getCommandAndAncestors().reverse().forEach((E)=>E.emit("beforeAllHelp",P)),this.emit("beforeHelp",P);let z=this.helpInformation(P);if($){if(z=$(z),typeof z!=="string"&&!Buffer.isBuffer(z))throw Error("outputHelp callback must return a string or a Buffer")}if(P.write(z),this._getHelpOption()?.long)this.emit(this._getHelpOption().long);this.emit("afterHelp",P),this._getCommandAndAncestors().forEach((E)=>E.emit("afterAllHelp",P))}helpOption(f,$){if(typeof f==="boolean"){if(f)this._helpOption=this._helpOption??void 0;else this._helpOption=null;return this}return f=f??"-h, --help",$=$??"display help for command",this._helpOption=this.createOption(f,$),this}_getHelpOption(){if(this._helpOption===void 0)this.helpOption(void 0,void 0);return this._helpOption}addHelpOption(f){return this._helpOption=f,this}help(f){this.outputHelp(f);let $=T.exitCode||0;if($===0&&f&&typeof f!=="function"&&f.error)$=1;this._exit($,"commander.help","(outputHelp)")}addHelpText(f,$){let P=["beforeAll","before","after","afterAll"];if(!P.includes(f))throw Error(`Unexpected value for position to addHelpText.
Expecting one of '${P.join("', '")}'`);let z=`${f}Help`;return this.on(z,(E)=>{let Q;if(typeof $==="function")Q=$({error:E.error,command:E.command});else Q=$;if(Q)E.write(`${Q}
`)}),this}_outputHelpIfRequested(f){let $=this._getHelpOption();if($&&f.find((z)=>$.is(z)))this.outputHelp(),this._exit(0,"commander.helpDisplayed","(outputHelp)")}}function kf(f){return f.map(($)=>{if(!$.startsWith("--inspect"))return $;let P,z="127.0.0.1",E="9229",Q;if((Q=$.match(/^(--inspect(-brk)?)$/))!==null)P=Q[1];else if((Q=$.match(/^(--inspect(-brk|-port)?)=([^:]+)$/))!==null)if(P=Q[1],/^\d+$/.test(Q[3]))E=Q[3];else z=Q[3];else if((Q=$.match(/^(--inspect(-brk|-port)?)=([^:]+):(\d+)$/))!==null)P=Q[1],z=Q[3],E=Q[4];if(P&&E!=="0")return`${P}=${z}:${parseInt(E)+1}`;return $})}X1.Command=Rf});var cf=H((R1)=>{var{Argument:uf}=i(),{Command:Gf}=vf(),{CommanderError:N1,InvalidArgumentError:lf}=k(),{Help:W1}=Sf(),{Option:hf}=Xf();R1.program=new Gf;R1.createCommand=(f)=>new Gf(f);R1.createOption=(f,$)=>new hf(f,$);R1.createArgument=(f,$)=>new uf(f,$);R1.Command=Gf;R1.Option=hf;R1.Argument=uf;R1.Help=W1;R1.CommanderError=N1;R1.InvalidArgumentError=lf;R1.InvalidOptionArgumentError=lf});var gf=k0(cf(),1),{program:I,createCommand:Q$,createArgument:J$,createOption:Y$,CommanderError:S$,InvalidArgumentError:X$,InvalidOptionArgumentError:Z$,Command:N$,Argument:W$,Option:R$,Help:G$}=gf.default;import{Database as F1}from"bun:sqlite";import{existsSync as sf,mkdirSync as D1}from"fs";import{homedir as H1}from"os";import{join as mf}from"path";var m=process.env.WASP_DATA_DIR||mf(H1(),".wasp"),tf=mf(m,"wasp.db"),s=null;function Lf(){return m}function x(){return sf(tf)}function B(){if(!s){if(!sf(m))D1(m,{recursive:!0});s=new F1(tf),s.exec("PRAGMA journal_mode = WAL")}return s}function t(){B().exec(`
    CREATE TABLE IF NOT EXISTS contacts (
      id INTEGER PRIMARY KEY AUTOINCREMENT,
      identifier TEXT NOT NULL,
      platform TEXT NOT NULL DEFAULT 'whatsapp',
      name TEXT,
      trust TEXT NOT NULL DEFAULT 'trusted',
      added_at TEXT NOT NULL DEFAULT (datetime('now')),
      notes TEXT,
      UNIQUE(identifier, platform)
    );

    CREATE TABLE IF NOT EXISTS audit_log (
      id INTEGER PRIMARY KEY AUTOINCREMENT,
      timestamp TEXT NOT NULL DEFAULT (datetime('now')),
      identifier TEXT NOT NULL,
      platform TEXT NOT NULL,
      decision TEXT NOT NULL,
      reason TEXT
    );

    CREATE TABLE IF NOT EXISTS quarantine (
      id INTEGER PRIMARY KEY AUTOINCREMENT,
      identifier TEXT NOT NULL,
      platform TEXT NOT NULL DEFAULT 'whatsapp',
      message_preview TEXT,
      full_message TEXT,
      timestamp TEXT NOT NULL DEFAULT (datetime('now')),
      reviewed INTEGER NOT NULL DEFAULT 0
    );

    CREATE INDEX IF NOT EXISTS idx_contacts_identifier ON contacts(identifier);
    CREATE INDEX IF NOT EXISTS idx_audit_timestamp ON audit_log(timestamp);
    CREATE INDEX IF NOT EXISTS idx_quarantine_identifier ON quarantine(identifier);
    CREATE INDEX IF NOT EXISTS idx_quarantine_reviewed ON quarantine(reviewed);
  `)}function rf(f=!1){if(x()&&!f){console.log("wasp is already initialized."),console.log(`Data directory: ${Lf()}`),console.log("Use --force to reinitialize.");return}t(),console.log("wasp initialized successfully."),console.log(`Data directory: ${Lf()}`),console.log(""),console.log("Next steps:"),console.log('  wasp add "+440123456789" --name "Your Name" --trust sovereign'),console.log("  wasp list"),console.log("  wasp serve")}function q(f,$="whatsapp",P="trusted",z,E){let Q=B();Q.prepare(`
    INSERT INTO contacts (identifier, platform, trust, name, notes)
    VALUES (?, ?, ?, ?, ?)
    ON CONFLICT(identifier, platform) DO UPDATE SET
      trust = excluded.trust,
      name = COALESCE(excluded.name, contacts.name),
      notes = COALESCE(excluded.notes, contacts.notes)
  `).run(f,$,P,z||null,E||null);let J=Q.prepare("SELECT * FROM contacts WHERE identifier = ? AND platform = ?").get(f,$);return{id:J.id,identifier:J.identifier,platform:J.platform,name:J.name,trust:J.trust,addedAt:J.added_at,notes:J.notes}}function r(f,$="whatsapp"){return B().prepare("DELETE FROM contacts WHERE identifier = ? AND platform = ?").run(f,$).changes>0}function q1(f,$="whatsapp"){let E=B().prepare("SELECT * FROM contacts WHERE identifier = ? AND platform = ?").get(f,$);if(!E)return null;return{id:E.id,identifier:E.identifier,platform:E.platform,name:E.name,trust:E.trust,addedAt:E.added_at,notes:E.notes}}function d(f,$){let P=B(),z="SELECT * FROM contacts WHERE 1=1",E=[];if(f)z+=" AND platform = ?",E.push(f);if($)z+=" AND trust = ?",E.push($);return z+=" ORDER BY added_at DESC",P.prepare(z).all(...E).map((J)=>({id:J.id,identifier:J.identifier,platform:J.platform,name:J.name,trust:J.trust,addedAt:J.added_at,notes:J.notes}))}function p(f,$="whatsapp"){let P=q1(f,$);if(!P)return{allowed:!1,trust:null,name:null,reason:"Contact not in whitelist"};if(P.trust==="limited")return{allowed:!0,trust:"limited",name:P.name,reason:"Limited trust - agent may view but should not act"};return{allowed:!0,trust:P.trust,name:P.name,reason:"Contact is trusted"}}function df(f,$){let P=q(f,$.platform||"whatsapp",$.trust||"trusted",$.name,$.notes);if(console.log("Contact added/updated:"),console.log(`  Identifier: ${P.identifier}`),console.log(`  Platform:   ${P.platform}`),console.log(`  Trust:      ${P.trust}`),P.name)console.log(`  Name:       ${P.name}`);if(P.notes)console.log(`  Notes:      ${P.notes}`)}function pf(f,$="whatsapp"){if(r(f,$))console.log(`Removed: ${f} (${$})`);else console.log(`Not found: ${f} (${$})`)}function nf(f){let $=d(f.platform,f.trust);if($.length===0){console.log("No contacts found.");return}if(f.json){console.log(JSON.stringify($,null,2));return}console.log(`Found ${$.length} contact(s):
`);for(let P of $){let z=P.name?` (${P.name})`:"";if(console.log(`  ${P.identifier}${z}`),console.log(`    Platform: ${P.platform} | Trust: ${P.trust}`),P.notes)console.log(`    Notes: ${P.notes}`);console.log("")}}function n(f,$,P,z){B().prepare(`
    INSERT INTO audit_log (identifier, platform, decision, reason)
    VALUES (?, ?, ?, ?)
  `).run(f,$,P,z)}function b(f){let $=B(),P="SELECT * FROM audit_log WHERE 1=1",z=[];if(f.decision)P+=" AND decision = ?",z.push(f.decision);if(f.since)P+=" AND timestamp >= ?",z.push(f.since);if(P+=" ORDER BY timestamp DESC",f.limit)P+=" LIMIT ?",z.push(f.limit);return $.prepare(P).all(...z).map((Y)=>({id:Y.id,timestamp:Y.timestamp,identifier:Y.identifier,platform:Y.platform,decision:Y.decision,reason:Y.reason}))}function of(f,$){let P=$.platform||"whatsapp",z=p(f,P),E=!z.allowed?"deny":z.trust==="limited"?"limited":"allow";if(n(f,P,E,z.reason),$.json){console.log(JSON.stringify(z)),process.exit(z.allowed?0:1);return}if($.quiet){process.exit(z.allowed?0:1);return}if(z.allowed){let Q=z.name?` (${z.name})`:"";if(console.log(`ALLOWED: ${f}${Q}`),console.log(`  Trust level: ${z.trust}`),z.trust==="limited")console.log("  Note: Limited trust - agent may view but should not act")}else console.log(`DENIED: ${f}`),console.log(`  Reason: ${z.reason}`);process.exit(z.allowed?0:1)}function af(f){let $=b({limit:f.limit||50,decision:f.denied?"deny":void 0});if($.length===0){console.log("No audit entries found.");return}if(f.json){console.log(JSON.stringify($,null,2));return}console.log(`Last ${$.length} audit entries:
`);for(let P of $){let z=P.decision==="allow"?"\u2713":P.decision==="limited"?"~":"\u2717";console.log(`  ${z} ${P.timestamp} | ${P.identifier} (${P.platform})`),console.log(`    Decision: ${P.decision} - ${P.reason}`),console.log("")}}var Tf=(f,$,P)=>{return(z,E)=>{let Q=-1;return Y(0);async function Y(J){if(J<=Q)throw Error("next() called multiple times");Q=J;let S,X=!1,Z;if(f[J])Z=f[J][0][0],z.req.routeIndex=J;else Z=J===f.length&&E||void 0;if(Z)try{S=await Z(z,()=>Y(J+1))}catch(N){if(N instanceof Error&&$)z.error=N,S=await $(N,z),X=!0;else throw N}else if(z.finalized===!1&&P)S=await P(z);if(S&&(z.finalized===!1||X))z.res=S;return z}}};var ef=Symbol();var f0=async(f,$=Object.create(null))=>{let{all:P=!1,dot:z=!1}=$,Q=(f instanceof o?f.raw.headers:f.headers).get("Content-Type");if(Q?.startsWith("multipart/form-data")||Q?.startsWith("application/x-www-form-urlencoded"))return w1(f,{all:P,dot:z});return{}};async function w1(f,$){let P=await f.formData();if(P)return A1(P,$);return{}}function A1(f,$){let P=Object.create(null);if(f.forEach((z,E)=>{if(!($.all||E.endsWith("[]")))P[E]=z;else x1(P,E,z)}),$.dot)Object.entries(P).forEach(([z,E])=>{if(z.includes("."))b1(P,z,E),delete P[z]});return P}var x1=(f,$,P)=>{if(f[$]!==void 0)if(Array.isArray(f[$]))f[$].push(P);else f[$]=[f[$],P];else if(!$.endsWith("[]"))f[$]=P;else f[$]=[P]},b1=(f,$,P)=>{let z=f,E=$.split(".");E.forEach((Q,Y)=>{if(Y===E.length-1)z[Q]=P;else{if(!z[Q]||typeof z[Q]!=="object"||Array.isArray(z[Q])||z[Q]instanceof File)z[Q]=Object.create(null);z=z[Q]}})};var Uf=(f)=>{let $=f.split("/");if($[0]==="")$.shift();return $},$0=(f)=>{let{groups:$,path:P}=O1(f),z=Uf(P);return y1(z,$)},O1=(f)=>{let $=[];return f=f.replace(/\{[^}]+\}/g,(P,z)=>{let E=`@${z}`;return $.push([E,P]),E}),{groups:$,path:f}},y1=(f,$)=>{for(let P=$.length-1;P>=0;P--){let[z]=$[P];for(let E=f.length-1;E>=0;E--)if(f[E].includes(z)){f[E]=f[E].replace(z,$[P][1]);break}}return f},a={},P0=(f,$)=>{if(f==="*")return"*";let P=f.match(/^\:([^\{\}]+)(?:\{(.+)\})?$/);if(P){let z=`${f}#${$}`;if(!a[z])if(P[2])a[z]=$&&$[0]!==":"&&$[0]!=="*"?[z,P[1],new RegExp(`^${P[2]}(?=/${$})`)]:[f,P[1],new RegExp(`^${P[2]}$`)];else a[z]=[f,P[1],!0];return a[z]}return null},e=(f,$)=>{try{return $(f)}catch{return f.replace(/(?:%[0-9A-Fa-f]{2})+/g,(P)=>{try{return $(P)}catch{return P}})}},C1=(f)=>e(f,decodeURI),Bf=(f)=>{let $=f.url,P=$.indexOf("/",$.indexOf(":")+4),z=P;for(;z<$.length;z++){let E=$.charCodeAt(z);if(E===37){let Q=$.indexOf("?",z),Y=$.slice(P,Q===-1?void 0:Q);return C1(Y.includes("%25")?Y.replace(/%25/g,"%2525"):Y)}else if(E===63)break}return $.slice(P,z)};var z0=(f)=>{let $=Bf(f);return $.length>1&&$.at(-1)==="/"?$.slice(0,-1):$},w=(f,$,...P)=>{if(P.length)$=w($,...P);return`${f?.[0]==="/"?"":"/"}${f}${$==="/"?"":`${f?.at(-1)==="/"?"":"/"}${$?.[0]==="/"?$.slice(1):$}`}`},ff=(f)=>{if(f.charCodeAt(f.length-1)!==63||!f.includes(":"))return null;let $=f.split("/"),P=[],z="";return $.forEach((E)=>{if(E!==""&&!/\:/.test(E))z+="/"+E;else if(/\:/.test(E))if(/\?/.test(E)){if(P.length===0&&z==="")P.push("/");else P.push(z);let Q=E.replace("?","");z+="/"+Q,P.push(z)}else z+="/"+E}),P.filter((E,Q,Y)=>Y.indexOf(E)===Q)},Mf=(f)=>{if(!/[%+]/.test(f))return f;if(f.indexOf("+")!==-1)f=f.replace(/\+/g," ");return f.indexOf("%")!==-1?e(f,If):f},E0=(f,$,P)=>{let z;if(!P&&$&&!/[%+]/.test($)){let Y=f.indexOf("?",8);if(Y===-1)return;if(!f.startsWith($,Y+1))Y=f.indexOf(`&${$}`,Y+1);while(Y!==-1){let J=f.charCodeAt(Y+$.length+1);if(J===61){let S=Y+$.length+2,X=f.indexOf("&",S);return Mf(f.slice(S,X===-1?void 0:X))}else if(J==38||isNaN(J))return"";Y=f.indexOf(`&${$}`,Y+1)}if(z=/[%+]/.test(f),!z)return}let E={};z??=/[%+]/.test(f);let Q=f.indexOf("?",8);while(Q!==-1){let Y=f.indexOf("&",Q+1),J=f.indexOf("=",Q);if(J>Y&&Y!==-1)J=-1;let S=f.slice(Q+1,J===-1?Y===-1?void 0:Y:J);if(z)S=Mf(S);if(Q=Y,S==="")continue;let X;if(J===-1)X="";else if(X=f.slice(J+1,Y===-1?void 0:Y),z)X=Mf(X);if(P){if(!(E[S]&&Array.isArray(E[S])))E[S]=[];E[S].push(X)}else E[S]??=X}return $?E[$]:E},Q0=E0,J0=(f,$)=>{return E0(f,$,!0)},If=decodeURIComponent;var Y0=(f)=>e(f,If),o=class{raw;#f;#$;routeIndex=0;path;bodyCache={};constructor(f,$="/",P=[[]]){this.raw=f,this.path=$,this.#$=P,this.#f={}}param(f){return f?this.#P(f):this.#Q()}#P(f){let $=this.#$[0][this.routeIndex][1][f],P=this.#E($);return P&&/\%/.test(P)?Y0(P):P}#Q(){let f={},$=Object.keys(this.#$[0][this.routeIndex][1]);for(let P of $){let z=this.#E(this.#$[0][this.routeIndex][1][P]);if(z!==void 0)f[P]=/\%/.test(z)?Y0(z):z}return f}#E(f){return this.#$[1]?this.#$[1][f]:f}query(f){return Q0(this.url,f)}queries(f){return J0(this.url,f)}header(f){if(f)return this.raw.headers.get(f)??void 0;let $={};return this.raw.headers.forEach((P,z)=>{$[z]=P}),$}async parseBody(f){return this.bodyCache.parsedBody??=await f0(this,f)}#z=(f)=>{let{bodyCache:$,raw:P}=this,z=$[f];if(z)return z;let E=Object.keys($)[0];if(E)return $[E].then((Q)=>{if(E==="json")Q=JSON.stringify(Q);return new Response(Q)[f]()});return $[f]=P[f]()};json(){return this.#z("text").then((f)=>JSON.parse(f))}text(){return this.#z("text")}arrayBuffer(){return this.#z("arrayBuffer")}blob(){return this.#z("blob")}formData(){return this.#z("formData")}addValidatedData(f,$){this.#f[f]=$}valid(f){return this.#f[f]}get url(){return this.raw.url}get method(){return this.raw.method}get[ef](){return this.#$}get matchedRoutes(){return this.#$[0].map(([[,f]])=>f)}get routePath(){return this.#$[0].map(([[,f]])=>f)[this.routeIndex].path}};var S0={Stringify:1,BeforeStream:2,Stream:3},k1=(f,$)=>{let P=new String(f);return P.isEscaped=!0,P.callbacks=$,P};var jf=async(f,$,P,z,E)=>{if(typeof f==="object"&&!(f instanceof String)){if(!(f instanceof Promise))f=f.toString();if(f instanceof Promise)f=await f}let Q=f.callbacks;if(!Q?.length)return Promise.resolve(f);if(E)E[0]+=f;else E=[f];let Y=Promise.all(Q.map((J)=>J({phase:$,buffer:E,context:z}))).then((J)=>Promise.all(J.filter(Boolean).map((S)=>jf(S,$,!1,z,E))).then(()=>E[0]));if(P)return k1(await Y,Q);else return Y};var v1="text/plain; charset=UTF-8",Kf=(f,$)=>{return{"Content-Type":f,...$}},X0=class{#f;#$;env={};#P;finalized=!1;error;#Q;#E;#z;#Z;#S;#X;#Y;#N;#W;constructor(f,$){if(this.#f=f,$)this.#E=$.executionCtx,this.env=$.env,this.#X=$.notFoundHandler,this.#W=$.path,this.#N=$.matchResult}get req(){return this.#$??=new o(this.#f,this.#W,this.#N),this.#$}get event(){if(this.#E&&"respondWith"in this.#E)return this.#E;else throw Error("This context has no FetchEvent")}get executionCtx(){if(this.#E)return this.#E;else throw Error("This context has no ExecutionContext")}get res(){return this.#z||=new Response(null,{headers:this.#Y??=new Headers})}set res(f){if(this.#z&&f){f=new Response(f.body,f);for(let[$,P]of this.#z.headers.entries()){if($==="content-type")continue;if($==="set-cookie"){let z=this.#z.headers.getSetCookie();f.headers.delete("set-cookie");for(let E of z)f.headers.append("set-cookie",E)}else f.headers.set($,P)}}this.#z=f,this.finalized=!0}render=(...f)=>{return this.#S??=($)=>this.html($),this.#S(...f)};setLayout=(f)=>this.#Z=f;getLayout=()=>this.#Z;setRenderer=(f)=>{this.#S=f};header=(f,$,P)=>{if(this.finalized)this.#z=new Response(this.#z.body,this.#z);let z=this.#z?this.#z.headers:this.#Y??=new Headers;if($===void 0)z.delete(f);else if(P?.append)z.append(f,$);else z.set(f,$)};status=(f)=>{this.#Q=f};set=(f,$)=>{this.#P??=new Map,this.#P.set(f,$)};get=(f)=>{return this.#P?this.#P.get(f):void 0};get var(){if(!this.#P)return{};return Object.fromEntries(this.#P)}#J(f,$,P){let z=this.#z?new Headers(this.#z.headers):this.#Y??new Headers;if(typeof $==="object"&&"headers"in $){let Q=$.headers instanceof Headers?$.headers:new Headers($.headers);for(let[Y,J]of Q)if(Y.toLowerCase()==="set-cookie")z.append(Y,J);else z.set(Y,J)}if(P)for(let[Q,Y]of Object.entries(P))if(typeof Y==="string")z.set(Q,Y);else{z.delete(Q);for(let J of Y)z.append(Q,J)}let E=typeof $==="number"?$:$?.status??this.#Q;return new Response(f,{status:E,headers:z})}newResponse=(...f)=>this.#J(...f);body=(f,$,P)=>this.#J(f,$,P);text=(f,$,P)=>{return!this.#Y&&!this.#Q&&!$&&!P&&!this.finalized?new Response(f):this.#J(f,$,Kf(v1,P))};json=(f,$,P)=>{return this.#J(JSON.stringify(f),$,Kf("application/json",P))};html=(f,$,P)=>{let z=(E)=>this.#J(E,$,Kf("text/html; charset=UTF-8",P));return typeof f==="object"?jf(f,S0.Stringify,!1,{}).then(z):z(f)};redirect=(f,$)=>{let P=String(f);return this.header("Location",!/[^\x00-\xFF]/.test(P)?P:encodeURI(P)),this.newResponse(null,$??302)};notFound=()=>{return this.#X??=()=>new Response,this.#X(this)}};var G="ALL",Z0="all",N0=["get","post","put","delete","options","patch"],$f="Can not add a route since the matcher is already built.",Pf=class extends Error{};var W0="__COMPOSED_HANDLER";var u1=(f)=>{return f.text("404 Not Found",404)},R0=(f,$)=>{if("getResponse"in f){let P=f.getResponse();return $.newResponse(P.body,P)}return console.error(f),$.text("Internal Server Error",500)},G0=class f{get;post;put;delete;options;patch;all;on;use;router;getPath;_basePath="/";#f="/";routes=[];constructor($={}){[...N0,Z0].forEach((Q)=>{this[Q]=(Y,...J)=>{if(typeof Y==="string")this.#f=Y;else this.#Q(Q,this.#f,Y);return J.forEach((S)=>{this.#Q(Q,this.#f,S)}),this}}),this.on=(Q,Y,...J)=>{for(let S of[Y].flat()){this.#f=S;for(let X of[Q].flat())J.map((Z)=>{this.#Q(X.toUpperCase(),this.#f,Z)})}return this},this.use=(Q,...Y)=>{if(typeof Q==="string")this.#f=Q;else this.#f="*",Y.unshift(Q);return Y.forEach((J)=>{this.#Q(G,this.#f,J)}),this};let{strict:z,...E}=$;Object.assign(this,E),this.getPath=z??!0?$.getPath??Bf:z0}#$(){let $=new f({router:this.router,getPath:this.getPath});return $.errorHandler=this.errorHandler,$.#P=this.#P,$.routes=this.routes,$}#P=u1;errorHandler=R0;route($,P){let z=this.basePath($);return P.routes.map((E)=>{let Q;if(P.errorHandler===R0)Q=E.handler;else Q=async(Y,J)=>(await Tf([],P.errorHandler)(Y,()=>E.handler(Y,J))).res,Q[W0]=E.handler;z.#Q(E.method,E.path,Q)}),this}basePath($){let P=this.#$();return P._basePath=w(this._basePath,$),P}onError=($)=>{return this.errorHandler=$,this};notFound=($)=>{return this.#P=$,this};mount($,P,z){let E,Q;if(z)if(typeof z==="function")Q=z;else if(Q=z.optionHandler,z.replaceRequest===!1)E=(S)=>S;else E=z.replaceRequest;let Y=Q?(S)=>{let X=Q(S);return Array.isArray(X)?X:[X]}:(S)=>{let X=void 0;try{X=S.executionCtx}catch{}return[S.env,X]};E||=(()=>{let S=w(this._basePath,$),X=S==="/"?0:S.length;return(Z)=>{let N=new URL(Z.url);return N.pathname=N.pathname.slice(X)||"/",new Request(N,Z)}})();let J=async(S,X)=>{let Z=await P(E(S.req.raw),...Y(S));if(Z)return Z;await X()};return this.#Q(G,w($,"*"),J),this}#Q($,P,z){$=$.toUpperCase(),P=w(this._basePath,P);let E={basePath:this._basePath,path:P,method:$,handler:z};this.router.add($,P,[z,E]),this.routes.push(E)}#E($,P){if($ instanceof Error)return this.errorHandler($,P);throw $}#z($,P,z,E){if(E==="HEAD")return(async()=>new Response(null,await this.#z($,P,z,"GET")))();let Q=this.getPath($,{env:z}),Y=this.router.match(E,Q),J=new X0($,{path:Q,matchResult:Y,env:z,executionCtx:P,notFoundHandler:this.#P});if(Y[0].length===1){let X;try{X=Y[0][0][0][0](J,async()=>{J.res=await this.#P(J)})}catch(Z){return this.#E(Z,J)}return X instanceof Promise?X.then((Z)=>Z||(J.finalized?J.res:this.#P(J))).catch((Z)=>this.#E(Z,J)):X??this.#P(J)}let S=Tf(Y[0],this.errorHandler,this.#P);return(async()=>{try{let X=await S(J);if(!X.finalized)throw Error("Context is not finalized. Did you forget to return a Response object or `await next()`?");return X.res}catch(X){return this.#E(X,J)}})()}fetch=($,...P)=>{return this.#z($,P[1],P[0],$.method)};request=($,P,z,E)=>{if($ instanceof Request)return this.fetch(P?new Request($,P):$,z,E);return $=$.toString(),this.fetch(new Request(/^https?:\/\//.test($)?$:`http://localhost${w("/",$)}`,P),z,E)};fire=()=>{addEventListener("fetch",($)=>{$.respondWith(this.#z($.request,$,void 0,$.request.method))})}};var v=[];function zf(f,$){let P=this.buildAllMatchers(),z=(E,Q)=>{let Y=P[E]||P[G],J=Y[2][Q];if(J)return J;let S=Q.match(Y[0]);if(!S)return[[],v];let X=S.indexOf("",1);return[Y[1][X],S]};return this.match=z,z(f,$)}var Ef="[^/]+",u=".*",l="(?:|/.*)",A=Symbol(),l1=new Set(".\\+*[^]$()");function h1(f,$){if(f.length===1)return $.length===1?f<$?-1:1:-1;if($.length===1)return 1;if(f===u||f===l)return 1;else if($===u||$===l)return-1;if(f===Ef)return 1;else if($===Ef)return-1;return f.length===$.length?f<$?-1:1:$.length-f.length}var L0=class f{#f;#$;#P=Object.create(null);insert($,P,z,E,Q){if($.length===0){if(this.#f!==void 0)throw A;if(Q)return;this.#f=P;return}let[Y,...J]=$,S=Y==="*"?J.length===0?["","",u]:["","",Ef]:Y==="/*"?["","",l]:Y.match(/^\:([^\{\}]+)(?:\{(.+)\})?$/),X;if(S){let Z=S[1],N=S[2]||Ef;if(Z&&S[2]){if(N===".*")throw A;if(N=N.replace(/^\((?!\?:)(?=[^)]+\)$)/,"(?:"),/\((?!\?:)/.test(N))throw A}if(X=this.#P[N],!X){if(Object.keys(this.#P).some((R)=>R!==u&&R!==l))throw A;if(Q)return;if(X=this.#P[N]=new f,Z!=="")X.#$=E.varIndex++}if(!Q&&Z!=="")z.push([Z,X.#$])}else if(X=this.#P[Y],!X){if(Object.keys(this.#P).some((Z)=>Z.length>1&&Z!==u&&Z!==l))throw A;if(Q)return;X=this.#P[Y]=new f}X.insert(J,P,z,E,Q)}buildRegExpStr(){let P=Object.keys(this.#P).sort(h1).map((z)=>{let E=this.#P[z];return(typeof E.#$==="number"?`(${z})@${E.#$}`:l1.has(z)?`\\${z}`:z)+E.buildRegExpStr()});if(typeof this.#f==="number")P.unshift(`#${this.#f}`);if(P.length===0)return"";if(P.length===1)return P[0];return"(?:"+P.join("|")+")"}};var T0=class{#f={varIndex:0};#$=new L0;insert(f,$,P){let z=[],E=[];for(let Y=0;;){let J=!1;if(f=f.replace(/\{[^}]+\}/g,(S)=>{let X=`@\\${Y}`;return E[Y]=[X,S],Y++,J=!0,X}),!J)break}let Q=f.match(/(?::[^\/]+)|(?:\/\*$)|./g)||[];for(let Y=E.length-1;Y>=0;Y--){let[J]=E[Y];for(let S=Q.length-1;S>=0;S--)if(Q[S].indexOf(J)!==-1){Q[S]=Q[S].replace(J,E[Y][1]);break}}return this.#$.insert(Q,$,z,this.#f,P),z}buildRegExp(){let f=this.#$.buildRegExpStr();if(f==="")return[/^$/,[],[]];let $=0,P=[],z=[];return f=f.replace(/#(\d+)|@(\d+)|\.\*\$/g,(E,Q,Y)=>{if(Q!==void 0)return P[++$]=Number(Q),"$()";if(Y!==void 0)return z[Number(Y)]=++$,"";return""}),[new RegExp(`^${f}`),P,z]}};var c1=[/^$/,[],Object.create(null)],M0=Object.create(null);function U0(f){return M0[f]??=new RegExp(f==="*"?"":`^${f.replace(/\/\*$|([.\\+*[^\]$()])/g,($,P)=>P?`\\${P}`:"(?:|/.*)")}$`)}function g1(){M0=Object.create(null)}function i1(f){let $=new T0,P=[];if(f.length===0)return c1;let z=f.map((X)=>[!/\*|\/:/.test(X[0]),...X]).sort(([X,Z],[N,R])=>X?1:N?-1:Z.length-R.length),E=Object.create(null);for(let X=0,Z=-1,N=z.length;X<N;X++){let[R,W,M]=z[X];if(R)E[W]=[M.map(([U])=>[U,Object.create(null)]),v];else Z++;let L;try{L=$.insert(W,Z,R)}catch(U){throw U===A?new Pf(W):U}if(R)continue;P[Z]=M.map(([U,V])=>{let c=Object.create(null);V-=1;for(;V>=0;V--){let[g,j]=L[V];c[g]=j}return[U,c]})}let[Q,Y,J]=$.buildRegExp();for(let X=0,Z=P.length;X<Z;X++)for(let N=0,R=P[X].length;N<R;N++){let W=P[X][N]?.[1];if(!W)continue;let M=Object.keys(W);for(let L=0,U=M.length;L<U;L++)W[M[L]]=J[W[M[L]]]}let S=[];for(let X in Y)S[X]=P[Y[X]];return[Q,S,E]}function O(f,$){if(!f)return;for(let P of Object.keys(f).sort((z,E)=>E.length-z.length))if(U0(P).test($))return[...f[P]];return}var Qf=class{name="RegExpRouter";#f;#$;constructor(){this.#f={[G]:Object.create(null)},this.#$={[G]:Object.create(null)}}add(f,$,P){let z=this.#f,E=this.#$;if(!z||!E)throw Error($f);if(!z[f])[z,E].forEach((J)=>{J[f]=Object.create(null),Object.keys(J[G]).forEach((S)=>{J[f][S]=[...J[G][S]]})});if($==="/*")$="*";let Q=($.match(/\/:/g)||[]).length;if(/\*$/.test($)){let J=U0($);if(f===G)Object.keys(z).forEach((S)=>{z[S][$]||=O(z[S],$)||O(z[G],$)||[]});else z[f][$]||=O(z[f],$)||O(z[G],$)||[];Object.keys(z).forEach((S)=>{if(f===G||f===S)Object.keys(z[S]).forEach((X)=>{J.test(X)&&z[S][X].push([P,Q])})}),Object.keys(E).forEach((S)=>{if(f===G||f===S)Object.keys(E[S]).forEach((X)=>J.test(X)&&E[S][X].push([P,Q]))});return}let Y=ff($)||[$];for(let J=0,S=Y.length;J<S;J++){let X=Y[J];Object.keys(E).forEach((Z)=>{if(f===G||f===Z)E[Z][X]||=[...O(z[Z],X)||O(z[G],X)||[]],E[Z][X].push([P,Q-S+J+1])})}}match=zf;buildAllMatchers(){let f=Object.create(null);return Object.keys(this.#$).concat(Object.keys(this.#f)).forEach(($)=>{f[$]||=this.#P($)}),this.#f=this.#$=void 0,g1(),f}#P(f){let $=[],P=f===G;if([this.#f,this.#$].forEach((z)=>{let E=z[f]?Object.keys(z[f]).map((Q)=>[Q,z[f][Q]]):[];if(E.length!==0)P||=!0,$.push(...E);else if(f!==G)$.push(...Object.keys(z[G]).map((Q)=>[Q,z[G][Q]]))}),!P)return null;else return i1($)}};var s1=class{name="PreparedRegExpRouter";#f;#$;constructor(f,$){this.#f=f,this.#$=$}#P(f,$){let P=this.#f[f];P[1].forEach((z)=>z&&z.push($)),Object.values(P[2]).forEach((z)=>z[0].push($))}#Q(f,$,P,z,E){let Q=this.#f[f];if(!E)Q[2][$][0].push([P,{}]);else z.forEach((Y)=>{if(typeof Y==="number")Q[1][Y].push([P,E]);else Q[2][Y||$][0].push([P,E])})}add(f,$,P){if(!this.#f[f]){let E=this.#f[G],Q={};for(let Y in E[2])Q[Y]=[E[2][Y][0].slice(),v];this.#f[f]=[E[0],E[1].map((Y)=>Array.isArray(Y)?Y.slice():0),Q]}if($==="/*"||$==="*"){let E=[P,{}];if(f===G)for(let Q in this.#f)this.#P(Q,E);else this.#P(f,E);return}let z=this.#$[$];if(!z)throw Error(`Path ${$} is not registered`);for(let[E,Q]of z)if(f===G)for(let Y in this.#f)this.#Q(Y,$,P,E,Q);else this.#Q(f,$,P,E,Q)}buildAllMatchers(){return this.#f}match=zf};var _f=class{name="SmartRouter";#f=[];#$=[];constructor(f){this.#f=f.routers}add(f,$,P){if(!this.#$)throw Error($f);this.#$.push([f,$,P])}match(f,$){if(!this.#$)throw Error("Fatal error");let P=this.#f,z=this.#$,E=P.length,Q=0,Y;for(;Q<E;Q++){let J=P[Q];try{for(let S=0,X=z.length;S<X;S++)J.add(...z[S]);Y=J.match(f,$)}catch(S){if(S instanceof Pf)continue;throw S}this.match=J.match.bind(J),this.#f=[J],this.#$=void 0;break}if(Q===E)throw Error("Fatal error");return this.name=`SmartRouter + ${this.activeRouter.name}`,Y}get activeRouter(){if(this.#$||this.#f.length!==1)throw Error("No active router has been determined yet.");return this.#f[0]}};var h=Object.create(null),B0=class f{#f;#$;#P;#Q=0;#E=h;constructor($,P,z){if(this.#$=z||Object.create(null),this.#f=[],$&&P){let E=Object.create(null);E[$]={handler:P,possibleKeys:[],score:0},this.#f=[E]}this.#P=[]}insert($,P,z){this.#Q=++this.#Q;let E=this,Q=$0(P),Y=[];for(let J=0,S=Q.length;J<S;J++){let X=Q[J],Z=Q[J+1],N=P0(X,Z),R=Array.isArray(N)?N[0]:X;if(R in E.#$){if(E=E.#$[R],N)Y.push(N[1]);continue}if(E.#$[R]=new f,N)E.#P.push(N),Y.push(N[1]);E=E.#$[R]}return E.#f.push({[$]:{handler:z,possibleKeys:Y.filter((J,S,X)=>X.indexOf(J)===S),score:this.#Q}}),E}#z($,P,z,E){let Q=[];for(let Y=0,J=$.#f.length;Y<J;Y++){let S=$.#f[Y],X=S[P]||S[G],Z={};if(X!==void 0){if(X.params=Object.create(null),Q.push(X),z!==h||E&&E!==h)for(let N=0,R=X.possibleKeys.length;N<R;N++){let W=X.possibleKeys[N],M=Z[X.score];X.params[W]=E?.[W]&&!M?E[W]:z[W]??E?.[W],Z[X.score]=!0}}}return Q}search($,P){let z=[];this.#E=h;let Q=[this],Y=Uf(P),J=[];for(let S=0,X=Y.length;S<X;S++){let Z=Y[S],N=S===X-1,R=[];for(let W=0,M=Q.length;W<M;W++){let L=Q[W],U=L.#$[Z];if(U)if(U.#E=L.#E,N){if(U.#$["*"])z.push(...this.#z(U.#$["*"],$,L.#E));z.push(...this.#z(U,$,L.#E))}else R.push(U);for(let V=0,c=L.#P.length;V<c;V++){let g=L.#P[V],j=L.#E===h?{}:{...L.#E};if(g==="*"){let F=L.#$["*"];if(F)z.push(...this.#z(F,$,L.#E)),F.#E=j,R.push(F);continue}let[w0,Df,y]=g;if(!Z&&!(y instanceof RegExp))continue;let K=L.#$[w0],A0=Y.slice(S).join("/");if(y instanceof RegExp){let F=y.exec(A0);if(F){if(j[Df]=F[0],z.push(...this.#z(K,$,L.#E,j)),Object.keys(K.#$).length){K.#E=j;let x0=F[0].match(/\//)?.length??0;(J[x0]||=[]).push(K)}continue}}if(y===!0||y.test(Z))if(j[Df]=Z,N){if(z.push(...this.#z(K,$,j,L.#E)),K.#$["*"])z.push(...this.#z(K.#$["*"],$,j,L.#E))}else K.#E=j,R.push(K)}}Q=R.concat(J.shift()??[])}if(z.length>1)z.sort((S,X)=>{return S.score-X.score});return[z.map(({handler:S,params:X})=>[S,X])]}};var Vf=class{name="TrieRouter";#f;constructor(){this.#f=new B0}add(f,$,P){let z=ff($);if(z){for(let E=0,Q=z.length;E<Q;E++)this.#f.insert(f,z[E],P);return}this.#f.insert(f,$,P)}match(f,$){return this.#f.search(f,$)}};var Ff=class extends G0{constructor(f={}){super(f);this.router=f.router??new _f({routers:[new Qf,new Vf]})}};var Jf=new Map,m1={windowMs:60000,maxRequests:100};function I0(f,$=m1){let P=Date.now(),z=Jf.get(f);if(!z||P-z.windowStart>=$.windowMs)return Jf.set(f,{count:1,windowStart:P}),{allowed:!0,remaining:$.maxRequests-1,resetMs:$.windowMs};if(z.count>=$.maxRequests)return{allowed:!1,remaining:0,resetMs:$.windowMs-(P-z.windowStart)};return z.count++,{allowed:!0,remaining:$.maxRequests-z.count,resetMs:$.windowMs-(P-z.windowStart)}}function t1(f=300000){let $=Date.now(),P=0;for(let[z,E]of Jf.entries())if($-E.windowStart>f)Jf.delete(z),P++;return P}setInterval(()=>{t1()},300000);var j0={windowMs:60000,maxRequests:100};function r1(){let f=new Ff;return f.get("/health",($)=>{return $.json({ok:!0,timestamp:new Date().toISOString()})}),f.post("/check",async($)=>{let P=$.req.header("x-forwarded-for")||$.req.header("x-real-ip")||"unknown",z=I0(`check:${P}`,j0);if($.header("X-RateLimit-Limit",String(j0.maxRequests)),$.header("X-RateLimit-Remaining",String(z.remaining)),$.header("X-RateLimit-Reset",String(Math.ceil(z.resetMs/1000))),!z.allowed)return $.json({error:"Rate limit exceeded",retryAfterMs:z.resetMs},429);let E=await $.req.json(),{identifier:Q,platform:Y="whatsapp"}=E;if(!Q)return $.json({error:"identifier is required"},400);let J=p(Q,Y),S=!J.allowed?"deny":J.trust==="limited"?"limited":"allow";return n(Q,Y,S,J.reason),$.json(J)}),f.get("/contacts",($)=>{let P=$.req.query("platform"),z=$.req.query("trust"),E=d(P,z);return $.json({contacts:E})}),f.post("/contacts",async($)=>{let P=await $.req.json(),{identifier:z,platform:E="whatsapp",trust:Q="trusted",name:Y,notes:J}=P;if(!z)return $.json({error:"identifier is required"},400);let S=q(z,E,Q,Y,J);return $.json({contact:S})}),f.delete("/contacts/:identifier",($)=>{let P=$.req.param("identifier"),z=$.req.query("platform")||"whatsapp",E=r(P,z);return $.json({removed:E})}),f.get("/audit",($)=>{let P=parseInt($.req.query("limit")||"100"),z=$.req.query("decision"),E=b({limit:P,decision:z});return $.json({entries:E})}),f}function K0(f=3847){let $=r1();console.log(`wasp server listening on http://localhost:${f}`),console.log("Endpoints:"),console.log("  POST /check         - Check if contact is allowed"),console.log("  GET  /contacts      - List contacts"),console.log("  POST /contacts      - Add contact"),console.log("  DELETE /contacts/:id - Remove contact"),console.log("  GET  /audit         - View audit log"),console.log("  GET  /health        - Health check"),Bun.serve({port:f,fetch:$.fetch})}function _0(f){if(!x())console.error("wasp is not initialized. Run `wasp init` first."),process.exit(1);let $=f.port||3847;K0($)}function V0(f=50){return B().prepare(`
    SELECT * FROM quarantine 
    WHERE reviewed = 0 
    ORDER BY timestamp DESC 
    LIMIT ?
  `).all(f).map((E)=>({id:E.id,identifier:E.identifier,platform:E.platform,messagePreview:E.message_preview,fullMessage:E.full_message,timestamp:E.timestamp,reviewed:!!E.reviewed}))}function d1(f,$="whatsapp"){return B().prepare(`
    SELECT * FROM quarantine 
    WHERE identifier = ? AND platform = ? AND reviewed = 0
    ORDER BY timestamp ASC
  `).all(f,$).map((Q)=>({id:Q.id,identifier:Q.identifier,platform:Q.platform,messagePreview:Q.message_preview,fullMessage:Q.full_message,timestamp:Q.timestamp,reviewed:!!Q.reviewed}))}function F0(f,$="whatsapp"){let P=d1(f,$);if(P.length>0)B().prepare(`
      UPDATE quarantine SET reviewed = 1 
      WHERE identifier = ? AND platform = ?
    `).run(f,$);return P}function D0(f,$="whatsapp"){return B().prepare(`
    DELETE FROM quarantine WHERE identifier = ? AND platform = ?
  `).run(f,$).changes}async function H0(f){if(f.approve){let E=F0(f.approve);if(E.length>0)q(E[0].identifier,E[0].platform,"trusted"),console.log(`\u2713 Approved ${E[0].identifier}`),console.log(`  Released ${E.length} quarantined message(s)`);else console.log(`No quarantined messages for: ${f.approve}`);return}if(f.deny){let E=D0(f.deny);if(E>0)q(f.deny,"whatsapp","limited"),console.log(`\u2717 Denied ${f.deny}`),console.log(`  Deleted ${E} message(s)`);else console.log(`No quarantined messages for: ${f.deny}`);return}let $=V0(50);if($.length===0){console.log(`
\uD83D\uDC1D Quarantine is empty - no messages awaiting review
`);return}let P=new Map;for(let E of $){let Q=`${E.identifier}|${E.platform}`;if(!P.has(Q))P.set(Q,[]);P.get(Q).push(E)}console.log(`
\uD83D\uDC1D Quarantine Review
`),console.log(`${P.size} sender(s), ${$.length} message(s) awaiting review
`),console.log("\u2500".repeat(60)+`
`);let z=1;for(let[E,Q]of P){let[Y,J]=E.split("|");console.log(`${z}. ${Y} (${J})`),console.log(`   ${Q.length} message(s)`),console.log("");let S=Q[0];console.log(`   First: "${S.messagePreview}"`),console.log(`   Time:  ${S.timestamp}`),console.log(""),z++}if(console.log("\u2500".repeat(60)),console.log(`
Actions:`),console.log("  wasp review --approve <identifier>   Add to trusted, release messages"),console.log("  wasp review --deny <identifier>      Block sender, delete messages"),console.log(""),f.interactive)console.log("Interactive mode not yet implemented."),console.log("Use --approve or --deny flags for now.")}function q0(f=20){let $=b({limit:100,decision:"deny"}),P=new Set,z=[];for(let E of $){let Q=`${E.identifier}|${E.platform}`;if(!P.has(Q)){if(P.add(Q),z.push(E),z.length>=f)break}}if(z.length===0){console.log(`
No blocked contacts in recent history.
`);return}console.log(`
\uD83D\uDC1D Recently Blocked Contacts
`),console.log("\u2500".repeat(60)+`
`);for(let E of z)console.log(`  ${E.identifier} (${E.platform})`),console.log(`    Last seen: ${E.timestamp}`),console.log(`    Reason: ${E.reason}`),console.log("");console.log("\u2500".repeat(60)),console.log(`
To allow a contact:`),console.log('  wasp add "<identifier>" --trust trusted'),console.log("")}var p1="0.0.1";I.name("wasp").description("Security whitelist layer for Moltbot and agentic systems").version(p1);I.command("init").description("Initialize wasp database").option("-f, --force","Reinitialize even if already initialized").action((f)=>{rf(f.force)});I.command("add <identifier>").description("Add a contact to the whitelist").option("-p, --platform <platform>","Platform (whatsapp, telegram, email, discord, slack, signal)","whatsapp").option("-t, --trust <level>","Trust level (sovereign, trusted, limited)","trusted").option("-n, --name <name>","Contact name").option("--notes <notes>","Notes about this contact").action((f,$)=>{D(),df(f,$)});I.command("remove <identifier>").description("Remove a contact from the whitelist").option("-p, --platform <platform>","Platform","whatsapp").action((f,$)=>{D(),pf(f,$.platform)});I.command("list").description("List all contacts").option("-p, --platform <platform>","Filter by platform").option("-t, --trust <level>","Filter by trust level").option("-j, --json","Output as JSON").action((f)=>{D(),nf(f)});I.command("check <identifier>").description("Check if a contact is allowed").option("-p, --platform <platform>","Platform","whatsapp").option("-j, --json","Output as JSON").option("-q, --quiet","Exit code only, no output").action((f,$)=>{D(),of(f,$)});I.command("log").description("View audit log").option("-l, --limit <number>","Number of entries to show","50").option("-d, --denied","Show only denied entries").option("-j, --json","Output as JSON").action((f)=>{D(),af({...f,limit:parseInt(f.limit)})});I.command("serve").description("Start HTTP server for Moltbot integration").option("-p, --port <number>","Port to listen on","3847").action((f)=>{D(),_0({port:parseInt(f.port)})});I.command("review").description("Review quarantined messages and first-time contacts").option("--approve <identifier>","Approve sender and release messages").option("--deny <identifier>","Block sender and delete messages").option("-i, --interactive","Interactive review mode").action(async(f)=>{D(),await H0(f)});I.command("blocked").description("Show recently blocked contacts").option("-l, --limit <number>","Number to show","20").action((f)=>{D(),q0(parseInt(f.limit))});function D(){if(!x())console.log("wasp is not initialized. Initializing now..."),t(),console.log("")}I.parse();
