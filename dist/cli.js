#!/usr/bin/env node
// @bun
var Of=Object.create;var{getPrototypeOf:yf,defineProperty:n0,getOwnPropertyNames:Cf}=Object;var bf=Object.prototype.hasOwnProperty;var kf=(f,$,E)=>{E=f!=null?Of(yf(f)):{};let z=$||!f||!f.__esModule?n0(E,"default",{value:f,enumerable:!0}):E;for(let P of Cf(f))if(!bf.call(z,P))n0(z,P,{get:()=>f[P],enumerable:!0});return z};var U=(f,$)=>()=>($||f(($={exports:{}}).exports,$),$.exports);var M=import.meta.require;var l=U((vf)=>{class V0 extends Error{constructor(f,$,E){super(E);Error.captureStackTrace(this,this.constructor),this.name=this.constructor.name,this.code=$,this.exitCode=f,this.nestedError=void 0}}class d0 extends V0{constructor(f){super(1,"commander.invalidArgument",f);Error.captureStackTrace(this,this.constructor),this.name=this.constructor.name}}vf.CommanderError=V0;vf.InvalidArgumentError=d0});var p=U((lf)=>{var{InvalidArgumentError:gf}=l();class p0{constructor(f,$){switch(this.description=$||"",this.variadic=!1,this.parseArg=void 0,this.defaultValue=void 0,this.defaultValueDescription=void 0,this.argChoices=void 0,f[0]){case"<":this.required=!0,this._name=f.slice(1,-1);break;case"[":this.required=!1,this._name=f.slice(1,-1);break;default:this.required=!0,this._name=f;break}if(this._name.length>3&&this._name.slice(-3)==="...")this.variadic=!0,this._name=this._name.slice(0,-3)}name(){return this._name}_concatValue(f,$){if($===this.defaultValue||!Array.isArray($))return[f];return $.concat(f)}default(f,$){return this.defaultValue=f,this.defaultValueDescription=$,this}argParser(f){return this.parseArg=f,this}choices(f){return this.argChoices=f.slice(),this.parseArg=($,E)=>{if(!this.argChoices.includes($))throw new gf(`Allowed choices are ${this.argChoices.join(", ")}.`);if(this.variadic)return this._concatValue($,E);return $},this}argRequired(){return this.required=!0,this}argOptional(){return this.required=!1,this}}function hf(f){let $=f.name()+(f.variadic===!0?"...":"");return f.required?"<"+$+">":"["+$+"]"}lf.Argument=p0;lf.humanReadableArgName=hf});var _0=U((mf)=>{var{humanReadableArgName:rf}=p();class o0{constructor(){this.helpWidth=void 0,this.sortSubcommands=!1,this.sortOptions=!1,this.showGlobalOptions=!1}visibleCommands(f){let $=f.commands.filter((z)=>!z._hidden),E=f._getHelpCommand();if(E&&!E._hidden)$.push(E);if(this.sortSubcommands)$.sort((z,P)=>{return z.name().localeCompare(P.name())});return $}compareOptions(f,$){let E=(z)=>{return z.short?z.short.replace(/^-/,""):z.long.replace(/^--/,"")};return E(f).localeCompare(E($))}visibleOptions(f){let $=f.options.filter((z)=>!z.hidden),E=f._getHelpOption();if(E&&!E.hidden){let z=E.short&&f._findOption(E.short),P=E.long&&f._findOption(E.long);if(!z&&!P)$.push(E);else if(E.long&&!P)$.push(f.createOption(E.long,E.description));else if(E.short&&!z)$.push(f.createOption(E.short,E.description))}if(this.sortOptions)$.sort(this.compareOptions);return $}visibleGlobalOptions(f){if(!this.showGlobalOptions)return[];let $=[];for(let E=f.parent;E;E=E.parent){let z=E.options.filter((P)=>!P.hidden);$.push(...z)}if(this.sortOptions)$.sort(this.compareOptions);return $}visibleArguments(f){if(f._argsDescription)f.registeredArguments.forEach(($)=>{$.description=$.description||f._argsDescription[$.name()]||""});if(f.registeredArguments.find(($)=>$.description))return f.registeredArguments;return[]}subcommandTerm(f){let $=f.registeredArguments.map((E)=>rf(E)).join(" ");return f._name+(f._aliases[0]?"|"+f._aliases[0]:"")+(f.options.length?" [options]":"")+($?" "+$:"")}optionTerm(f){return f.flags}argumentTerm(f){return f.name()}longestSubcommandTermLength(f,$){return $.visibleCommands(f).reduce((E,z)=>{return Math.max(E,$.subcommandTerm(z).length)},0)}longestOptionTermLength(f,$){return $.visibleOptions(f).reduce((E,z)=>{return Math.max(E,$.optionTerm(z).length)},0)}longestGlobalOptionTermLength(f,$){return $.visibleGlobalOptions(f).reduce((E,z)=>{return Math.max(E,$.optionTerm(z).length)},0)}longestArgumentTermLength(f,$){return $.visibleArguments(f).reduce((E,z)=>{return Math.max(E,$.argumentTerm(z).length)},0)}commandUsage(f){let $=f._name;if(f._aliases[0])$=$+"|"+f._aliases[0];let E="";for(let z=f.parent;z;z=z.parent)E=z.name()+" "+E;return E+$+" "+f.usage()}commandDescription(f){return f.description()}subcommandDescription(f){return f.summary()||f.description()}optionDescription(f){let $=[];if(f.argChoices)$.push(`choices: ${f.argChoices.map((E)=>JSON.stringify(E)).join(", ")}`);if(f.defaultValue!==void 0){if(f.required||f.optional||f.isBoolean()&&typeof f.defaultValue==="boolean")$.push(`default: ${f.defaultValueDescription||JSON.stringify(f.defaultValue)}`)}if(f.presetArg!==void 0&&f.optional)$.push(`preset: ${JSON.stringify(f.presetArg)}`);if(f.envVar!==void 0)$.push(`env: ${f.envVar}`);if($.length>0)return`${f.description} (${$.join(", ")})`;return f.description}argumentDescription(f){let $=[];if(f.argChoices)$.push(`choices: ${f.argChoices.map((E)=>JSON.stringify(E)).join(", ")}`);if(f.defaultValue!==void 0)$.push(`default: ${f.defaultValueDescription||JSON.stringify(f.defaultValue)}`);if($.length>0){let E=`(${$.join(", ")})`;if(f.description)return`${f.description} ${E}`;return E}return f.description}formatHelp(f,$){let E=$.padWidth(f,$),z=$.helpWidth||80,P=2,Q=2;function S(W,j){if(j){let L=`${W.padEnd(E+2)}${j}`;return $.wrap(L,z-2,E+2)}return W}function J(W){return W.join(`
`).replace(/^/gm," ".repeat(2))}let Y=[`Usage: ${$.commandUsage(f)}`,""],X=$.commandDescription(f);if(X.length>0)Y=Y.concat([$.wrap(X,z,0),""]);let Z=$.visibleArguments(f).map((W)=>{return S($.argumentTerm(W),$.argumentDescription(W))});if(Z.length>0)Y=Y.concat(["Arguments:",J(Z),""]);let R=$.visibleOptions(f).map((W)=>{return S($.optionTerm(W),$.optionDescription(W))});if(R.length>0)Y=Y.concat(["Options:",J(R),""]);if(this.showGlobalOptions){let W=$.visibleGlobalOptions(f).map((j)=>{return S($.optionTerm(j),$.optionDescription(j))});if(W.length>0)Y=Y.concat(["Global Options:",J(W),""])}let T=$.visibleCommands(f).map((W)=>{return S($.subcommandTerm(W),$.subcommandDescription(W))});if(T.length>0)Y=Y.concat(["Commands:",J(T),""]);return Y.join(`
`)}padWidth(f,$){return Math.max($.longestOptionTermLength(f,$),$.longestGlobalOptionTermLength(f,$),$.longestSubcommandTermLength(f,$),$.longestArgumentTermLength(f,$))}wrap(f,$,E,z=40){let Q=new RegExp(`[\\n][${" \\f\\t\\v\xA0\u1680\u2000-\u200A\u202F\u205F\u3000\uFEFF"}]+`);if(f.match(Q))return f;let S=$-E;if(S<z)return f;let J=f.slice(0,E),Y=f.slice(E).replace(`\r
`,`
`),X=" ".repeat(E),R=`\\s${"\u200B"}`,T=new RegExp(`
|.{1,${S-1}}([${R}]|$)|[^${R}]+?([${R}]|$)`,"g"),W=Y.match(T)||[];return J+W.map((j,L)=>{if(j===`
`)return"";return(L>0?X:"")+j.trimEnd()}).join(`
`)}}mf.Help=o0});var H0=U((af)=>{var{InvalidArgumentError:df}=l();class a0{constructor(f,$){this.flags=f,this.description=$||"",this.required=f.includes("<"),this.optional=f.includes("["),this.variadic=/\w\.\.\.[>\]]$/.test(f),this.mandatory=!1;let E=of(f);if(this.short=E.shortFlag,this.long=E.longFlag,this.negate=!1,this.long)this.negate=this.long.startsWith("--no-");this.defaultValue=void 0,this.defaultValueDescription=void 0,this.presetArg=void 0,this.envVar=void 0,this.parseArg=void 0,this.hidden=!1,this.argChoices=void 0,this.conflictsWith=[],this.implied=void 0}default(f,$){return this.defaultValue=f,this.defaultValueDescription=$,this}preset(f){return this.presetArg=f,this}conflicts(f){return this.conflictsWith=this.conflictsWith.concat(f),this}implies(f){let $=f;if(typeof f==="string")$={[f]:!0};return this.implied=Object.assign(this.implied||{},$),this}env(f){return this.envVar=f,this}argParser(f){return this.parseArg=f,this}makeOptionMandatory(f=!0){return this.mandatory=!!f,this}hideHelp(f=!0){return this.hidden=!!f,this}_concatValue(f,$){if($===this.defaultValue||!Array.isArray($))return[f];return $.concat(f)}choices(f){return this.argChoices=f.slice(),this.parseArg=($,E)=>{if(!this.argChoices.includes($))throw new df(`Allowed choices are ${this.argChoices.join(", ")}.`);if(this.variadic)return this._concatValue($,E);return $},this}name(){if(this.long)return this.long.replace(/^--/,"");return this.short.replace(/^-/,"")}attributeName(){return pf(this.name().replace(/^no-/,""))}is(f){return this.short===f||this.long===f}isBoolean(){return!this.required&&!this.optional&&!this.negate}}class e0{constructor(f){this.positiveOptions=new Map,this.negativeOptions=new Map,this.dualOptions=new Set,f.forEach(($)=>{if($.negate)this.negativeOptions.set($.attributeName(),$);else this.positiveOptions.set($.attributeName(),$)}),this.negativeOptions.forEach(($,E)=>{if(this.positiveOptions.has(E))this.dualOptions.add(E)})}valueFromOption(f,$){let E=$.attributeName();if(!this.dualOptions.has(E))return!0;let z=this.negativeOptions.get(E).presetArg,P=z!==void 0?z:!1;return $.negate===(P===f)}}function pf(f){return f.split("-").reduce(($,E)=>{return $+E[0].toUpperCase()+E.slice(1)})}function of(f){let $,E,z=f.split(/[ |,]+/);if(z.length>1&&!/^[[<]/.test(z[1]))$=z.shift();if(E=z.shift(),!$&&/^-[^-]$/.test(E))$=E,E=void 0;return{shortFlag:$,longFlag:E}}af.Option=a0;af.DualOptions=e0});var f1=U((z$)=>{function $$(f,$){if(Math.abs(f.length-$.length)>3)return Math.max(f.length,$.length);let E=[];for(let z=0;z<=f.length;z++)E[z]=[z];for(let z=0;z<=$.length;z++)E[0][z]=z;for(let z=1;z<=$.length;z++)for(let P=1;P<=f.length;P++){let Q=1;if(f[P-1]===$[z-1])Q=0;else Q=1;if(E[P][z]=Math.min(E[P-1][z]+1,E[P][z-1]+1,E[P-1][z-1]+Q),P>1&&z>1&&f[P-1]===$[z-2]&&f[P-2]===$[z-1])E[P][z]=Math.min(E[P][z],E[P-2][z-2]+1)}return E[f.length][$.length]}function E$(f,$){if(!$||$.length===0)return"";$=Array.from(new Set($));let E=f.startsWith("--");if(E)f=f.slice(2),$=$.map((S)=>S.slice(2));let z=[],P=3,Q=0.4;if($.forEach((S)=>{if(S.length<=1)return;let J=$$(f,S),Y=Math.max(f.length,S.length);if((Y-J)/Y>Q){if(J<P)P=J,z=[S];else if(J===P)z.push(S)}}),z.sort((S,J)=>S.localeCompare(J)),E)z=z.map((S)=>`--${S}`);if(z.length>1)return`
(Did you mean one of ${z.join(", ")}?)`;if(z.length===1)return`
(Did you mean ${z[0]}?)`;return""}z$.suggestSimilar=E$});var P1=U((Z$)=>{var Q$=M("events").EventEmitter,F0=M("child_process"),D=M("path"),q0=M("fs"),B=M("process"),{Argument:J$,humanReadableArgName:S$}=p(),{CommanderError:N0}=l(),{Help:Y$}=_0(),{Option:$1,DualOptions:X$}=H0(),{suggestSimilar:E1}=f1();class D0 extends Q${constructor(f){super();this.commands=[],this.options=[],this.parent=null,this._allowUnknownOption=!1,this._allowExcessArguments=!0,this.registeredArguments=[],this._args=this.registeredArguments,this.args=[],this.rawArgs=[],this.processedArgs=[],this._scriptPath=null,this._name=f||"",this._optionValues={},this._optionValueSources={},this._storeOptionsAsProperties=!1,this._actionHandler=null,this._executableHandler=!1,this._executableFile=null,this._executableDir=null,this._defaultCommandName=null,this._exitCallback=null,this._aliases=[],this._combineFlagAndOptionalValue=!0,this._description="",this._summary="",this._argsDescription=void 0,this._enablePositionalOptions=!1,this._passThroughOptions=!1,this._lifeCycleHooks={},this._showHelpAfterError=!1,this._showSuggestionAfterError=!0,this._outputConfiguration={writeOut:($)=>B.stdout.write($),writeErr:($)=>B.stderr.write($),getOutHelpWidth:()=>B.stdout.isTTY?B.stdout.columns:void 0,getErrHelpWidth:()=>B.stderr.isTTY?B.stderr.columns:void 0,outputError:($,E)=>E($)},this._hidden=!1,this._helpOption=void 0,this._addImplicitHelpCommand=void 0,this._helpCommand=void 0,this._helpConfiguration={}}copyInheritedSettings(f){return this._outputConfiguration=f._outputConfiguration,this._helpOption=f._helpOption,this._helpCommand=f._helpCommand,this._helpConfiguration=f._helpConfiguration,this._exitCallback=f._exitCallback,this._storeOptionsAsProperties=f._storeOptionsAsProperties,this._combineFlagAndOptionalValue=f._combineFlagAndOptionalValue,this._allowExcessArguments=f._allowExcessArguments,this._enablePositionalOptions=f._enablePositionalOptions,this._showHelpAfterError=f._showHelpAfterError,this._showSuggestionAfterError=f._showSuggestionAfterError,this}_getCommandAndAncestors(){let f=[];for(let $=this;$;$=$.parent)f.push($);return f}command(f,$,E){let z=$,P=E;if(typeof z==="object"&&z!==null)P=z,z=null;P=P||{};let[,Q,S]=f.match(/([^ ]+) *(.*)/),J=this.createCommand(Q);if(z)J.description(z),J._executableHandler=!0;if(P.isDefault)this._defaultCommandName=J._name;if(J._hidden=!!(P.noHelp||P.hidden),J._executableFile=P.executableFile||null,S)J.arguments(S);if(this._registerCommand(J),J.parent=this,J.copyInheritedSettings(this),z)return this;return J}createCommand(f){return new D0(f)}createHelp(){return Object.assign(new Y$,this.configureHelp())}configureHelp(f){if(f===void 0)return this._helpConfiguration;return this._helpConfiguration=f,this}configureOutput(f){if(f===void 0)return this._outputConfiguration;return Object.assign(this._outputConfiguration,f),this}showHelpAfterError(f=!0){if(typeof f!=="string")f=!!f;return this._showHelpAfterError=f,this}showSuggestionAfterError(f=!0){return this._showSuggestionAfterError=!!f,this}addCommand(f,$){if(!f._name)throw Error(`Command passed to .addCommand() must have a name
- specify the name in Command constructor or using .name()`);if($=$||{},$.isDefault)this._defaultCommandName=f._name;if($.noHelp||$.hidden)f._hidden=!0;return this._registerCommand(f),f.parent=this,f._checkForBrokenPassThrough(),this}createArgument(f,$){return new J$(f,$)}argument(f,$,E,z){let P=this.createArgument(f,$);if(typeof E==="function")P.default(z).argParser(E);else P.default(E);return this.addArgument(P),this}arguments(f){return f.trim().split(/ +/).forEach(($)=>{this.argument($)}),this}addArgument(f){let $=this.registeredArguments.slice(-1)[0];if($&&$.variadic)throw Error(`only the last argument can be variadic '${$.name()}'`);if(f.required&&f.defaultValue!==void 0&&f.parseArg===void 0)throw Error(`a default value for a required argument is never used: '${f.name()}'`);return this.registeredArguments.push(f),this}helpCommand(f,$){if(typeof f==="boolean")return this._addImplicitHelpCommand=f,this;f=f??"help [command]";let[,E,z]=f.match(/([^ ]+) *(.*)/),P=$??"display help for command",Q=this.createCommand(E);if(Q.helpOption(!1),z)Q.arguments(z);if(P)Q.description(P);return this._addImplicitHelpCommand=!0,this._helpCommand=Q,this}addHelpCommand(f,$){if(typeof f!=="object")return this.helpCommand(f,$),this;return this._addImplicitHelpCommand=!0,this._helpCommand=f,this}_getHelpCommand(){if(this._addImplicitHelpCommand??(this.commands.length&&!this._actionHandler&&!this._findCommand("help"))){if(this._helpCommand===void 0)this.helpCommand(void 0,void 0);return this._helpCommand}return null}hook(f,$){let E=["preSubcommand","preAction","postAction"];if(!E.includes(f))throw Error(`Unexpected value for event passed to hook : '${f}'.
Expecting one of '${E.join("', '")}'`);if(this._lifeCycleHooks[f])this._lifeCycleHooks[f].push($);else this._lifeCycleHooks[f]=[$];return this}exitOverride(f){if(f)this._exitCallback=f;else this._exitCallback=($)=>{if($.code!=="commander.executeSubCommandAsync")throw $};return this}_exit(f,$,E){if(this._exitCallback)this._exitCallback(new N0(f,$,E));B.exit(f)}action(f){let $=(E)=>{let z=this.registeredArguments.length,P=E.slice(0,z);if(this._storeOptionsAsProperties)P[z]=this;else P[z]=this.opts();return P.push(this),f.apply(this,P)};return this._actionHandler=$,this}createOption(f,$){return new $1(f,$)}_callParseArg(f,$,E,z){try{return f.parseArg($,E)}catch(P){if(P.code==="commander.invalidArgument"){let Q=`${z} ${P.message}`;this.error(Q,{exitCode:P.exitCode,code:P.code})}throw P}}_registerOption(f){let $=f.short&&this._findOption(f.short)||f.long&&this._findOption(f.long);if($){let E=f.long&&this._findOption(f.long)?f.long:f.short;throw Error(`Cannot add option '${f.flags}'${this._name&&` to command '${this._name}'`} due to conflicting flag '${E}'
-  already used by option '${$.flags}'`)}this.options.push(f)}_registerCommand(f){let $=(z)=>{return[z.name()].concat(z.aliases())},E=$(f).find((z)=>this._findCommand(z));if(E){let z=$(this._findCommand(E)).join("|"),P=$(f).join("|");throw Error(`cannot add command '${P}' as already have command '${z}'`)}this.commands.push(f)}addOption(f){this._registerOption(f);let $=f.name(),E=f.attributeName();if(f.negate){let P=f.long.replace(/^--no-/,"--");if(!this._findOption(P))this.setOptionValueWithSource(E,f.defaultValue===void 0?!0:f.defaultValue,"default")}else if(f.defaultValue!==void 0)this.setOptionValueWithSource(E,f.defaultValue,"default");let z=(P,Q,S)=>{if(P==null&&f.presetArg!==void 0)P=f.presetArg;let J=this.getOptionValue(E);if(P!==null&&f.parseArg)P=this._callParseArg(f,P,J,Q);else if(P!==null&&f.variadic)P=f._concatValue(P,J);if(P==null)if(f.negate)P=!1;else if(f.isBoolean()||f.optional)P=!0;else P="";this.setOptionValueWithSource(E,P,S)};if(this.on("option:"+$,(P)=>{let Q=`error: option '${f.flags}' argument '${P}' is invalid.`;z(P,Q,"cli")}),f.envVar)this.on("optionEnv:"+$,(P)=>{let Q=`error: option '${f.flags}' value '${P}' from env '${f.envVar}' is invalid.`;z(P,Q,"env")});return this}_optionEx(f,$,E,z,P){if(typeof $==="object"&&$ instanceof $1)throw Error("To add an Option object use addOption() instead of option() or requiredOption()");let Q=this.createOption($,E);if(Q.makeOptionMandatory(!!f.mandatory),typeof z==="function")Q.default(P).argParser(z);else if(z instanceof RegExp){let S=z;z=(J,Y)=>{let X=S.exec(J);return X?X[0]:Y},Q.default(P).argParser(z)}else Q.default(z);return this.addOption(Q)}option(f,$,E,z){return this._optionEx({},f,$,E,z)}requiredOption(f,$,E,z){return this._optionEx({mandatory:!0},f,$,E,z)}combineFlagAndOptionalValue(f=!0){return this._combineFlagAndOptionalValue=!!f,this}allowUnknownOption(f=!0){return this._allowUnknownOption=!!f,this}allowExcessArguments(f=!0){return this._allowExcessArguments=!!f,this}enablePositionalOptions(f=!0){return this._enablePositionalOptions=!!f,this}passThroughOptions(f=!0){return this._passThroughOptions=!!f,this._checkForBrokenPassThrough(),this}_checkForBrokenPassThrough(){if(this.parent&&this._passThroughOptions&&!this.parent._enablePositionalOptions)throw Error(`passThroughOptions cannot be used for '${this._name}' without turning on enablePositionalOptions for parent command(s)`)}storeOptionsAsProperties(f=!0){if(this.options.length)throw Error("call .storeOptionsAsProperties() before adding options");if(Object.keys(this._optionValues).length)throw Error("call .storeOptionsAsProperties() before setting option values");return this._storeOptionsAsProperties=!!f,this}getOptionValue(f){if(this._storeOptionsAsProperties)return this[f];return this._optionValues[f]}setOptionValue(f,$){return this.setOptionValueWithSource(f,$,void 0)}setOptionValueWithSource(f,$,E){if(this._storeOptionsAsProperties)this[f]=$;else this._optionValues[f]=$;return this._optionValueSources[f]=E,this}getOptionValueSource(f){return this._optionValueSources[f]}getOptionValueSourceWithGlobals(f){let $;return this._getCommandAndAncestors().forEach((E)=>{if(E.getOptionValueSource(f)!==void 0)$=E.getOptionValueSource(f)}),$}_prepareUserArgs(f,$){if(f!==void 0&&!Array.isArray(f))throw Error("first parameter to parse must be array or undefined");if($=$||{},f===void 0&&$.from===void 0){if(B.versions?.electron)$.from="electron";let z=B.execArgv??[];if(z.includes("-e")||z.includes("--eval")||z.includes("-p")||z.includes("--print"))$.from="eval"}if(f===void 0)f=B.argv;this.rawArgs=f.slice();let E;switch($.from){case void 0:case"node":this._scriptPath=f[1],E=f.slice(2);break;case"electron":if(B.defaultApp)this._scriptPath=f[1],E=f.slice(2);else E=f.slice(1);break;case"user":E=f.slice(0);break;case"eval":E=f.slice(1);break;default:throw Error(`unexpected parse option { from: '${$.from}' }`)}if(!this._name&&this._scriptPath)this.nameFromFilename(this._scriptPath);return this._name=this._name||"program",E}parse(f,$){let E=this._prepareUserArgs(f,$);return this._parseCommand([],E),this}async parseAsync(f,$){let E=this._prepareUserArgs(f,$);return await this._parseCommand([],E),this}_executeSubCommand(f,$){$=$.slice();let E=!1,z=[".js",".ts",".tsx",".mjs",".cjs"];function P(X,Z){let R=D.resolve(X,Z);if(q0.existsSync(R))return R;if(z.includes(D.extname(Z)))return;let T=z.find((W)=>q0.existsSync(`${R}${W}`));if(T)return`${R}${T}`;return}this._checkForMissingMandatoryOptions(),this._checkForConflictingOptions();let Q=f._executableFile||`${this._name}-${f._name}`,S=this._executableDir||"";if(this._scriptPath){let X;try{X=q0.realpathSync(this._scriptPath)}catch(Z){X=this._scriptPath}S=D.resolve(D.dirname(X),S)}if(S){let X=P(S,Q);if(!X&&!f._executableFile&&this._scriptPath){let Z=D.basename(this._scriptPath,D.extname(this._scriptPath));if(Z!==this._name)X=P(S,`${Z}-${f._name}`)}Q=X||Q}E=z.includes(D.extname(Q));let J;if(B.platform!=="win32")if(E)$.unshift(Q),$=z1(B.execArgv).concat($),J=F0.spawn(B.argv[0],$,{stdio:"inherit"});else J=F0.spawn(Q,$,{stdio:"inherit"});else $.unshift(Q),$=z1(B.execArgv).concat($),J=F0.spawn(B.execPath,$,{stdio:"inherit"});if(!J.killed)["SIGUSR1","SIGUSR2","SIGTERM","SIGINT","SIGHUP"].forEach((Z)=>{B.on(Z,()=>{if(J.killed===!1&&J.exitCode===null)J.kill(Z)})});let Y=this._exitCallback;J.on("close",(X)=>{if(X=X??1,!Y)B.exit(X);else Y(new N0(X,"commander.executeSubCommandAsync","(close)"))}),J.on("error",(X)=>{if(X.code==="ENOENT"){let Z=S?`searched for local subcommand relative to directory '${S}'`:"no directory for search for local subcommand, use .executableDir() to supply a custom directory",R=`'${Q}' does not exist
 - if '${f._name}' is not meant to be an executable command, remove description parameter from '.command()' and use '.description()' instead
 - if the default executable name is not suitable, use the executableFile option to supply a custom name or path
 - ${Z}`;throw Error(R)}else if(X.code==="EACCES")throw Error(`'${Q}' not executable`);if(!Y)B.exit(1);else{let Z=new N0(1,"commander.executeSubCommandAsync","(error)");Z.nestedError=X,Y(Z)}}),this.runningCommand=J}_dispatchSubcommand(f,$,E){let z=this._findCommand(f);if(!z)this.help({error:!0});let P;return P=this._chainOrCallSubCommandHook(P,z,"preSubcommand"),P=this._chainOrCall(P,()=>{if(z._executableHandler)this._executeSubCommand(z,$.concat(E));else return z._parseCommand($,E)}),P}_dispatchHelpCommand(f){if(!f)this.help();let $=this._findCommand(f);if($&&!$._executableHandler)$.help();return this._dispatchSubcommand(f,[],[this._getHelpOption()?.long??this._getHelpOption()?.short??"--help"])}_checkNumberOfArguments(){if(this.registeredArguments.forEach((f,$)=>{if(f.required&&this.args[$]==null)this.missingArgument(f.name())}),this.registeredArguments.length>0&&this.registeredArguments[this.registeredArguments.length-1].variadic)return;if(this.args.length>this.registeredArguments.length)this._excessArguments(this.args)}_processArguments(){let f=(E,z,P)=>{let Q=z;if(z!==null&&E.parseArg){let S=`error: command-argument value '${z}' is invalid for argument '${E.name()}'.`;Q=this._callParseArg(E,z,P,S)}return Q};this._checkNumberOfArguments();let $=[];this.registeredArguments.forEach((E,z)=>{let P=E.defaultValue;if(E.variadic){if(z<this.args.length){if(P=this.args.slice(z),E.parseArg)P=P.reduce((Q,S)=>{return f(E,S,Q)},E.defaultValue)}else if(P===void 0)P=[]}else if(z<this.args.length){if(P=this.args[z],E.parseArg)P=f(E,P,E.defaultValue)}$[z]=P}),this.processedArgs=$}_chainOrCall(f,$){if(f&&f.then&&typeof f.then==="function")return f.then(()=>$());return $()}_chainOrCallHooks(f,$){let E=f,z=[];if(this._getCommandAndAncestors().reverse().filter((P)=>P._lifeCycleHooks[$]!==void 0).forEach((P)=>{P._lifeCycleHooks[$].forEach((Q)=>{z.push({hookedCommand:P,callback:Q})})}),$==="postAction")z.reverse();return z.forEach((P)=>{E=this._chainOrCall(E,()=>{return P.callback(P.hookedCommand,this)})}),E}_chainOrCallSubCommandHook(f,$,E){let z=f;if(this._lifeCycleHooks[E]!==void 0)this._lifeCycleHooks[E].forEach((P)=>{z=this._chainOrCall(z,()=>{return P(this,$)})});return z}_parseCommand(f,$){let E=this.parseOptions($);if(this._parseOptionsEnv(),this._parseOptionsImplied(),f=f.concat(E.operands),$=E.unknown,this.args=f.concat($),f&&this._findCommand(f[0]))return this._dispatchSubcommand(f[0],f.slice(1),$);if(this._getHelpCommand()&&f[0]===this._getHelpCommand().name())return this._dispatchHelpCommand(f[1]);if(this._defaultCommandName)return this._outputHelpIfRequested($),this._dispatchSubcommand(this._defaultCommandName,f,$);if(this.commands.length&&this.args.length===0&&!this._actionHandler&&!this._defaultCommandName)this.help({error:!0});this._outputHelpIfRequested(E.unknown),this._checkForMissingMandatoryOptions(),this._checkForConflictingOptions();let z=()=>{if(E.unknown.length>0)this.unknownOption(E.unknown[0])},P=`command:${this.name()}`;if(this._actionHandler){z(),this._processArguments();let Q;if(Q=this._chainOrCallHooks(Q,"preAction"),Q=this._chainOrCall(Q,()=>this._actionHandler(this.processedArgs)),this.parent)Q=this._chainOrCall(Q,()=>{this.parent.emit(P,f,$)});return Q=this._chainOrCallHooks(Q,"postAction"),Q}if(this.parent&&this.parent.listenerCount(P))z(),this._processArguments(),this.parent.emit(P,f,$);else if(f.length){if(this._findCommand("*"))return this._dispatchSubcommand("*",f,$);if(this.listenerCount("command:*"))this.emit("command:*",f,$);else if(this.commands.length)this.unknownCommand();else z(),this._processArguments()}else if(this.commands.length)z(),this.help({error:!0});else z(),this._processArguments()}_findCommand(f){if(!f)return;return this.commands.find(($)=>$._name===f||$._aliases.includes(f))}_findOption(f){return this.options.find(($)=>$.is(f))}_checkForMissingMandatoryOptions(){this._getCommandAndAncestors().forEach((f)=>{f.options.forEach(($)=>{if($.mandatory&&f.getOptionValue($.attributeName())===void 0)f.missingMandatoryOptionValue($)})})}_checkForConflictingLocalOptions(){let f=this.options.filter((E)=>{let z=E.attributeName();if(this.getOptionValue(z)===void 0)return!1;return this.getOptionValueSource(z)!=="default"});f.filter((E)=>E.conflictsWith.length>0).forEach((E)=>{let z=f.find((P)=>E.conflictsWith.includes(P.attributeName()));if(z)this._conflictingOption(E,z)})}_checkForConflictingOptions(){this._getCommandAndAncestors().forEach((f)=>{f._checkForConflictingLocalOptions()})}parseOptions(f){let $=[],E=[],z=$,P=f.slice();function Q(J){return J.length>1&&J[0]==="-"}let S=null;while(P.length){let J=P.shift();if(J==="--"){if(z===E)z.push(J);z.push(...P);break}if(S&&!Q(J)){this.emit(`option:${S.name()}`,J);continue}if(S=null,Q(J)){let Y=this._findOption(J);if(Y){if(Y.required){let X=P.shift();if(X===void 0)this.optionMissingArgument(Y);this.emit(`option:${Y.name()}`,X)}else if(Y.optional){let X=null;if(P.length>0&&!Q(P[0]))X=P.shift();this.emit(`option:${Y.name()}`,X)}else this.emit(`option:${Y.name()}`);S=Y.variadic?Y:null;continue}}if(J.length>2&&J[0]==="-"&&J[1]!=="-"){let Y=this._findOption(`-${J[1]}`);if(Y){if(Y.required||Y.optional&&this._combineFlagAndOptionalValue)this.emit(`option:${Y.name()}`,J.slice(2));else this.emit(`option:${Y.name()}`),P.unshift(`-${J.slice(2)}`);continue}}if(/^--[^=]+=/.test(J)){let Y=J.indexOf("="),X=this._findOption(J.slice(0,Y));if(X&&(X.required||X.optional)){this.emit(`option:${X.name()}`,J.slice(Y+1));continue}}if(Q(J))z=E;if((this._enablePositionalOptions||this._passThroughOptions)&&$.length===0&&E.length===0){if(this._findCommand(J)){if($.push(J),P.length>0)E.push(...P);break}else if(this._getHelpCommand()&&J===this._getHelpCommand().name()){if($.push(J),P.length>0)$.push(...P);break}else if(this._defaultCommandName){if(E.push(J),P.length>0)E.push(...P);break}}if(this._passThroughOptions){if(z.push(J),P.length>0)z.push(...P);break}z.push(J)}return{operands:$,unknown:E}}opts(){if(this._storeOptionsAsProperties){let f={},$=this.options.length;for(let E=0;E<$;E++){let z=this.options[E].attributeName();f[z]=z===this._versionOptionName?this._version:this[z]}return f}return this._optionValues}optsWithGlobals(){return this._getCommandAndAncestors().reduce((f,$)=>Object.assign(f,$.opts()),{})}error(f,$){if(this._outputConfiguration.outputError(`${f}
`,this._outputConfiguration.writeErr),typeof this._showHelpAfterError==="string")this._outputConfiguration.writeErr(`${this._showHelpAfterError}
`);else if(this._showHelpAfterError)this._outputConfiguration.writeErr(`
`),this.outputHelp({error:!0});let E=$||{},z=E.exitCode||1,P=E.code||"commander.error";this._exit(z,P,f)}_parseOptionsEnv(){this.options.forEach((f)=>{if(f.envVar&&f.envVar in B.env){let $=f.attributeName();if(this.getOptionValue($)===void 0||["default","config","env"].includes(this.getOptionValueSource($)))if(f.required||f.optional)this.emit(`optionEnv:${f.name()}`,B.env[f.envVar]);else this.emit(`optionEnv:${f.name()}`)}})}_parseOptionsImplied(){let f=new X$(this.options),$=(E)=>{return this.getOptionValue(E)!==void 0&&!["default","implied"].includes(this.getOptionValueSource(E))};this.options.filter((E)=>E.implied!==void 0&&$(E.attributeName())&&f.valueFromOption(this.getOptionValue(E.attributeName()),E)).forEach((E)=>{Object.keys(E.implied).filter((z)=>!$(z)).forEach((z)=>{this.setOptionValueWithSource(z,E.implied[z],"implied")})})}missingArgument(f){let $=`error: missing required argument '${f}'`;this.error($,{code:"commander.missingArgument"})}optionMissingArgument(f){let $=`error: option '${f.flags}' argument missing`;this.error($,{code:"commander.optionMissingArgument"})}missingMandatoryOptionValue(f){let $=`error: required option '${f.flags}' not specified`;this.error($,{code:"commander.missingMandatoryOptionValue"})}_conflictingOption(f,$){let E=(Q)=>{let S=Q.attributeName(),J=this.getOptionValue(S),Y=this.options.find((Z)=>Z.negate&&S===Z.attributeName()),X=this.options.find((Z)=>!Z.negate&&S===Z.attributeName());if(Y&&(Y.presetArg===void 0&&J===!1||Y.presetArg!==void 0&&J===Y.presetArg))return Y;return X||Q},z=(Q)=>{let S=E(Q),J=S.attributeName();if(this.getOptionValueSource(J)==="env")return`environment variable '${S.envVar}'`;return`option '${S.flags}'`},P=`error: ${z(f)} cannot be used with ${z($)}`;this.error(P,{code:"commander.conflictingOption"})}unknownOption(f){if(this._allowUnknownOption)return;let $="";if(f.startsWith("--")&&this._showSuggestionAfterError){let z=[],P=this;do{let Q=P.createHelp().visibleOptions(P).filter((S)=>S.long).map((S)=>S.long);z=z.concat(Q),P=P.parent}while(P&&!P._enablePositionalOptions);$=E1(f,z)}let E=`error: unknown option '${f}'${$}`;this.error(E,{code:"commander.unknownOption"})}_excessArguments(f){if(this._allowExcessArguments)return;let $=this.registeredArguments.length,E=$===1?"":"s",P=`error: too many arguments${this.parent?` for '${this.name()}'`:""}. Expected ${$} argument${E} but got ${f.length}.`;this.error(P,{code:"commander.excessArguments"})}unknownCommand(){let f=this.args[0],$="";if(this._showSuggestionAfterError){let z=[];this.createHelp().visibleCommands(this).forEach((P)=>{if(z.push(P.name()),P.alias())z.push(P.alias())}),$=E1(f,z)}let E=`error: unknown command '${f}'${$}`;this.error(E,{code:"commander.unknownCommand"})}version(f,$,E){if(f===void 0)return this._version;this._version=f,$=$||"-V, --version",E=E||"output the version number";let z=this.createOption($,E);return this._versionOptionName=z.attributeName(),this._registerOption(z),this.on("option:"+z.name(),()=>{this._outputConfiguration.writeOut(`${f}
`),this._exit(0,"commander.version",f)}),this}description(f,$){if(f===void 0&&$===void 0)return this._description;if(this._description=f,$)this._argsDescription=$;return this}summary(f){if(f===void 0)return this._summary;return this._summary=f,this}alias(f){if(f===void 0)return this._aliases[0];let $=this;if(this.commands.length!==0&&this.commands[this.commands.length-1]._executableHandler)$=this.commands[this.commands.length-1];if(f===$._name)throw Error("Command alias can't be the same as its name");let E=this.parent?._findCommand(f);if(E){let z=[E.name()].concat(E.aliases()).join("|");throw Error(`cannot add alias '${f}' to command '${this.name()}' as already have command '${z}'`)}return $._aliases.push(f),this}aliases(f){if(f===void 0)return this._aliases;return f.forEach(($)=>this.alias($)),this}usage(f){if(f===void 0){if(this._usage)return this._usage;let $=this.registeredArguments.map((E)=>{return S$(E)});return[].concat(this.options.length||this._helpOption!==null?"[options]":[],this.commands.length?"[command]":[],this.registeredArguments.length?$:[]).join(" ")}return this._usage=f,this}name(f){if(f===void 0)return this._name;return this._name=f,this}nameFromFilename(f){return this._name=D.basename(f,D.extname(f)),this}executableDir(f){if(f===void 0)return this._executableDir;return this._executableDir=f,this}helpInformation(f){let $=this.createHelp();if($.helpWidth===void 0)$.helpWidth=f&&f.error?this._outputConfiguration.getErrHelpWidth():this._outputConfiguration.getOutHelpWidth();return $.formatHelp(this,$)}_getHelpContext(f){f=f||{};let $={error:!!f.error},E;if($.error)E=(z)=>this._outputConfiguration.writeErr(z);else E=(z)=>this._outputConfiguration.writeOut(z);return $.write=f.write||E,$.command=this,$}outputHelp(f){let $;if(typeof f==="function")$=f,f=void 0;let E=this._getHelpContext(f);this._getCommandAndAncestors().reverse().forEach((P)=>P.emit("beforeAllHelp",E)),this.emit("beforeHelp",E);let z=this.helpInformation(E);if($){if(z=$(z),typeof z!=="string"&&!Buffer.isBuffer(z))throw Error("outputHelp callback must return a string or a Buffer")}if(E.write(z),this._getHelpOption()?.long)this.emit(this._getHelpOption().long);this.emit("afterHelp",E),this._getCommandAndAncestors().forEach((P)=>P.emit("afterAllHelp",E))}helpOption(f,$){if(typeof f==="boolean"){if(f)this._helpOption=this._helpOption??void 0;else this._helpOption=null;return this}return f=f??"-h, --help",$=$??"display help for command",this._helpOption=this.createOption(f,$),this}_getHelpOption(){if(this._helpOption===void 0)this.helpOption(void 0,void 0);return this._helpOption}addHelpOption(f){return this._helpOption=f,this}help(f){this.outputHelp(f);let $=B.exitCode||0;if($===0&&f&&typeof f!=="function"&&f.error)$=1;this._exit($,"commander.help","(outputHelp)")}addHelpText(f,$){let E=["beforeAll","before","after","afterAll"];if(!E.includes(f))throw Error(`Unexpected value for position to addHelpText.
Expecting one of '${E.join("', '")}'`);let z=`${f}Help`;return this.on(z,(P)=>{let Q;if(typeof $==="function")Q=$({error:P.error,command:P.command});else Q=$;if(Q)P.write(`${Q}
`)}),this}_outputHelpIfRequested(f){let $=this._getHelpOption();if($&&f.find((z)=>$.is(z)))this.outputHelp(),this._exit(0,"commander.helpDisplayed","(outputHelp)")}}function z1(f){return f.map(($)=>{if(!$.startsWith("--inspect"))return $;let E,z="127.0.0.1",P="9229",Q;if((Q=$.match(/^(--inspect(-brk)?)$/))!==null)E=Q[1];else if((Q=$.match(/^(--inspect(-brk|-port)?)=([^:]+)$/))!==null)if(E=Q[1],/^\d+$/.test(Q[3]))P=Q[3];else z=Q[3];else if((Q=$.match(/^(--inspect(-brk|-port)?)=([^:]+):(\d+)$/))!==null)E=Q[1],z=Q[3],P=Q[4];if(E&&P!=="0")return`${E}=${z}:${parseInt(P)+1}`;return $})}Z$.Command=D0});var Y1=U((I$)=>{var{Argument:Q1}=p(),{Command:w0}=P1(),{CommanderError:W$,InvalidArgumentError:J1}=l(),{Help:T$}=_0(),{Option:S1}=H0();I$.program=new w0;I$.createCommand=(f)=>new w0(f);I$.createOption=(f,$)=>new S1(f,$);I$.createArgument=(f,$)=>new Q1(f,$);I$.Command=w0;I$.Option=S1;I$.Argument=Q1;I$.Help=T$;I$.CommanderError=W$;I$.InvalidArgumentError=J1;I$.InvalidOptionArgumentError=J1});var q=U((q$)=>{q$.getBooleanOption=(f,$)=>{let E=!1;if($ in f&&typeof(E=f[$])!=="boolean")throw TypeError(`Expected the "${$}" option to be a boolean`);return E};q$.cppdb=Symbol();q$.inspect=Symbol.for("nodejs.util.inspect.custom")});var x0=U((PE,Z1)=>{var A0={value:"SqliteError",writable:!0,enumerable:!1,configurable:!0};function O(f,$){if(new.target!==O)return new O(f,$);if(typeof $!=="string")throw TypeError("Expected second argument to be a string");Error.call(this,f),A0.value=""+f,Object.defineProperty(this,"message",A0),Error.captureStackTrace(this,O),this.code=$}Object.setPrototypeOf(O,Error);Object.setPrototypeOf(O.prototype,Error.prototype);Object.defineProperty(O.prototype,"name",A0);Z1.exports=O});var W1=U((QE,R1)=>{var o=M("path").sep||"/";R1.exports=A$;function A$(f){if(typeof f!="string"||f.length<=7||f.substring(0,7)!="file://")throw TypeError("must pass in a file:// URI to convert to a file path");var $=decodeURI(f.substring(7)),E=$.indexOf("/"),z=$.substring(0,E),P=$.substring(E+1);if(z=="localhost")z="";if(z)z=o+o+z;if(P=P.replace(/^(.+)\|/,"$1:"),o=="\\")P=P.replace(/\//g,"\\");if(/^.+\:/.test(P));else P=o+P;return z+P}});var U1=U((f0,L1)=>{var __filename="/home/mrkai/code/wasp/node_modules/bindings/bindings.js",O0=M("fs"),e=M("path"),x$=W1(),a=e.join,O$=e.dirname,T1=O0.accessSync&&function(f){try{O0.accessSync(f)}catch($){return!1}return!0}||O0.existsSync||e.existsSync,I1={arrow:process.env.NODE_BINDINGS_ARROW||" \u2192 ",compiled:process.env.NODE_BINDINGS_COMPILED_DIR||"compiled",platform:process.platform,arch:process.arch,nodePreGyp:"node-v"+process.versions.modules+"-"+process.platform+"-"+process.arch,version:process.versions.node,bindings:"bindings.node",try:[["module_root","build","bindings"],["module_root","build","Debug","bindings"],["module_root","build","Release","bindings"],["module_root","out","Debug","bindings"],["module_root","Debug","bindings"],["module_root","out","Release","bindings"],["module_root","Release","bindings"],["module_root","build","default","bindings"],["module_root","compiled","version","platform","arch","bindings"],["module_root","addon-build","release","install-root","bindings"],["module_root","addon-build","debug","install-root","bindings"],["module_root","addon-build","default","install-root","bindings"],["module_root","lib","binding","nodePreGyp","bindings"]]};function y$(f){if(typeof f=="string")f={bindings:f};else if(!f)f={};if(Object.keys(I1).map(function(Y){if(!(Y in f))f[Y]=I1[Y]}),!f.module_root)f.module_root=f0.getRoot(f0.getFileName());if(e.extname(f.bindings)!=".node")f.bindings+=".node";var $=typeof __webpack_require__==="function"?__non_webpack_require__:M,E=[],z=0,P=f.try.length,Q,S,J;for(;z<P;z++){Q=a.apply(null,f.try[z].map(function(Y){return f[Y]||Y})),E.push(Q);try{if(S=f.path?$.resolve(Q):$(Q),!f.path)S.path=Q;return S}catch(Y){if(Y.code!=="MODULE_NOT_FOUND"&&Y.code!=="QUALIFIED_PATH_RESOLUTION_FAILED"&&!/not find/i.test(Y.message))throw Y}}throw J=Error(`Could not locate the bindings file. Tried:
`+E.map(function(Y){return f.arrow+Y}).join(`
`)),J.tries=E,J}L1.exports=f0=y$;f0.getFileName=function($){var{prepareStackTrace:E,stackTraceLimit:z}=Error,P={},Q;Error.stackTraceLimit=10,Error.prepareStackTrace=function(J,Y){for(var X=0,Z=Y.length;X<Z;X++)if(Q=Y[X].getFileName(),Q!==__filename)if($){if(Q!==$)return}else return},Error.captureStackTrace(P),P.stack,Error.prepareStackTrace=E,Error.stackTraceLimit=z;var S="file://";if(Q.indexOf(S)===0)Q=x$(Q);return Q};f0.getRoot=function($){var E=O$($),z;while(!0){if(E===".")E=process.cwd();if(T1(a(E,"package.json"))||T1(a(E,"node_modules")))return E;if(z===E)throw Error('Could not find module root given file: "'+$+'". Do you have a `package.json` file? ');z=E,E=a(E,"..")}}});var B1=U((C$)=>{var{cppdb:H}=q();C$.prepare=function($){return this[H].prepare($,this,!1)};C$.exec=function($){return this[H].exec($),this};C$.close=function(){return this[H].close(),this};C$.loadExtension=function(...$){return this[H].loadExtension(...$),this};C$.defaultSafeIntegers=function(...$){return this[H].defaultSafeIntegers(...$),this};C$.unsafeMode=function(...$){return this[H].unsafeMode(...$),this};C$.getters={name:{get:function(){return this[H].name},enumerable:!0},open:{get:function(){return this[H].open},enumerable:!0},inTransaction:{get:function(){return this[H].inTransaction},enumerable:!0},readonly:{get:function(){return this[H].readonly},enumerable:!0},memory:{get:function(){return this[H].memory},enumerable:!0}}});var K1=U((ZE,M1)=>{var{cppdb:l$}=q(),j1=new WeakMap;M1.exports=function($){if(typeof $!=="function")throw TypeError("Expected first argument to be a function");let E=this[l$],z=s$(E,this),{apply:P}=Function.prototype,Q={default:{value:$0(P,$,E,z.default)},deferred:{value:$0(P,$,E,z.deferred)},immediate:{value:$0(P,$,E,z.immediate)},exclusive:{value:$0(P,$,E,z.exclusive)},database:{value:this,enumerable:!0}};return Object.defineProperties(Q.default.value,Q),Object.defineProperties(Q.deferred.value,Q),Object.defineProperties(Q.immediate.value,Q),Object.defineProperties(Q.exclusive.value,Q),Q.default.value};var s$=(f,$)=>{let E=j1.get(f);if(!E){let z={commit:f.prepare("COMMIT",$,!1),rollback:f.prepare("ROLLBACK",$,!1),savepoint:f.prepare("SAVEPOINT `\t_bs3.\t`",$,!1),release:f.prepare("RELEASE `\t_bs3.\t`",$,!1),rollbackTo:f.prepare("ROLLBACK TO `\t_bs3.\t`",$,!1)};j1.set(f,E={default:Object.assign({begin:f.prepare("BEGIN",$,!1)},z),deferred:Object.assign({begin:f.prepare("BEGIN DEFERRED",$,!1)},z),immediate:Object.assign({begin:f.prepare("BEGIN IMMEDIATE",$,!1)},z),exclusive:Object.assign({begin:f.prepare("BEGIN EXCLUSIVE",$,!1)},z)})}return E},$0=(f,$,E,{begin:z,commit:P,rollback:Q,savepoint:S,release:J,rollbackTo:Y})=>function(){let Z,R,T;if(E.inTransaction)Z=S,R=J,T=Y;else Z=z,R=P,T=Q;Z.run();try{let W=f.call($,this,arguments);if(W&&typeof W.then==="function")throw TypeError("Transaction function cannot return a promise");return R.run(),W}catch(W){if(E.inTransaction){if(T.run(),T!==Q)R.run()}throw W}}});var V1=U((RE,G1)=>{var{getBooleanOption:i$,cppdb:t$}=q();G1.exports=function($,E){if(E==null)E={};if(typeof $!=="string")throw TypeError("Expected first argument to be a string");if(typeof E!=="object")throw TypeError("Expected second argument to be an options object");let z=i$(E,"simple"),P=this[t$].prepare(`PRAGMA ${$}`,this,!0);return z?P.pluck().get():P.all()}});var F1=U((WE,H1)=>{var r$=M("fs"),m$=M("path"),{promisify:n$}=M("util"),{cppdb:d$}=q(),_1=n$(r$.access);H1.exports=async function($,E){if(E==null)E={};if(typeof $!=="string")throw TypeError("Expected first argument to be a string");if(typeof E!=="object")throw TypeError("Expected second argument to be an options object");$=$.trim();let z="attached"in E?E.attached:"main",P="progress"in E?E.progress:null;if(!$)throw TypeError("Backup filename cannot be an empty string");if($===":memory:")throw TypeError('Invalid backup filename ":memory:"');if(typeof z!=="string")throw TypeError('Expected the "attached" option to be a string');if(!z)throw TypeError('The "attached" option cannot be an empty string');if(P!=null&&typeof P!=="function")throw TypeError('Expected the "progress" option to be a function');await _1(m$.dirname($)).catch(()=>{throw TypeError("Cannot save backup because the directory does not exist")});let Q=await _1($).then(()=>!1,()=>!0);return p$(this[d$].backup(this,z,$,Q),P||null)};var p$=(f,$)=>{let E=0,z=!0;return new Promise((P,Q)=>{setImmediate(function S(){try{let J=f.transfer(E);if(!J.remainingPages){f.close(),P(J);return}if(z)z=!1,E=100;if($){let Y=$(J);if(Y!==void 0)if(typeof Y==="number"&&Y===Y)E=Math.max(0,Math.min(2147483647,Math.round(Y)));else throw TypeError("Expected progress callback to return a number or undefined")}setImmediate(S)}catch(J){f.close(),Q(J)}})})}});var N1=U((TE,q1)=>{var{cppdb:o$}=q();q1.exports=function($){if($==null)$={};if(typeof $!=="object")throw TypeError("Expected first argument to be an options object");let E="attached"in $?$.attached:"main";if(typeof E!=="string")throw TypeError('Expected the "attached" option to be a string');if(!E)throw TypeError('The "attached" option cannot be an empty string');return this[o$].serialize(E)}});var w1=U((IE,D1)=>{var{getBooleanOption:E0,cppdb:a$}=q();D1.exports=function($,E,z){if(E==null)E={};if(typeof E==="function")z=E,E={};if(typeof $!=="string")throw TypeError("Expected first argument to be a string");if(typeof z!=="function")throw TypeError("Expected last argument to be a function");if(typeof E!=="object")throw TypeError("Expected second argument to be an options object");if(!$)throw TypeError("User-defined function name cannot be an empty string");let P="safeIntegers"in E?+E0(E,"safeIntegers"):2,Q=E0(E,"deterministic"),S=E0(E,"directOnly"),J=E0(E,"varargs"),Y=-1;if(!J){if(Y=z.length,!Number.isInteger(Y)||Y<0)throw TypeError("Expected function.length to be a positive integer");if(Y>100)throw RangeError("User-defined functions cannot have more than 100 arguments")}return this[a$].function(z,$,Y,P,Q,S),this}});var O1=U((LE,x1)=>{var{getBooleanOption:z0,cppdb:e$}=q();x1.exports=function($,E){if(typeof $!=="string")throw TypeError("Expected first argument to be a string");if(typeof E!=="object"||E===null)throw TypeError("Expected second argument to be an options object");if(!$)throw TypeError("User-defined function name cannot be an empty string");let z="start"in E?E.start:null,P=y0(E,"step",!0),Q=y0(E,"inverse",!1),S=y0(E,"result",!1),J="safeIntegers"in E?+z0(E,"safeIntegers"):2,Y=z0(E,"deterministic"),X=z0(E,"directOnly"),Z=z0(E,"varargs"),R=-1;if(!Z){if(R=Math.max(A1(P),Q?A1(Q):0),R>0)R-=1;if(R>100)throw RangeError("User-defined functions cannot have more than 100 arguments")}return this[e$].aggregate(z,P,Q,S,$,R,J,Y,X),this};var y0=(f,$,E)=>{let z=$ in f?f[$]:null;if(typeof z==="function")return z;if(z!=null)throw TypeError(`Expected the "${$}" option to be a function`);if(E)throw TypeError(`Missing required option "${$}"`);return null},A1=({length:f})=>{if(Number.isInteger(f)&&f>=0)return f;throw TypeError("Expected function.length to be a positive integer")}});var k1=U((UE,b1)=>{var{cppdb:f2}=q();b1.exports=function($,E){if(typeof $!=="string")throw TypeError("Expected first argument to be a string");if(!$)throw TypeError("Virtual table module name cannot be an empty string");let z=!1;if(typeof E==="object"&&E!==null)z=!0,E=Y2(C1(E,"used",$));else{if(typeof E!=="function")throw TypeError("Expected second argument to be a function or a table definition object");E=$2(E)}return this[f2].table(E,$,z),this};function $2(f){return function(E,z,P,...Q){let S={module:E,database:z,table:P},J=J2.call(f,S,Q);if(typeof J!=="object"||J===null)throw TypeError(`Virtual table module "${E}" did not return a table definition object`);return C1(J,"returned",E)}}function C1(f,$,E){if(!s.call(f,"rows"))throw TypeError(`Virtual table module "${E}" ${$} a table definition without a "rows" property`);if(!s.call(f,"columns"))throw TypeError(`Virtual table module "${E}" ${$} a table definition without a "columns" property`);let z=f.rows;if(typeof z!=="function"||Object.getPrototypeOf(z)!==S2)throw TypeError(`Virtual table module "${E}" ${$} a table definition with an invalid "rows" property (should be a generator function)`);let P=f.columns;if(!Array.isArray(P)||!(P=[...P]).every((X)=>typeof X==="string"))throw TypeError(`Virtual table module "${E}" ${$} a table definition with an invalid "columns" property (should be an array of strings)`);if(P.length!==new Set(P).size)throw TypeError(`Virtual table module "${E}" ${$} a table definition with duplicate column names`);if(!P.length)throw RangeError(`Virtual table module "${E}" ${$} a table definition with zero columns`);let Q;if(s.call(f,"parameters")){if(Q=f.parameters,!Array.isArray(Q)||!(Q=[...Q]).every((X)=>typeof X==="string"))throw TypeError(`Virtual table module "${E}" ${$} a table definition with an invalid "parameters" property (should be an array of strings)`)}else Q=Q2(z);if(Q.length!==new Set(Q).size)throw TypeError(`Virtual table module "${E}" ${$} a table definition with duplicate parameter names`);if(Q.length>32)throw RangeError(`Virtual table module "${E}" ${$} a table definition with more than the maximum number of 32 parameters`);for(let X of Q)if(P.includes(X))throw TypeError(`Virtual table module "${E}" ${$} a table definition with column "${X}" which was ambiguously defined as both a column and parameter`);let S=2;if(s.call(f,"safeIntegers")){let X=f.safeIntegers;if(typeof X!=="boolean")throw TypeError(`Virtual table module "${E}" ${$} a table definition with an invalid "safeIntegers" property (should be a boolean)`);S=+X}let J=!1;if(s.call(f,"directOnly")){if(J=f.directOnly,typeof J!=="boolean")throw TypeError(`Virtual table module "${E}" ${$} a table definition with an invalid "directOnly" property (should be a boolean)`)}return[`CREATE TABLE x(${[...Q.map(y1).map((X)=>`${X} HIDDEN`),...P.map(y1)].join(", ")});`,E2(z,new Map(P.map((X,Z)=>[X,Q.length+Z])),E),Q,S,J]}function E2(f,$,E){return function*(...P){let Q=P.map((S)=>Buffer.isBuffer(S)?Buffer.from(S):S);for(let S=0;S<$.size;++S)Q.push(null);for(let S of f(...P))if(Array.isArray(S))z2(S,Q,$.size,E),yield Q;else if(typeof S==="object"&&S!==null)P2(S,Q,$,E),yield Q;else throw TypeError(`Virtual table module "${E}" yielded something that isn't a valid row object`)}}function z2(f,$,E,z){if(f.length!==E)throw TypeError(`Virtual table module "${z}" yielded a row with an incorrect number of columns`);let P=$.length-E;for(let Q=0;Q<E;++Q)$[Q+P]=f[Q]}function P2(f,$,E,z){let P=0;for(let Q of Object.keys(f)){let S=E.get(Q);if(S===void 0)throw TypeError(`Virtual table module "${z}" yielded a row with an undeclared column "${Q}"`);$[S]=f[Q],P+=1}if(P!==E.size)throw TypeError(`Virtual table module "${z}" yielded a row with missing columns`)}function Q2({length:f}){if(!Number.isInteger(f)||f<0)throw TypeError("Expected function.length to be a positive integer");let $=[];for(let E=0;E<f;++E)$.push(`$${E+1}`);return $}var{hasOwnProperty:s}=Object.prototype,{apply:J2}=Function.prototype,S2=Object.getPrototypeOf(function*(){}),y1=(f)=>`"${f.replace(/"/g,'""')}"`,Y2=(f)=>()=>f});var c1=U((BE,v1)=>{var X2=function(){};v1.exports=function($,E){return Object.assign(new X2,this)}});var l1=U((jE,h1)=>{var Z2=M("fs"),u1=M("path"),P0=q(),R2=x0(),g1;function K(f,$){if(new.target==null)return new K(f,$);let E;if(Buffer.isBuffer(f))E=f,f=":memory:";if(f==null)f="";if($==null)$={};if(typeof f!=="string")throw TypeError("Expected first argument to be a string");if(typeof $!=="object")throw TypeError("Expected second argument to be an options object");if("readOnly"in $)throw TypeError('Misspelled option "readOnly" should be "readonly"');if("memory"in $)throw TypeError('Option "memory" was removed in v7.0.0 (use ":memory:" filename instead)');let z=f.trim(),P=z===""||z===":memory:",Q=P0.getBooleanOption($,"readonly"),S=P0.getBooleanOption($,"fileMustExist"),J="timeout"in $?$.timeout:5000,Y="verbose"in $?$.verbose:null,X="nativeBinding"in $?$.nativeBinding:null;if(Q&&P&&!E)throw TypeError("In-memory/temporary databases cannot be readonly");if(!Number.isInteger(J)||J<0)throw TypeError('Expected the "timeout" option to be a positive integer');if(J>2147483647)throw RangeError('Option "timeout" cannot be greater than 2147483647');if(Y!=null&&typeof Y!=="function")throw TypeError('Expected the "verbose" option to be a function');if(X!=null&&typeof X!=="string"&&typeof X!=="object")throw TypeError('Expected the "nativeBinding" option to be a string or addon object');let Z;if(X==null)Z=g1||(g1=U1()("better_sqlite3.node"));else if(typeof X==="string")Z=(typeof __non_webpack_require__==="function"?__non_webpack_require__:M)(u1.resolve(X).replace(/(\.node)?$/,".node"));else Z=X;if(!Z.isInitialized)Z.setErrorConstructor(R2),Z.isInitialized=!0;if(!P&&!z.startsWith("file:")&&!Z2.existsSync(u1.dirname(z)))throw TypeError("Cannot open database because the directory does not exist");Object.defineProperties(this,{[P0.cppdb]:{value:new Z.Database(z,f,P,Q,S,J,Y||null,E||null)},...y.getters})}var y=B1();K.prototype.prepare=y.prepare;K.prototype.transaction=K1();K.prototype.pragma=V1();K.prototype.backup=F1();K.prototype.serialize=N1();K.prototype.function=w1();K.prototype.aggregate=O1();K.prototype.table=k1();K.prototype.loadExtension=y.loadExtension;K.prototype.exec=y.exec;K.prototype.close=y.close;K.prototype.defaultSafeIntegers=y.defaultSafeIntegers;K.prototype.unsafeMode=y.unsafeMode;K.prototype[P0.inspect]=c1();h1.exports=K});var s1=U((KE,C0)=>{C0.exports=l1();C0.exports.SqliteError=x0()});var X1=kf(Y1(),1),{program:_,createCommand:r2,createArgument:m2,createOption:n2,CommanderError:d2,InvalidArgumentError:p2,InvalidOptionArgumentError:o2,Command:a2,Argument:e2,Option:fE,Help:$E}=X1.default;var W2=typeof globalThis.Bun<"u",Q0;if(W2)Q0=(f)=>{let{Database:$}=M("bun:sqlite"),E=new $(f);return{exec:(z)=>E.exec(z),prepare:(z)=>{let P=E.prepare(z);return{run:(...Q)=>P.run(...Q),get:(...Q)=>P.get(...Q),all:(...Q)=>P.all(...Q)}},close:()=>E.close()}};else Q0=(f)=>{let E=new(s1())(f);return{exec:(z)=>E.exec(z),prepare:(z)=>{let P=E.prepare(z);return{run:(...Q)=>P.run(...Q),get:(...Q)=>P.get(...Q),all:(...Q)=>P.all(...Q)}},close:()=>E.close()}};import{existsSync as i1,mkdirSync as T2}from"fs";import{homedir as I2}from"os";import{join as t1}from"path";var J0=process.env.WASP_DATA_DIR||t1(I2(),".wasp"),r1=t1(J0,"wasp.db"),C=null;function b0(){return J0}function c(){return i1(r1)}function V(){if(!C){if(!i1(J0))T2(J0,{recursive:!0});C=Q0(r1),C.exec("PRAGMA journal_mode = WAL")}return C}function S0(){V().exec(`
    CREATE TABLE IF NOT EXISTS contacts (
      id INTEGER PRIMARY KEY AUTOINCREMENT,
      identifier TEXT NOT NULL,
      platform TEXT NOT NULL DEFAULT 'whatsapp',
      name TEXT,
      trust TEXT NOT NULL DEFAULT 'trusted',
      added_at TEXT NOT NULL DEFAULT (datetime('now')),
      notes TEXT,
      UNIQUE(identifier, platform)
    );

    CREATE TABLE IF NOT EXISTS audit_log (
      id INTEGER PRIMARY KEY AUTOINCREMENT,
      timestamp TEXT NOT NULL DEFAULT (datetime('now')),
      identifier TEXT NOT NULL,
      platform TEXT NOT NULL,
      decision TEXT NOT NULL,
      reason TEXT
    );

    CREATE TABLE IF NOT EXISTS quarantine (
      id INTEGER PRIMARY KEY AUTOINCREMENT,
      identifier TEXT NOT NULL,
      platform TEXT NOT NULL DEFAULT 'whatsapp',
      message_preview TEXT,
      full_message TEXT,
      timestamp TEXT NOT NULL DEFAULT (datetime('now')),
      reviewed INTEGER NOT NULL DEFAULT 0
    );

    CREATE INDEX IF NOT EXISTS idx_contacts_identifier ON contacts(identifier);
    CREATE INDEX IF NOT EXISTS idx_audit_timestamp ON audit_log(timestamp);
    CREATE INDEX IF NOT EXISTS idx_quarantine_identifier ON quarantine(identifier);
    CREATE INDEX IF NOT EXISTS idx_quarantine_reviewed ON quarantine(reviewed);
  `)}function k0(){if(C)C.close(),C=null}function m1(f=!1){if(c()&&!f){console.log("wasp is already initialized."),console.log(`Data directory: ${b0()}`),console.log("Use --force to reinitialize.");return}S0(),console.log("wasp initialized successfully."),console.log(`Data directory: ${b0()}`),console.log(""),console.log("Next steps:"),console.log('  wasp add "+440123456789" --name "Your Name" --trust sovereign'),console.log("  wasp list"),console.log("  wasp serve")}function b(f,$="whatsapp",E="trusted",z,P){let Q=V();Q.prepare(`
    INSERT INTO contacts (identifier, platform, trust, name, notes)
    VALUES (?, ?, ?, ?, ?)
    ON CONFLICT(identifier, platform) DO UPDATE SET
      trust = excluded.trust,
      name = COALESCE(excluded.name, contacts.name),
      notes = COALESCE(excluded.notes, contacts.notes)
  `).run(f,$,E,z||null,P||null);let J=Q.prepare("SELECT * FROM contacts WHERE identifier = ? AND platform = ?").get(f,$);return{id:J.id,identifier:J.identifier,platform:J.platform,name:J.name,trust:J.trust,addedAt:J.added_at,notes:J.notes}}function Y0(f,$="whatsapp"){return V().prepare("DELETE FROM contacts WHERE identifier = ? AND platform = ?").run(f,$).changes>0}function L2(f,$="whatsapp"){let P=V().prepare("SELECT * FROM contacts WHERE identifier = ? AND platform = ?").get(f,$);if(!P)return null;return{id:P.id,identifier:P.identifier,platform:P.platform,name:P.name,trust:P.trust,addedAt:P.added_at,notes:P.notes}}function X0(f,$){let E=V(),z="SELECT * FROM contacts WHERE 1=1",P=[];if(f)z+=" AND platform = ?",P.push(f);if($)z+=" AND trust = ?",P.push($);return z+=" ORDER BY added_at DESC",E.prepare(z).all(...P).map((J)=>({id:J.id,identifier:J.identifier,platform:J.platform,name:J.name,trust:J.trust,addedAt:J.added_at,notes:J.notes}))}function Z0(f,$="whatsapp"){let E=L2(f,$);if(!E)return{allowed:!1,trust:null,name:null,reason:"Contact not in whitelist"};if(E.trust==="limited")return{allowed:!0,trust:"limited",name:E.name,reason:"Limited trust - agent may view but should not act"};return{allowed:!0,trust:E.trust,name:E.name,reason:"Contact is trusted"}}function n1(f,$){let E=b(f,$.platform||"whatsapp",$.trust||"trusted",$.name,$.notes);if(console.log("Contact added/updated:"),console.log(`  Identifier: ${E.identifier}`),console.log(`  Platform:   ${E.platform}`),console.log(`  Trust:      ${E.trust}`),E.name)console.log(`  Name:       ${E.name}`);if(E.notes)console.log(`  Notes:      ${E.notes}`)}function d1(f,$="whatsapp"){if(Y0(f,$))console.log(`Removed: ${f} (${$})`);else console.log(`Not found: ${f} (${$})`)}function p1(f){let $=X0(f.platform,f.trust);if($.length===0){console.log("No contacts found.");return}if(f.json){console.log(JSON.stringify($,null,2));return}console.log(`Found ${$.length} contact(s):
`);for(let E of $){let z=E.name?` (${E.name})`:"";if(console.log(`  ${E.identifier}${z}`),console.log(`    Platform: ${E.platform} | Trust: ${E.trust}`),E.notes)console.log(`    Notes: ${E.notes}`);console.log("")}}function R0(f,$,E,z){V().prepare(`
    INSERT INTO audit_log (identifier, platform, decision, reason)
    VALUES (?, ?, ?, ?)
  `).run(f,$,E,z)}function u(f){let $=V(),E="SELECT * FROM audit_log WHERE 1=1",z=[];if(f.decision)E+=" AND decision = ?",z.push(f.decision);if(f.since)E+=" AND timestamp >= ?",z.push(f.since);if(E+=" ORDER BY timestamp DESC",f.limit)E+=" LIMIT ?",z.push(f.limit);return $.prepare(E).all(...z).map((S)=>({id:S.id,timestamp:S.timestamp,identifier:S.identifier,platform:S.platform,decision:S.decision,reason:S.reason}))}function o1(f,$){let E=$.platform||"whatsapp",z=Z0(f,E),P=!z.allowed?"deny":z.trust==="limited"?"limited":"allow";if(R0(f,E,P,z.reason),$.json){console.log(JSON.stringify(z)),process.exit(z.allowed?0:1);return}if($.quiet){process.exit(z.allowed?0:1);return}if(z.allowed){let Q=z.name?` (${z.name})`:"";if(console.log(`ALLOWED: ${f}${Q}`),console.log(`  Trust level: ${z.trust}`),z.trust==="limited")console.log("  Note: Limited trust - agent may view but should not act")}else console.log(`DENIED: ${f}`),console.log(`  Reason: ${z.reason}`);process.exit(z.allowed?0:1)}function a1(f){let $=u({limit:f.limit||50,decision:f.denied?"deny":void 0});if($.length===0){console.log("No audit entries found.");return}if(f.json){console.log(JSON.stringify($,null,2));return}console.log(`Last ${$.length} audit entries:
`);for(let E of $){let z=E.decision==="allow"?"\u2713":E.decision==="limited"?"~":"\u2717";console.log(`  ${z} ${E.timestamp} | ${E.identifier} (${E.platform})`),console.log(`    Decision: ${E.decision} - ${E.reason}`),console.log("")}}var v0=(f,$,E)=>{return(z,P)=>{let Q=-1;return S(0);async function S(J){if(J<=Q)throw Error("next() called multiple times");Q=J;let Y,X=!1,Z;if(f[J])Z=f[J][0][0],z.req.routeIndex=J;else Z=J===f.length&&P||void 0;if(Z)try{Y=await Z(z,()=>S(J+1))}catch(R){if(R instanceof Error&&$)z.error=R,Y=await $(R,z),X=!0;else throw R}else if(z.finalized===!1&&E)Y=await E(z);if(Y&&(z.finalized===!1||X))z.res=Y;return z}}};var e1=Symbol();var ff=async(f,$=Object.create(null))=>{let{all:E=!1,dot:z=!1}=$,Q=(f instanceof W0?f.raw.headers:f.headers).get("Content-Type");if(Q?.startsWith("multipart/form-data")||Q?.startsWith("application/x-www-form-urlencoded"))return U2(f,{all:E,dot:z});return{}};async function U2(f,$){let E=await f.formData();if(E)return B2(E,$);return{}}function B2(f,$){let E=Object.create(null);if(f.forEach((z,P)=>{if(!($.all||P.endsWith("[]")))E[P]=z;else j2(E,P,z)}),$.dot)Object.entries(E).forEach(([z,P])=>{if(z.includes("."))M2(E,z,P),delete E[z]});return E}var j2=(f,$,E)=>{if(f[$]!==void 0)if(Array.isArray(f[$]))f[$].push(E);else f[$]=[f[$],E];else if(!$.endsWith("[]"))f[$]=E;else f[$]=[E]},M2=(f,$,E)=>{let z=f,P=$.split(".");P.forEach((Q,S)=>{if(S===P.length-1)z[Q]=E;else{if(!z[Q]||typeof z[Q]!=="object"||Array.isArray(z[Q])||z[Q]instanceof File)z[Q]=Object.create(null);z=z[Q]}})};var u0=(f)=>{let $=f.split("/");if($[0]==="")$.shift();return $},$f=(f)=>{let{groups:$,path:E}=K2(f),z=u0(E);return G2(z,$)},K2=(f)=>{let $=[];return f=f.replace(/\{[^}]+\}/g,(E,z)=>{let P=`@${z}`;return $.push([P,E]),P}),{groups:$,path:f}},G2=(f,$)=>{for(let E=$.length-1;E>=0;E--){let[z]=$[E];for(let P=f.length-1;P>=0;P--)if(f[P].includes(z)){f[P]=f[P].replace(z,$[E][1]);break}}return f},T0={},Ef=(f,$)=>{if(f==="*")return"*";let E=f.match(/^\:([^\{\}]+)(?:\{(.+)\})?$/);if(E){let z=`${f}#${$}`;if(!T0[z])if(E[2])T0[z]=$&&$[0]!==":"&&$[0]!=="*"?[z,E[1],new RegExp(`^${E[2]}(?=/${$})`)]:[f,E[1],new RegExp(`^${E[2]}$`)];else T0[z]=[f,E[1],!0];return T0[z]}return null},I0=(f,$)=>{try{return $(f)}catch{return f.replace(/(?:%[0-9A-Fa-f]{2})+/g,(E)=>{try{return $(E)}catch{return E}})}},V2=(f)=>I0(f,decodeURI),g0=(f)=>{let $=f.url,E=$.indexOf("/",$.indexOf(":")+4),z=E;for(;z<$.length;z++){let P=$.charCodeAt(z);if(P===37){let Q=$.indexOf("?",z),S=$.slice(E,Q===-1?void 0:Q);return V2(S.includes("%25")?S.replace(/%25/g,"%2525"):S)}else if(P===63)break}return $.slice(E,z)};var zf=(f)=>{let $=g0(f);return $.length>1&&$.at(-1)==="/"?$.slice(0,-1):$},k=(f,$,...E)=>{if(E.length)$=k($,...E);return`${f?.[0]==="/"?"":"/"}${f}${$==="/"?"":`${f?.at(-1)==="/"?"":"/"}${$?.[0]==="/"?$.slice(1):$}`}`},L0=(f)=>{if(f.charCodeAt(f.length-1)!==63||!f.includes(":"))return null;let $=f.split("/"),E=[],z="";return $.forEach((P)=>{if(P!==""&&!/\:/.test(P))z+="/"+P;else if(/\:/.test(P))if(/\?/.test(P)){if(E.length===0&&z==="")E.push("/");else E.push(z);let Q=P.replace("?","");z+="/"+Q,E.push(z)}else z+="/"+P}),E.filter((P,Q,S)=>S.indexOf(P)===Q)},c0=(f)=>{if(!/[%+]/.test(f))return f;if(f.indexOf("+")!==-1)f=f.replace(/\+/g," ");return f.indexOf("%")!==-1?I0(f,h0):f},Pf=(f,$,E)=>{let z;if(!E&&$&&!/[%+]/.test($)){let S=f.indexOf("?",8);if(S===-1)return;if(!f.startsWith($,S+1))S=f.indexOf(`&${$}`,S+1);while(S!==-1){let J=f.charCodeAt(S+$.length+1);if(J===61){let Y=S+$.length+2,X=f.indexOf("&",Y);return c0(f.slice(Y,X===-1?void 0:X))}else if(J==38||isNaN(J))return"";S=f.indexOf(`&${$}`,S+1)}if(z=/[%+]/.test(f),!z)return}let P={};z??=/[%+]/.test(f);let Q=f.indexOf("?",8);while(Q!==-1){let S=f.indexOf("&",Q+1),J=f.indexOf("=",Q);if(J>S&&S!==-1)J=-1;let Y=f.slice(Q+1,J===-1?S===-1?void 0:S:J);if(z)Y=c0(Y);if(Q=S,Y==="")continue;let X;if(J===-1)X="";else if(X=f.slice(J+1,S===-1?void 0:S),z)X=c0(X);if(E){if(!(P[Y]&&Array.isArray(P[Y])))P[Y]=[];P[Y].push(X)}else P[Y]??=X}return $?P[$]:P},Qf=Pf,Jf=(f,$)=>{return Pf(f,$,!0)},h0=decodeURIComponent;var Sf=(f)=>I0(f,h0),W0=class{raw;#f;#$;routeIndex=0;path;bodyCache={};constructor(f,$="/",E=[[]]){this.raw=f,this.path=$,this.#$=E,this.#f={}}param(f){return f?this.#E(f):this.#Q()}#E(f){let $=this.#$[0][this.routeIndex][1][f],E=this.#P($);return E&&/\%/.test(E)?Sf(E):E}#Q(){let f={},$=Object.keys(this.#$[0][this.routeIndex][1]);for(let E of $){let z=this.#P(this.#$[0][this.routeIndex][1][E]);if(z!==void 0)f[E]=/\%/.test(z)?Sf(z):z}return f}#P(f){return this.#$[1]?this.#$[1][f]:f}query(f){return Qf(this.url,f)}queries(f){return Jf(this.url,f)}header(f){if(f)return this.raw.headers.get(f)??void 0;let $={};return this.raw.headers.forEach((E,z)=>{$[z]=E}),$}async parseBody(f){return this.bodyCache.parsedBody??=await ff(this,f)}#z=(f)=>{let{bodyCache:$,raw:E}=this,z=$[f];if(z)return z;let P=Object.keys($)[0];if(P)return $[P].then((Q)=>{if(P==="json")Q=JSON.stringify(Q);return new Response(Q)[f]()});return $[f]=E[f]()};json(){return this.#z("text").then((f)=>JSON.parse(f))}text(){return this.#z("text")}arrayBuffer(){return this.#z("arrayBuffer")}blob(){return this.#z("blob")}formData(){return this.#z("formData")}addValidatedData(f,$){this.#f[f]=$}valid(f){return this.#f[f]}get url(){return this.raw.url}get method(){return this.raw.method}get[e1](){return this.#$}get matchedRoutes(){return this.#$[0].map(([[,f]])=>f)}get routePath(){return this.#$[0].map(([[,f]])=>f)[this.routeIndex].path}};var Yf={Stringify:1,BeforeStream:2,Stream:3},_2=(f,$)=>{let E=new String(f);return E.isEscaped=!0,E.callbacks=$,E};var l0=async(f,$,E,z,P)=>{if(typeof f==="object"&&!(f instanceof String)){if(!(f instanceof Promise))f=f.toString();if(f instanceof Promise)f=await f}let Q=f.callbacks;if(!Q?.length)return Promise.resolve(f);if(P)P[0]+=f;else P=[f];let S=Promise.all(Q.map((J)=>J({phase:$,buffer:P,context:z}))).then((J)=>Promise.all(J.filter(Boolean).map((Y)=>l0(Y,$,!1,z,P))).then(()=>P[0]));if(E)return _2(await S,Q);else return S};var H2="text/plain; charset=UTF-8",s0=(f,$)=>{return{"Content-Type":f,...$}},Xf=class{#f;#$;env={};#E;finalized=!1;error;#Q;#P;#z;#Z;#Y;#X;#S;#R;#W;constructor(f,$){if(this.#f=f,$)this.#P=$.executionCtx,this.env=$.env,this.#X=$.notFoundHandler,this.#W=$.path,this.#R=$.matchResult}get req(){return this.#$??=new W0(this.#f,this.#W,this.#R),this.#$}get event(){if(this.#P&&"respondWith"in this.#P)return this.#P;else throw Error("This context has no FetchEvent")}get executionCtx(){if(this.#P)return this.#P;else throw Error("This context has no ExecutionContext")}get res(){return this.#z||=new Response(null,{headers:this.#S??=new Headers})}set res(f){if(this.#z&&f){f=new Response(f.body,f);for(let[$,E]of this.#z.headers.entries()){if($==="content-type")continue;if($==="set-cookie"){let z=this.#z.headers.getSetCookie();f.headers.delete("set-cookie");for(let P of z)f.headers.append("set-cookie",P)}else f.headers.set($,E)}}this.#z=f,this.finalized=!0}render=(...f)=>{return this.#Y??=($)=>this.html($),this.#Y(...f)};setLayout=(f)=>this.#Z=f;getLayout=()=>this.#Z;setRenderer=(f)=>{this.#Y=f};header=(f,$,E)=>{if(this.finalized)this.#z=new Response(this.#z.body,this.#z);let z=this.#z?this.#z.headers:this.#S??=new Headers;if($===void 0)z.delete(f);else if(E?.append)z.append(f,$);else z.set(f,$)};status=(f)=>{this.#Q=f};set=(f,$)=>{this.#E??=new Map,this.#E.set(f,$)};get=(f)=>{return this.#E?this.#E.get(f):void 0};get var(){if(!this.#E)return{};return Object.fromEntries(this.#E)}#J(f,$,E){let z=this.#z?new Headers(this.#z.headers):this.#S??new Headers;if(typeof $==="object"&&"headers"in $){let Q=$.headers instanceof Headers?$.headers:new Headers($.headers);for(let[S,J]of Q)if(S.toLowerCase()==="set-cookie")z.append(S,J);else z.set(S,J)}if(E)for(let[Q,S]of Object.entries(E))if(typeof S==="string")z.set(Q,S);else{z.delete(Q);for(let J of S)z.append(Q,J)}let P=typeof $==="number"?$:$?.status??this.#Q;return new Response(f,{status:P,headers:z})}newResponse=(...f)=>this.#J(...f);body=(f,$,E)=>this.#J(f,$,E);text=(f,$,E)=>{return!this.#S&&!this.#Q&&!$&&!E&&!this.finalized?new Response(f):this.#J(f,$,s0(H2,E))};json=(f,$,E)=>{return this.#J(JSON.stringify(f),$,s0("application/json",E))};html=(f,$,E)=>{let z=(P)=>this.#J(P,$,s0("text/html; charset=UTF-8",E));return typeof f==="object"?l0(f,Yf.Stringify,!1,{}).then(z):z(f)};redirect=(f,$)=>{let E=String(f);return this.header("Location",!/[^\x00-\xFF]/.test(E)?E:encodeURI(E)),this.newResponse(null,$??302)};notFound=()=>{return this.#X??=()=>new Response,this.#X(this)}};var I="ALL",Zf="all",Rf=["get","post","put","delete","options","patch"],U0="Can not add a route since the matcher is already built.",B0=class extends Error{};var Wf="__COMPOSED_HANDLER";var F2=(f)=>{return f.text("404 Not Found",404)},Tf=(f,$)=>{if("getResponse"in f){let E=f.getResponse();return $.newResponse(E.body,E)}return console.error(f),$.text("Internal Server Error",500)},If=class f{get;post;put;delete;options;patch;all;on;use;router;getPath;_basePath="/";#f="/";routes=[];constructor($={}){[...Rf,Zf].forEach((Q)=>{this[Q]=(S,...J)=>{if(typeof S==="string")this.#f=S;else this.#Q(Q,this.#f,S);return J.forEach((Y)=>{this.#Q(Q,this.#f,Y)}),this}}),this.on=(Q,S,...J)=>{for(let Y of[S].flat()){this.#f=Y;for(let X of[Q].flat())J.map((Z)=>{this.#Q(X.toUpperCase(),this.#f,Z)})}return this},this.use=(Q,...S)=>{if(typeof Q==="string")this.#f=Q;else this.#f="*",S.unshift(Q);return S.forEach((J)=>{this.#Q(I,this.#f,J)}),this};let{strict:z,...P}=$;Object.assign(this,P),this.getPath=z??!0?$.getPath??g0:zf}#$(){let $=new f({router:this.router,getPath:this.getPath});return $.errorHandler=this.errorHandler,$.#E=this.#E,$.routes=this.routes,$}#E=F2;errorHandler=Tf;route($,E){let z=this.basePath($);return E.routes.map((P)=>{let Q;if(E.errorHandler===Tf)Q=P.handler;else Q=async(S,J)=>(await v0([],E.errorHandler)(S,()=>P.handler(S,J))).res,Q[Wf]=P.handler;z.#Q(P.method,P.path,Q)}),this}basePath($){let E=this.#$();return E._basePath=k(this._basePath,$),E}onError=($)=>{return this.errorHandler=$,this};notFound=($)=>{return this.#E=$,this};mount($,E,z){let P,Q;if(z)if(typeof z==="function")Q=z;else if(Q=z.optionHandler,z.replaceRequest===!1)P=(Y)=>Y;else P=z.replaceRequest;let S=Q?(Y)=>{let X=Q(Y);return Array.isArray(X)?X:[X]}:(Y)=>{let X=void 0;try{X=Y.executionCtx}catch{}return[Y.env,X]};P||=(()=>{let Y=k(this._basePath,$),X=Y==="/"?0:Y.length;return(Z)=>{let R=new URL(Z.url);return R.pathname=R.pathname.slice(X)||"/",new Request(R,Z)}})();let J=async(Y,X)=>{let Z=await E(P(Y.req.raw),...S(Y));if(Z)return Z;await X()};return this.#Q(I,k($,"*"),J),this}#Q($,E,z){$=$.toUpperCase(),E=k(this._basePath,E);let P={basePath:this._basePath,path:E,method:$,handler:z};this.router.add($,E,[z,P]),this.routes.push(P)}#P($,E){if($ instanceof Error)return this.errorHandler($,E);throw $}#z($,E,z,P){if(P==="HEAD")return(async()=>new Response(null,await this.#z($,E,z,"GET")))();let Q=this.getPath($,{env:z}),S=this.router.match(P,Q),J=new Xf($,{path:Q,matchResult:S,env:z,executionCtx:E,notFoundHandler:this.#E});if(S[0].length===1){let X;try{X=S[0][0][0][0](J,async()=>{J.res=await this.#E(J)})}catch(Z){return this.#P(Z,J)}return X instanceof Promise?X.then((Z)=>Z||(J.finalized?J.res:this.#E(J))).catch((Z)=>this.#P(Z,J)):X??this.#E(J)}let Y=v0(S[0],this.errorHandler,this.#E);return(async()=>{try{let X=await Y(J);if(!X.finalized)throw Error("Context is not finalized. Did you forget to return a Response object or `await next()`?");return X.res}catch(X){return this.#P(X,J)}})()}fetch=($,...E)=>{return this.#z($,E[1],E[0],$.method)};request=($,E,z,P)=>{if($ instanceof Request)return this.fetch(E?new Request($,E):$,z,P);return $=$.toString(),this.fetch(new Request(/^https?:\/\//.test($)?$:`http://localhost${k("/",$)}`,E),z,P)};fire=()=>{addEventListener("fetch",($)=>{$.respondWith(this.#z($.request,$,void 0,$.request.method))})}};var i=[];function j0(f,$){let E=this.buildAllMatchers(),z=(P,Q)=>{let S=E[P]||E[I],J=S[2][Q];if(J)return J;let Y=Q.match(S[0]);if(!Y)return[[],i];let X=Y.indexOf("",1);return[S[1][X],Y]};return this.match=z,z(f,$)}var M0="[^/]+",t=".*",r="(?:|/.*)",v=Symbol(),q2=new Set(".\\+*[^]$()");function N2(f,$){if(f.length===1)return $.length===1?f<$?-1:1:-1;if($.length===1)return 1;if(f===t||f===r)return 1;else if($===t||$===r)return-1;if(f===M0)return 1;else if($===M0)return-1;return f.length===$.length?f<$?-1:1:$.length-f.length}var Lf=class f{#f;#$;#E=Object.create(null);insert($,E,z,P,Q){if($.length===0){if(this.#f!==void 0)throw v;if(Q)return;this.#f=E;return}let[S,...J]=$,Y=S==="*"?J.length===0?["","",t]:["","",M0]:S==="/*"?["","",r]:S.match(/^\:([^\{\}]+)(?:\{(.+)\})?$/),X;if(Y){let Z=Y[1],R=Y[2]||M0;if(Z&&Y[2]){if(R===".*")throw v;if(R=R.replace(/^\((?!\?:)(?=[^)]+\)$)/,"(?:"),/\((?!\?:)/.test(R))throw v}if(X=this.#E[R],!X){if(Object.keys(this.#E).some((T)=>T!==t&&T!==r))throw v;if(Q)return;if(X=this.#E[R]=new f,Z!=="")X.#$=P.varIndex++}if(!Q&&Z!=="")z.push([Z,X.#$])}else if(X=this.#E[S],!X){if(Object.keys(this.#E).some((Z)=>Z.length>1&&Z!==t&&Z!==r))throw v;if(Q)return;X=this.#E[S]=new f}X.insert(J,E,z,P,Q)}buildRegExpStr(){let E=Object.keys(this.#E).sort(N2).map((z)=>{let P=this.#E[z];return(typeof P.#$==="number"?`(${z})@${P.#$}`:q2.has(z)?`\\${z}`:z)+P.buildRegExpStr()});if(typeof this.#f==="number")E.unshift(`#${this.#f}`);if(E.length===0)return"";if(E.length===1)return E[0];return"(?:"+E.join("|")+")"}};var Uf=class{#f={varIndex:0};#$=new Lf;insert(f,$,E){let z=[],P=[];for(let S=0;;){let J=!1;if(f=f.replace(/\{[^}]+\}/g,(Y)=>{let X=`@\\${S}`;return P[S]=[X,Y],S++,J=!0,X}),!J)break}let Q=f.match(/(?::[^\/]+)|(?:\/\*$)|./g)||[];for(let S=P.length-1;S>=0;S--){let[J]=P[S];for(let Y=Q.length-1;Y>=0;Y--)if(Q[Y].indexOf(J)!==-1){Q[Y]=Q[Y].replace(J,P[S][1]);break}}return this.#$.insert(Q,$,z,this.#f,E),z}buildRegExp(){let f=this.#$.buildRegExpStr();if(f==="")return[/^$/,[],[]];let $=0,E=[],z=[];return f=f.replace(/#(\d+)|@(\d+)|\.\*\$/g,(P,Q,S)=>{if(Q!==void 0)return E[++$]=Number(Q),"$()";if(S!==void 0)return z[Number(S)]=++$,"";return""}),[new RegExp(`^${f}`),E,z]}};var D2=[/^$/,[],Object.create(null)],Bf=Object.create(null);function jf(f){return Bf[f]??=new RegExp(f==="*"?"":`^${f.replace(/\/\*$|([.\\+*[^\]$()])/g,($,E)=>E?`\\${E}`:"(?:|/.*)")}$`)}function w2(){Bf=Object.create(null)}function A2(f){let $=new Uf,E=[];if(f.length===0)return D2;let z=f.map((X)=>[!/\*|\/:/.test(X[0]),...X]).sort(([X,Z],[R,T])=>X?1:R?-1:Z.length-T.length),P=Object.create(null);for(let X=0,Z=-1,R=z.length;X<R;X++){let[T,W,j]=z[X];if(T)P[W]=[j.map(([G])=>[G,Object.create(null)]),i];else Z++;let L;try{L=$.insert(W,Z,T)}catch(G){throw G===v?new B0(W):G}if(T)continue;E[Z]=j.map(([G,w])=>{let n=Object.create(null);w-=1;for(;w>=0;w--){let[d,F]=L[w];n[d]=F}return[G,n]})}let[Q,S,J]=$.buildRegExp();for(let X=0,Z=E.length;X<Z;X++)for(let R=0,T=E[X].length;R<T;R++){let W=E[X][R]?.[1];if(!W)continue;let j=Object.keys(W);for(let L=0,G=j.length;L<G;L++)W[j[L]]=J[W[j[L]]]}let Y=[];for(let X in S)Y[X]=E[S[X]];return[Q,Y,P]}function g(f,$){if(!f)return;for(let E of Object.keys(f).sort((z,P)=>P.length-z.length))if(jf(E).test($))return[...f[E]];return}var K0=class{name="RegExpRouter";#f;#$;constructor(){this.#f={[I]:Object.create(null)},this.#$={[I]:Object.create(null)}}add(f,$,E){let z=this.#f,P=this.#$;if(!z||!P)throw Error(U0);if(!z[f])[z,P].forEach((J)=>{J[f]=Object.create(null),Object.keys(J[I]).forEach((Y)=>{J[f][Y]=[...J[I][Y]]})});if($==="/*")$="*";let Q=($.match(/\/:/g)||[]).length;if(/\*$/.test($)){let J=jf($);if(f===I)Object.keys(z).forEach((Y)=>{z[Y][$]||=g(z[Y],$)||g(z[I],$)||[]});else z[f][$]||=g(z[f],$)||g(z[I],$)||[];Object.keys(z).forEach((Y)=>{if(f===I||f===Y)Object.keys(z[Y]).forEach((X)=>{J.test(X)&&z[Y][X].push([E,Q])})}),Object.keys(P).forEach((Y)=>{if(f===I||f===Y)Object.keys(P[Y]).forEach((X)=>J.test(X)&&P[Y][X].push([E,Q]))});return}let S=L0($)||[$];for(let J=0,Y=S.length;J<Y;J++){let X=S[J];Object.keys(P).forEach((Z)=>{if(f===I||f===Z)P[Z][X]||=[...g(z[Z],X)||g(z[I],X)||[]],P[Z][X].push([E,Q-Y+J+1])})}}match=j0;buildAllMatchers(){let f=Object.create(null);return Object.keys(this.#$).concat(Object.keys(this.#f)).forEach(($)=>{f[$]||=this.#E($)}),this.#f=this.#$=void 0,w2(),f}#E(f){let $=[],E=f===I;if([this.#f,this.#$].forEach((z)=>{let P=z[f]?Object.keys(z[f]).map((Q)=>[Q,z[f][Q]]):[];if(P.length!==0)E||=!0,$.push(...P);else if(f!==I)$.push(...Object.keys(z[I]).map((Q)=>[Q,z[I][Q]]))}),!E)return null;else return A2($)}};var x2=class{name="PreparedRegExpRouter";#f;#$;constructor(f,$){this.#f=f,this.#$=$}#E(f,$){let E=this.#f[f];E[1].forEach((z)=>z&&z.push($)),Object.values(E[2]).forEach((z)=>z[0].push($))}#Q(f,$,E,z,P){let Q=this.#f[f];if(!P)Q[2][$][0].push([E,{}]);else z.forEach((S)=>{if(typeof S==="number")Q[1][S].push([E,P]);else Q[2][S||$][0].push([E,P])})}add(f,$,E){if(!this.#f[f]){let P=this.#f[I],Q={};for(let S in P[2])Q[S]=[P[2][S][0].slice(),i];this.#f[f]=[P[0],P[1].map((S)=>Array.isArray(S)?S.slice():0),Q]}if($==="/*"||$==="*"){let P=[E,{}];if(f===I)for(let Q in this.#f)this.#E(Q,P);else this.#E(f,P);return}let z=this.#$[$];if(!z)throw Error(`Path ${$} is not registered`);for(let[P,Q]of z)if(f===I)for(let S in this.#f)this.#Q(S,$,E,P,Q);else this.#Q(f,$,E,P,Q)}buildAllMatchers(){return this.#f}match=j0};var i0=class{name="SmartRouter";#f=[];#$=[];constructor(f){this.#f=f.routers}add(f,$,E){if(!this.#$)throw Error(U0);this.#$.push([f,$,E])}match(f,$){if(!this.#$)throw Error("Fatal error");let E=this.#f,z=this.#$,P=E.length,Q=0,S;for(;Q<P;Q++){let J=E[Q];try{for(let Y=0,X=z.length;Y<X;Y++)J.add(...z[Y]);S=J.match(f,$)}catch(Y){if(Y instanceof B0)continue;throw Y}this.match=J.match.bind(J),this.#f=[J],this.#$=void 0;break}if(Q===P)throw Error("Fatal error");return this.name=`SmartRouter + ${this.activeRouter.name}`,S}get activeRouter(){if(this.#$||this.#f.length!==1)throw Error("No active router has been determined yet.");return this.#f[0]}};var m=Object.create(null),Mf=class f{#f;#$;#E;#Q=0;#P=m;constructor($,E,z){if(this.#$=z||Object.create(null),this.#f=[],$&&E){let P=Object.create(null);P[$]={handler:E,possibleKeys:[],score:0},this.#f=[P]}this.#E=[]}insert($,E,z){this.#Q=++this.#Q;let P=this,Q=$f(E),S=[];for(let J=0,Y=Q.length;J<Y;J++){let X=Q[J],Z=Q[J+1],R=Ef(X,Z),T=Array.isArray(R)?R[0]:X;if(T in P.#$){if(P=P.#$[T],R)S.push(R[1]);continue}if(P.#$[T]=new f,R)P.#E.push(R),S.push(R[1]);P=P.#$[T]}return P.#f.push({[$]:{handler:z,possibleKeys:S.filter((J,Y,X)=>X.indexOf(J)===Y),score:this.#Q}}),P}#z($,E,z,P){let Q=[];for(let S=0,J=$.#f.length;S<J;S++){let Y=$.#f[S],X=Y[E]||Y[I],Z={};if(X!==void 0){if(X.params=Object.create(null),Q.push(X),z!==m||P&&P!==m)for(let R=0,T=X.possibleKeys.length;R<T;R++){let W=X.possibleKeys[R],j=Z[X.score];X.params[W]=P?.[W]&&!j?P[W]:z[W]??P?.[W],Z[X.score]=!0}}}return Q}search($,E){let z=[];this.#P=m;let Q=[this],S=u0(E),J=[];for(let Y=0,X=S.length;Y<X;Y++){let Z=S[Y],R=Y===X-1,T=[];for(let W=0,j=Q.length;W<j;W++){let L=Q[W],G=L.#$[Z];if(G)if(G.#P=L.#P,R){if(G.#$["*"])z.push(...this.#z(G.#$["*"],$,L.#P));z.push(...this.#z(G,$,L.#P))}else T.push(G);for(let w=0,n=L.#E.length;w<n;w++){let d=L.#E[w],F=L.#P===m?{}:{...L.#P};if(d==="*"){let A=L.#$["*"];if(A)z.push(...this.#z(A,$,L.#P)),A.#P=F,T.push(A);continue}let[wf,m0,h]=d;if(!Z&&!(h instanceof RegExp))continue;let N=L.#$[wf],Af=S.slice(Y).join("/");if(h instanceof RegExp){let A=h.exec(Af);if(A){if(F[m0]=A[0],z.push(...this.#z(N,$,L.#P,F)),Object.keys(N.#$).length){N.#P=F;let xf=A[0].match(/\//)?.length??0;(J[xf]||=[]).push(N)}continue}}if(h===!0||h.test(Z))if(F[m0]=Z,R){if(z.push(...this.#z(N,$,F,L.#P)),N.#$["*"])z.push(...this.#z(N.#$["*"],$,F,L.#P))}else N.#P=F,T.push(N)}}Q=T.concat(J.shift()??[])}if(z.length>1)z.sort((Y,X)=>{return Y.score-X.score});return[z.map(({handler:Y,params:X})=>[Y,X])]}};var t0=class{name="TrieRouter";#f;constructor(){this.#f=new Mf}add(f,$,E){let z=L0($);if(z){for(let P=0,Q=z.length;P<Q;P++)this.#f.insert(f,z[P],E);return}this.#f.insert(f,$,E)}match(f,$){return this.#f.search(f,$)}};var r0=class extends If{constructor(f={}){super(f);this.router=f.router??new i0({routers:[new K0,new t0]})}};var G0=new Map,O2={windowMs:60000,maxRequests:100};function Kf(f,$=O2){let E=Date.now(),z=G0.get(f);if(!z||E-z.windowStart>=$.windowMs)return G0.set(f,{count:1,windowStart:E}),{allowed:!0,remaining:$.maxRequests-1,resetMs:$.windowMs};if(z.count>=$.maxRequests)return{allowed:!1,remaining:0,resetMs:$.windowMs-(E-z.windowStart)};return z.count++,{allowed:!0,remaining:$.maxRequests-z.count,resetMs:$.windowMs-(E-z.windowStart)}}function y2(f=300000){let $=Date.now(),E=0;for(let[z,P]of G0.entries())if($-P.windowStart>f)G0.delete(z),E++;return E}setInterval(()=>{y2()},300000);var Gf={windowMs:60000,maxRequests:100};function C2(){let f=new r0;return f.get("/health",($)=>{return $.json({ok:!0,timestamp:new Date().toISOString()})}),f.post("/check",async($)=>{let E=$.req.header("x-forwarded-for")||$.req.header("x-real-ip")||"unknown",z=Kf(`check:${E}`,Gf);if($.header("X-RateLimit-Limit",String(Gf.maxRequests)),$.header("X-RateLimit-Remaining",String(z.remaining)),$.header("X-RateLimit-Reset",String(Math.ceil(z.resetMs/1000))),!z.allowed)return $.json({error:"Rate limit exceeded",retryAfterMs:z.resetMs},429);let P=await $.req.json(),{identifier:Q,platform:S="whatsapp"}=P;if(!Q)return $.json({error:"identifier is required"},400);let J=Z0(Q,S),Y=!J.allowed?"deny":J.trust==="limited"?"limited":"allow";return R0(Q,S,Y,J.reason),$.json(J)}),f.get("/contacts",($)=>{let E=$.req.query("platform"),z=$.req.query("trust"),P=X0(E,z);return $.json({contacts:P})}),f.post("/contacts",async($)=>{let E=await $.req.json(),{identifier:z,platform:P="whatsapp",trust:Q="trusted",name:S,notes:J}=E;if(!z)return $.json({error:"identifier is required"},400);let Y=b(z,P,Q,S,J);return $.json({contact:Y})}),f.delete("/contacts/:identifier",($)=>{let E=$.req.param("identifier"),z=$.req.query("platform")||"whatsapp",P=Y0(E,z);return $.json({removed:P})}),f.get("/audit",($)=>{let E=parseInt($.req.query("limit")||"100"),z=$.req.query("decision"),P=u({limit:E,decision:z});return $.json({entries:P})}),f}function Vf(f=3847){let $=C2();console.log(`wasp server listening on http://localhost:${f}`),console.log("Endpoints:"),console.log("  POST /check         - Check if contact is allowed"),console.log("  GET  /contacts      - List contacts"),console.log("  POST /contacts      - Add contact"),console.log("  DELETE /contacts/:id - Remove contact"),console.log("  GET  /audit         - View audit log"),console.log("  GET  /health        - Health check"),Bun.serve({port:f,fetch:$.fetch})}function _f(f){if(!c())console.error("wasp is not initialized. Run `wasp init` first."),process.exit(1);let $=f.port||3847;Vf($)}function Hf(f=50){return V().prepare(`
    SELECT * FROM quarantine 
    WHERE reviewed = 0 
    ORDER BY timestamp DESC 
    LIMIT ?
  `).all(f).map((P)=>({id:P.id,identifier:P.identifier,platform:P.platform,messagePreview:P.message_preview,fullMessage:P.full_message,timestamp:P.timestamp,reviewed:!!P.reviewed}))}function b2(f,$="whatsapp"){return V().prepare(`
    SELECT * FROM quarantine 
    WHERE identifier = ? AND platform = ? AND reviewed = 0
    ORDER BY timestamp ASC
  `).all(f,$).map((Q)=>({id:Q.id,identifier:Q.identifier,platform:Q.platform,messagePreview:Q.message_preview,fullMessage:Q.full_message,timestamp:Q.timestamp,reviewed:!!Q.reviewed}))}function Ff(f,$="whatsapp"){let E=b2(f,$);if(E.length>0)V().prepare(`
      UPDATE quarantine SET reviewed = 1 
      WHERE identifier = ? AND platform = ?
    `).run(f,$);return E}function qf(f,$="whatsapp"){return V().prepare(`
    DELETE FROM quarantine WHERE identifier = ? AND platform = ?
  `).run(f,$).changes}async function Nf(f){if(f.approve){let P=Ff(f.approve);if(P.length>0)b(P[0].identifier,P[0].platform,"trusted"),console.log(`\u2713 Approved ${P[0].identifier}`),console.log(`  Released ${P.length} quarantined message(s)`);else console.log(`No quarantined messages for: ${f.approve}`);return}if(f.deny){let P=qf(f.deny);if(P>0)b(f.deny,"whatsapp","limited"),console.log(`\u2717 Denied ${f.deny}`),console.log(`  Deleted ${P} message(s)`);else console.log(`No quarantined messages for: ${f.deny}`);return}let $=Hf(50);if($.length===0){console.log(`
\uD83D\uDC1D Quarantine is empty - no messages awaiting review
`);return}let E=new Map;for(let P of $){let Q=`${P.identifier}|${P.platform}`;if(!E.has(Q))E.set(Q,[]);E.get(Q).push(P)}console.log(`
\uD83D\uDC1D Quarantine Review
`),console.log(`${E.size} sender(s), ${$.length} message(s) awaiting review
`),console.log("\u2500".repeat(60)+`
`);let z=1;for(let[P,Q]of E){let[S,J]=P.split("|");console.log(`${z}. ${S} (${J})`),console.log(`   ${Q.length} message(s)`),console.log("");let Y=Q[0];console.log(`   First: "${Y.messagePreview}"`),console.log(`   Time:  ${Y.timestamp}`),console.log(""),z++}if(console.log("\u2500".repeat(60)),console.log(`
Actions:`),console.log("  wasp review --approve <identifier>   Add to trusted, release messages"),console.log("  wasp review --deny <identifier>      Block sender, delete messages"),console.log(""),f.interactive)console.log("Interactive mode not yet implemented."),console.log("Use --approve or --deny flags for now.")}function Df(f=20){let $=u({limit:100,decision:"deny"}),E=new Set,z=[];for(let P of $){let Q=`${P.identifier}|${P.platform}`;if(!E.has(Q)){if(E.add(Q),z.push(P),z.length>=f)break}}if(z.length===0){console.log(`
No blocked contacts in recent history.
`);return}console.log(`
\uD83D\uDC1D Recently Blocked Contacts
`),console.log("\u2500".repeat(60)+`
`);for(let P of z)console.log(`  ${P.identifier} (${P.platform})`),console.log(`    Last seen: ${P.timestamp}`),console.log(`    Reason: ${P.reason}`),console.log("");console.log("\u2500".repeat(60)),console.log(`
To allow a contact:`),console.log('  wasp add "<identifier>" --trust trusted'),console.log("")}var k2="0.0.1";_.name("wasp").description("Security whitelist layer for Moltbot and agentic systems").version(k2);_.command("init").description("Initialize wasp database").option("-f, --force","Reinitialize even if already initialized").action((f)=>{m1(f.force)});_.command("add <identifier>").description("Add a contact to the whitelist").option("-p, --platform <platform>","Platform (whatsapp, telegram, email, discord, slack, signal)","whatsapp").option("-t, --trust <level>","Trust level (sovereign, trusted, limited)","trusted").option("-n, --name <name>","Contact name").option("--notes <notes>","Notes about this contact").action((f,$)=>{x(),n1(f,$)});_.command("remove <identifier>").description("Remove a contact from the whitelist").option("-p, --platform <platform>","Platform","whatsapp").action((f,$)=>{x(),d1(f,$.platform)});_.command("list").description("List all contacts").option("-p, --platform <platform>","Filter by platform").option("-t, --trust <level>","Filter by trust level").option("-j, --json","Output as JSON").action((f)=>{x(),p1(f)});_.command("check <identifier>").description("Check if a contact is allowed").option("-p, --platform <platform>","Platform","whatsapp").option("-j, --json","Output as JSON").option("-q, --quiet","Exit code only, no output").action((f,$)=>{x(),o1(f,$)});_.command("log").description("View audit log").option("-l, --limit <number>","Number of entries to show","50").option("-d, --denied","Show only denied entries").option("-j, --json","Output as JSON").action((f)=>{x(),a1({...f,limit:parseInt(f.limit)})});_.command("serve").description("Start HTTP server for Moltbot integration").option("-p, --port <number>","Port to listen on","3847").action((f)=>{x(),_f({port:parseInt(f.port)})});_.command("review").description("Review quarantined messages and first-time contacts").option("--approve <identifier>","Approve sender and release messages").option("--deny <identifier>","Block sender and delete messages").option("-i, --interactive","Interactive review mode").action(async(f)=>{x(),await Nf(f)});_.command("blocked").description("Show recently blocked contacts").option("-l, --limit <number>","Number to show","20").action((f)=>{x(),Df(parseInt(f.limit))});function x(){if(!c())console.log("wasp is not initialized. Initializing now..."),S0(),console.log("")}_.parseAsync().then(()=>{k0(),process.exit(0)}).catch((f)=>{console.error(f),k0(),process.exit(1)});
