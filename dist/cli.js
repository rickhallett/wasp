#!/usr/bin/env node
// @bun
var O$=Object.create;var{getPrototypeOf:y$,defineProperty:d0,getOwnPropertyNames:C$}=Object;var b$=Object.prototype.hasOwnProperty;var k$=($,E,f)=>{f=$!=null?O$(y$($)):{};let Q=E||!$||!$.__esModule?d0(f,"default",{value:$,enumerable:!0}):f;for(let P of C$($))if(!b$.call(Q,P))d0(Q,P,{get:()=>$[P],enumerable:!0});return Q};var B=($,E)=>()=>(E||$((E={exports:{}}).exports,E),E.exports);var G=import.meta.require;var l=B((v$)=>{class V0 extends Error{constructor($,E,f){super(f);Error.captureStackTrace(this,this.constructor),this.name=this.constructor.name,this.code=E,this.exitCode=$,this.nestedError=void 0}}class p0 extends V0{constructor($){super(1,"commander.invalidArgument",$);Error.captureStackTrace(this,this.constructor),this.name=this.constructor.name}}v$.CommanderError=V0;v$.InvalidArgumentError=p0});var n=B((l$)=>{var{InvalidArgumentError:u$}=l();class n0{constructor($,E){switch(this.description=E||"",this.variadic=!1,this.parseArg=void 0,this.defaultValue=void 0,this.defaultValueDescription=void 0,this.argChoices=void 0,$[0]){case"<":this.required=!0,this._name=$.slice(1,-1);break;case"[":this.required=!1,this._name=$.slice(1,-1);break;default:this.required=!0,this._name=$;break}if(this._name.length>3&&this._name.slice(-3)==="...")this.variadic=!0,this._name=this._name.slice(0,-3)}name(){return this._name}_concatValue($,E){if(E===this.defaultValue||!Array.isArray(E))return[$];return E.concat($)}default($,E){return this.defaultValue=$,this.defaultValueDescription=E,this}argParser($){return this.parseArg=$,this}choices($){return this.argChoices=$.slice(),this.parseArg=(E,f)=>{if(!this.argChoices.includes(E))throw new u$(`Allowed choices are ${this.argChoices.join(", ")}.`);if(this.variadic)return this._concatValue(E,f);return E},this}argRequired(){return this.required=!0,this}argOptional(){return this.required=!1,this}}function c$($){let E=$.name()+($.variadic===!0?"...":"");return $.required?"<"+E+">":"["+E+"]"}l$.Argument=n0;l$.humanReadableArgName=c$});var _0=B((r$)=>{var{humanReadableArgName:m$}=n();class o0{constructor(){this.helpWidth=void 0,this.sortSubcommands=!1,this.sortOptions=!1,this.showGlobalOptions=!1}visibleCommands($){let E=$.commands.filter((Q)=>!Q._hidden),f=$._getHelpCommand();if(f&&!f._hidden)E.push(f);if(this.sortSubcommands)E.sort((Q,P)=>{return Q.name().localeCompare(P.name())});return E}compareOptions($,E){let f=(Q)=>{return Q.short?Q.short.replace(/^-/,""):Q.long.replace(/^--/,"")};return f($).localeCompare(f(E))}visibleOptions($){let E=$.options.filter((Q)=>!Q.hidden),f=$._getHelpOption();if(f&&!f.hidden){let Q=f.short&&$._findOption(f.short),P=f.long&&$._findOption(f.long);if(!Q&&!P)E.push(f);else if(f.long&&!P)E.push($.createOption(f.long,f.description));else if(f.short&&!Q)E.push($.createOption(f.short,f.description))}if(this.sortOptions)E.sort(this.compareOptions);return E}visibleGlobalOptions($){if(!this.showGlobalOptions)return[];let E=[];for(let f=$.parent;f;f=f.parent){let Q=f.options.filter((P)=>!P.hidden);E.push(...Q)}if(this.sortOptions)E.sort(this.compareOptions);return E}visibleArguments($){if($._argsDescription)$.registeredArguments.forEach((E)=>{E.description=E.description||$._argsDescription[E.name()]||""});if($.registeredArguments.find((E)=>E.description))return $.registeredArguments;return[]}subcommandTerm($){let E=$.registeredArguments.map((f)=>m$(f)).join(" ");return $._name+($._aliases[0]?"|"+$._aliases[0]:"")+($.options.length?" [options]":"")+(E?" "+E:"")}optionTerm($){return $.flags}argumentTerm($){return $.name()}longestSubcommandTermLength($,E){return E.visibleCommands($).reduce((f,Q)=>{return Math.max(f,E.subcommandTerm(Q).length)},0)}longestOptionTermLength($,E){return E.visibleOptions($).reduce((f,Q)=>{return Math.max(f,E.optionTerm(Q).length)},0)}longestGlobalOptionTermLength($,E){return E.visibleGlobalOptions($).reduce((f,Q)=>{return Math.max(f,E.optionTerm(Q).length)},0)}longestArgumentTermLength($,E){return E.visibleArguments($).reduce((f,Q)=>{return Math.max(f,E.argumentTerm(Q).length)},0)}commandUsage($){let E=$._name;if($._aliases[0])E=E+"|"+$._aliases[0];let f="";for(let Q=$.parent;Q;Q=Q.parent)f=Q.name()+" "+f;return f+E+" "+$.usage()}commandDescription($){return $.description()}subcommandDescription($){return $.summary()||$.description()}optionDescription($){let E=[];if($.argChoices)E.push(`choices: ${$.argChoices.map((f)=>JSON.stringify(f)).join(", ")}`);if($.defaultValue!==void 0){if($.required||$.optional||$.isBoolean()&&typeof $.defaultValue==="boolean")E.push(`default: ${$.defaultValueDescription||JSON.stringify($.defaultValue)}`)}if($.presetArg!==void 0&&$.optional)E.push(`preset: ${JSON.stringify($.presetArg)}`);if($.envVar!==void 0)E.push(`env: ${$.envVar}`);if(E.length>0)return`${$.description} (${E.join(", ")})`;return $.description}argumentDescription($){let E=[];if($.argChoices)E.push(`choices: ${$.argChoices.map((f)=>JSON.stringify(f)).join(", ")}`);if($.defaultValue!==void 0)E.push(`default: ${$.defaultValueDescription||JSON.stringify($.defaultValue)}`);if(E.length>0){let f=`(${E.join(", ")})`;if($.description)return`${$.description} ${f}`;return f}return $.description}formatHelp($,E){let f=E.padWidth($,E),Q=E.helpWidth||80,P=2,J=2;function Y(T,M){if(M){let U=`${T.padEnd(f+2)}${M}`;return E.wrap(U,Q-2,f+2)}return T}function X(T){return T.join(`
`).replace(/^/gm," ".repeat(2))}let Z=[`Usage: ${E.commandUsage($)}`,""],z=E.commandDescription($);if(z.length>0)Z=Z.concat([E.wrap(z,Q,0),""]);let W=E.visibleArguments($).map((T)=>{return Y(E.argumentTerm(T),E.argumentDescription(T))});if(W.length>0)Z=Z.concat(["Arguments:",X(W),""]);let S=E.visibleOptions($).map((T)=>{return Y(E.optionTerm(T),E.optionDescription(T))});if(S.length>0)Z=Z.concat(["Options:",X(S),""]);if(this.showGlobalOptions){let T=E.visibleGlobalOptions($).map((M)=>{return Y(E.optionTerm(M),E.optionDescription(M))});if(T.length>0)Z=Z.concat(["Global Options:",X(T),""])}let R=E.visibleCommands($).map((T)=>{return Y(E.subcommandTerm(T),E.subcommandDescription(T))});if(R.length>0)Z=Z.concat(["Commands:",X(R),""]);return Z.join(`
`)}padWidth($,E){return Math.max(E.longestOptionTermLength($,E),E.longestGlobalOptionTermLength($,E),E.longestSubcommandTermLength($,E),E.longestArgumentTermLength($,E))}wrap($,E,f,Q=40){let J=new RegExp(`[\\n][${" \\f\\t\\v\xA0\u1680\u2000-\u200A\u202F\u205F\u3000\uFEFF"}]+`);if($.match(J))return $;let Y=E-f;if(Y<Q)return $;let X=$.slice(0,f),Z=$.slice(f).replace(`\r
`,`
`),z=" ".repeat(f),S=`\\s${"\u200B"}`,R=new RegExp(`
|.{1,${Y-1}}([${S}]|$)|[^${S}]+?([${S}]|$)`,"g"),T=Z.match(R)||[];return X+T.map((M,U)=>{if(M===`
`)return"";return(U>0?z:"")+M.trimEnd()}).join(`
`)}}r$.Help=o0});var H0=B((o$)=>{var{InvalidArgumentError:d$}=l();class a0{constructor($,E){this.flags=$,this.description=E||"",this.required=$.includes("<"),this.optional=$.includes("["),this.variadic=/\w\.\.\.[>\]]$/.test($),this.mandatory=!1;let f=n$($);if(this.short=f.shortFlag,this.long=f.longFlag,this.negate=!1,this.long)this.negate=this.long.startsWith("--no-");this.defaultValue=void 0,this.defaultValueDescription=void 0,this.presetArg=void 0,this.envVar=void 0,this.parseArg=void 0,this.hidden=!1,this.argChoices=void 0,this.conflictsWith=[],this.implied=void 0}default($,E){return this.defaultValue=$,this.defaultValueDescription=E,this}preset($){return this.presetArg=$,this}conflicts($){return this.conflictsWith=this.conflictsWith.concat($),this}implies($){let E=$;if(typeof $==="string")E={[$]:!0};return this.implied=Object.assign(this.implied||{},E),this}env($){return this.envVar=$,this}argParser($){return this.parseArg=$,this}makeOptionMandatory($=!0){return this.mandatory=!!$,this}hideHelp($=!0){return this.hidden=!!$,this}_concatValue($,E){if(E===this.defaultValue||!Array.isArray(E))return[$];return E.concat($)}choices($){return this.argChoices=$.slice(),this.parseArg=(E,f)=>{if(!this.argChoices.includes(E))throw new d$(`Allowed choices are ${this.argChoices.join(", ")}.`);if(this.variadic)return this._concatValue(E,f);return E},this}name(){if(this.long)return this.long.replace(/^--/,"");return this.short.replace(/^-/,"")}attributeName(){return p$(this.name().replace(/^no-/,""))}is($){return this.short===$||this.long===$}isBoolean(){return!this.required&&!this.optional&&!this.negate}}class e0{constructor($){this.positiveOptions=new Map,this.negativeOptions=new Map,this.dualOptions=new Set,$.forEach((E)=>{if(E.negate)this.negativeOptions.set(E.attributeName(),E);else this.positiveOptions.set(E.attributeName(),E)}),this.negativeOptions.forEach((E,f)=>{if(this.positiveOptions.has(f))this.dualOptions.add(f)})}valueFromOption($,E){let f=E.attributeName();if(!this.dualOptions.has(f))return!0;let Q=this.negativeOptions.get(f).presetArg,P=Q!==void 0?Q:!1;return E.negate===(P===$)}}function p$($){return $.split("-").reduce((E,f)=>{return E+f[0].toUpperCase()+f.slice(1)})}function n$($){let E,f,Q=$.split(/[ |,]+/);if(Q.length>1&&!/^[[<]/.test(Q[1]))E=Q.shift();if(f=Q.shift(),!E&&/^-[^-]$/.test(f))E=f,f=void 0;return{shortFlag:E,longFlag:f}}o$.Option=a0;o$.DualOptions=e0});var $1=B((f2)=>{function $2($,E){if(Math.abs($.length-E.length)>3)return Math.max($.length,E.length);let f=[];for(let Q=0;Q<=$.length;Q++)f[Q]=[Q];for(let Q=0;Q<=E.length;Q++)f[0][Q]=Q;for(let Q=1;Q<=E.length;Q++)for(let P=1;P<=$.length;P++){let J=1;if($[P-1]===E[Q-1])J=0;else J=1;if(f[P][Q]=Math.min(f[P-1][Q]+1,f[P][Q-1]+1,f[P-1][Q-1]+J),P>1&&Q>1&&$[P-1]===E[Q-2]&&$[P-2]===E[Q-1])f[P][Q]=Math.min(f[P][Q],f[P-2][Q-2]+1)}return f[$.length][E.length]}function E2($,E){if(!E||E.length===0)return"";E=Array.from(new Set(E));let f=$.startsWith("--");if(f)$=$.slice(2),E=E.map((Y)=>Y.slice(2));let Q=[],P=3,J=0.4;if(E.forEach((Y)=>{if(Y.length<=1)return;let X=$2($,Y),Z=Math.max($.length,Y.length);if((Z-X)/Z>J){if(X<P)P=X,Q=[Y];else if(X===P)Q.push(Y)}}),Q.sort((Y,X)=>Y.localeCompare(X)),f)Q=Q.map((Y)=>`--${Y}`);if(Q.length>1)return`
(Did you mean one of ${Q.join(", ")}?)`;if(Q.length===1)return`
(Did you mean ${Q[0]}?)`;return""}f2.suggestSimilar=E2});var P1=B((z2)=>{var P2=G("events").EventEmitter,F0=G("child_process"),N=G("path"),q0=G("fs"),K=G("process"),{Argument:J2,humanReadableArgName:Y2}=n(),{CommanderError:D0}=l(),{Help:X2}=_0(),{Option:E1,DualOptions:Z2}=H0(),{suggestSimilar:f1}=$1();class N0 extends P2{constructor($){super();this.commands=[],this.options=[],this.parent=null,this._allowUnknownOption=!1,this._allowExcessArguments=!0,this.registeredArguments=[],this._args=this.registeredArguments,this.args=[],this.rawArgs=[],this.processedArgs=[],this._scriptPath=null,this._name=$||"",this._optionValues={},this._optionValueSources={},this._storeOptionsAsProperties=!1,this._actionHandler=null,this._executableHandler=!1,this._executableFile=null,this._executableDir=null,this._defaultCommandName=null,this._exitCallback=null,this._aliases=[],this._combineFlagAndOptionalValue=!0,this._description="",this._summary="",this._argsDescription=void 0,this._enablePositionalOptions=!1,this._passThroughOptions=!1,this._lifeCycleHooks={},this._showHelpAfterError=!1,this._showSuggestionAfterError=!0,this._outputConfiguration={writeOut:(E)=>K.stdout.write(E),writeErr:(E)=>K.stderr.write(E),getOutHelpWidth:()=>K.stdout.isTTY?K.stdout.columns:void 0,getErrHelpWidth:()=>K.stderr.isTTY?K.stderr.columns:void 0,outputError:(E,f)=>f(E)},this._hidden=!1,this._helpOption=void 0,this._addImplicitHelpCommand=void 0,this._helpCommand=void 0,this._helpConfiguration={}}copyInheritedSettings($){return this._outputConfiguration=$._outputConfiguration,this._helpOption=$._helpOption,this._helpCommand=$._helpCommand,this._helpConfiguration=$._helpConfiguration,this._exitCallback=$._exitCallback,this._storeOptionsAsProperties=$._storeOptionsAsProperties,this._combineFlagAndOptionalValue=$._combineFlagAndOptionalValue,this._allowExcessArguments=$._allowExcessArguments,this._enablePositionalOptions=$._enablePositionalOptions,this._showHelpAfterError=$._showHelpAfterError,this._showSuggestionAfterError=$._showSuggestionAfterError,this}_getCommandAndAncestors(){let $=[];for(let E=this;E;E=E.parent)$.push(E);return $}command($,E,f){let Q=E,P=f;if(typeof Q==="object"&&Q!==null)P=Q,Q=null;P=P||{};let[,J,Y]=$.match(/([^ ]+) *(.*)/),X=this.createCommand(J);if(Q)X.description(Q),X._executableHandler=!0;if(P.isDefault)this._defaultCommandName=X._name;if(X._hidden=!!(P.noHelp||P.hidden),X._executableFile=P.executableFile||null,Y)X.arguments(Y);if(this._registerCommand(X),X.parent=this,X.copyInheritedSettings(this),Q)return this;return X}createCommand($){return new N0($)}createHelp(){return Object.assign(new X2,this.configureHelp())}configureHelp($){if($===void 0)return this._helpConfiguration;return this._helpConfiguration=$,this}configureOutput($){if($===void 0)return this._outputConfiguration;return Object.assign(this._outputConfiguration,$),this}showHelpAfterError($=!0){if(typeof $!=="string")$=!!$;return this._showHelpAfterError=$,this}showSuggestionAfterError($=!0){return this._showSuggestionAfterError=!!$,this}addCommand($,E){if(!$._name)throw Error(`Command passed to .addCommand() must have a name
- specify the name in Command constructor or using .name()`);if(E=E||{},E.isDefault)this._defaultCommandName=$._name;if(E.noHelp||E.hidden)$._hidden=!0;return this._registerCommand($),$.parent=this,$._checkForBrokenPassThrough(),this}createArgument($,E){return new J2($,E)}argument($,E,f,Q){let P=this.createArgument($,E);if(typeof f==="function")P.default(Q).argParser(f);else P.default(f);return this.addArgument(P),this}arguments($){return $.trim().split(/ +/).forEach((E)=>{this.argument(E)}),this}addArgument($){let E=this.registeredArguments.slice(-1)[0];if(E&&E.variadic)throw Error(`only the last argument can be variadic '${E.name()}'`);if($.required&&$.defaultValue!==void 0&&$.parseArg===void 0)throw Error(`a default value for a required argument is never used: '${$.name()}'`);return this.registeredArguments.push($),this}helpCommand($,E){if(typeof $==="boolean")return this._addImplicitHelpCommand=$,this;$=$??"help [command]";let[,f,Q]=$.match(/([^ ]+) *(.*)/),P=E??"display help for command",J=this.createCommand(f);if(J.helpOption(!1),Q)J.arguments(Q);if(P)J.description(P);return this._addImplicitHelpCommand=!0,this._helpCommand=J,this}addHelpCommand($,E){if(typeof $!=="object")return this.helpCommand($,E),this;return this._addImplicitHelpCommand=!0,this._helpCommand=$,this}_getHelpCommand(){if(this._addImplicitHelpCommand??(this.commands.length&&!this._actionHandler&&!this._findCommand("help"))){if(this._helpCommand===void 0)this.helpCommand(void 0,void 0);return this._helpCommand}return null}hook($,E){let f=["preSubcommand","preAction","postAction"];if(!f.includes($))throw Error(`Unexpected value for event passed to hook : '${$}'.
Expecting one of '${f.join("', '")}'`);if(this._lifeCycleHooks[$])this._lifeCycleHooks[$].push(E);else this._lifeCycleHooks[$]=[E];return this}exitOverride($){if($)this._exitCallback=$;else this._exitCallback=(E)=>{if(E.code!=="commander.executeSubCommandAsync")throw E};return this}_exit($,E,f){if(this._exitCallback)this._exitCallback(new D0($,E,f));K.exit($)}action($){let E=(f)=>{let Q=this.registeredArguments.length,P=f.slice(0,Q);if(this._storeOptionsAsProperties)P[Q]=this;else P[Q]=this.opts();return P.push(this),$.apply(this,P)};return this._actionHandler=E,this}createOption($,E){return new E1($,E)}_callParseArg($,E,f,Q){try{return $.parseArg(E,f)}catch(P){if(P.code==="commander.invalidArgument"){let J=`${Q} ${P.message}`;this.error(J,{exitCode:P.exitCode,code:P.code})}throw P}}_registerOption($){let E=$.short&&this._findOption($.short)||$.long&&this._findOption($.long);if(E){let f=$.long&&this._findOption($.long)?$.long:$.short;throw Error(`Cannot add option '${$.flags}'${this._name&&` to command '${this._name}'`} due to conflicting flag '${f}'
-  already used by option '${E.flags}'`)}this.options.push($)}_registerCommand($){let E=(Q)=>{return[Q.name()].concat(Q.aliases())},f=E($).find((Q)=>this._findCommand(Q));if(f){let Q=E(this._findCommand(f)).join("|"),P=E($).join("|");throw Error(`cannot add command '${P}' as already have command '${Q}'`)}this.commands.push($)}addOption($){this._registerOption($);let E=$.name(),f=$.attributeName();if($.negate){let P=$.long.replace(/^--no-/,"--");if(!this._findOption(P))this.setOptionValueWithSource(f,$.defaultValue===void 0?!0:$.defaultValue,"default")}else if($.defaultValue!==void 0)this.setOptionValueWithSource(f,$.defaultValue,"default");let Q=(P,J,Y)=>{if(P==null&&$.presetArg!==void 0)P=$.presetArg;let X=this.getOptionValue(f);if(P!==null&&$.parseArg)P=this._callParseArg($,P,X,J);else if(P!==null&&$.variadic)P=$._concatValue(P,X);if(P==null)if($.negate)P=!1;else if($.isBoolean()||$.optional)P=!0;else P="";this.setOptionValueWithSource(f,P,Y)};if(this.on("option:"+E,(P)=>{let J=`error: option '${$.flags}' argument '${P}' is invalid.`;Q(P,J,"cli")}),$.envVar)this.on("optionEnv:"+E,(P)=>{let J=`error: option '${$.flags}' value '${P}' from env '${$.envVar}' is invalid.`;Q(P,J,"env")});return this}_optionEx($,E,f,Q,P){if(typeof E==="object"&&E instanceof E1)throw Error("To add an Option object use addOption() instead of option() or requiredOption()");let J=this.createOption(E,f);if(J.makeOptionMandatory(!!$.mandatory),typeof Q==="function")J.default(P).argParser(Q);else if(Q instanceof RegExp){let Y=Q;Q=(X,Z)=>{let z=Y.exec(X);return z?z[0]:Z},J.default(P).argParser(Q)}else J.default(Q);return this.addOption(J)}option($,E,f,Q){return this._optionEx({},$,E,f,Q)}requiredOption($,E,f,Q){return this._optionEx({mandatory:!0},$,E,f,Q)}combineFlagAndOptionalValue($=!0){return this._combineFlagAndOptionalValue=!!$,this}allowUnknownOption($=!0){return this._allowUnknownOption=!!$,this}allowExcessArguments($=!0){return this._allowExcessArguments=!!$,this}enablePositionalOptions($=!0){return this._enablePositionalOptions=!!$,this}passThroughOptions($=!0){return this._passThroughOptions=!!$,this._checkForBrokenPassThrough(),this}_checkForBrokenPassThrough(){if(this.parent&&this._passThroughOptions&&!this.parent._enablePositionalOptions)throw Error(`passThroughOptions cannot be used for '${this._name}' without turning on enablePositionalOptions for parent command(s)`)}storeOptionsAsProperties($=!0){if(this.options.length)throw Error("call .storeOptionsAsProperties() before adding options");if(Object.keys(this._optionValues).length)throw Error("call .storeOptionsAsProperties() before setting option values");return this._storeOptionsAsProperties=!!$,this}getOptionValue($){if(this._storeOptionsAsProperties)return this[$];return this._optionValues[$]}setOptionValue($,E){return this.setOptionValueWithSource($,E,void 0)}setOptionValueWithSource($,E,f){if(this._storeOptionsAsProperties)this[$]=E;else this._optionValues[$]=E;return this._optionValueSources[$]=f,this}getOptionValueSource($){return this._optionValueSources[$]}getOptionValueSourceWithGlobals($){let E;return this._getCommandAndAncestors().forEach((f)=>{if(f.getOptionValueSource($)!==void 0)E=f.getOptionValueSource($)}),E}_prepareUserArgs($,E){if($!==void 0&&!Array.isArray($))throw Error("first parameter to parse must be array or undefined");if(E=E||{},$===void 0&&E.from===void 0){if(K.versions?.electron)E.from="electron";let Q=K.execArgv??[];if(Q.includes("-e")||Q.includes("--eval")||Q.includes("-p")||Q.includes("--print"))E.from="eval"}if($===void 0)$=K.argv;this.rawArgs=$.slice();let f;switch(E.from){case void 0:case"node":this._scriptPath=$[1],f=$.slice(2);break;case"electron":if(K.defaultApp)this._scriptPath=$[1],f=$.slice(2);else f=$.slice(1);break;case"user":f=$.slice(0);break;case"eval":f=$.slice(1);break;default:throw Error(`unexpected parse option { from: '${E.from}' }`)}if(!this._name&&this._scriptPath)this.nameFromFilename(this._scriptPath);return this._name=this._name||"program",f}parse($,E){let f=this._prepareUserArgs($,E);return this._parseCommand([],f),this}async parseAsync($,E){let f=this._prepareUserArgs($,E);return await this._parseCommand([],f),this}_executeSubCommand($,E){E=E.slice();let f=!1,Q=[".js",".ts",".tsx",".mjs",".cjs"];function P(z,W){let S=N.resolve(z,W);if(q0.existsSync(S))return S;if(Q.includes(N.extname(W)))return;let R=Q.find((T)=>q0.existsSync(`${S}${T}`));if(R)return`${S}${R}`;return}this._checkForMissingMandatoryOptions(),this._checkForConflictingOptions();let J=$._executableFile||`${this._name}-${$._name}`,Y=this._executableDir||"";if(this._scriptPath){let z;try{z=q0.realpathSync(this._scriptPath)}catch(W){z=this._scriptPath}Y=N.resolve(N.dirname(z),Y)}if(Y){let z=P(Y,J);if(!z&&!$._executableFile&&this._scriptPath){let W=N.basename(this._scriptPath,N.extname(this._scriptPath));if(W!==this._name)z=P(Y,`${W}-${$._name}`)}J=z||J}f=Q.includes(N.extname(J));let X;if(K.platform!=="win32")if(f)E.unshift(J),E=Q1(K.execArgv).concat(E),X=F0.spawn(K.argv[0],E,{stdio:"inherit"});else X=F0.spawn(J,E,{stdio:"inherit"});else E.unshift(J),E=Q1(K.execArgv).concat(E),X=F0.spawn(K.execPath,E,{stdio:"inherit"});if(!X.killed)["SIGUSR1","SIGUSR2","SIGTERM","SIGINT","SIGHUP"].forEach((W)=>{K.on(W,()=>{if(X.killed===!1&&X.exitCode===null)X.kill(W)})});let Z=this._exitCallback;X.on("close",(z)=>{if(z=z??1,!Z)K.exit(z);else Z(new D0(z,"commander.executeSubCommandAsync","(close)"))}),X.on("error",(z)=>{if(z.code==="ENOENT"){let W=Y?`searched for local subcommand relative to directory '${Y}'`:"no directory for search for local subcommand, use .executableDir() to supply a custom directory",S=`'${J}' does not exist
 - if '${$._name}' is not meant to be an executable command, remove description parameter from '.command()' and use '.description()' instead
 - if the default executable name is not suitable, use the executableFile option to supply a custom name or path
 - ${W}`;throw Error(S)}else if(z.code==="EACCES")throw Error(`'${J}' not executable`);if(!Z)K.exit(1);else{let W=new D0(1,"commander.executeSubCommandAsync","(error)");W.nestedError=z,Z(W)}}),this.runningCommand=X}_dispatchSubcommand($,E,f){let Q=this._findCommand($);if(!Q)this.help({error:!0});let P;return P=this._chainOrCallSubCommandHook(P,Q,"preSubcommand"),P=this._chainOrCall(P,()=>{if(Q._executableHandler)this._executeSubCommand(Q,E.concat(f));else return Q._parseCommand(E,f)}),P}_dispatchHelpCommand($){if(!$)this.help();let E=this._findCommand($);if(E&&!E._executableHandler)E.help();return this._dispatchSubcommand($,[],[this._getHelpOption()?.long??this._getHelpOption()?.short??"--help"])}_checkNumberOfArguments(){if(this.registeredArguments.forEach(($,E)=>{if($.required&&this.args[E]==null)this.missingArgument($.name())}),this.registeredArguments.length>0&&this.registeredArguments[this.registeredArguments.length-1].variadic)return;if(this.args.length>this.registeredArguments.length)this._excessArguments(this.args)}_processArguments(){let $=(f,Q,P)=>{let J=Q;if(Q!==null&&f.parseArg){let Y=`error: command-argument value '${Q}' is invalid for argument '${f.name()}'.`;J=this._callParseArg(f,Q,P,Y)}return J};this._checkNumberOfArguments();let E=[];this.registeredArguments.forEach((f,Q)=>{let P=f.defaultValue;if(f.variadic){if(Q<this.args.length){if(P=this.args.slice(Q),f.parseArg)P=P.reduce((J,Y)=>{return $(f,Y,J)},f.defaultValue)}else if(P===void 0)P=[]}else if(Q<this.args.length){if(P=this.args[Q],f.parseArg)P=$(f,P,f.defaultValue)}E[Q]=P}),this.processedArgs=E}_chainOrCall($,E){if($&&$.then&&typeof $.then==="function")return $.then(()=>E());return E()}_chainOrCallHooks($,E){let f=$,Q=[];if(this._getCommandAndAncestors().reverse().filter((P)=>P._lifeCycleHooks[E]!==void 0).forEach((P)=>{P._lifeCycleHooks[E].forEach((J)=>{Q.push({hookedCommand:P,callback:J})})}),E==="postAction")Q.reverse();return Q.forEach((P)=>{f=this._chainOrCall(f,()=>{return P.callback(P.hookedCommand,this)})}),f}_chainOrCallSubCommandHook($,E,f){let Q=$;if(this._lifeCycleHooks[f]!==void 0)this._lifeCycleHooks[f].forEach((P)=>{Q=this._chainOrCall(Q,()=>{return P(this,E)})});return Q}_parseCommand($,E){let f=this.parseOptions(E);if(this._parseOptionsEnv(),this._parseOptionsImplied(),$=$.concat(f.operands),E=f.unknown,this.args=$.concat(E),$&&this._findCommand($[0]))return this._dispatchSubcommand($[0],$.slice(1),E);if(this._getHelpCommand()&&$[0]===this._getHelpCommand().name())return this._dispatchHelpCommand($[1]);if(this._defaultCommandName)return this._outputHelpIfRequested(E),this._dispatchSubcommand(this._defaultCommandName,$,E);if(this.commands.length&&this.args.length===0&&!this._actionHandler&&!this._defaultCommandName)this.help({error:!0});this._outputHelpIfRequested(f.unknown),this._checkForMissingMandatoryOptions(),this._checkForConflictingOptions();let Q=()=>{if(f.unknown.length>0)this.unknownOption(f.unknown[0])},P=`command:${this.name()}`;if(this._actionHandler){Q(),this._processArguments();let J;if(J=this._chainOrCallHooks(J,"preAction"),J=this._chainOrCall(J,()=>this._actionHandler(this.processedArgs)),this.parent)J=this._chainOrCall(J,()=>{this.parent.emit(P,$,E)});return J=this._chainOrCallHooks(J,"postAction"),J}if(this.parent&&this.parent.listenerCount(P))Q(),this._processArguments(),this.parent.emit(P,$,E);else if($.length){if(this._findCommand("*"))return this._dispatchSubcommand("*",$,E);if(this.listenerCount("command:*"))this.emit("command:*",$,E);else if(this.commands.length)this.unknownCommand();else Q(),this._processArguments()}else if(this.commands.length)Q(),this.help({error:!0});else Q(),this._processArguments()}_findCommand($){if(!$)return;return this.commands.find((E)=>E._name===$||E._aliases.includes($))}_findOption($){return this.options.find((E)=>E.is($))}_checkForMissingMandatoryOptions(){this._getCommandAndAncestors().forEach(($)=>{$.options.forEach((E)=>{if(E.mandatory&&$.getOptionValue(E.attributeName())===void 0)$.missingMandatoryOptionValue(E)})})}_checkForConflictingLocalOptions(){let $=this.options.filter((f)=>{let Q=f.attributeName();if(this.getOptionValue(Q)===void 0)return!1;return this.getOptionValueSource(Q)!=="default"});$.filter((f)=>f.conflictsWith.length>0).forEach((f)=>{let Q=$.find((P)=>f.conflictsWith.includes(P.attributeName()));if(Q)this._conflictingOption(f,Q)})}_checkForConflictingOptions(){this._getCommandAndAncestors().forEach(($)=>{$._checkForConflictingLocalOptions()})}parseOptions($){let E=[],f=[],Q=E,P=$.slice();function J(X){return X.length>1&&X[0]==="-"}let Y=null;while(P.length){let X=P.shift();if(X==="--"){if(Q===f)Q.push(X);Q.push(...P);break}if(Y&&!J(X)){this.emit(`option:${Y.name()}`,X);continue}if(Y=null,J(X)){let Z=this._findOption(X);if(Z){if(Z.required){let z=P.shift();if(z===void 0)this.optionMissingArgument(Z);this.emit(`option:${Z.name()}`,z)}else if(Z.optional){let z=null;if(P.length>0&&!J(P[0]))z=P.shift();this.emit(`option:${Z.name()}`,z)}else this.emit(`option:${Z.name()}`);Y=Z.variadic?Z:null;continue}}if(X.length>2&&X[0]==="-"&&X[1]!=="-"){let Z=this._findOption(`-${X[1]}`);if(Z){if(Z.required||Z.optional&&this._combineFlagAndOptionalValue)this.emit(`option:${Z.name()}`,X.slice(2));else this.emit(`option:${Z.name()}`),P.unshift(`-${X.slice(2)}`);continue}}if(/^--[^=]+=/.test(X)){let Z=X.indexOf("="),z=this._findOption(X.slice(0,Z));if(z&&(z.required||z.optional)){this.emit(`option:${z.name()}`,X.slice(Z+1));continue}}if(J(X))Q=f;if((this._enablePositionalOptions||this._passThroughOptions)&&E.length===0&&f.length===0){if(this._findCommand(X)){if(E.push(X),P.length>0)f.push(...P);break}else if(this._getHelpCommand()&&X===this._getHelpCommand().name()){if(E.push(X),P.length>0)E.push(...P);break}else if(this._defaultCommandName){if(f.push(X),P.length>0)f.push(...P);break}}if(this._passThroughOptions){if(Q.push(X),P.length>0)Q.push(...P);break}Q.push(X)}return{operands:E,unknown:f}}opts(){if(this._storeOptionsAsProperties){let $={},E=this.options.length;for(let f=0;f<E;f++){let Q=this.options[f].attributeName();$[Q]=Q===this._versionOptionName?this._version:this[Q]}return $}return this._optionValues}optsWithGlobals(){return this._getCommandAndAncestors().reduce(($,E)=>Object.assign($,E.opts()),{})}error($,E){if(this._outputConfiguration.outputError(`${$}
`,this._outputConfiguration.writeErr),typeof this._showHelpAfterError==="string")this._outputConfiguration.writeErr(`${this._showHelpAfterError}
`);else if(this._showHelpAfterError)this._outputConfiguration.writeErr(`
`),this.outputHelp({error:!0});let f=E||{},Q=f.exitCode||1,P=f.code||"commander.error";this._exit(Q,P,$)}_parseOptionsEnv(){this.options.forEach(($)=>{if($.envVar&&$.envVar in K.env){let E=$.attributeName();if(this.getOptionValue(E)===void 0||["default","config","env"].includes(this.getOptionValueSource(E)))if($.required||$.optional)this.emit(`optionEnv:${$.name()}`,K.env[$.envVar]);else this.emit(`optionEnv:${$.name()}`)}})}_parseOptionsImplied(){let $=new Z2(this.options),E=(f)=>{return this.getOptionValue(f)!==void 0&&!["default","implied"].includes(this.getOptionValueSource(f))};this.options.filter((f)=>f.implied!==void 0&&E(f.attributeName())&&$.valueFromOption(this.getOptionValue(f.attributeName()),f)).forEach((f)=>{Object.keys(f.implied).filter((Q)=>!E(Q)).forEach((Q)=>{this.setOptionValueWithSource(Q,f.implied[Q],"implied")})})}missingArgument($){let E=`error: missing required argument '${$}'`;this.error(E,{code:"commander.missingArgument"})}optionMissingArgument($){let E=`error: option '${$.flags}' argument missing`;this.error(E,{code:"commander.optionMissingArgument"})}missingMandatoryOptionValue($){let E=`error: required option '${$.flags}' not specified`;this.error(E,{code:"commander.missingMandatoryOptionValue"})}_conflictingOption($,E){let f=(J)=>{let Y=J.attributeName(),X=this.getOptionValue(Y),Z=this.options.find((W)=>W.negate&&Y===W.attributeName()),z=this.options.find((W)=>!W.negate&&Y===W.attributeName());if(Z&&(Z.presetArg===void 0&&X===!1||Z.presetArg!==void 0&&X===Z.presetArg))return Z;return z||J},Q=(J)=>{let Y=f(J),X=Y.attributeName();if(this.getOptionValueSource(X)==="env")return`environment variable '${Y.envVar}'`;return`option '${Y.flags}'`},P=`error: ${Q($)} cannot be used with ${Q(E)}`;this.error(P,{code:"commander.conflictingOption"})}unknownOption($){if(this._allowUnknownOption)return;let E="";if($.startsWith("--")&&this._showSuggestionAfterError){let Q=[],P=this;do{let J=P.createHelp().visibleOptions(P).filter((Y)=>Y.long).map((Y)=>Y.long);Q=Q.concat(J),P=P.parent}while(P&&!P._enablePositionalOptions);E=f1($,Q)}let f=`error: unknown option '${$}'${E}`;this.error(f,{code:"commander.unknownOption"})}_excessArguments($){if(this._allowExcessArguments)return;let E=this.registeredArguments.length,f=E===1?"":"s",P=`error: too many arguments${this.parent?` for '${this.name()}'`:""}. Expected ${E} argument${f} but got ${$.length}.`;this.error(P,{code:"commander.excessArguments"})}unknownCommand(){let $=this.args[0],E="";if(this._showSuggestionAfterError){let Q=[];this.createHelp().visibleCommands(this).forEach((P)=>{if(Q.push(P.name()),P.alias())Q.push(P.alias())}),E=f1($,Q)}let f=`error: unknown command '${$}'${E}`;this.error(f,{code:"commander.unknownCommand"})}version($,E,f){if($===void 0)return this._version;this._version=$,E=E||"-V, --version",f=f||"output the version number";let Q=this.createOption(E,f);return this._versionOptionName=Q.attributeName(),this._registerOption(Q),this.on("option:"+Q.name(),()=>{this._outputConfiguration.writeOut(`${$}
`),this._exit(0,"commander.version",$)}),this}description($,E){if($===void 0&&E===void 0)return this._description;if(this._description=$,E)this._argsDescription=E;return this}summary($){if($===void 0)return this._summary;return this._summary=$,this}alias($){if($===void 0)return this._aliases[0];let E=this;if(this.commands.length!==0&&this.commands[this.commands.length-1]._executableHandler)E=this.commands[this.commands.length-1];if($===E._name)throw Error("Command alias can't be the same as its name");let f=this.parent?._findCommand($);if(f){let Q=[f.name()].concat(f.aliases()).join("|");throw Error(`cannot add alias '${$}' to command '${this.name()}' as already have command '${Q}'`)}return E._aliases.push($),this}aliases($){if($===void 0)return this._aliases;return $.forEach((E)=>this.alias(E)),this}usage($){if($===void 0){if(this._usage)return this._usage;let E=this.registeredArguments.map((f)=>{return Y2(f)});return[].concat(this.options.length||this._helpOption!==null?"[options]":[],this.commands.length?"[command]":[],this.registeredArguments.length?E:[]).join(" ")}return this._usage=$,this}name($){if($===void 0)return this._name;return this._name=$,this}nameFromFilename($){return this._name=N.basename($,N.extname($)),this}executableDir($){if($===void 0)return this._executableDir;return this._executableDir=$,this}helpInformation($){let E=this.createHelp();if(E.helpWidth===void 0)E.helpWidth=$&&$.error?this._outputConfiguration.getErrHelpWidth():this._outputConfiguration.getOutHelpWidth();return E.formatHelp(this,E)}_getHelpContext($){$=$||{};let E={error:!!$.error},f;if(E.error)f=(Q)=>this._outputConfiguration.writeErr(Q);else f=(Q)=>this._outputConfiguration.writeOut(Q);return E.write=$.write||f,E.command=this,E}outputHelp($){let E;if(typeof $==="function")E=$,$=void 0;let f=this._getHelpContext($);this._getCommandAndAncestors().reverse().forEach((P)=>P.emit("beforeAllHelp",f)),this.emit("beforeHelp",f);let Q=this.helpInformation(f);if(E){if(Q=E(Q),typeof Q!=="string"&&!Buffer.isBuffer(Q))throw Error("outputHelp callback must return a string or a Buffer")}if(f.write(Q),this._getHelpOption()?.long)this.emit(this._getHelpOption().long);this.emit("afterHelp",f),this._getCommandAndAncestors().forEach((P)=>P.emit("afterAllHelp",f))}helpOption($,E){if(typeof $==="boolean"){if($)this._helpOption=this._helpOption??void 0;else this._helpOption=null;return this}return $=$??"-h, --help",E=E??"display help for command",this._helpOption=this.createOption($,E),this}_getHelpOption(){if(this._helpOption===void 0)this.helpOption(void 0,void 0);return this._helpOption}addHelpOption($){return this._helpOption=$,this}help($){this.outputHelp($);let E=K.exitCode||0;if(E===0&&$&&typeof $!=="function"&&$.error)E=1;this._exit(E,"commander.help","(outputHelp)")}addHelpText($,E){let f=["beforeAll","before","after","afterAll"];if(!f.includes($))throw Error(`Unexpected value for position to addHelpText.
Expecting one of '${f.join("', '")}'`);let Q=`${$}Help`;return this.on(Q,(P)=>{let J;if(typeof E==="function")J=E({error:P.error,command:P.command});else J=E;if(J)P.write(`${J}
`)}),this}_outputHelpIfRequested($){let E=this._getHelpOption();if(E&&$.find((Q)=>E.is(Q)))this.outputHelp(),this._exit(0,"commander.helpDisplayed","(outputHelp)")}}function Q1($){return $.map((E)=>{if(!E.startsWith("--inspect"))return E;let f,Q="127.0.0.1",P="9229",J;if((J=E.match(/^(--inspect(-brk)?)$/))!==null)f=J[1];else if((J=E.match(/^(--inspect(-brk|-port)?)=([^:]+)$/))!==null)if(f=J[1],/^\d+$/.test(J[3]))P=J[3];else Q=J[3];else if((J=E.match(/^(--inspect(-brk|-port)?)=([^:]+):(\d+)$/))!==null)f=J[1],Q=J[3],P=J[4];if(f&&P!=="0")return`${f}=${Q}:${parseInt(P)+1}`;return E})}z2.Command=N0});var Z1=B((R2)=>{var{Argument:J1}=n(),{Command:x0}=P1(),{CommanderError:S2,InvalidArgumentError:Y1}=l(),{Help:T2}=_0(),{Option:X1}=H0();R2.program=new x0;R2.createCommand=($)=>new x0($);R2.createOption=($,E)=>new X1($,E);R2.createArgument=($,E)=>new J1($,E);R2.Command=x0;R2.Option=X1;R2.Argument=J1;R2.Help=T2;R2.CommanderError=S2;R2.InvalidArgumentError=Y1;R2.InvalidOptionArgumentError=Y1});var q=B((F2)=>{F2.getBooleanOption=($,E)=>{let f=!1;if(E in $&&typeof(f=$[E])!=="boolean")throw TypeError(`Expected the "${E}" option to be a boolean`);return f};F2.cppdb=Symbol();F2.inspect=Symbol.for("nodejs.util.inspect.custom")});var w0=B((Xf,W1)=>{var A0={value:"SqliteError",writable:!0,enumerable:!1,configurable:!0};function O($,E){if(new.target!==O)return new O($,E);if(typeof E!=="string")throw TypeError("Expected second argument to be a string");Error.call(this,$),A0.value=""+$,Object.defineProperty(this,"message",A0),Error.captureStackTrace(this,O),this.code=E}Object.setPrototypeOf(O,Error);Object.setPrototypeOf(O.prototype,Error.prototype);Object.defineProperty(O.prototype,"name",A0);W1.exports=O});var T1=B((Zf,S1)=>{var o=G("path").sep||"/";S1.exports=x2;function x2($){if(typeof $!="string"||$.length<=7||$.substring(0,7)!="file://")throw TypeError("must pass in a file:// URI to convert to a file path");var E=decodeURI($.substring(7)),f=E.indexOf("/"),Q=E.substring(0,f),P=E.substring(f+1);if(Q=="localhost")Q="";if(Q)Q=o+o+Q;if(P=P.replace(/^(.+)\|/,"$1:"),o=="\\")P=P.replace(/\//g,"\\");if(/^.+\:/.test(P));else P=o+P;return Q+P}});var B1=B(($0,U1)=>{var __filename="/home/mrkai/code/wasp/node_modules/bindings/bindings.js",O0=G("fs"),e=G("path"),A2=T1(),a=e.join,w2=e.dirname,R1=O0.accessSync&&function($){try{O0.accessSync($)}catch(E){return!1}return!0}||O0.existsSync||e.existsSync,L1={arrow:process.env.NODE_BINDINGS_ARROW||" \u2192 ",compiled:process.env.NODE_BINDINGS_COMPILED_DIR||"compiled",platform:process.platform,arch:process.arch,nodePreGyp:"node-v"+process.versions.modules+"-"+process.platform+"-"+process.arch,version:process.versions.node,bindings:"bindings.node",try:[["module_root","build","bindings"],["module_root","build","Debug","bindings"],["module_root","build","Release","bindings"],["module_root","out","Debug","bindings"],["module_root","Debug","bindings"],["module_root","out","Release","bindings"],["module_root","Release","bindings"],["module_root","build","default","bindings"],["module_root","compiled","version","platform","arch","bindings"],["module_root","addon-build","release","install-root","bindings"],["module_root","addon-build","debug","install-root","bindings"],["module_root","addon-build","default","install-root","bindings"],["module_root","lib","binding","nodePreGyp","bindings"]]};function O2($){if(typeof $=="string")$={bindings:$};else if(!$)$={};if(Object.keys(L1).map(function(Z){if(!(Z in $))$[Z]=L1[Z]}),!$.module_root)$.module_root=$0.getRoot($0.getFileName());if(e.extname($.bindings)!=".node")$.bindings+=".node";var E=typeof __webpack_require__==="function"?__non_webpack_require__:G,f=[],Q=0,P=$.try.length,J,Y,X;for(;Q<P;Q++){J=a.apply(null,$.try[Q].map(function(Z){return $[Z]||Z})),f.push(J);try{if(Y=$.path?E.resolve(J):E(J),!$.path)Y.path=J;return Y}catch(Z){if(Z.code!=="MODULE_NOT_FOUND"&&Z.code!=="QUALIFIED_PATH_RESOLUTION_FAILED"&&!/not find/i.test(Z.message))throw Z}}throw X=Error(`Could not locate the bindings file. Tried:
`+f.map(function(Z){return $.arrow+Z}).join(`
`)),X.tries=f,X}U1.exports=$0=O2;$0.getFileName=function(E){var{prepareStackTrace:f,stackTraceLimit:Q}=Error,P={},J;Error.stackTraceLimit=10,Error.prepareStackTrace=function(X,Z){for(var z=0,W=Z.length;z<W;z++)if(J=Z[z].getFileName(),J!==__filename)if(E){if(J!==E)return}else return},Error.captureStackTrace(P),P.stack,Error.prepareStackTrace=f,Error.stackTraceLimit=Q;var Y="file://";if(J.indexOf(Y)===0)J=A2(J);return J};$0.getRoot=function(E){var f=w2(E),Q;while(!0){if(f===".")f=process.cwd();if(R1(a(f,"package.json"))||R1(a(f,"node_modules")))return f;if(Q===f)throw Error('Could not find module root given file: "'+E+'". Do you have a `package.json` file? ');Q=f,f=a(f,"..")}}});var K1=B((y2)=>{var{cppdb:H}=q();y2.prepare=function(E){return this[H].prepare(E,this,!1)};y2.exec=function(E){return this[H].exec(E),this};y2.close=function(){return this[H].close(),this};y2.loadExtension=function(...E){return this[H].loadExtension(...E),this};y2.defaultSafeIntegers=function(...E){return this[H].defaultSafeIntegers(...E),this};y2.unsafeMode=function(...E){return this[H].unsafeMode(...E),this};y2.getters={name:{get:function(){return this[H].name},enumerable:!0},open:{get:function(){return this[H].open},enumerable:!0},inTransaction:{get:function(){return this[H].inTransaction},enumerable:!0},readonly:{get:function(){return this[H].readonly},enumerable:!0},memory:{get:function(){return this[H].memory},enumerable:!0}}});var I1=B((Rf,G1)=>{var{cppdb:c2}=q(),M1=new WeakMap;G1.exports=function(E){if(typeof E!=="function")throw TypeError("Expected first argument to be a function");let f=this[c2],Q=l2(f,this),{apply:P}=Function.prototype,J={default:{value:E0(P,E,f,Q.default)},deferred:{value:E0(P,E,f,Q.deferred)},immediate:{value:E0(P,E,f,Q.immediate)},exclusive:{value:E0(P,E,f,Q.exclusive)},database:{value:this,enumerable:!0}};return Object.defineProperties(J.default.value,J),Object.defineProperties(J.deferred.value,J),Object.defineProperties(J.immediate.value,J),Object.defineProperties(J.exclusive.value,J),J.default.value};var l2=($,E)=>{let f=M1.get($);if(!f){let Q={commit:$.prepare("COMMIT",E,!1),rollback:$.prepare("ROLLBACK",E,!1),savepoint:$.prepare("SAVEPOINT `\t_bs3.\t`",E,!1),release:$.prepare("RELEASE `\t_bs3.\t`",E,!1),rollbackTo:$.prepare("ROLLBACK TO `\t_bs3.\t`",E,!1)};M1.set($,f={default:Object.assign({begin:$.prepare("BEGIN",E,!1)},Q),deferred:Object.assign({begin:$.prepare("BEGIN DEFERRED",E,!1)},Q),immediate:Object.assign({begin:$.prepare("BEGIN IMMEDIATE",E,!1)},Q),exclusive:Object.assign({begin:$.prepare("BEGIN EXCLUSIVE",E,!1)},Q)})}return f},E0=($,E,f,{begin:Q,commit:P,rollback:J,savepoint:Y,release:X,rollbackTo:Z})=>function(){let W,S,R;if(f.inTransaction)W=Y,S=X,R=Z;else W=Q,S=P,R=J;W.run();try{let T=$.call(E,this,arguments);if(T&&typeof T.then==="function")throw TypeError("Transaction function cannot return a promise");return S.run(),T}catch(T){if(f.inTransaction){if(R.run(),R!==J)S.run()}throw T}}});var V1=B((Lf,j1)=>{var{getBooleanOption:s2,cppdb:i2}=q();j1.exports=function(E,f){if(f==null)f={};if(typeof E!=="string")throw TypeError("Expected first argument to be a string");if(typeof f!=="object")throw TypeError("Expected second argument to be an options object");let Q=s2(f,"simple"),P=this[i2].prepare(`PRAGMA ${E}`,this,!0);return Q?P.pluck().get():P.all()}});var F1=B((Uf,H1)=>{var m2=G("fs"),r2=G("path"),{promisify:t2}=G("util"),{cppdb:d2}=q(),_1=t2(m2.access);H1.exports=async function(E,f){if(f==null)f={};if(typeof E!=="string")throw TypeError("Expected first argument to be a string");if(typeof f!=="object")throw TypeError("Expected second argument to be an options object");E=E.trim();let Q="attached"in f?f.attached:"main",P="progress"in f?f.progress:null;if(!E)throw TypeError("Backup filename cannot be an empty string");if(E===":memory:")throw TypeError('Invalid backup filename ":memory:"');if(typeof Q!=="string")throw TypeError('Expected the "attached" option to be a string');if(!Q)throw TypeError('The "attached" option cannot be an empty string');if(P!=null&&typeof P!=="function")throw TypeError('Expected the "progress" option to be a function');await _1(r2.dirname(E)).catch(()=>{throw TypeError("Cannot save backup because the directory does not exist")});let J=await _1(E).then(()=>!1,()=>!0);return p2(this[d2].backup(this,Q,E,J),P||null)};var p2=($,E)=>{let f=0,Q=!0;return new Promise((P,J)=>{setImmediate(function Y(){try{let X=$.transfer(f);if(!X.remainingPages){$.close(),P(X);return}if(Q)Q=!1,f=100;if(E){let Z=E(X);if(Z!==void 0)if(typeof Z==="number"&&Z===Z)f=Math.max(0,Math.min(2147483647,Math.round(Z)));else throw TypeError("Expected progress callback to return a number or undefined")}setImmediate(Y)}catch(X){$.close(),J(X)}})})}});var D1=B((Bf,q1)=>{var{cppdb:n2}=q();q1.exports=function(E){if(E==null)E={};if(typeof E!=="object")throw TypeError("Expected first argument to be an options object");let f="attached"in E?E.attached:"main";if(typeof f!=="string")throw TypeError('Expected the "attached" option to be a string');if(!f)throw TypeError('The "attached" option cannot be an empty string');return this[n2].serialize(f)}});var x1=B((Kf,N1)=>{var{getBooleanOption:f0,cppdb:o2}=q();N1.exports=function(E,f,Q){if(f==null)f={};if(typeof f==="function")Q=f,f={};if(typeof E!=="string")throw TypeError("Expected first argument to be a string");if(typeof Q!=="function")throw TypeError("Expected last argument to be a function");if(typeof f!=="object")throw TypeError("Expected second argument to be an options object");if(!E)throw TypeError("User-defined function name cannot be an empty string");let P="safeIntegers"in f?+f0(f,"safeIntegers"):2,J=f0(f,"deterministic"),Y=f0(f,"directOnly"),X=f0(f,"varargs"),Z=-1;if(!X){if(Z=Q.length,!Number.isInteger(Z)||Z<0)throw TypeError("Expected function.length to be a positive integer");if(Z>100)throw RangeError("User-defined functions cannot have more than 100 arguments")}return this[o2].function(Q,E,Z,P,J,Y),this}});var O1=B((Mf,w1)=>{var{getBooleanOption:Q0,cppdb:a2}=q();w1.exports=function(E,f){if(typeof E!=="string")throw TypeError("Expected first argument to be a string");if(typeof f!=="object"||f===null)throw TypeError("Expected second argument to be an options object");if(!E)throw TypeError("User-defined function name cannot be an empty string");let Q="start"in f?f.start:null,P=y0(f,"step",!0),J=y0(f,"inverse",!1),Y=y0(f,"result",!1),X="safeIntegers"in f?+Q0(f,"safeIntegers"):2,Z=Q0(f,"deterministic"),z=Q0(f,"directOnly"),W=Q0(f,"varargs"),S=-1;if(!W){if(S=Math.max(A1(P),J?A1(J):0),S>0)S-=1;if(S>100)throw RangeError("User-defined functions cannot have more than 100 arguments")}return this[a2].aggregate(Q,P,J,Y,E,S,X,Z,z),this};var y0=($,E,f)=>{let Q=E in $?$[E]:null;if(typeof Q==="function")return Q;if(Q!=null)throw TypeError(`Expected the "${E}" option to be a function`);if(f)throw TypeError(`Missing required option "${E}"`);return null},A1=({length:$})=>{if(Number.isInteger($)&&$>=0)return $;throw TypeError("Expected function.length to be a positive integer")}});var k1=B((Gf,b1)=>{var{cppdb:e2}=q();b1.exports=function(E,f){if(typeof E!=="string")throw TypeError("Expected first argument to be a string");if(!E)throw TypeError("Virtual table module name cannot be an empty string");let Q=!1;if(typeof f==="object"&&f!==null)Q=!0,f=XE(C1(f,"used",E));else{if(typeof f!=="function")throw TypeError("Expected second argument to be a function or a table definition object");f=$E(f)}return this[e2].table(f,E,Q),this};function $E($){return function(f,Q,P,...J){let Y={module:f,database:Q,table:P},X=JE.call($,Y,J);if(typeof X!=="object"||X===null)throw TypeError(`Virtual table module "${f}" did not return a table definition object`);return C1(X,"returned",f)}}function C1($,E,f){if(!s.call($,"rows"))throw TypeError(`Virtual table module "${f}" ${E} a table definition without a "rows" property`);if(!s.call($,"columns"))throw TypeError(`Virtual table module "${f}" ${E} a table definition without a "columns" property`);let Q=$.rows;if(typeof Q!=="function"||Object.getPrototypeOf(Q)!==YE)throw TypeError(`Virtual table module "${f}" ${E} a table definition with an invalid "rows" property (should be a generator function)`);let P=$.columns;if(!Array.isArray(P)||!(P=[...P]).every((z)=>typeof z==="string"))throw TypeError(`Virtual table module "${f}" ${E} a table definition with an invalid "columns" property (should be an array of strings)`);if(P.length!==new Set(P).size)throw TypeError(`Virtual table module "${f}" ${E} a table definition with duplicate column names`);if(!P.length)throw RangeError(`Virtual table module "${f}" ${E} a table definition with zero columns`);let J;if(s.call($,"parameters")){if(J=$.parameters,!Array.isArray(J)||!(J=[...J]).every((z)=>typeof z==="string"))throw TypeError(`Virtual table module "${f}" ${E} a table definition with an invalid "parameters" property (should be an array of strings)`)}else J=PE(Q);if(J.length!==new Set(J).size)throw TypeError(`Virtual table module "${f}" ${E} a table definition with duplicate parameter names`);if(J.length>32)throw RangeError(`Virtual table module "${f}" ${E} a table definition with more than the maximum number of 32 parameters`);for(let z of J)if(P.includes(z))throw TypeError(`Virtual table module "${f}" ${E} a table definition with column "${z}" which was ambiguously defined as both a column and parameter`);let Y=2;if(s.call($,"safeIntegers")){let z=$.safeIntegers;if(typeof z!=="boolean")throw TypeError(`Virtual table module "${f}" ${E} a table definition with an invalid "safeIntegers" property (should be a boolean)`);Y=+z}let X=!1;if(s.call($,"directOnly")){if(X=$.directOnly,typeof X!=="boolean")throw TypeError(`Virtual table module "${f}" ${E} a table definition with an invalid "directOnly" property (should be a boolean)`)}return[`CREATE TABLE x(${[...J.map(y1).map((z)=>`${z} HIDDEN`),...P.map(y1)].join(", ")});`,EE(Q,new Map(P.map((z,W)=>[z,J.length+W])),f),J,Y,X]}function EE($,E,f){return function*(...P){let J=P.map((Y)=>Buffer.isBuffer(Y)?Buffer.from(Y):Y);for(let Y=0;Y<E.size;++Y)J.push(null);for(let Y of $(...P))if(Array.isArray(Y))fE(Y,J,E.size,f),yield J;else if(typeof Y==="object"&&Y!==null)QE(Y,J,E,f),yield J;else throw TypeError(`Virtual table module "${f}" yielded something that isn't a valid row object`)}}function fE($,E,f,Q){if($.length!==f)throw TypeError(`Virtual table module "${Q}" yielded a row with an incorrect number of columns`);let P=E.length-f;for(let J=0;J<f;++J)E[J+P]=$[J]}function QE($,E,f,Q){let P=0;for(let J of Object.keys($)){let Y=f.get(J);if(Y===void 0)throw TypeError(`Virtual table module "${Q}" yielded a row with an undeclared column "${J}"`);E[Y]=$[J],P+=1}if(P!==f.size)throw TypeError(`Virtual table module "${Q}" yielded a row with missing columns`)}function PE({length:$}){if(!Number.isInteger($)||$<0)throw TypeError("Expected function.length to be a positive integer");let E=[];for(let f=0;f<$;++f)E.push(`$${f+1}`);return E}var{hasOwnProperty:s}=Object.prototype,{apply:JE}=Function.prototype,YE=Object.getPrototypeOf(function*(){}),y1=($)=>`"${$.replace(/"/g,'""')}"`,XE=($)=>()=>$});var g1=B((If,v1)=>{var ZE=function(){};v1.exports=function(E,f){return Object.assign(new ZE,this)}});var l1=B((jf,c1)=>{var zE=G("fs"),h1=G("path"),P0=q(),WE=w0(),u1;function I($,E){if(new.target==null)return new I($,E);let f;if(Buffer.isBuffer($))f=$,$=":memory:";if($==null)$="";if(E==null)E={};if(typeof $!=="string")throw TypeError("Expected first argument to be a string");if(typeof E!=="object")throw TypeError("Expected second argument to be an options object");if("readOnly"in E)throw TypeError('Misspelled option "readOnly" should be "readonly"');if("memory"in E)throw TypeError('Option "memory" was removed in v7.0.0 (use ":memory:" filename instead)');let Q=$.trim(),P=Q===""||Q===":memory:",J=P0.getBooleanOption(E,"readonly"),Y=P0.getBooleanOption(E,"fileMustExist"),X="timeout"in E?E.timeout:5000,Z="verbose"in E?E.verbose:null,z="nativeBinding"in E?E.nativeBinding:null;if(J&&P&&!f)throw TypeError("In-memory/temporary databases cannot be readonly");if(!Number.isInteger(X)||X<0)throw TypeError('Expected the "timeout" option to be a positive integer');if(X>2147483647)throw RangeError('Option "timeout" cannot be greater than 2147483647');if(Z!=null&&typeof Z!=="function")throw TypeError('Expected the "verbose" option to be a function');if(z!=null&&typeof z!=="string"&&typeof z!=="object")throw TypeError('Expected the "nativeBinding" option to be a string or addon object');let W;if(z==null)W=u1||(u1=B1()("better_sqlite3.node"));else if(typeof z==="string")W=(typeof __non_webpack_require__==="function"?__non_webpack_require__:G)(h1.resolve(z).replace(/(\.node)?$/,".node"));else W=z;if(!W.isInitialized)W.setErrorConstructor(WE),W.isInitialized=!0;if(!P&&!Q.startsWith("file:")&&!zE.existsSync(h1.dirname(Q)))throw TypeError("Cannot open database because the directory does not exist");Object.defineProperties(this,{[P0.cppdb]:{value:new W.Database(Q,$,P,J,Y,X,Z||null,f||null)},...y.getters})}var y=K1();I.prototype.prepare=y.prepare;I.prototype.transaction=I1();I.prototype.pragma=V1();I.prototype.backup=F1();I.prototype.serialize=D1();I.prototype.function=x1();I.prototype.aggregate=O1();I.prototype.table=k1();I.prototype.loadExtension=y.loadExtension;I.prototype.exec=y.exec;I.prototype.close=y.close;I.prototype.defaultSafeIntegers=y.defaultSafeIntegers;I.prototype.unsafeMode=y.unsafeMode;I.prototype[P0.inspect]=g1();c1.exports=I});var s1=B((_f,C0)=>{C0.exports=l1();C0.exports.SqliteError=w0()});var z1=k$(Z1(),1),{program:_,createCommand:pE,createArgument:nE,createOption:oE,CommanderError:aE,InvalidArgumentError:eE,InvalidOptionArgumentError:$f,Command:Ef,Argument:ff,Option:Qf,Help:Pf}=z1.default;import{createRequire as kE}from"module";var SE=typeof globalThis.Bun<"u",J0;if(SE)J0=($)=>{let{Database:E}=G("bun:sqlite"),f=new E($);return{exec:(Q)=>f.exec(Q),prepare:(Q)=>{let P=f.prepare(Q);return{run:(...J)=>P.run(...J),get:(...J)=>P.get(...J),all:(...J)=>P.all(...J)}},close:()=>f.close()}};else J0=($)=>{let f=new(s1())($);return{exec:(Q)=>f.exec(Q),prepare:(Q)=>{let P=f.prepare(Q);return{run:(...J)=>P.run(...J),get:(...J)=>P.get(...J),all:(...J)=>P.all(...J)}},close:()=>f.close()}};import{existsSync as i1,mkdirSync as TE}from"fs";import{homedir as RE}from"os";import{join as m1}from"path";var Y0=process.env.WASP_DATA_DIR||m1(RE(),".wasp"),r1=m1(Y0,"wasp.db"),C=null;function b0(){return Y0}function g(){return i1(r1)}function V(){if(!C){if(!i1(Y0))TE(Y0,{recursive:!0});C=J0(r1),C.exec("PRAGMA journal_mode = WAL")}return C}function X0(){V().exec(`
    CREATE TABLE IF NOT EXISTS contacts (
      id INTEGER PRIMARY KEY AUTOINCREMENT,
      identifier TEXT NOT NULL,
      platform TEXT NOT NULL DEFAULT 'whatsapp',
      name TEXT,
      trust TEXT NOT NULL DEFAULT 'trusted',
      added_at TEXT NOT NULL DEFAULT (datetime('now')),
      notes TEXT,
      UNIQUE(identifier, platform)
    );

    CREATE TABLE IF NOT EXISTS audit_log (
      id INTEGER PRIMARY KEY AUTOINCREMENT,
      timestamp TEXT NOT NULL DEFAULT (datetime('now')),
      identifier TEXT NOT NULL,
      platform TEXT NOT NULL,
      decision TEXT NOT NULL,
      reason TEXT
    );

    CREATE TABLE IF NOT EXISTS quarantine (
      id INTEGER PRIMARY KEY AUTOINCREMENT,
      identifier TEXT NOT NULL,
      platform TEXT NOT NULL DEFAULT 'whatsapp',
      message_preview TEXT,
      full_message TEXT,
      timestamp TEXT NOT NULL DEFAULT (datetime('now')),
      reviewed INTEGER NOT NULL DEFAULT 0
    );

    CREATE INDEX IF NOT EXISTS idx_contacts_identifier ON contacts(identifier);
    CREATE INDEX IF NOT EXISTS idx_audit_timestamp ON audit_log(timestamp);
    CREATE INDEX IF NOT EXISTS idx_quarantine_identifier ON quarantine(identifier);
    CREATE INDEX IF NOT EXISTS idx_quarantine_reviewed ON quarantine(reviewed);
  `)}function k0(){if(C)C.close(),C=null}function t1($=!1){if(g()&&!$){console.log("wasp is already initialized."),console.log(`Data directory: ${b0()}`),console.log("Use --force to reinitialize.");return}X0(),console.log("wasp initialized successfully."),console.log(`Data directory: ${b0()}`),console.log(""),console.log("Next steps:"),console.log('  wasp add "+440123456789" --name "Your Name" --trust sovereign'),console.log("  wasp list"),console.log("  wasp serve")}function b($,E="whatsapp",f="trusted",Q,P){let J=V();J.prepare(`
    INSERT INTO contacts (identifier, platform, trust, name, notes)
    VALUES (?, ?, ?, ?, ?)
    ON CONFLICT(identifier, platform) DO UPDATE SET
      trust = excluded.trust,
      name = COALESCE(excluded.name, contacts.name),
      notes = COALESCE(excluded.notes, contacts.notes)
  `).run($,E,f,Q||null,P||null);let X=J.prepare("SELECT * FROM contacts WHERE identifier = ? AND platform = ?").get($,E);return{id:X.id,identifier:X.identifier,platform:X.platform,name:X.name,trust:X.trust,addedAt:X.added_at,notes:X.notes}}function Z0($,E="whatsapp"){return V().prepare("DELETE FROM contacts WHERE identifier = ? AND platform = ?").run($,E).changes>0}function LE($,E="whatsapp"){let P=V().prepare("SELECT * FROM contacts WHERE identifier = ? AND platform = ?").get($,E);if(!P)return null;return{id:P.id,identifier:P.identifier,platform:P.platform,name:P.name,trust:P.trust,addedAt:P.added_at,notes:P.notes}}function z0($,E){let f=V(),Q="SELECT * FROM contacts WHERE 1=1",P=[];if($)Q+=" AND platform = ?",P.push($);if(E)Q+=" AND trust = ?",P.push(E);return Q+=" ORDER BY added_at DESC",f.prepare(Q).all(...P).map((X)=>({id:X.id,identifier:X.identifier,platform:X.platform,name:X.name,trust:X.trust,addedAt:X.added_at,notes:X.notes}))}function W0($,E="whatsapp"){let f=LE($,E);if(!f)return{allowed:!1,trust:null,name:null,reason:"Contact not in whitelist"};if(f.trust==="limited")return{allowed:!0,trust:"limited",name:f.name,reason:"Limited trust - agent may view but should not act"};return{allowed:!0,trust:f.trust,name:f.name,reason:"Contact is trusted"}}function d1($,E){let f=b($,E.platform||"whatsapp",E.trust||"trusted",E.name,E.notes);if(console.log("Contact added/updated:"),console.log(`  Identifier: ${f.identifier}`),console.log(`  Platform:   ${f.platform}`),console.log(`  Trust:      ${f.trust}`),f.name)console.log(`  Name:       ${f.name}`);if(f.notes)console.log(`  Notes:      ${f.notes}`)}function p1($,E="whatsapp"){if(Z0($,E))console.log(`Removed: ${$} (${E})`);else console.log(`Not found: ${$} (${E})`)}function n1($){let E=z0($.platform,$.trust);if(E.length===0){console.log("No contacts found.");return}if($.json){console.log(JSON.stringify(E,null,2));return}console.log(`Found ${E.length} contact(s):
`);for(let f of E){let Q=f.name?` (${f.name})`:"";if(console.log(`  ${f.identifier}${Q}`),console.log(`    Platform: ${f.platform} | Trust: ${f.trust}`),f.notes)console.log(`    Notes: ${f.notes}`);console.log("")}}function S0($,E,f,Q){V().prepare(`
    INSERT INTO audit_log (identifier, platform, decision, reason)
    VALUES (?, ?, ?, ?)
  `).run($,E,f,Q)}function h($){let E=V(),f="SELECT * FROM audit_log WHERE 1=1",Q=[];if($.decision)f+=" AND decision = ?",Q.push($.decision);if($.since)f+=" AND timestamp >= ?",Q.push($.since);if(f+=" ORDER BY timestamp DESC",$.limit)f+=" LIMIT ?",Q.push($.limit);return E.prepare(f).all(...Q).map((Y)=>({id:Y.id,timestamp:Y.timestamp,identifier:Y.identifier,platform:Y.platform,decision:Y.decision,reason:Y.reason}))}function o1($,E){let f=E.platform||"whatsapp",Q=W0($,f),P=!Q.allowed?"deny":Q.trust==="limited"?"limited":"allow";if(S0($,f,P,Q.reason),E.json){console.log(JSON.stringify(Q)),process.exit(Q.allowed?0:1);return}if(E.quiet){process.exit(Q.allowed?0:1);return}if(Q.allowed){let J=Q.name?` (${Q.name})`:"";if(console.log(`ALLOWED: ${$}${J}`),console.log(`  Trust level: ${Q.trust}`),Q.trust==="limited")console.log("  Note: Limited trust - agent may view but should not act")}else console.log(`DENIED: ${$}`),console.log(`  Reason: ${Q.reason}`);process.exit(Q.allowed?0:1)}function a1($){let E=h({limit:$.limit||50,decision:$.denied?"deny":void 0});if(E.length===0){console.log("No audit entries found.");return}if($.json){console.log(JSON.stringify(E,null,2));return}console.log(`Last ${E.length} audit entries:
`);for(let f of E){let Q=f.decision==="allow"?"\u2713":f.decision==="limited"?"~":"\u2717";console.log(`  ${Q} ${f.timestamp} | ${f.identifier} (${f.platform})`),console.log(`    Decision: ${f.decision} - ${f.reason}`),console.log("")}}var v0=($,E,f)=>{return(Q,P)=>{let J=-1;return Y(0);async function Y(X){if(X<=J)throw Error("next() called multiple times");J=X;let Z,z=!1,W;if($[X])W=$[X][0][0],Q.req.routeIndex=X;else W=X===$.length&&P||void 0;if(W)try{Z=await W(Q,()=>Y(X+1))}catch(S){if(S instanceof Error&&E)Q.error=S,Z=await E(S,Q),z=!0;else throw S}else if(Q.finalized===!1&&f)Z=await f(Q);if(Z&&(Q.finalized===!1||z))Q.res=Z;return Q}}};var e1=Symbol();var $$=async($,E=Object.create(null))=>{let{all:f=!1,dot:Q=!1}=E,J=($ instanceof T0?$.raw.headers:$.headers).get("Content-Type");if(J?.startsWith("multipart/form-data")||J?.startsWith("application/x-www-form-urlencoded"))return UE($,{all:f,dot:Q});return{}};async function UE($,E){let f=await $.formData();if(f)return BE(f,E);return{}}function BE($,E){let f=Object.create(null);if($.forEach((Q,P)=>{if(!(E.all||P.endsWith("[]")))f[P]=Q;else KE(f,P,Q)}),E.dot)Object.entries(f).forEach(([Q,P])=>{if(Q.includes("."))ME(f,Q,P),delete f[Q]});return f}var KE=($,E,f)=>{if($[E]!==void 0)if(Array.isArray($[E]))$[E].push(f);else $[E]=[$[E],f];else if(!E.endsWith("[]"))$[E]=f;else $[E]=[f]},ME=($,E,f)=>{let Q=$,P=E.split(".");P.forEach((J,Y)=>{if(Y===P.length-1)Q[J]=f;else{if(!Q[J]||typeof Q[J]!=="object"||Array.isArray(Q[J])||Q[J]instanceof File)Q[J]=Object.create(null);Q=Q[J]}})};var h0=($)=>{let E=$.split("/");if(E[0]==="")E.shift();return E},E$=($)=>{let{groups:E,path:f}=GE($),Q=h0(f);return IE(Q,E)},GE=($)=>{let E=[];return $=$.replace(/\{[^}]+\}/g,(f,Q)=>{let P=`@${Q}`;return E.push([P,f]),P}),{groups:E,path:$}},IE=($,E)=>{for(let f=E.length-1;f>=0;f--){let[Q]=E[f];for(let P=$.length-1;P>=0;P--)if($[P].includes(Q)){$[P]=$[P].replace(Q,E[f][1]);break}}return $},R0={},f$=($,E)=>{if($==="*")return"*";let f=$.match(/^\:([^\{\}]+)(?:\{(.+)\})?$/);if(f){let Q=`${$}#${E}`;if(!R0[Q])if(f[2])R0[Q]=E&&E[0]!==":"&&E[0]!=="*"?[Q,f[1],new RegExp(`^${f[2]}(?=/${E})`)]:[$,f[1],new RegExp(`^${f[2]}$`)];else R0[Q]=[$,f[1],!0];return R0[Q]}return null},L0=($,E)=>{try{return E($)}catch{return $.replace(/(?:%[0-9A-Fa-f]{2})+/g,(f)=>{try{return E(f)}catch{return f}})}},jE=($)=>L0($,decodeURI),u0=($)=>{let E=$.url,f=E.indexOf("/",E.indexOf(":")+4),Q=f;for(;Q<E.length;Q++){let P=E.charCodeAt(Q);if(P===37){let J=E.indexOf("?",Q),Y=E.slice(f,J===-1?void 0:J);return jE(Y.includes("%25")?Y.replace(/%25/g,"%2525"):Y)}else if(P===63)break}return E.slice(f,Q)};var Q$=($)=>{let E=u0($);return E.length>1&&E.at(-1)==="/"?E.slice(0,-1):E},k=($,E,...f)=>{if(f.length)E=k(E,...f);return`${$?.[0]==="/"?"":"/"}${$}${E==="/"?"":`${$?.at(-1)==="/"?"":"/"}${E?.[0]==="/"?E.slice(1):E}`}`},U0=($)=>{if($.charCodeAt($.length-1)!==63||!$.includes(":"))return null;let E=$.split("/"),f=[],Q="";return E.forEach((P)=>{if(P!==""&&!/\:/.test(P))Q+="/"+P;else if(/\:/.test(P))if(/\?/.test(P)){if(f.length===0&&Q==="")f.push("/");else f.push(Q);let J=P.replace("?","");Q+="/"+J,f.push(Q)}else Q+="/"+P}),f.filter((P,J,Y)=>Y.indexOf(P)===J)},g0=($)=>{if(!/[%+]/.test($))return $;if($.indexOf("+")!==-1)$=$.replace(/\+/g," ");return $.indexOf("%")!==-1?L0($,c0):$},P$=($,E,f)=>{let Q;if(!f&&E&&!/[%+]/.test(E)){let Y=$.indexOf("?",8);if(Y===-1)return;if(!$.startsWith(E,Y+1))Y=$.indexOf(`&${E}`,Y+1);while(Y!==-1){let X=$.charCodeAt(Y+E.length+1);if(X===61){let Z=Y+E.length+2,z=$.indexOf("&",Z);return g0($.slice(Z,z===-1?void 0:z))}else if(X==38||isNaN(X))return"";Y=$.indexOf(`&${E}`,Y+1)}if(Q=/[%+]/.test($),!Q)return}let P={};Q??=/[%+]/.test($);let J=$.indexOf("?",8);while(J!==-1){let Y=$.indexOf("&",J+1),X=$.indexOf("=",J);if(X>Y&&Y!==-1)X=-1;let Z=$.slice(J+1,X===-1?Y===-1?void 0:Y:X);if(Q)Z=g0(Z);if(J=Y,Z==="")continue;let z;if(X===-1)z="";else if(z=$.slice(X+1,Y===-1?void 0:Y),Q)z=g0(z);if(f){if(!(P[Z]&&Array.isArray(P[Z])))P[Z]=[];P[Z].push(z)}else P[Z]??=z}return E?P[E]:P},J$=P$,Y$=($,E)=>{return P$($,E,!0)},c0=decodeURIComponent;var X$=($)=>L0($,c0),T0=class{raw;#$;#E;routeIndex=0;path;bodyCache={};constructor($,E="/",f=[[]]){this.raw=$,this.path=E,this.#E=f,this.#$={}}param($){return $?this.#f($):this.#J()}#f($){let E=this.#E[0][this.routeIndex][1][$],f=this.#P(E);return f&&/\%/.test(f)?X$(f):f}#J(){let $={},E=Object.keys(this.#E[0][this.routeIndex][1]);for(let f of E){let Q=this.#P(this.#E[0][this.routeIndex][1][f]);if(Q!==void 0)$[f]=/\%/.test(Q)?X$(Q):Q}return $}#P($){return this.#E[1]?this.#E[1][$]:$}query($){return J$(this.url,$)}queries($){return Y$(this.url,$)}header($){if($)return this.raw.headers.get($)??void 0;let E={};return this.raw.headers.forEach((f,Q)=>{E[Q]=f}),E}async parseBody($){return this.bodyCache.parsedBody??=await $$(this,$)}#Q=($)=>{let{bodyCache:E,raw:f}=this,Q=E[$];if(Q)return Q;let P=Object.keys(E)[0];if(P)return E[P].then((J)=>{if(P==="json")J=JSON.stringify(J);return new Response(J)[$]()});return E[$]=f[$]()};json(){return this.#Q("text").then(($)=>JSON.parse($))}text(){return this.#Q("text")}arrayBuffer(){return this.#Q("arrayBuffer")}blob(){return this.#Q("blob")}formData(){return this.#Q("formData")}addValidatedData($,E){this.#$[$]=E}valid($){return this.#$[$]}get url(){return this.raw.url}get method(){return this.raw.method}get[e1](){return this.#E}get matchedRoutes(){return this.#E[0].map(([[,$]])=>$)}get routePath(){return this.#E[0].map(([[,$]])=>$)[this.routeIndex].path}};var Z$={Stringify:1,BeforeStream:2,Stream:3},VE=($,E)=>{let f=new String($);return f.isEscaped=!0,f.callbacks=E,f};var l0=async($,E,f,Q,P)=>{if(typeof $==="object"&&!($ instanceof String)){if(!($ instanceof Promise))$=$.toString();if($ instanceof Promise)$=await $}let J=$.callbacks;if(!J?.length)return Promise.resolve($);if(P)P[0]+=$;else P=[$];let Y=Promise.all(J.map((X)=>X({phase:E,buffer:P,context:Q}))).then((X)=>Promise.all(X.filter(Boolean).map((Z)=>l0(Z,E,!1,Q,P))).then(()=>P[0]));if(f)return VE(await Y,J);else return Y};var _E="text/plain; charset=UTF-8",s0=($,E)=>{return{"Content-Type":$,...E}},z$=class{#$;#E;env={};#f;finalized=!1;error;#J;#P;#Q;#W;#Z;#z;#X;#S;#T;constructor($,E){if(this.#$=$,E)this.#P=E.executionCtx,this.env=E.env,this.#z=E.notFoundHandler,this.#T=E.path,this.#S=E.matchResult}get req(){return this.#E??=new T0(this.#$,this.#T,this.#S),this.#E}get event(){if(this.#P&&"respondWith"in this.#P)return this.#P;else throw Error("This context has no FetchEvent")}get executionCtx(){if(this.#P)return this.#P;else throw Error("This context has no ExecutionContext")}get res(){return this.#Q||=new Response(null,{headers:this.#X??=new Headers})}set res($){if(this.#Q&&$){$=new Response($.body,$);for(let[E,f]of this.#Q.headers.entries()){if(E==="content-type")continue;if(E==="set-cookie"){let Q=this.#Q.headers.getSetCookie();$.headers.delete("set-cookie");for(let P of Q)$.headers.append("set-cookie",P)}else $.headers.set(E,f)}}this.#Q=$,this.finalized=!0}render=(...$)=>{return this.#Z??=(E)=>this.html(E),this.#Z(...$)};setLayout=($)=>this.#W=$;getLayout=()=>this.#W;setRenderer=($)=>{this.#Z=$};header=($,E,f)=>{if(this.finalized)this.#Q=new Response(this.#Q.body,this.#Q);let Q=this.#Q?this.#Q.headers:this.#X??=new Headers;if(E===void 0)Q.delete($);else if(f?.append)Q.append($,E);else Q.set($,E)};status=($)=>{this.#J=$};set=($,E)=>{this.#f??=new Map,this.#f.set($,E)};get=($)=>{return this.#f?this.#f.get($):void 0};get var(){if(!this.#f)return{};return Object.fromEntries(this.#f)}#Y($,E,f){let Q=this.#Q?new Headers(this.#Q.headers):this.#X??new Headers;if(typeof E==="object"&&"headers"in E){let J=E.headers instanceof Headers?E.headers:new Headers(E.headers);for(let[Y,X]of J)if(Y.toLowerCase()==="set-cookie")Q.append(Y,X);else Q.set(Y,X)}if(f)for(let[J,Y]of Object.entries(f))if(typeof Y==="string")Q.set(J,Y);else{Q.delete(J);for(let X of Y)Q.append(J,X)}let P=typeof E==="number"?E:E?.status??this.#J;return new Response($,{status:P,headers:Q})}newResponse=(...$)=>this.#Y(...$);body=($,E,f)=>this.#Y($,E,f);text=($,E,f)=>{return!this.#X&&!this.#J&&!E&&!f&&!this.finalized?new Response($):this.#Y($,E,s0(_E,f))};json=($,E,f)=>{return this.#Y(JSON.stringify($),E,s0("application/json",f))};html=($,E,f)=>{let Q=(P)=>this.#Y(P,E,s0("text/html; charset=UTF-8",f));return typeof $==="object"?l0($,Z$.Stringify,!1,{}).then(Q):Q($)};redirect=($,E)=>{let f=String($);return this.header("Location",!/[^\x00-\xFF]/.test(f)?f:encodeURI(f)),this.newResponse(null,E??302)};notFound=()=>{return this.#z??=()=>new Response,this.#z(this)}};var L="ALL",W$="all",S$=["get","post","put","delete","options","patch"],B0="Can not add a route since the matcher is already built.",K0=class extends Error{};var T$="__COMPOSED_HANDLER";var HE=($)=>{return $.text("404 Not Found",404)},R$=($,E)=>{if("getResponse"in $){let f=$.getResponse();return E.newResponse(f.body,f)}return console.error($),E.text("Internal Server Error",500)},L$=class ${get;post;put;delete;options;patch;all;on;use;router;getPath;_basePath="/";#$="/";routes=[];constructor(E={}){[...S$,W$].forEach((J)=>{this[J]=(Y,...X)=>{if(typeof Y==="string")this.#$=Y;else this.#J(J,this.#$,Y);return X.forEach((Z)=>{this.#J(J,this.#$,Z)}),this}}),this.on=(J,Y,...X)=>{for(let Z of[Y].flat()){this.#$=Z;for(let z of[J].flat())X.map((W)=>{this.#J(z.toUpperCase(),this.#$,W)})}return this},this.use=(J,...Y)=>{if(typeof J==="string")this.#$=J;else this.#$="*",Y.unshift(J);return Y.forEach((X)=>{this.#J(L,this.#$,X)}),this};let{strict:Q,...P}=E;Object.assign(this,P),this.getPath=Q??!0?E.getPath??u0:Q$}#E(){let E=new $({router:this.router,getPath:this.getPath});return E.errorHandler=this.errorHandler,E.#f=this.#f,E.routes=this.routes,E}#f=HE;errorHandler=R$;route(E,f){let Q=this.basePath(E);return f.routes.map((P)=>{let J;if(f.errorHandler===R$)J=P.handler;else J=async(Y,X)=>(await v0([],f.errorHandler)(Y,()=>P.handler(Y,X))).res,J[T$]=P.handler;Q.#J(P.method,P.path,J)}),this}basePath(E){let f=this.#E();return f._basePath=k(this._basePath,E),f}onError=(E)=>{return this.errorHandler=E,this};notFound=(E)=>{return this.#f=E,this};mount(E,f,Q){let P,J;if(Q)if(typeof Q==="function")J=Q;else if(J=Q.optionHandler,Q.replaceRequest===!1)P=(Z)=>Z;else P=Q.replaceRequest;let Y=J?(Z)=>{let z=J(Z);return Array.isArray(z)?z:[z]}:(Z)=>{let z=void 0;try{z=Z.executionCtx}catch{}return[Z.env,z]};P||=(()=>{let Z=k(this._basePath,E),z=Z==="/"?0:Z.length;return(W)=>{let S=new URL(W.url);return S.pathname=S.pathname.slice(z)||"/",new Request(S,W)}})();let X=async(Z,z)=>{let W=await f(P(Z.req.raw),...Y(Z));if(W)return W;await z()};return this.#J(L,k(E,"*"),X),this}#J(E,f,Q){E=E.toUpperCase(),f=k(this._basePath,f);let P={basePath:this._basePath,path:f,method:E,handler:Q};this.router.add(E,f,[Q,P]),this.routes.push(P)}#P(E,f){if(E instanceof Error)return this.errorHandler(E,f);throw E}#Q(E,f,Q,P){if(P==="HEAD")return(async()=>new Response(null,await this.#Q(E,f,Q,"GET")))();let J=this.getPath(E,{env:Q}),Y=this.router.match(P,J),X=new z$(E,{path:J,matchResult:Y,env:Q,executionCtx:f,notFoundHandler:this.#f});if(Y[0].length===1){let z;try{z=Y[0][0][0][0](X,async()=>{X.res=await this.#f(X)})}catch(W){return this.#P(W,X)}return z instanceof Promise?z.then((W)=>W||(X.finalized?X.res:this.#f(X))).catch((W)=>this.#P(W,X)):z??this.#f(X)}let Z=v0(Y[0],this.errorHandler,this.#f);return(async()=>{try{let z=await Z(X);if(!z.finalized)throw Error("Context is not finalized. Did you forget to return a Response object or `await next()`?");return z.res}catch(z){return this.#P(z,X)}})()}fetch=(E,...f)=>{return this.#Q(E,f[1],f[0],E.method)};request=(E,f,Q,P)=>{if(E instanceof Request)return this.fetch(f?new Request(E,f):E,Q,P);return E=E.toString(),this.fetch(new Request(/^https?:\/\//.test(E)?E:`http://localhost${k("/",E)}`,f),Q,P)};fire=()=>{addEventListener("fetch",(E)=>{E.respondWith(this.#Q(E.request,E,void 0,E.request.method))})}};var i=[];function M0($,E){let f=this.buildAllMatchers(),Q=(P,J)=>{let Y=f[P]||f[L],X=Y[2][J];if(X)return X;let Z=J.match(Y[0]);if(!Z)return[[],i];let z=Z.indexOf("",1);return[Y[1][z],Z]};return this.match=Q,Q($,E)}var G0="[^/]+",m=".*",r="(?:|/.*)",v=Symbol(),FE=new Set(".\\+*[^]$()");function qE($,E){if($.length===1)return E.length===1?$<E?-1:1:-1;if(E.length===1)return 1;if($===m||$===r)return 1;else if(E===m||E===r)return-1;if($===G0)return 1;else if(E===G0)return-1;return $.length===E.length?$<E?-1:1:E.length-$.length}var U$=class ${#$;#E;#f=Object.create(null);insert(E,f,Q,P,J){if(E.length===0){if(this.#$!==void 0)throw v;if(J)return;this.#$=f;return}let[Y,...X]=E,Z=Y==="*"?X.length===0?["","",m]:["","",G0]:Y==="/*"?["","",r]:Y.match(/^\:([^\{\}]+)(?:\{(.+)\})?$/),z;if(Z){let W=Z[1],S=Z[2]||G0;if(W&&Z[2]){if(S===".*")throw v;if(S=S.replace(/^\((?!\?:)(?=[^)]+\)$)/,"(?:"),/\((?!\?:)/.test(S))throw v}if(z=this.#f[S],!z){if(Object.keys(this.#f).some((R)=>R!==m&&R!==r))throw v;if(J)return;if(z=this.#f[S]=new $,W!=="")z.#E=P.varIndex++}if(!J&&W!=="")Q.push([W,z.#E])}else if(z=this.#f[Y],!z){if(Object.keys(this.#f).some((W)=>W.length>1&&W!==m&&W!==r))throw v;if(J)return;z=this.#f[Y]=new $}z.insert(X,f,Q,P,J)}buildRegExpStr(){let f=Object.keys(this.#f).sort(qE).map((Q)=>{let P=this.#f[Q];return(typeof P.#E==="number"?`(${Q})@${P.#E}`:FE.has(Q)?`\\${Q}`:Q)+P.buildRegExpStr()});if(typeof this.#$==="number")f.unshift(`#${this.#$}`);if(f.length===0)return"";if(f.length===1)return f[0];return"(?:"+f.join("|")+")"}};var B$=class{#$={varIndex:0};#E=new U$;insert($,E,f){let Q=[],P=[];for(let Y=0;;){let X=!1;if($=$.replace(/\{[^}]+\}/g,(Z)=>{let z=`@\\${Y}`;return P[Y]=[z,Z],Y++,X=!0,z}),!X)break}let J=$.match(/(?::[^\/]+)|(?:\/\*$)|./g)||[];for(let Y=P.length-1;Y>=0;Y--){let[X]=P[Y];for(let Z=J.length-1;Z>=0;Z--)if(J[Z].indexOf(X)!==-1){J[Z]=J[Z].replace(X,P[Y][1]);break}}return this.#E.insert(J,E,Q,this.#$,f),Q}buildRegExp(){let $=this.#E.buildRegExpStr();if($==="")return[/^$/,[],[]];let E=0,f=[],Q=[];return $=$.replace(/#(\d+)|@(\d+)|\.\*\$/g,(P,J,Y)=>{if(J!==void 0)return f[++E]=Number(J),"$()";if(Y!==void 0)return Q[Number(Y)]=++E,"";return""}),[new RegExp(`^${$}`),f,Q]}};var DE=[/^$/,[],Object.create(null)],K$=Object.create(null);function M$($){return K$[$]??=new RegExp($==="*"?"":`^${$.replace(/\/\*$|([.\\+*[^\]$()])/g,(E,f)=>f?`\\${f}`:"(?:|/.*)")}$`)}function NE(){K$=Object.create(null)}function xE($){let E=new B$,f=[];if($.length===0)return DE;let Q=$.map((z)=>[!/\*|\/:/.test(z[0]),...z]).sort(([z,W],[S,R])=>z?1:S?-1:W.length-R.length),P=Object.create(null);for(let z=0,W=-1,S=Q.length;z<S;z++){let[R,T,M]=Q[z];if(R)P[T]=[M.map(([j])=>[j,Object.create(null)]),i];else W++;let U;try{U=E.insert(T,W,R)}catch(j){throw j===v?new K0(T):j}if(R)continue;f[W]=M.map(([j,x])=>{let d=Object.create(null);x-=1;for(;x>=0;x--){let[p,F]=U[x];d[p]=F}return[j,d]})}let[J,Y,X]=E.buildRegExp();for(let z=0,W=f.length;z<W;z++)for(let S=0,R=f[z].length;S<R;S++){let T=f[z][S]?.[1];if(!T)continue;let M=Object.keys(T);for(let U=0,j=M.length;U<j;U++)T[M[U]]=X[T[M[U]]]}let Z=[];for(let z in Y)Z[z]=f[Y[z]];return[J,Z,P]}function u($,E){if(!$)return;for(let f of Object.keys($).sort((Q,P)=>P.length-Q.length))if(M$(f).test(E))return[...$[f]];return}var I0=class{name="RegExpRouter";#$;#E;constructor(){this.#$={[L]:Object.create(null)},this.#E={[L]:Object.create(null)}}add($,E,f){let Q=this.#$,P=this.#E;if(!Q||!P)throw Error(B0);if(!Q[$])[Q,P].forEach((X)=>{X[$]=Object.create(null),Object.keys(X[L]).forEach((Z)=>{X[$][Z]=[...X[L][Z]]})});if(E==="/*")E="*";let J=(E.match(/\/:/g)||[]).length;if(/\*$/.test(E)){let X=M$(E);if($===L)Object.keys(Q).forEach((Z)=>{Q[Z][E]||=u(Q[Z],E)||u(Q[L],E)||[]});else Q[$][E]||=u(Q[$],E)||u(Q[L],E)||[];Object.keys(Q).forEach((Z)=>{if($===L||$===Z)Object.keys(Q[Z]).forEach((z)=>{X.test(z)&&Q[Z][z].push([f,J])})}),Object.keys(P).forEach((Z)=>{if($===L||$===Z)Object.keys(P[Z]).forEach((z)=>X.test(z)&&P[Z][z].push([f,J]))});return}let Y=U0(E)||[E];for(let X=0,Z=Y.length;X<Z;X++){let z=Y[X];Object.keys(P).forEach((W)=>{if($===L||$===W)P[W][z]||=[...u(Q[W],z)||u(Q[L],z)||[]],P[W][z].push([f,J-Z+X+1])})}}match=M0;buildAllMatchers(){let $=Object.create(null);return Object.keys(this.#E).concat(Object.keys(this.#$)).forEach((E)=>{$[E]||=this.#f(E)}),this.#$=this.#E=void 0,NE(),$}#f($){let E=[],f=$===L;if([this.#$,this.#E].forEach((Q)=>{let P=Q[$]?Object.keys(Q[$]).map((J)=>[J,Q[$][J]]):[];if(P.length!==0)f||=!0,E.push(...P);else if($!==L)E.push(...Object.keys(Q[L]).map((J)=>[J,Q[L][J]]))}),!f)return null;else return xE(E)}};var AE=class{name="PreparedRegExpRouter";#$;#E;constructor($,E){this.#$=$,this.#E=E}#f($,E){let f=this.#$[$];f[1].forEach((Q)=>Q&&Q.push(E)),Object.values(f[2]).forEach((Q)=>Q[0].push(E))}#J($,E,f,Q,P){let J=this.#$[$];if(!P)J[2][E][0].push([f,{}]);else Q.forEach((Y)=>{if(typeof Y==="number")J[1][Y].push([f,P]);else J[2][Y||E][0].push([f,P])})}add($,E,f){if(!this.#$[$]){let P=this.#$[L],J={};for(let Y in P[2])J[Y]=[P[2][Y][0].slice(),i];this.#$[$]=[P[0],P[1].map((Y)=>Array.isArray(Y)?Y.slice():0),J]}if(E==="/*"||E==="*"){let P=[f,{}];if($===L)for(let J in this.#$)this.#f(J,P);else this.#f($,P);return}let Q=this.#E[E];if(!Q)throw Error(`Path ${E} is not registered`);for(let[P,J]of Q)if($===L)for(let Y in this.#$)this.#J(Y,E,f,P,J);else this.#J($,E,f,P,J)}buildAllMatchers(){return this.#$}match=M0};var i0=class{name="SmartRouter";#$=[];#E=[];constructor($){this.#$=$.routers}add($,E,f){if(!this.#E)throw Error(B0);this.#E.push([$,E,f])}match($,E){if(!this.#E)throw Error("Fatal error");let f=this.#$,Q=this.#E,P=f.length,J=0,Y;for(;J<P;J++){let X=f[J];try{for(let Z=0,z=Q.length;Z<z;Z++)X.add(...Q[Z]);Y=X.match($,E)}catch(Z){if(Z instanceof K0)continue;throw Z}this.match=X.match.bind(X),this.#$=[X],this.#E=void 0;break}if(J===P)throw Error("Fatal error");return this.name=`SmartRouter + ${this.activeRouter.name}`,Y}get activeRouter(){if(this.#E||this.#$.length!==1)throw Error("No active router has been determined yet.");return this.#$[0]}};var t=Object.create(null),G$=class ${#$;#E;#f;#J=0;#P=t;constructor(E,f,Q){if(this.#E=Q||Object.create(null),this.#$=[],E&&f){let P=Object.create(null);P[E]={handler:f,possibleKeys:[],score:0},this.#$=[P]}this.#f=[]}insert(E,f,Q){this.#J=++this.#J;let P=this,J=E$(f),Y=[];for(let X=0,Z=J.length;X<Z;X++){let z=J[X],W=J[X+1],S=f$(z,W),R=Array.isArray(S)?S[0]:z;if(R in P.#E){if(P=P.#E[R],S)Y.push(S[1]);continue}if(P.#E[R]=new $,S)P.#f.push(S),Y.push(S[1]);P=P.#E[R]}return P.#$.push({[E]:{handler:Q,possibleKeys:Y.filter((X,Z,z)=>z.indexOf(X)===Z),score:this.#J}}),P}#Q(E,f,Q,P){let J=[];for(let Y=0,X=E.#$.length;Y<X;Y++){let Z=E.#$[Y],z=Z[f]||Z[L],W={};if(z!==void 0){if(z.params=Object.create(null),J.push(z),Q!==t||P&&P!==t)for(let S=0,R=z.possibleKeys.length;S<R;S++){let T=z.possibleKeys[S],M=W[z.score];z.params[T]=P?.[T]&&!M?P[T]:Q[T]??P?.[T],W[z.score]=!0}}}return J}search(E,f){let Q=[];this.#P=t;let J=[this],Y=h0(f),X=[];for(let Z=0,z=Y.length;Z<z;Z++){let W=Y[Z],S=Z===z-1,R=[];for(let T=0,M=J.length;T<M;T++){let U=J[T],j=U.#E[W];if(j)if(j.#P=U.#P,S){if(j.#E["*"])Q.push(...this.#Q(j.#E["*"],E,U.#P));Q.push(...this.#Q(j,E,U.#P))}else R.push(j);for(let x=0,d=U.#f.length;x<d;x++){let p=U.#f[x],F=U.#P===t?{}:{...U.#P};if(p==="*"){let A=U.#E["*"];if(A)Q.push(...this.#Q(A,E,U.#P)),A.#P=F,R.push(A);continue}let[x$,t0,c]=p;if(!W&&!(c instanceof RegExp))continue;let D=U.#E[x$],A$=Y.slice(Z).join("/");if(c instanceof RegExp){let A=c.exec(A$);if(A){if(F[t0]=A[0],Q.push(...this.#Q(D,E,U.#P,F)),Object.keys(D.#E).length){D.#P=F;let w$=A[0].match(/\//)?.length??0;(X[w$]||=[]).push(D)}continue}}if(c===!0||c.test(W))if(F[t0]=W,S){if(Q.push(...this.#Q(D,E,F,U.#P)),D.#E["*"])Q.push(...this.#Q(D.#E["*"],E,F,U.#P))}else D.#P=F,R.push(D)}}J=R.concat(X.shift()??[])}if(Q.length>1)Q.sort((Z,z)=>{return Z.score-z.score});return[Q.map(({handler:Z,params:z})=>[Z,z])]}};var m0=class{name="TrieRouter";#$;constructor(){this.#$=new G$}add($,E,f){let Q=U0(E);if(Q){for(let P=0,J=Q.length;P<J;P++)this.#$.insert($,Q[P],f);return}this.#$.insert($,E,f)}match($,E){return this.#$.search($,E)}};var r0=class extends L${constructor($={}){super($);this.router=$.router??new i0({routers:[new I0,new m0]})}};var j0=new Map,wE={windowMs:60000,maxRequests:100};function I$($,E=wE){let f=Date.now(),Q=j0.get($);if(!Q||f-Q.windowStart>=E.windowMs)return j0.set($,{count:1,windowStart:f}),{allowed:!0,remaining:E.maxRequests-1,resetMs:E.windowMs};if(Q.count>=E.maxRequests)return{allowed:!1,remaining:0,resetMs:E.windowMs-(f-Q.windowStart)};return Q.count++,{allowed:!0,remaining:E.maxRequests-Q.count,resetMs:E.windowMs-(f-Q.windowStart)}}function OE($=300000){let E=Date.now(),f=0;for(let[Q,P]of j0.entries())if(E-P.windowStart>$)j0.delete(Q),f++;return f}var yE=setInterval(()=>{OE()},300000);yE.unref();var j$={windowMs:60000,maxRequests:100};function CE(){let $=new r0;return $.get("/health",(E)=>{return E.json({ok:!0,timestamp:new Date().toISOString()})}),$.post("/check",async(E)=>{let f=E.req.header("x-forwarded-for")||E.req.header("x-real-ip")||"unknown",Q=I$(`check:${f}`,j$);if(E.header("X-RateLimit-Limit",String(j$.maxRequests)),E.header("X-RateLimit-Remaining",String(Q.remaining)),E.header("X-RateLimit-Reset",String(Math.ceil(Q.resetMs/1000))),!Q.allowed)return E.json({error:"Rate limit exceeded",retryAfterMs:Q.resetMs},429);let P;try{P=await E.req.json()}catch{return E.json({error:"Invalid JSON body"},400)}let{identifier:J,platform:Y="whatsapp"}=P;if(!J)return E.json({error:"identifier is required"},400);let X=["whatsapp","telegram","email","discord","slack","signal","webchat"];if(!X.includes(Y))return E.json({error:`Invalid platform. Must be one of: ${X.join(", ")}`},400);let Z=W0(J,Y),z=!Z.allowed?"deny":Z.trust==="limited"?"limited":"allow";return S0(J,Y,z,Z.reason),E.json(Z)}),$.get("/contacts",(E)=>{let f=E.req.query("platform"),Q=E.req.query("trust"),P=z0(f,Q);return E.json({contacts:P})}),$.post("/contacts",async(E)=>{let f=await E.req.json(),{identifier:Q,platform:P="whatsapp",trust:J="trusted",name:Y,notes:X}=f;if(!Q)return E.json({error:"identifier is required"},400);let Z=b(Q,P,J,Y,X);return E.json({contact:Z})}),$.delete("/contacts/:identifier",(E)=>{let f=E.req.param("identifier"),Q=E.req.query("platform")||"whatsapp",P=Z0(f,Q);return E.json({removed:P})}),$.get("/audit",(E)=>{let f=parseInt(E.req.query("limit")||"100"),Q=E.req.query("decision"),P=h({limit:f,decision:Q});return E.json({entries:P})}),$}function V$($=3847){let E=CE();console.log(`wasp server listening on http://localhost:${$}`),console.log("Endpoints:"),console.log("  POST /check         - Check if contact is allowed"),console.log("  GET  /contacts      - List contacts"),console.log("  POST /contacts      - Add contact"),console.log("  DELETE /contacts/:id - Remove contact"),console.log("  GET  /audit         - View audit log"),console.log("  GET  /health        - Health check"),Bun.serve({port:$,fetch:E.fetch})}function _$($){if(!g())console.error("wasp is not initialized. Run `wasp init` first."),process.exit(1);let E=$.port||3847;V$(E)}function H$($=50){return V().prepare(`
    SELECT * FROM quarantine 
    WHERE reviewed = 0 
    ORDER BY timestamp DESC 
    LIMIT ?
  `).all($).map((P)=>({id:P.id,identifier:P.identifier,platform:P.platform,messagePreview:P.message_preview,fullMessage:P.full_message,timestamp:P.timestamp,reviewed:!!P.reviewed}))}function bE($,E="whatsapp"){return V().prepare(`
    SELECT * FROM quarantine 
    WHERE identifier = ? AND platform = ? AND reviewed = 0
    ORDER BY timestamp ASC
  `).all($,E).map((J)=>({id:J.id,identifier:J.identifier,platform:J.platform,messagePreview:J.message_preview,fullMessage:J.full_message,timestamp:J.timestamp,reviewed:!!J.reviewed}))}function F$($,E="whatsapp"){let f=bE($,E);if(f.length>0)V().prepare(`
      UPDATE quarantine SET reviewed = 1 
      WHERE identifier = ? AND platform = ?
    `).run($,E);return f}function q$($,E="whatsapp"){return V().prepare(`
    DELETE FROM quarantine WHERE identifier = ? AND platform = ?
  `).run($,E).changes}async function D$($){if($.approve){let P=F$($.approve);if(P.length>0)b(P[0].identifier,P[0].platform,"trusted"),console.log(`\u2713 Approved ${P[0].identifier}`),console.log(`  Released ${P.length} quarantined message(s)`);else console.log(`No quarantined messages for: ${$.approve}`);return}if($.deny){let P=q$($.deny);if(P>0)b($.deny,"whatsapp","limited"),console.log(`\u2717 Denied ${$.deny}`),console.log(`  Deleted ${P} message(s)`);else console.log(`No quarantined messages for: ${$.deny}`);return}let E=H$(50);if(E.length===0){console.log(`
\uD83D\uDC1D Quarantine is empty - no messages awaiting review
`);return}let f=new Map;for(let P of E){let J=`${P.identifier}|${P.platform}`;if(!f.has(J))f.set(J,[]);f.get(J).push(P)}console.log(`
\uD83D\uDC1D Quarantine Review
`),console.log(`${f.size} sender(s), ${E.length} message(s) awaiting review
`),console.log("\u2500".repeat(60)+`
`);let Q=1;for(let[P,J]of f){let[Y,X]=P.split("|");console.log(`${Q}. ${Y} (${X})`),console.log(`   ${J.length} message(s)`),console.log("");let Z=J[0];console.log(`   First: "${Z.messagePreview}"`),console.log(`   Time:  ${Z.timestamp}`),console.log(""),Q++}if(console.log("\u2500".repeat(60)),console.log(`
Actions:`),console.log("  wasp review --approve <identifier>   Add to trusted, release messages"),console.log("  wasp review --deny <identifier>      Block sender, delete messages"),console.log(""),$.interactive)console.log("Interactive mode not yet implemented."),console.log("Use --approve or --deny flags for now.")}function N$($=20){let E=h({limit:100,decision:"deny"}),f=new Set,Q=[];for(let P of E){let J=`${P.identifier}|${P.platform}`;if(!f.has(J)){if(f.add(J),Q.push(P),Q.length>=$)break}}if(Q.length===0){console.log(`
No blocked contacts in recent history.
`);return}console.log(`
\uD83D\uDC1D Recently Blocked Contacts
`),console.log("\u2500".repeat(60)+`
`);for(let P of Q)console.log(`  ${P.identifier} (${P.platform})`),console.log(`    Last seen: ${P.timestamp}`),console.log(`    Reason: ${P.reason}`),console.log("");console.log("\u2500".repeat(60)),console.log(`
To allow a contact:`),console.log('  wasp add "<identifier>" --trust trusted'),console.log("")}var vE=kE(import.meta.url),gE=vE("../package.json"),hE=gE.version;_.name("wasp").description("Security whitelist layer for Moltbot and agentic systems").version(hE);_.command("init").description("Initialize wasp database").option("-f, --force","Reinitialize even if already initialized").action(($)=>{t1($.force)});_.command("add <identifier>").description("Add a contact to the whitelist").option("-p, --platform <platform>","Platform (whatsapp, telegram, email, discord, slack, signal)","whatsapp").option("-t, --trust <level>","Trust level (sovereign, trusted, limited)","trusted").option("-n, --name <name>","Contact name").option("--notes <notes>","Notes about this contact").action(($,E)=>{w(),d1($,E)});_.command("remove <identifier>").description("Remove a contact from the whitelist").option("-p, --platform <platform>","Platform","whatsapp").action(($,E)=>{w(),p1($,E.platform)});_.command("list").description("List all contacts").option("-p, --platform <platform>","Filter by platform").option("-t, --trust <level>","Filter by trust level").option("-j, --json","Output as JSON").action(($)=>{w(),n1($)});_.command("check <identifier>").description("Check if a contact is allowed").option("-p, --platform <platform>","Platform","whatsapp").option("-j, --json","Output as JSON").option("-q, --quiet","Exit code only, no output").action(($,E)=>{w(),o1($,E)});_.command("log").description("View audit log").option("-l, --limit <number>","Number of entries to show","50").option("-d, --denied","Show only denied entries").option("-j, --json","Output as JSON").action(($)=>{w(),a1({...$,limit:parseInt($.limit)})});_.command("serve").description("Start HTTP server for Moltbot integration").option("-p, --port <number>","Port to listen on","3847").action(($)=>{w(),_$({port:parseInt($.port)})});_.command("review").description("Review quarantined messages and first-time contacts").option("--approve <identifier>","Approve sender and release messages").option("--deny <identifier>","Block sender and delete messages").option("-i, --interactive","Interactive review mode").action(async($)=>{w(),await D$($)});_.command("blocked").description("Show recently blocked contacts").option("-l, --limit <number>","Number to show","20").action(($)=>{w(),N$(parseInt($.limit))});function w(){if(!g())console.log("wasp is not initialized. Initializing now..."),X0(),console.log("")}_.parseAsync().then(()=>{k0(),process.exit(0)}).catch(($)=>{console.error($),k0(),process.exit(1)});
