#!/usr/bin/env node
import{createRequire as s$}from"node:module";var h$=Object.create;var{getPrototypeOf:g$,defineProperty:o0,getOwnPropertyNames:u$}=Object;var c$=Object.prototype.hasOwnProperty;var l$=($,J,X)=>{X=$!=null?h$(g$($)):{};let Z=J||!$||!$.__esModule?o0(X,"default",{value:$,enumerable:!0}):X;for(let Y of u$($))if(!c$.call(Z,Y))o0(Z,Y,{get:()=>$[Y],enumerable:!0});return Z};var L=($,J)=>()=>(J||$((J={exports:{}}).exports,J),J.exports);var I=s$(import.meta.url);var l=L((m$)=>{class H0 extends Error{constructor($,J,X){super(X);Error.captureStackTrace(this,this.constructor),this.name=this.constructor.name,this.code=J,this.exitCode=$,this.nestedError=void 0}}class a0 extends H0{constructor($){super(1,"commander.invalidArgument",$);Error.captureStackTrace(this,this.constructor),this.name=this.constructor.name}}m$.CommanderError=H0;m$.InvalidArgumentError=a0});var t=L((n$)=>{var{InvalidArgumentError:r$}=l();class e0{constructor($,J){switch(this.description=J||"",this.variadic=!1,this.parseArg=void 0,this.defaultValue=void 0,this.defaultValueDescription=void 0,this.argChoices=void 0,$[0]){case"<":this.required=!0,this._name=$.slice(1,-1);break;case"[":this.required=!1,this._name=$.slice(1,-1);break;default:this.required=!0,this._name=$;break}if(this._name.length>3&&this._name.slice(-3)==="...")this.variadic=!0,this._name=this._name.slice(0,-3)}name(){return this._name}_concatValue($,J){if(J===this.defaultValue||!Array.isArray(J))return[$];return J.concat($)}default($,J){return this.defaultValue=$,this.defaultValueDescription=J,this}argParser($){return this.parseArg=$,this}choices($){return this.argChoices=$.slice(),this.parseArg=(J,X)=>{if(!this.argChoices.includes(J))throw new r$(`Allowed choices are ${this.argChoices.join(", ")}.`);if(this.variadic)return this._concatValue(J,X);return J},this}argRequired(){return this.required=!0,this}argOptional(){return this.required=!1,this}}function p$($){let J=$.name()+($.variadic===!0?"...":"");return $.required?"<"+J+">":"["+J+"]"}n$.Argument=e0;n$.humanReadableArgName=p$});var F0=L((e$)=>{var{humanReadableArgName:a$}=t();class $1{constructor(){this.helpWidth=void 0,this.sortSubcommands=!1,this.sortOptions=!1,this.showGlobalOptions=!1}visibleCommands($){let J=$.commands.filter((Z)=>!Z._hidden),X=$._getHelpCommand();if(X&&!X._hidden)J.push(X);if(this.sortSubcommands)J.sort((Z,Y)=>{return Z.name().localeCompare(Y.name())});return J}compareOptions($,J){let X=(Z)=>{return Z.short?Z.short.replace(/^-/,""):Z.long.replace(/^--/,"")};return X($).localeCompare(X(J))}visibleOptions($){let J=$.options.filter((Z)=>!Z.hidden),X=$._getHelpOption();if(X&&!X.hidden){let Z=X.short&&$._findOption(X.short),Y=X.long&&$._findOption(X.long);if(!Z&&!Y)J.push(X);else if(X.long&&!Y)J.push($.createOption(X.long,X.description));else if(X.short&&!Z)J.push($.createOption(X.short,X.description))}if(this.sortOptions)J.sort(this.compareOptions);return J}visibleGlobalOptions($){if(!this.showGlobalOptions)return[];let J=[];for(let X=$.parent;X;X=X.parent){let Z=X.options.filter((Y)=>!Y.hidden);J.push(...Z)}if(this.sortOptions)J.sort(this.compareOptions);return J}visibleArguments($){if($._argsDescription)$.registeredArguments.forEach((J)=>{J.description=J.description||$._argsDescription[J.name()]||""});if($.registeredArguments.find((J)=>J.description))return $.registeredArguments;return[]}subcommandTerm($){let J=$.registeredArguments.map((X)=>a$(X)).join(" ");return $._name+($._aliases[0]?"|"+$._aliases[0]:"")+($.options.length?" [options]":"")+(J?" "+J:"")}optionTerm($){return $.flags}argumentTerm($){return $.name()}longestSubcommandTermLength($,J){return J.visibleCommands($).reduce((X,Z)=>{return Math.max(X,J.subcommandTerm(Z).length)},0)}longestOptionTermLength($,J){return J.visibleOptions($).reduce((X,Z)=>{return Math.max(X,J.optionTerm(Z).length)},0)}longestGlobalOptionTermLength($,J){return J.visibleGlobalOptions($).reduce((X,Z)=>{return Math.max(X,J.optionTerm(Z).length)},0)}longestArgumentTermLength($,J){return J.visibleArguments($).reduce((X,Z)=>{return Math.max(X,J.argumentTerm(Z).length)},0)}commandUsage($){let J=$._name;if($._aliases[0])J=J+"|"+$._aliases[0];let X="";for(let Z=$.parent;Z;Z=Z.parent)X=Z.name()+" "+X;return X+J+" "+$.usage()}commandDescription($){return $.description()}subcommandDescription($){return $.summary()||$.description()}optionDescription($){let J=[];if($.argChoices)J.push(`choices: ${$.argChoices.map((X)=>JSON.stringify(X)).join(", ")}`);if($.defaultValue!==void 0){if($.required||$.optional||$.isBoolean()&&typeof $.defaultValue==="boolean")J.push(`default: ${$.defaultValueDescription||JSON.stringify($.defaultValue)}`)}if($.presetArg!==void 0&&$.optional)J.push(`preset: ${JSON.stringify($.presetArg)}`);if($.envVar!==void 0)J.push(`env: ${$.envVar}`);if(J.length>0)return`${$.description} (${J.join(", ")})`;return $.description}argumentDescription($){let J=[];if($.argChoices)J.push(`choices: ${$.argChoices.map((X)=>JSON.stringify(X)).join(", ")}`);if($.defaultValue!==void 0)J.push(`default: ${$.defaultValueDescription||JSON.stringify($.defaultValue)}`);if(J.length>0){let X=`(${J.join(", ")})`;if($.description)return`${$.description} ${X}`;return X}return $.description}formatHelp($,J){let X=J.padWidth($,J),Z=J.helpWidth||80,Y=2,z=2;function E(U,j){if(j){let R=`${U.padEnd(X+2)}${j}`;return J.wrap(R,Z-2,X+2)}return U}function Q(U){return U.join(`
`).replace(/^/gm," ".repeat(2))}let W=[`Usage: ${J.commandUsage($)}`,""],P=J.commandDescription($);if(P.length>0)W=W.concat([J.wrap(P,Z,0),""]);let B=J.visibleArguments($).map((U)=>{return E(J.argumentTerm(U),J.argumentDescription(U))});if(B.length>0)W=W.concat(["Arguments:",Q(B),""]);let S=J.visibleOptions($).map((U)=>{return E(J.optionTerm(U),J.optionDescription(U))});if(S.length>0)W=W.concat(["Options:",Q(S),""]);if(this.showGlobalOptions){let U=J.visibleGlobalOptions($).map((j)=>{return E(J.optionTerm(j),J.optionDescription(j))});if(U.length>0)W=W.concat(["Global Options:",Q(U),""])}let K=J.visibleCommands($).map((U)=>{return E(J.subcommandTerm(U),J.subcommandDescription(U))});if(K.length>0)W=W.concat(["Commands:",Q(K),""]);return W.join(`
`)}padWidth($,J){return Math.max(J.longestOptionTermLength($,J),J.longestGlobalOptionTermLength($,J),J.longestSubcommandTermLength($,J),J.longestArgumentTermLength($,J))}wrap($,J,X,Z=40){let z=new RegExp(`[\\n][${" \\f\\t\\v   -   　\uFEFF"}]+`);if($.match(z))return $;let E=J-X;if(E<Z)return $;let Q=$.slice(0,X),W=$.slice(X).replace(`\r
`,`
`),P=" ".repeat(X),S=`\\s${"​"}`,K=new RegExp(`
|.{1,${E-1}}([${S}]|$)|[^${S}]+?([${S}]|$)`,"g"),U=W.match(K)||[];return Q+U.map((j,R)=>{if(j===`
`)return"";return(R>0?P:"")+j.trimEnd()}).join(`
`)}}e$.Help=$1});var q0=L((Y2)=>{var{InvalidArgumentError:J2}=l();class J1{constructor($,J){this.flags=$,this.description=J||"",this.required=$.includes("<"),this.optional=$.includes("["),this.variadic=/\w\.\.\.[>\]]$/.test($),this.mandatory=!1;let X=Z2($);if(this.short=X.shortFlag,this.long=X.longFlag,this.negate=!1,this.long)this.negate=this.long.startsWith("--no-");this.defaultValue=void 0,this.defaultValueDescription=void 0,this.presetArg=void 0,this.envVar=void 0,this.parseArg=void 0,this.hidden=!1,this.argChoices=void 0,this.conflictsWith=[],this.implied=void 0}default($,J){return this.defaultValue=$,this.defaultValueDescription=J,this}preset($){return this.presetArg=$,this}conflicts($){return this.conflictsWith=this.conflictsWith.concat($),this}implies($){let J=$;if(typeof $==="string")J={[$]:!0};return this.implied=Object.assign(this.implied||{},J),this}env($){return this.envVar=$,this}argParser($){return this.parseArg=$,this}makeOptionMandatory($=!0){return this.mandatory=!!$,this}hideHelp($=!0){return this.hidden=!!$,this}_concatValue($,J){if(J===this.defaultValue||!Array.isArray(J))return[$];return J.concat($)}choices($){return this.argChoices=$.slice(),this.parseArg=(J,X)=>{if(!this.argChoices.includes(J))throw new J2(`Allowed choices are ${this.argChoices.join(", ")}.`);if(this.variadic)return this._concatValue(J,X);return J},this}name(){if(this.long)return this.long.replace(/^--/,"");return this.short.replace(/^-/,"")}attributeName(){return X2(this.name().replace(/^no-/,""))}is($){return this.short===$||this.long===$}isBoolean(){return!this.required&&!this.optional&&!this.negate}}class X1{constructor($){this.positiveOptions=new Map,this.negativeOptions=new Map,this.dualOptions=new Set,$.forEach((J)=>{if(J.negate)this.negativeOptions.set(J.attributeName(),J);else this.positiveOptions.set(J.attributeName(),J)}),this.negativeOptions.forEach((J,X)=>{if(this.positiveOptions.has(X))this.dualOptions.add(X)})}valueFromOption($,J){let X=J.attributeName();if(!this.dualOptions.has(X))return!0;let Z=this.negativeOptions.get(X).presetArg,Y=Z!==void 0?Z:!1;return J.negate===(Y===$)}}function X2($){return $.split("-").reduce((J,X)=>{return J+X[0].toUpperCase()+X.slice(1)})}function Z2($){let J,X,Z=$.split(/[ |,]+/);if(Z.length>1&&!/^[[<]/.test(Z[1]))J=Z.shift();if(X=Z.shift(),!J&&/^-[^-]$/.test(X))J=X,X=void 0;return{shortFlag:J,longFlag:X}}Y2.Option=J1;Y2.DualOptions=X1});var Z1=L((P2)=>{function Q2($,J){if(Math.abs($.length-J.length)>3)return Math.max($.length,J.length);let X=[];for(let Z=0;Z<=$.length;Z++)X[Z]=[Z];for(let Z=0;Z<=J.length;Z++)X[0][Z]=Z;for(let Z=1;Z<=J.length;Z++)for(let Y=1;Y<=$.length;Y++){let z=1;if($[Y-1]===J[Z-1])z=0;else z=1;if(X[Y][Z]=Math.min(X[Y-1][Z]+1,X[Y][Z-1]+1,X[Y-1][Z-1]+z),Y>1&&Z>1&&$[Y-1]===J[Z-2]&&$[Y-2]===J[Z-1])X[Y][Z]=Math.min(X[Y][Z],X[Y-2][Z-2]+1)}return X[$.length][J.length]}function W2($,J){if(!J||J.length===0)return"";J=Array.from(new Set(J));let X=$.startsWith("--");if(X)$=$.slice(2),J=J.map((E)=>E.slice(2));let Z=[],Y=3,z=0.4;if(J.forEach((E)=>{if(E.length<=1)return;let Q=Q2($,E),W=Math.max($.length,E.length);if((W-Q)/W>z){if(Q<Y)Y=Q,Z=[E];else if(Q===Y)Z.push(E)}}),Z.sort((E,Q)=>E.localeCompare(Q)),X)Z=Z.map((E)=>`--${E}`);if(Z.length>1)return`
(Did you mean one of ${Z.join(", ")}?)`;if(Z.length===1)return`
(Did you mean ${Z[0]}?)`;return""}P2.suggestSimilar=W2});var Q1=L((L2)=>{var S2=I("node:events").EventEmitter,N0=I("node:child_process"),A=I("node:path"),f0=I("node:fs"),T=I("node:process"),{Argument:U2,humanReadableArgName:K2}=t(),{CommanderError:A0}=l(),{Help:G2}=F0(),{Option:Y1,DualOptions:R2}=q0(),{suggestSimilar:z1}=Z1();class D0 extends S2{constructor($){super();this.commands=[],this.options=[],this.parent=null,this._allowUnknownOption=!1,this._allowExcessArguments=!0,this.registeredArguments=[],this._args=this.registeredArguments,this.args=[],this.rawArgs=[],this.processedArgs=[],this._scriptPath=null,this._name=$||"",this._optionValues={},this._optionValueSources={},this._storeOptionsAsProperties=!1,this._actionHandler=null,this._executableHandler=!1,this._executableFile=null,this._executableDir=null,this._defaultCommandName=null,this._exitCallback=null,this._aliases=[],this._combineFlagAndOptionalValue=!0,this._description="",this._summary="",this._argsDescription=void 0,this._enablePositionalOptions=!1,this._passThroughOptions=!1,this._lifeCycleHooks={},this._showHelpAfterError=!1,this._showSuggestionAfterError=!0,this._outputConfiguration={writeOut:(J)=>T.stdout.write(J),writeErr:(J)=>T.stderr.write(J),getOutHelpWidth:()=>T.stdout.isTTY?T.stdout.columns:void 0,getErrHelpWidth:()=>T.stderr.isTTY?T.stderr.columns:void 0,outputError:(J,X)=>X(J)},this._hidden=!1,this._helpOption=void 0,this._addImplicitHelpCommand=void 0,this._helpCommand=void 0,this._helpConfiguration={}}copyInheritedSettings($){return this._outputConfiguration=$._outputConfiguration,this._helpOption=$._helpOption,this._helpCommand=$._helpCommand,this._helpConfiguration=$._helpConfiguration,this._exitCallback=$._exitCallback,this._storeOptionsAsProperties=$._storeOptionsAsProperties,this._combineFlagAndOptionalValue=$._combineFlagAndOptionalValue,this._allowExcessArguments=$._allowExcessArguments,this._enablePositionalOptions=$._enablePositionalOptions,this._showHelpAfterError=$._showHelpAfterError,this._showSuggestionAfterError=$._showSuggestionAfterError,this}_getCommandAndAncestors(){let $=[];for(let J=this;J;J=J.parent)$.push(J);return $}command($,J,X){let Z=J,Y=X;if(typeof Z==="object"&&Z!==null)Y=Z,Z=null;Y=Y||{};let[,z,E]=$.match(/([^ ]+) *(.*)/),Q=this.createCommand(z);if(Z)Q.description(Z),Q._executableHandler=!0;if(Y.isDefault)this._defaultCommandName=Q._name;if(Q._hidden=!!(Y.noHelp||Y.hidden),Q._executableFile=Y.executableFile||null,E)Q.arguments(E);if(this._registerCommand(Q),Q.parent=this,Q.copyInheritedSettings(this),Z)return this;return Q}createCommand($){return new D0($)}createHelp(){return Object.assign(new G2,this.configureHelp())}configureHelp($){if($===void 0)return this._helpConfiguration;return this._helpConfiguration=$,this}configureOutput($){if($===void 0)return this._outputConfiguration;return Object.assign(this._outputConfiguration,$),this}showHelpAfterError($=!0){if(typeof $!=="string")$=!!$;return this._showHelpAfterError=$,this}showSuggestionAfterError($=!0){return this._showSuggestionAfterError=!!$,this}addCommand($,J){if(!$._name)throw Error(`Command passed to .addCommand() must have a name
- specify the name in Command constructor or using .name()`);if(J=J||{},J.isDefault)this._defaultCommandName=$._name;if(J.noHelp||J.hidden)$._hidden=!0;return this._registerCommand($),$.parent=this,$._checkForBrokenPassThrough(),this}createArgument($,J){return new U2($,J)}argument($,J,X,Z){let Y=this.createArgument($,J);if(typeof X==="function")Y.default(Z).argParser(X);else Y.default(X);return this.addArgument(Y),this}arguments($){return $.trim().split(/ +/).forEach((J)=>{this.argument(J)}),this}addArgument($){let J=this.registeredArguments.slice(-1)[0];if(J&&J.variadic)throw Error(`only the last argument can be variadic '${J.name()}'`);if($.required&&$.defaultValue!==void 0&&$.parseArg===void 0)throw Error(`a default value for a required argument is never used: '${$.name()}'`);return this.registeredArguments.push($),this}helpCommand($,J){if(typeof $==="boolean")return this._addImplicitHelpCommand=$,this;$=$??"help [command]";let[,X,Z]=$.match(/([^ ]+) *(.*)/),Y=J??"display help for command",z=this.createCommand(X);if(z.helpOption(!1),Z)z.arguments(Z);if(Y)z.description(Y);return this._addImplicitHelpCommand=!0,this._helpCommand=z,this}addHelpCommand($,J){if(typeof $!=="object")return this.helpCommand($,J),this;return this._addImplicitHelpCommand=!0,this._helpCommand=$,this}_getHelpCommand(){if(this._addImplicitHelpCommand??(this.commands.length&&!this._actionHandler&&!this._findCommand("help"))){if(this._helpCommand===void 0)this.helpCommand(void 0,void 0);return this._helpCommand}return null}hook($,J){let X=["preSubcommand","preAction","postAction"];if(!X.includes($))throw Error(`Unexpected value for event passed to hook : '${$}'.
Expecting one of '${X.join("', '")}'`);if(this._lifeCycleHooks[$])this._lifeCycleHooks[$].push(J);else this._lifeCycleHooks[$]=[J];return this}exitOverride($){if($)this._exitCallback=$;else this._exitCallback=(J)=>{if(J.code!=="commander.executeSubCommandAsync")throw J};return this}_exit($,J,X){if(this._exitCallback)this._exitCallback(new A0($,J,X));T.exit($)}action($){let J=(X)=>{let Z=this.registeredArguments.length,Y=X.slice(0,Z);if(this._storeOptionsAsProperties)Y[Z]=this;else Y[Z]=this.opts();return Y.push(this),$.apply(this,Y)};return this._actionHandler=J,this}createOption($,J){return new Y1($,J)}_callParseArg($,J,X,Z){try{return $.parseArg(J,X)}catch(Y){if(Y.code==="commander.invalidArgument"){let z=`${Z} ${Y.message}`;this.error(z,{exitCode:Y.exitCode,code:Y.code})}throw Y}}_registerOption($){let J=$.short&&this._findOption($.short)||$.long&&this._findOption($.long);if(J){let X=$.long&&this._findOption($.long)?$.long:$.short;throw Error(`Cannot add option '${$.flags}'${this._name&&` to command '${this._name}'`} due to conflicting flag '${X}'
-  already used by option '${J.flags}'`)}this.options.push($)}_registerCommand($){let J=(Z)=>{return[Z.name()].concat(Z.aliases())},X=J($).find((Z)=>this._findCommand(Z));if(X){let Z=J(this._findCommand(X)).join("|"),Y=J($).join("|");throw Error(`cannot add command '${Y}' as already have command '${Z}'`)}this.commands.push($)}addOption($){this._registerOption($);let J=$.name(),X=$.attributeName();if($.negate){let Y=$.long.replace(/^--no-/,"--");if(!this._findOption(Y))this.setOptionValueWithSource(X,$.defaultValue===void 0?!0:$.defaultValue,"default")}else if($.defaultValue!==void 0)this.setOptionValueWithSource(X,$.defaultValue,"default");let Z=(Y,z,E)=>{if(Y==null&&$.presetArg!==void 0)Y=$.presetArg;let Q=this.getOptionValue(X);if(Y!==null&&$.parseArg)Y=this._callParseArg($,Y,Q,z);else if(Y!==null&&$.variadic)Y=$._concatValue(Y,Q);if(Y==null)if($.negate)Y=!1;else if($.isBoolean()||$.optional)Y=!0;else Y="";this.setOptionValueWithSource(X,Y,E)};if(this.on("option:"+J,(Y)=>{let z=`error: option '${$.flags}' argument '${Y}' is invalid.`;Z(Y,z,"cli")}),$.envVar)this.on("optionEnv:"+J,(Y)=>{let z=`error: option '${$.flags}' value '${Y}' from env '${$.envVar}' is invalid.`;Z(Y,z,"env")});return this}_optionEx($,J,X,Z,Y){if(typeof J==="object"&&J instanceof Y1)throw Error("To add an Option object use addOption() instead of option() or requiredOption()");let z=this.createOption(J,X);if(z.makeOptionMandatory(!!$.mandatory),typeof Z==="function")z.default(Y).argParser(Z);else if(Z instanceof RegExp){let E=Z;Z=(Q,W)=>{let P=E.exec(Q);return P?P[0]:W},z.default(Y).argParser(Z)}else z.default(Z);return this.addOption(z)}option($,J,X,Z){return this._optionEx({},$,J,X,Z)}requiredOption($,J,X,Z){return this._optionEx({mandatory:!0},$,J,X,Z)}combineFlagAndOptionalValue($=!0){return this._combineFlagAndOptionalValue=!!$,this}allowUnknownOption($=!0){return this._allowUnknownOption=!!$,this}allowExcessArguments($=!0){return this._allowExcessArguments=!!$,this}enablePositionalOptions($=!0){return this._enablePositionalOptions=!!$,this}passThroughOptions($=!0){return this._passThroughOptions=!!$,this._checkForBrokenPassThrough(),this}_checkForBrokenPassThrough(){if(this.parent&&this._passThroughOptions&&!this.parent._enablePositionalOptions)throw Error(`passThroughOptions cannot be used for '${this._name}' without turning on enablePositionalOptions for parent command(s)`)}storeOptionsAsProperties($=!0){if(this.options.length)throw Error("call .storeOptionsAsProperties() before adding options");if(Object.keys(this._optionValues).length)throw Error("call .storeOptionsAsProperties() before setting option values");return this._storeOptionsAsProperties=!!$,this}getOptionValue($){if(this._storeOptionsAsProperties)return this[$];return this._optionValues[$]}setOptionValue($,J){return this.setOptionValueWithSource($,J,void 0)}setOptionValueWithSource($,J,X){if(this._storeOptionsAsProperties)this[$]=J;else this._optionValues[$]=J;return this._optionValueSources[$]=X,this}getOptionValueSource($){return this._optionValueSources[$]}getOptionValueSourceWithGlobals($){let J;return this._getCommandAndAncestors().forEach((X)=>{if(X.getOptionValueSource($)!==void 0)J=X.getOptionValueSource($)}),J}_prepareUserArgs($,J){if($!==void 0&&!Array.isArray($))throw Error("first parameter to parse must be array or undefined");if(J=J||{},$===void 0&&J.from===void 0){if(T.versions?.electron)J.from="electron";let Z=T.execArgv??[];if(Z.includes("-e")||Z.includes("--eval")||Z.includes("-p")||Z.includes("--print"))J.from="eval"}if($===void 0)$=T.argv;this.rawArgs=$.slice();let X;switch(J.from){case void 0:case"node":this._scriptPath=$[1],X=$.slice(2);break;case"electron":if(T.defaultApp)this._scriptPath=$[1],X=$.slice(2);else X=$.slice(1);break;case"user":X=$.slice(0);break;case"eval":X=$.slice(1);break;default:throw Error(`unexpected parse option { from: '${J.from}' }`)}if(!this._name&&this._scriptPath)this.nameFromFilename(this._scriptPath);return this._name=this._name||"program",X}parse($,J){let X=this._prepareUserArgs($,J);return this._parseCommand([],X),this}async parseAsync($,J){let X=this._prepareUserArgs($,J);return await this._parseCommand([],X),this}_executeSubCommand($,J){J=J.slice();let X=!1,Z=[".js",".ts",".tsx",".mjs",".cjs"];function Y(P,B){let S=A.resolve(P,B);if(f0.existsSync(S))return S;if(Z.includes(A.extname(B)))return;let K=Z.find((U)=>f0.existsSync(`${S}${U}`));if(K)return`${S}${K}`;return}this._checkForMissingMandatoryOptions(),this._checkForConflictingOptions();let z=$._executableFile||`${this._name}-${$._name}`,E=this._executableDir||"";if(this._scriptPath){let P;try{P=f0.realpathSync(this._scriptPath)}catch(B){P=this._scriptPath}E=A.resolve(A.dirname(P),E)}if(E){let P=Y(E,z);if(!P&&!$._executableFile&&this._scriptPath){let B=A.basename(this._scriptPath,A.extname(this._scriptPath));if(B!==this._name)P=Y(E,`${B}-${$._name}`)}z=P||z}X=Z.includes(A.extname(z));let Q;if(T.platform!=="win32")if(X)J.unshift(z),J=E1(T.execArgv).concat(J),Q=N0.spawn(T.argv[0],J,{stdio:"inherit"});else Q=N0.spawn(z,J,{stdio:"inherit"});else J.unshift(z),J=E1(T.execArgv).concat(J),Q=N0.spawn(T.execPath,J,{stdio:"inherit"});if(!Q.killed)["SIGUSR1","SIGUSR2","SIGTERM","SIGINT","SIGHUP"].forEach((B)=>{T.on(B,()=>{if(Q.killed===!1&&Q.exitCode===null)Q.kill(B)})});let W=this._exitCallback;Q.on("close",(P)=>{if(P=P??1,!W)T.exit(P);else W(new A0(P,"commander.executeSubCommandAsync","(close)"))}),Q.on("error",(P)=>{if(P.code==="ENOENT"){let B=E?`searched for local subcommand relative to directory '${E}'`:"no directory for search for local subcommand, use .executableDir() to supply a custom directory",S=`'${z}' does not exist
 - if '${$._name}' is not meant to be an executable command, remove description parameter from '.command()' and use '.description()' instead
 - if the default executable name is not suitable, use the executableFile option to supply a custom name or path
 - ${B}`;throw Error(S)}else if(P.code==="EACCES")throw Error(`'${z}' not executable`);if(!W)T.exit(1);else{let B=new A0(1,"commander.executeSubCommandAsync","(error)");B.nestedError=P,W(B)}}),this.runningCommand=Q}_dispatchSubcommand($,J,X){let Z=this._findCommand($);if(!Z)this.help({error:!0});let Y;return Y=this._chainOrCallSubCommandHook(Y,Z,"preSubcommand"),Y=this._chainOrCall(Y,()=>{if(Z._executableHandler)this._executeSubCommand(Z,J.concat(X));else return Z._parseCommand(J,X)}),Y}_dispatchHelpCommand($){if(!$)this.help();let J=this._findCommand($);if(J&&!J._executableHandler)J.help();return this._dispatchSubcommand($,[],[this._getHelpOption()?.long??this._getHelpOption()?.short??"--help"])}_checkNumberOfArguments(){if(this.registeredArguments.forEach(($,J)=>{if($.required&&this.args[J]==null)this.missingArgument($.name())}),this.registeredArguments.length>0&&this.registeredArguments[this.registeredArguments.length-1].variadic)return;if(this.args.length>this.registeredArguments.length)this._excessArguments(this.args)}_processArguments(){let $=(X,Z,Y)=>{let z=Z;if(Z!==null&&X.parseArg){let E=`error: command-argument value '${Z}' is invalid for argument '${X.name()}'.`;z=this._callParseArg(X,Z,Y,E)}return z};this._checkNumberOfArguments();let J=[];this.registeredArguments.forEach((X,Z)=>{let Y=X.defaultValue;if(X.variadic){if(Z<this.args.length){if(Y=this.args.slice(Z),X.parseArg)Y=Y.reduce((z,E)=>{return $(X,E,z)},X.defaultValue)}else if(Y===void 0)Y=[]}else if(Z<this.args.length){if(Y=this.args[Z],X.parseArg)Y=$(X,Y,X.defaultValue)}J[Z]=Y}),this.processedArgs=J}_chainOrCall($,J){if($&&$.then&&typeof $.then==="function")return $.then(()=>J());return J()}_chainOrCallHooks($,J){let X=$,Z=[];if(this._getCommandAndAncestors().reverse().filter((Y)=>Y._lifeCycleHooks[J]!==void 0).forEach((Y)=>{Y._lifeCycleHooks[J].forEach((z)=>{Z.push({hookedCommand:Y,callback:z})})}),J==="postAction")Z.reverse();return Z.forEach((Y)=>{X=this._chainOrCall(X,()=>{return Y.callback(Y.hookedCommand,this)})}),X}_chainOrCallSubCommandHook($,J,X){let Z=$;if(this._lifeCycleHooks[X]!==void 0)this._lifeCycleHooks[X].forEach((Y)=>{Z=this._chainOrCall(Z,()=>{return Y(this,J)})});return Z}_parseCommand($,J){let X=this.parseOptions(J);if(this._parseOptionsEnv(),this._parseOptionsImplied(),$=$.concat(X.operands),J=X.unknown,this.args=$.concat(J),$&&this._findCommand($[0]))return this._dispatchSubcommand($[0],$.slice(1),J);if(this._getHelpCommand()&&$[0]===this._getHelpCommand().name())return this._dispatchHelpCommand($[1]);if(this._defaultCommandName)return this._outputHelpIfRequested(J),this._dispatchSubcommand(this._defaultCommandName,$,J);if(this.commands.length&&this.args.length===0&&!this._actionHandler&&!this._defaultCommandName)this.help({error:!0});this._outputHelpIfRequested(X.unknown),this._checkForMissingMandatoryOptions(),this._checkForConflictingOptions();let Z=()=>{if(X.unknown.length>0)this.unknownOption(X.unknown[0])},Y=`command:${this.name()}`;if(this._actionHandler){Z(),this._processArguments();let z;if(z=this._chainOrCallHooks(z,"preAction"),z=this._chainOrCall(z,()=>this._actionHandler(this.processedArgs)),this.parent)z=this._chainOrCall(z,()=>{this.parent.emit(Y,$,J)});return z=this._chainOrCallHooks(z,"postAction"),z}if(this.parent&&this.parent.listenerCount(Y))Z(),this._processArguments(),this.parent.emit(Y,$,J);else if($.length){if(this._findCommand("*"))return this._dispatchSubcommand("*",$,J);if(this.listenerCount("command:*"))this.emit("command:*",$,J);else if(this.commands.length)this.unknownCommand();else Z(),this._processArguments()}else if(this.commands.length)Z(),this.help({error:!0});else Z(),this._processArguments()}_findCommand($){if(!$)return;return this.commands.find((J)=>J._name===$||J._aliases.includes($))}_findOption($){return this.options.find((J)=>J.is($))}_checkForMissingMandatoryOptions(){this._getCommandAndAncestors().forEach(($)=>{$.options.forEach((J)=>{if(J.mandatory&&$.getOptionValue(J.attributeName())===void 0)$.missingMandatoryOptionValue(J)})})}_checkForConflictingLocalOptions(){let $=this.options.filter((X)=>{let Z=X.attributeName();if(this.getOptionValue(Z)===void 0)return!1;return this.getOptionValueSource(Z)!=="default"});$.filter((X)=>X.conflictsWith.length>0).forEach((X)=>{let Z=$.find((Y)=>X.conflictsWith.includes(Y.attributeName()));if(Z)this._conflictingOption(X,Z)})}_checkForConflictingOptions(){this._getCommandAndAncestors().forEach(($)=>{$._checkForConflictingLocalOptions()})}parseOptions($){let J=[],X=[],Z=J,Y=$.slice();function z(Q){return Q.length>1&&Q[0]==="-"}let E=null;while(Y.length){let Q=Y.shift();if(Q==="--"){if(Z===X)Z.push(Q);Z.push(...Y);break}if(E&&!z(Q)){this.emit(`option:${E.name()}`,Q);continue}if(E=null,z(Q)){let W=this._findOption(Q);if(W){if(W.required){let P=Y.shift();if(P===void 0)this.optionMissingArgument(W);this.emit(`option:${W.name()}`,P)}else if(W.optional){let P=null;if(Y.length>0&&!z(Y[0]))P=Y.shift();this.emit(`option:${W.name()}`,P)}else this.emit(`option:${W.name()}`);E=W.variadic?W:null;continue}}if(Q.length>2&&Q[0]==="-"&&Q[1]!=="-"){let W=this._findOption(`-${Q[1]}`);if(W){if(W.required||W.optional&&this._combineFlagAndOptionalValue)this.emit(`option:${W.name()}`,Q.slice(2));else this.emit(`option:${W.name()}`),Y.unshift(`-${Q.slice(2)}`);continue}}if(/^--[^=]+=/.test(Q)){let W=Q.indexOf("="),P=this._findOption(Q.slice(0,W));if(P&&(P.required||P.optional)){this.emit(`option:${P.name()}`,Q.slice(W+1));continue}}if(z(Q))Z=X;if((this._enablePositionalOptions||this._passThroughOptions)&&J.length===0&&X.length===0){if(this._findCommand(Q)){if(J.push(Q),Y.length>0)X.push(...Y);break}else if(this._getHelpCommand()&&Q===this._getHelpCommand().name()){if(J.push(Q),Y.length>0)J.push(...Y);break}else if(this._defaultCommandName){if(X.push(Q),Y.length>0)X.push(...Y);break}}if(this._passThroughOptions){if(Z.push(Q),Y.length>0)Z.push(...Y);break}Z.push(Q)}return{operands:J,unknown:X}}opts(){if(this._storeOptionsAsProperties){let $={},J=this.options.length;for(let X=0;X<J;X++){let Z=this.options[X].attributeName();$[Z]=Z===this._versionOptionName?this._version:this[Z]}return $}return this._optionValues}optsWithGlobals(){return this._getCommandAndAncestors().reduce(($,J)=>Object.assign($,J.opts()),{})}error($,J){if(this._outputConfiguration.outputError(`${$}
`,this._outputConfiguration.writeErr),typeof this._showHelpAfterError==="string")this._outputConfiguration.writeErr(`${this._showHelpAfterError}
`);else if(this._showHelpAfterError)this._outputConfiguration.writeErr(`
`),this.outputHelp({error:!0});let X=J||{},Z=X.exitCode||1,Y=X.code||"commander.error";this._exit(Z,Y,$)}_parseOptionsEnv(){this.options.forEach(($)=>{if($.envVar&&$.envVar in T.env){let J=$.attributeName();if(this.getOptionValue(J)===void 0||["default","config","env"].includes(this.getOptionValueSource(J)))if($.required||$.optional)this.emit(`optionEnv:${$.name()}`,T.env[$.envVar]);else this.emit(`optionEnv:${$.name()}`)}})}_parseOptionsImplied(){let $=new R2(this.options),J=(X)=>{return this.getOptionValue(X)!==void 0&&!["default","implied"].includes(this.getOptionValueSource(X))};this.options.filter((X)=>X.implied!==void 0&&J(X.attributeName())&&$.valueFromOption(this.getOptionValue(X.attributeName()),X)).forEach((X)=>{Object.keys(X.implied).filter((Z)=>!J(Z)).forEach((Z)=>{this.setOptionValueWithSource(Z,X.implied[Z],"implied")})})}missingArgument($){let J=`error: missing required argument '${$}'`;this.error(J,{code:"commander.missingArgument"})}optionMissingArgument($){let J=`error: option '${$.flags}' argument missing`;this.error(J,{code:"commander.optionMissingArgument"})}missingMandatoryOptionValue($){let J=`error: required option '${$.flags}' not specified`;this.error(J,{code:"commander.missingMandatoryOptionValue"})}_conflictingOption($,J){let X=(z)=>{let E=z.attributeName(),Q=this.getOptionValue(E),W=this.options.find((B)=>B.negate&&E===B.attributeName()),P=this.options.find((B)=>!B.negate&&E===B.attributeName());if(W&&(W.presetArg===void 0&&Q===!1||W.presetArg!==void 0&&Q===W.presetArg))return W;return P||z},Z=(z)=>{let E=X(z),Q=E.attributeName();if(this.getOptionValueSource(Q)==="env")return`environment variable '${E.envVar}'`;return`option '${E.flags}'`},Y=`error: ${Z($)} cannot be used with ${Z(J)}`;this.error(Y,{code:"commander.conflictingOption"})}unknownOption($){if(this._allowUnknownOption)return;let J="";if($.startsWith("--")&&this._showSuggestionAfterError){let Z=[],Y=this;do{let z=Y.createHelp().visibleOptions(Y).filter((E)=>E.long).map((E)=>E.long);Z=Z.concat(z),Y=Y.parent}while(Y&&!Y._enablePositionalOptions);J=z1($,Z)}let X=`error: unknown option '${$}'${J}`;this.error(X,{code:"commander.unknownOption"})}_excessArguments($){if(this._allowExcessArguments)return;let J=this.registeredArguments.length,X=J===1?"":"s",Y=`error: too many arguments${this.parent?` for '${this.name()}'`:""}. Expected ${J} argument${X} but got ${$.length}.`;this.error(Y,{code:"commander.excessArguments"})}unknownCommand(){let $=this.args[0],J="";if(this._showSuggestionAfterError){let Z=[];this.createHelp().visibleCommands(this).forEach((Y)=>{if(Z.push(Y.name()),Y.alias())Z.push(Y.alias())}),J=z1($,Z)}let X=`error: unknown command '${$}'${J}`;this.error(X,{code:"commander.unknownCommand"})}version($,J,X){if($===void 0)return this._version;this._version=$,J=J||"-V, --version",X=X||"output the version number";let Z=this.createOption(J,X);return this._versionOptionName=Z.attributeName(),this._registerOption(Z),this.on("option:"+Z.name(),()=>{this._outputConfiguration.writeOut(`${$}
`),this._exit(0,"commander.version",$)}),this}description($,J){if($===void 0&&J===void 0)return this._description;if(this._description=$,J)this._argsDescription=J;return this}summary($){if($===void 0)return this._summary;return this._summary=$,this}alias($){if($===void 0)return this._aliases[0];let J=this;if(this.commands.length!==0&&this.commands[this.commands.length-1]._executableHandler)J=this.commands[this.commands.length-1];if($===J._name)throw Error("Command alias can't be the same as its name");let X=this.parent?._findCommand($);if(X){let Z=[X.name()].concat(X.aliases()).join("|");throw Error(`cannot add alias '${$}' to command '${this.name()}' as already have command '${Z}'`)}return J._aliases.push($),this}aliases($){if($===void 0)return this._aliases;return $.forEach((J)=>this.alias(J)),this}usage($){if($===void 0){if(this._usage)return this._usage;let J=this.registeredArguments.map((X)=>{return K2(X)});return[].concat(this.options.length||this._helpOption!==null?"[options]":[],this.commands.length?"[command]":[],this.registeredArguments.length?J:[]).join(" ")}return this._usage=$,this}name($){if($===void 0)return this._name;return this._name=$,this}nameFromFilename($){return this._name=A.basename($,A.extname($)),this}executableDir($){if($===void 0)return this._executableDir;return this._executableDir=$,this}helpInformation($){let J=this.createHelp();if(J.helpWidth===void 0)J.helpWidth=$&&$.error?this._outputConfiguration.getErrHelpWidth():this._outputConfiguration.getOutHelpWidth();return J.formatHelp(this,J)}_getHelpContext($){$=$||{};let J={error:!!$.error},X;if(J.error)X=(Z)=>this._outputConfiguration.writeErr(Z);else X=(Z)=>this._outputConfiguration.writeOut(Z);return J.write=$.write||X,J.command=this,J}outputHelp($){let J;if(typeof $==="function")J=$,$=void 0;let X=this._getHelpContext($);this._getCommandAndAncestors().reverse().forEach((Y)=>Y.emit("beforeAllHelp",X)),this.emit("beforeHelp",X);let Z=this.helpInformation(X);if(J){if(Z=J(Z),typeof Z!=="string"&&!Buffer.isBuffer(Z))throw Error("outputHelp callback must return a string or a Buffer")}if(X.write(Z),this._getHelpOption()?.long)this.emit(this._getHelpOption().long);this.emit("afterHelp",X),this._getCommandAndAncestors().forEach((Y)=>Y.emit("afterAllHelp",X))}helpOption($,J){if(typeof $==="boolean"){if($)this._helpOption=this._helpOption??void 0;else this._helpOption=null;return this}return $=$??"-h, --help",J=J??"display help for command",this._helpOption=this.createOption($,J),this}_getHelpOption(){if(this._helpOption===void 0)this.helpOption(void 0,void 0);return this._helpOption}addHelpOption($){return this._helpOption=$,this}help($){this.outputHelp($);let J=T.exitCode||0;if(J===0&&$&&typeof $!=="function"&&$.error)J=1;this._exit(J,"commander.help","(outputHelp)")}addHelpText($,J){let X=["beforeAll","before","after","afterAll"];if(!X.includes($))throw Error(`Unexpected value for position to addHelpText.
Expecting one of '${X.join("', '")}'`);let Z=`${$}Help`;return this.on(Z,(Y)=>{let z;if(typeof J==="function")z=J({error:Y.error,command:Y.command});else z=J;if(z)Y.write(`${z}
`)}),this}_outputHelpIfRequested($){let J=this._getHelpOption();if(J&&$.find((Z)=>J.is(Z)))this.outputHelp(),this._exit(0,"commander.helpDisplayed","(outputHelp)")}}function E1($){return $.map((J)=>{if(!J.startsWith("--inspect"))return J;let X,Z="127.0.0.1",Y="9229",z;if((z=J.match(/^(--inspect(-brk)?)$/))!==null)X=z[1];else if((z=J.match(/^(--inspect(-brk|-port)?)=([^:]+)$/))!==null)if(X=z[1],/^\d+$/.test(z[3]))Y=z[3];else Z=z[3];else if((z=J.match(/^(--inspect(-brk|-port)?)=([^:]+):(\d+)$/))!==null)X=z[1],Z=z[3],Y=z[4];if(X&&Y!=="0")return`${X}=${Z}:${parseInt(Y)+1}`;return J})}L2.Command=D0});var S1=L((_2)=>{var{Argument:W1}=t(),{Command:x0}=Q1(),{CommanderError:j2,InvalidArgumentError:P1}=l(),{Help:I2}=F0(),{Option:B1}=q0();_2.program=new x0;_2.createCommand=($)=>new x0($);_2.createOption=($,J)=>new B1($,J);_2.createArgument=($,J)=>new W1($,J);_2.Command=x0;_2.Option=B1;_2.Argument=W1;_2.Help=I2;_2.CommanderError=j2;_2.InvalidArgumentError=P1;_2.InvalidOptionArgumentError=P1});var N=L((w2)=>{w2.getBooleanOption=($,J)=>{let X=!1;if(J in $&&typeof(X=$[J])!=="boolean")throw TypeError(`Expected the "${J}" option to be a boolean`);return X};w2.cppdb=Symbol();w2.inspect=Symbol.for("nodejs.util.inspect.custom")});var w0=L((G6,K1)=>{var O0={value:"SqliteError",writable:!0,enumerable:!1,configurable:!0};function w($,J){if(new.target!==w)return new w($,J);if(typeof J!=="string")throw TypeError("Expected second argument to be a string");Error.call(this,$),O0.value=""+$,Object.defineProperty(this,"message",O0),Error.captureStackTrace(this,w),this.code=J}Object.setPrototypeOf(w,Error);Object.setPrototypeOf(w.prototype,Error.prototype);Object.defineProperty(w.prototype,"name",O0);K1.exports=w});var R1=L((R6,G1)=>{var o=I("path").sep||"/";G1.exports=b2;function b2($){if(typeof $!="string"||$.length<=7||$.substring(0,7)!="file://")throw TypeError("must pass in a file:// URI to convert to a file path");var J=decodeURI($.substring(7)),X=J.indexOf("/"),Z=J.substring(0,X),Y=J.substring(X+1);if(Z=="localhost")Z="";if(Z)Z=o+o+Z;if(Y=Y.replace(/^(.+)\|/,"$1:"),o=="\\")Y=Y.replace(/\//g,"\\");if(/^.+\:/.test(Y));else Y=o+Y;return Z+Y}});var I1=L(($0,j1)=>{var __filename="/home/mrkai/code/wasp/node_modules/bindings/bindings.js",y0=I("fs"),e=I("path"),v2=R1(),a=e.join,h2=e.dirname,L1=y0.accessSync&&function($){try{y0.accessSync($)}catch(J){return!1}return!0}||y0.existsSync||e.existsSync,T1={arrow:process.env.NODE_BINDINGS_ARROW||" → ",compiled:process.env.NODE_BINDINGS_COMPILED_DIR||"compiled",platform:process.platform,arch:process.arch,nodePreGyp:"node-v"+process.versions.modules+"-"+process.platform+"-"+process.arch,version:process.versions.node,bindings:"bindings.node",try:[["module_root","build","bindings"],["module_root","build","Debug","bindings"],["module_root","build","Release","bindings"],["module_root","out","Debug","bindings"],["module_root","Debug","bindings"],["module_root","out","Release","bindings"],["module_root","Release","bindings"],["module_root","build","default","bindings"],["module_root","compiled","version","platform","arch","bindings"],["module_root","addon-build","release","install-root","bindings"],["module_root","addon-build","debug","install-root","bindings"],["module_root","addon-build","default","install-root","bindings"],["module_root","lib","binding","nodePreGyp","bindings"]]};function g2($){if(typeof $=="string")$={bindings:$};else if(!$)$={};if(Object.keys(T1).map(function(W){if(!(W in $))$[W]=T1[W]}),!$.module_root)$.module_root=$0.getRoot($0.getFileName());if(e.extname($.bindings)!=".node")$.bindings+=".node";var J=typeof __webpack_require__==="function"?__non_webpack_require__:I,X=[],Z=0,Y=$.try.length,z,E,Q;for(;Z<Y;Z++){z=a.apply(null,$.try[Z].map(function(W){return $[W]||W})),X.push(z);try{if(E=$.path?J.resolve(z):J(z),!$.path)E.path=z;return E}catch(W){if(W.code!=="MODULE_NOT_FOUND"&&W.code!=="QUALIFIED_PATH_RESOLUTION_FAILED"&&!/not find/i.test(W.message))throw W}}throw Q=Error(`Could not locate the bindings file. Tried:
`+X.map(function(W){return $.arrow+W}).join(`
`)),Q.tries=X,Q}j1.exports=$0=g2;$0.getFileName=function(J){var{prepareStackTrace:X,stackTraceLimit:Z}=Error,Y={},z;Error.stackTraceLimit=10,Error.prepareStackTrace=function(Q,W){for(var P=0,B=W.length;P<B;P++)if(z=W[P].getFileName(),z!==__filename)if(J){if(z!==J)return}else return},Error.captureStackTrace(Y),Y.stack,Error.prepareStackTrace=X,Error.stackTraceLimit=Z;var E="file://";if(z.indexOf(E)===0)z=v2(z);return z};$0.getRoot=function(J){var X=h2(J),Z;while(!0){if(X===".")X=process.cwd();if(L1(a(X,"package.json"))||L1(a(X,"node_modules")))return X;if(Z===X)throw Error('Could not find module root given file: "'+J+'". Do you have a `package.json` file? ');Z=X,X=a(X,"..")}}});var _1=L((u2)=>{var{cppdb:F}=N();u2.prepare=function(J){return this[F].prepare(J,this,!1)};u2.exec=function(J){return this[F].exec(J),this};u2.close=function(){return this[F].close(),this};u2.loadExtension=function(...J){return this[F].loadExtension(...J),this};u2.defaultSafeIntegers=function(...J){return this[F].defaultSafeIntegers(...J),this};u2.unsafeMode=function(...J){return this[F].unsafeMode(...J),this};u2.getters={name:{get:function(){return this[F].name},enumerable:!0},open:{get:function(){return this[F].open},enumerable:!0},inTransaction:{get:function(){return this[F].inTransaction},enumerable:!0},readonly:{get:function(){return this[F].readonly},enumerable:!0},memory:{get:function(){return this[F].memory},enumerable:!0}}});var H1=L((_6,M1)=>{var{cppdb:p2}=N(),V1=new WeakMap;M1.exports=function(J){if(typeof J!=="function")throw TypeError("Expected first argument to be a function");let X=this[p2],Z=n2(X,this),{apply:Y}=Function.prototype,z={default:{value:J0(Y,J,X,Z.default)},deferred:{value:J0(Y,J,X,Z.deferred)},immediate:{value:J0(Y,J,X,Z.immediate)},exclusive:{value:J0(Y,J,X,Z.exclusive)},database:{value:this,enumerable:!0}};return Object.defineProperties(z.default.value,z),Object.defineProperties(z.deferred.value,z),Object.defineProperties(z.immediate.value,z),Object.defineProperties(z.exclusive.value,z),z.default.value};var n2=($,J)=>{let X=V1.get($);if(!X){let Z={commit:$.prepare("COMMIT",J,!1),rollback:$.prepare("ROLLBACK",J,!1),savepoint:$.prepare("SAVEPOINT `\t_bs3.\t`",J,!1),release:$.prepare("RELEASE `\t_bs3.\t`",J,!1),rollbackTo:$.prepare("ROLLBACK TO `\t_bs3.\t`",J,!1)};V1.set($,X={default:Object.assign({begin:$.prepare("BEGIN",J,!1)},Z),deferred:Object.assign({begin:$.prepare("BEGIN DEFERRED",J,!1)},Z),immediate:Object.assign({begin:$.prepare("BEGIN IMMEDIATE",J,!1)},Z),exclusive:Object.assign({begin:$.prepare("BEGIN EXCLUSIVE",J,!1)},Z)})}return X},J0=($,J,X,{begin:Z,commit:Y,rollback:z,savepoint:E,release:Q,rollbackTo:W})=>function(){let B,S,K;if(X.inTransaction)B=E,S=Q,K=W;else B=Z,S=Y,K=z;B.run();try{let U=$.call(J,this,arguments);if(U&&typeof U.then==="function")throw TypeError("Transaction function cannot return a promise");return S.run(),U}catch(U){if(X.inTransaction){if(K.run(),K!==z)S.run()}throw U}}});var q1=L((V6,F1)=>{var{getBooleanOption:t2,cppdb:o2}=N();F1.exports=function(J,X){if(X==null)X={};if(typeof J!=="string")throw TypeError("Expected first argument to be a string");if(typeof X!=="object")throw TypeError("Expected second argument to be an options object");let Z=t2(X,"simple"),Y=this[o2].prepare(`PRAGMA ${J}`,this,!0);return Z?Y.pluck().get():Y.all()}});var A1=L((M6,f1)=>{var a2=I("fs"),e2=I("path"),{promisify:$5}=I("util"),{cppdb:J5}=N(),N1=$5(a2.access);f1.exports=async function(J,X){if(X==null)X={};if(typeof J!=="string")throw TypeError("Expected first argument to be a string");if(typeof X!=="object")throw TypeError("Expected second argument to be an options object");J=J.trim();let Z="attached"in X?X.attached:"main",Y="progress"in X?X.progress:null;if(!J)throw TypeError("Backup filename cannot be an empty string");if(J===":memory:")throw TypeError('Invalid backup filename ":memory:"');if(typeof Z!=="string")throw TypeError('Expected the "attached" option to be a string');if(!Z)throw TypeError('The "attached" option cannot be an empty string');if(Y!=null&&typeof Y!=="function")throw TypeError('Expected the "progress" option to be a function');await N1(e2.dirname(J)).catch(()=>{throw TypeError("Cannot save backup because the directory does not exist")});let z=await N1(J).then(()=>!1,()=>!0);return X5(this[J5].backup(this,Z,J,z),Y||null)};var X5=($,J)=>{let X=0,Z=!0;return new Promise((Y,z)=>{setImmediate(function E(){try{let Q=$.transfer(X);if(!Q.remainingPages){$.close(),Y(Q);return}if(Z)Z=!1,X=100;if(J){let W=J(Q);if(W!==void 0)if(typeof W==="number"&&W===W)X=Math.max(0,Math.min(2147483647,Math.round(W)));else throw TypeError("Expected progress callback to return a number or undefined")}setImmediate(E)}catch(Q){$.close(),z(Q)}})})}});var x1=L((H6,D1)=>{var{cppdb:Z5}=N();D1.exports=function(J){if(J==null)J={};if(typeof J!=="object")throw TypeError("Expected first argument to be an options object");let X="attached"in J?J.attached:"main";if(typeof X!=="string")throw TypeError('Expected the "attached" option to be a string');if(!X)throw TypeError('The "attached" option cannot be an empty string');return this[Z5].serialize(X)}});var w1=L((F6,O1)=>{var{getBooleanOption:X0,cppdb:Y5}=N();O1.exports=function(J,X,Z){if(X==null)X={};if(typeof X==="function")Z=X,X={};if(typeof J!=="string")throw TypeError("Expected first argument to be a string");if(typeof Z!=="function")throw TypeError("Expected last argument to be a function");if(typeof X!=="object")throw TypeError("Expected second argument to be an options object");if(!J)throw TypeError("User-defined function name cannot be an empty string");let Y="safeIntegers"in X?+X0(X,"safeIntegers"):2,z=X0(X,"deterministic"),E=X0(X,"directOnly"),Q=X0(X,"varargs"),W=-1;if(!Q){if(W=Z.length,!Number.isInteger(W)||W<0)throw TypeError("Expected function.length to be a positive integer");if(W>100)throw RangeError("User-defined functions cannot have more than 100 arguments")}return this[Y5].function(Z,J,W,Y,z,E),this}});var k1=L((q6,C1)=>{var{getBooleanOption:Z0,cppdb:z5}=N();C1.exports=function(J,X){if(typeof J!=="string")throw TypeError("Expected first argument to be a string");if(typeof X!=="object"||X===null)throw TypeError("Expected second argument to be an options object");if(!J)throw TypeError("User-defined function name cannot be an empty string");let Z="start"in X?X.start:null,Y=C0(X,"step",!0),z=C0(X,"inverse",!1),E=C0(X,"result",!1),Q="safeIntegers"in X?+Z0(X,"safeIntegers"):2,W=Z0(X,"deterministic"),P=Z0(X,"directOnly"),B=Z0(X,"varargs"),S=-1;if(!B){if(S=Math.max(y1(Y),z?y1(z):0),S>0)S-=1;if(S>100)throw RangeError("User-defined functions cannot have more than 100 arguments")}return this[z5].aggregate(Z,Y,z,E,J,S,Q,W,P),this};var C0=($,J,X)=>{let Z=J in $?$[J]:null;if(typeof Z==="function")return Z;if(Z!=null)throw TypeError(`Expected the "${J}" option to be a function`);if(X)throw TypeError(`Missing required option "${J}"`);return null},y1=({length:$})=>{if(Number.isInteger($)&&$>=0)return $;throw TypeError("Expected function.length to be a positive integer")}});var g1=L((N6,h1)=>{var{cppdb:E5}=N();h1.exports=function(J,X){if(typeof J!=="string")throw TypeError("Expected first argument to be a string");if(!J)throw TypeError("Virtual table module name cannot be an empty string");let Z=!1;if(typeof X==="object"&&X!==null)Z=!0,X=G5(v1(X,"used",J));else{if(typeof X!=="function")throw TypeError("Expected second argument to be a function or a table definition object");X=Q5(X)}return this[E5].table(X,J,Z),this};function Q5($){return function(X,Z,Y,...z){let E={module:X,database:Z,table:Y},Q=U5.call($,E,z);if(typeof Q!=="object"||Q===null)throw TypeError(`Virtual table module "${X}" did not return a table definition object`);return v1(Q,"returned",X)}}function v1($,J,X){if(!s.call($,"rows"))throw TypeError(`Virtual table module "${X}" ${J} a table definition without a "rows" property`);if(!s.call($,"columns"))throw TypeError(`Virtual table module "${X}" ${J} a table definition without a "columns" property`);let Z=$.rows;if(typeof Z!=="function"||Object.getPrototypeOf(Z)!==K5)throw TypeError(`Virtual table module "${X}" ${J} a table definition with an invalid "rows" property (should be a generator function)`);let Y=$.columns;if(!Array.isArray(Y)||!(Y=[...Y]).every((P)=>typeof P==="string"))throw TypeError(`Virtual table module "${X}" ${J} a table definition with an invalid "columns" property (should be an array of strings)`);if(Y.length!==new Set(Y).size)throw TypeError(`Virtual table module "${X}" ${J} a table definition with duplicate column names`);if(!Y.length)throw RangeError(`Virtual table module "${X}" ${J} a table definition with zero columns`);let z;if(s.call($,"parameters")){if(z=$.parameters,!Array.isArray(z)||!(z=[...z]).every((P)=>typeof P==="string"))throw TypeError(`Virtual table module "${X}" ${J} a table definition with an invalid "parameters" property (should be an array of strings)`)}else z=S5(Z);if(z.length!==new Set(z).size)throw TypeError(`Virtual table module "${X}" ${J} a table definition with duplicate parameter names`);if(z.length>32)throw RangeError(`Virtual table module "${X}" ${J} a table definition with more than the maximum number of 32 parameters`);for(let P of z)if(Y.includes(P))throw TypeError(`Virtual table module "${X}" ${J} a table definition with column "${P}" which was ambiguously defined as both a column and parameter`);let E=2;if(s.call($,"safeIntegers")){let P=$.safeIntegers;if(typeof P!=="boolean")throw TypeError(`Virtual table module "${X}" ${J} a table definition with an invalid "safeIntegers" property (should be a boolean)`);E=+P}let Q=!1;if(s.call($,"directOnly")){if(Q=$.directOnly,typeof Q!=="boolean")throw TypeError(`Virtual table module "${X}" ${J} a table definition with an invalid "directOnly" property (should be a boolean)`)}return[`CREATE TABLE x(${[...z.map(b1).map((P)=>`${P} HIDDEN`),...Y.map(b1)].join(", ")});`,W5(Z,new Map(Y.map((P,B)=>[P,z.length+B])),X),z,E,Q]}function W5($,J,X){return function*(...Y){let z=Y.map((E)=>Buffer.isBuffer(E)?Buffer.from(E):E);for(let E=0;E<J.size;++E)z.push(null);for(let E of $(...Y))if(Array.isArray(E))P5(E,z,J.size,X),yield z;else if(typeof E==="object"&&E!==null)B5(E,z,J,X),yield z;else throw TypeError(`Virtual table module "${X}" yielded something that isn't a valid row object`)}}function P5($,J,X,Z){if($.length!==X)throw TypeError(`Virtual table module "${Z}" yielded a row with an incorrect number of columns`);let Y=J.length-X;for(let z=0;z<X;++z)J[z+Y]=$[z]}function B5($,J,X,Z){let Y=0;for(let z of Object.keys($)){let E=X.get(z);if(E===void 0)throw TypeError(`Virtual table module "${Z}" yielded a row with an undeclared column "${z}"`);J[E]=$[z],Y+=1}if(Y!==X.size)throw TypeError(`Virtual table module "${Z}" yielded a row with missing columns`)}function S5({length:$}){if(!Number.isInteger($)||$<0)throw TypeError("Expected function.length to be a positive integer");let J=[];for(let X=0;X<$;++X)J.push(`$${X+1}`);return J}var{hasOwnProperty:s}=Object.prototype,{apply:U5}=Function.prototype,K5=Object.getPrototypeOf(function*(){}),b1=($)=>`"${$.replace(/"/g,'""')}"`,G5=($)=>()=>$});var c1=L((f6,u1)=>{var R5=function(){};u1.exports=function(J,X){return Object.assign(new R5,this)}});var i1=L((A6,m1)=>{var L5=I("fs"),l1=I("path"),Y0=N(),T5=w0(),s1;function _($,J){if(new.target==null)return new _($,J);let X;if(Buffer.isBuffer($))X=$,$=":memory:";if($==null)$="";if(J==null)J={};if(typeof $!=="string")throw TypeError("Expected first argument to be a string");if(typeof J!=="object")throw TypeError("Expected second argument to be an options object");if("readOnly"in J)throw TypeError('Misspelled option "readOnly" should be "readonly"');if("memory"in J)throw TypeError('Option "memory" was removed in v7.0.0 (use ":memory:" filename instead)');let Z=$.trim(),Y=Z===""||Z===":memory:",z=Y0.getBooleanOption(J,"readonly"),E=Y0.getBooleanOption(J,"fileMustExist"),Q="timeout"in J?J.timeout:5000,W="verbose"in J?J.verbose:null,P="nativeBinding"in J?J.nativeBinding:null;if(z&&Y&&!X)throw TypeError("In-memory/temporary databases cannot be readonly");if(!Number.isInteger(Q)||Q<0)throw TypeError('Expected the "timeout" option to be a positive integer');if(Q>2147483647)throw RangeError('Option "timeout" cannot be greater than 2147483647');if(W!=null&&typeof W!=="function")throw TypeError('Expected the "verbose" option to be a function');if(P!=null&&typeof P!=="string"&&typeof P!=="object")throw TypeError('Expected the "nativeBinding" option to be a string or addon object');let B;if(P==null)B=s1||(s1=I1()("better_sqlite3.node"));else if(typeof P==="string")B=(typeof __non_webpack_require__==="function"?__non_webpack_require__:I)(l1.resolve(P).replace(/(\.node)?$/,".node"));else B=P;if(!B.isInitialized)B.setErrorConstructor(T5),B.isInitialized=!0;if(!Y&&!Z.startsWith("file:")&&!L5.existsSync(l1.dirname(Z)))throw TypeError("Cannot open database because the directory does not exist");Object.defineProperties(this,{[Y0.cppdb]:{value:new B.Database(Z,$,Y,z,E,Q,W||null,X||null)},...y.getters})}var y=_1();_.prototype.prepare=y.prepare;_.prototype.transaction=H1();_.prototype.pragma=q1();_.prototype.backup=A1();_.prototype.serialize=x1();_.prototype.function=w1();_.prototype.aggregate=k1();_.prototype.table=g1();_.prototype.loadExtension=y.loadExtension;_.prototype.exec=y.exec;_.prototype.close=y.close;_.prototype.defaultSafeIntegers=y.defaultSafeIntegers;_.prototype.unsafeMode=y.unsafeMode;_.prototype[Y0.inspect]=c1();m1.exports=_});var d1=L((x6,k0)=>{k0.exports=i1();k0.exports.SqliteError=w0()});var U1=l$(S1(),1),{program:H,createCommand:X6,createArgument:Z6,createOption:Y6,CommanderError:z6,InvalidArgumentError:E6,InvalidOptionArgumentError:Q6,Command:W6,Argument:P6,Option:B6,Help:S6}=U1.default;import{existsSync as r1,mkdirSync as I5}from"node:fs";import{homedir as _5}from"node:os";import{join as p1}from"node:path";var j5=typeof globalThis.Bun<"u",z0;if(j5)z0=($)=>{let{Database:J}=I("bun:sqlite"),X=new J($);return{exec:(Z)=>X.exec(Z),prepare:(Z)=>{let Y=X.prepare(Z);return{run:(...z)=>Y.run(...z),get:(...z)=>Y.get(...z),all:(...z)=>Y.all(...z)}},close:()=>X.close()}};else z0=($)=>{let X=new(d1())($);return{exec:(Z)=>X.exec(Z),prepare:(Z)=>{let Y=X.prepare(Z);return{run:(...z)=>Y.run(...z),get:(...z)=>Y.get(...z),all:(...z)=>Y.all(...z)}},close:()=>X.close()}};var V5=null;function b0(){return V5||process.env.WASP_DATA_DIR||p1(_5(),".wasp")}function n1(){return p1(b0(),"wasp.db")}var C=null;function v0(){return b0()}function h(){return r1(n1())}function M(){if(!C){let $=b0(),J=n1();if(!r1($))I5($,{recursive:!0});C=z0(J),C.exec("PRAGMA journal_mode = WAL")}return C}function E0(){M().exec(`
    CREATE TABLE IF NOT EXISTS contacts (
      id INTEGER PRIMARY KEY AUTOINCREMENT,
      identifier TEXT NOT NULL,
      platform TEXT NOT NULL DEFAULT 'whatsapp',
      name TEXT,
      trust TEXT NOT NULL DEFAULT 'trusted',
      added_at TEXT NOT NULL DEFAULT (datetime('now')),
      notes TEXT,
      UNIQUE(identifier, platform)
    );

    CREATE TABLE IF NOT EXISTS audit_log (
      id INTEGER PRIMARY KEY AUTOINCREMENT,
      timestamp TEXT NOT NULL DEFAULT (datetime('now')),
      identifier TEXT NOT NULL,
      platform TEXT NOT NULL,
      decision TEXT NOT NULL,
      reason TEXT
    );

    CREATE TABLE IF NOT EXISTS quarantine (
      id INTEGER PRIMARY KEY AUTOINCREMENT,
      identifier TEXT NOT NULL,
      platform TEXT NOT NULL DEFAULT 'whatsapp',
      message_preview TEXT,
      full_message TEXT,
      timestamp TEXT NOT NULL DEFAULT (datetime('now')),
      reviewed INTEGER NOT NULL DEFAULT 0
    );

    CREATE INDEX IF NOT EXISTS idx_contacts_identifier ON contacts(identifier);
    CREATE INDEX IF NOT EXISTS idx_audit_timestamp ON audit_log(timestamp);
    CREATE INDEX IF NOT EXISTS idx_quarantine_identifier ON quarantine(identifier);
    CREATE INDEX IF NOT EXISTS idx_quarantine_reviewed ON quarantine(reviewed);
  `)}function h0(){if(C)C.close(),C=null}function g0($){return{id:$.id,identifier:$.identifier,platform:$.platform,name:$.name,trust:$.trust,addedAt:$.added_at,notes:$.notes}}function k($,J="whatsapp",X="trusted",Z,Y){let z=M();z.prepare(`
    INSERT INTO contacts (identifier, platform, trust, name, notes)
    VALUES (?, ?, ?, ?, ?)
    ON CONFLICT(identifier, platform) DO UPDATE SET
      trust = excluded.trust,
      name = COALESCE(excluded.name, contacts.name),
      notes = COALESCE(excluded.notes, contacts.notes)
  `).run($,J,X,Z||null,Y||null);let Q=z.prepare("SELECT * FROM contacts WHERE identifier = ? AND platform = ?").get($,J);if(!Q)throw Error(`Failed to retrieve contact after insert: ${$}`);return g0(Q)}function Q0($,J="whatsapp"){return M().prepare("DELETE FROM contacts WHERE identifier = ? AND platform = ?").run($,J).changes>0}function M5($,J="whatsapp"){let Y=M().prepare("SELECT * FROM contacts WHERE identifier = ? AND platform = ?").get($,J);if(!Y)return null;return g0(Y)}function W0($,J){let X=M(),Z="SELECT * FROM contacts WHERE 1=1",Y=[];if($)Z+=" AND platform = ?",Y.push($);if(J)Z+=" AND trust = ?",Y.push(J);return Z+=" ORDER BY added_at DESC",X.prepare(Z).all(...Y).map(g0)}function P0($,J="whatsapp"){let X=M5($,J);if(!X)return{allowed:!1,trust:null,name:null,reason:"Contact not in whitelist"};if(X.trust==="limited")return{allowed:!0,trust:"limited",name:X.name,reason:"Limited trust - agent may view but should not act"};return{allowed:!0,trust:X.trust,name:X.name,reason:"Contact is trusted"}}function t1($,J){let X=k($,J.platform||"whatsapp",J.trust||"trusted",J.name,J.notes);if(console.log("Contact added/updated:"),console.log(`  Identifier: ${X.identifier}`),console.log(`  Platform:   ${X.platform}`),console.log(`  Trust:      ${X.trust}`),X.name)console.log(`  Name:       ${X.name}`);if(X.notes)console.log(`  Notes:      ${X.notes}`)}function H5($){return{id:$.id,timestamp:$.timestamp,identifier:$.identifier,platform:$.platform,decision:$.decision,reason:$.reason||""}}function B0($,J,X,Z){M().prepare(`
    INSERT INTO audit_log (identifier, platform, decision, reason)
    VALUES (?, ?, ?, ?)
  `).run($,J,X,Z)}function g($){let J=M(),X="SELECT * FROM audit_log WHERE 1=1",Z=[];if($.decision)X+=" AND decision = ?",Z.push($.decision);if($.since)X+=" AND timestamp >= ?",Z.push($.since);if(X+=" ORDER BY timestamp DESC",$.limit)X+=" LIMIT ?",Z.push($.limit);return J.prepare(X).all(...Z).map(H5)}function o1($,J){let X=J.platform||"whatsapp",Z=P0($,X),Y=!Z.allowed?"deny":Z.trust==="limited"?"limited":"allow";if(B0($,X,Y,Z.reason),J.json){console.log(JSON.stringify(Z)),process.exit(Z.allowed?0:1);return}if(J.quiet){process.exit(Z.allowed?0:1);return}if(Z.allowed){let z=Z.name?` (${Z.name})`:"";if(console.log(`ALLOWED: ${$}${z}`),console.log(`  Trust level: ${Z.trust}`),Z.trust==="limited")console.log("  Note: Limited trust - agent may view but should not act")}else console.log(`DENIED: ${$}`),console.log(`  Reason: ${Z.reason}`);process.exit(Z.allowed?0:1)}function a1($=!1){if(h()&&!$){console.log("wasp is already initialized."),console.log(`Data directory: ${v0()}`),console.log("Use --force to reinitialize.");return}E0(),console.log("wasp initialized successfully."),console.log(`Data directory: ${v0()}`),console.log(""),console.log("Next steps:"),console.log('  wasp add "+440123456789" --name "Your Name" --trust sovereign'),console.log("  wasp list"),console.log("  wasp serve")}function e1($){let J=W0($.platform,$.trust);if(J.length===0){console.log("No contacts found.");return}if($.json){console.log(JSON.stringify(J,null,2));return}console.log(`Found ${J.length} contact(s):
`);for(let X of J){let Z=X.name?` (${X.name})`:"";if(console.log(`  ${X.identifier}${Z}`),console.log(`    Platform: ${X.platform} | Trust: ${X.trust}`),X.notes)console.log(`    Notes: ${X.notes}`);console.log("")}}function $$($){let J=g({limit:$.limit||50,decision:$.denied?"deny":void 0});if(J.length===0){console.log("No audit entries found.");return}if($.json){console.log(JSON.stringify(J,null,2));return}console.log(`Last ${J.length} audit entries:
`);for(let X of J){let Z=X.decision==="allow"?"✓":X.decision==="limited"?"~":"✗";console.log(`  ${Z} ${X.timestamp} | ${X.identifier} (${X.platform})`),console.log(`    Decision: ${X.decision} - ${X.reason}`),console.log("")}}function J$($,J="whatsapp"){if(Q0($,J))console.log(`Removed: ${$} (${J})`);else console.log(`Not found: ${$} (${J})`)}function X$($){return{id:$.id,identifier:$.identifier,platform:$.platform,messagePreview:$.message_preview||"",fullMessage:$.full_message||"",timestamp:$.timestamp,reviewed:!!$.reviewed}}function Z$($=50){return M().prepare(`
    SELECT * FROM quarantine 
    WHERE reviewed = 0 
    ORDER BY timestamp DESC 
    LIMIT ?
  `).all($).map(X$)}function F5($,J="whatsapp"){return M().prepare(`
    SELECT * FROM quarantine 
    WHERE identifier = ? AND platform = ? AND reviewed = 0
    ORDER BY timestamp ASC
  `).all($,J).map(X$)}function Y$($,J="whatsapp"){let X=F5($,J);if(X.length>0)M().prepare(`
      UPDATE quarantine SET reviewed = 1 
      WHERE identifier = ? AND platform = ?
    `).run($,J);return X}function z$($,J="whatsapp"){return M().prepare(`
    DELETE FROM quarantine WHERE identifier = ? AND platform = ?
  `).run($,J).changes}async function E$($){if($.approve){let Y=Y$($.approve);if(Y.length>0)k(Y[0].identifier,Y[0].platform,"trusted"),console.log(`✓ Approved ${Y[0].identifier}`),console.log(`  Released ${Y.length} quarantined message(s)`);else console.log(`No quarantined messages for: ${$.approve}`);return}if($.deny){let Y=z$($.deny);if(Y>0)k($.deny,"whatsapp","limited"),console.log(`✗ Denied ${$.deny}`),console.log(`  Deleted ${Y} message(s)`);else console.log(`No quarantined messages for: ${$.deny}`);return}let J=Z$(50);if(J.length===0){console.log(`
\uD83D\uDC1D Quarantine is empty - no messages awaiting review
`);return}let X=new Map;for(let Y of J){let z=`${Y.identifier}|${Y.platform}`;if(!X.has(z))X.set(z,[]);X.get(z)?.push(Y)}console.log(`
\uD83D\uDC1D Quarantine Review
`),console.log(`${X.size} sender(s), ${J.length} message(s) awaiting review
`),console.log(`${"─".repeat(60)}
`);let Z=1;for(let[Y,z]of X){let[E,Q]=Y.split("|");console.log(`${Z}. ${E} (${Q})`),console.log(`   ${z.length} message(s)`),console.log("");let W=z[0];console.log(`   First: "${W.messagePreview}"`),console.log(`   Time:  ${W.timestamp}`),console.log(""),Z++}if(console.log("─".repeat(60)),console.log(`
Actions:`),console.log("  wasp review --approve <identifier>   Add to trusted, release messages"),console.log("  wasp review --deny <identifier>      Block sender, delete messages"),console.log(""),$.interactive)console.log("Interactive mode not yet implemented."),console.log("Use --approve or --deny flags for now.")}function Q$($=20){let J=g({limit:100,decision:"deny"}),X=new Set,Z=[];for(let Y of J){let z=`${Y.identifier}|${Y.platform}`;if(!X.has(z)){if(X.add(z),Z.push(Y),Z.length>=$)break}}if(Z.length===0){console.log(`
No blocked contacts in recent history.
`);return}console.log(`
\uD83D\uDC1D Recently Blocked Contacts
`),console.log(`${"─".repeat(60)}
`);for(let Y of Z)console.log(`  ${Y.identifier} (${Y.platform})`),console.log(`    Last seen: ${Y.timestamp}`),console.log(`    Reason: ${Y.reason}`),console.log("");console.log("─".repeat(60)),console.log(`
To allow a contact:`),console.log('  wasp add "<identifier>" --trust trusted'),console.log("")}var u0=($,J,X)=>{return(Z,Y)=>{let z=-1;return E(0);async function E(Q){if(Q<=z)throw Error("next() called multiple times");z=Q;let W,P=!1,B;if($[Q])B=$[Q][0][0],Z.req.routeIndex=Q;else B=Q===$.length&&Y||void 0;if(B)try{W=await B(Z,()=>E(Q+1))}catch(S){if(S instanceof Error&&J)Z.error=S,W=await J(S,Z),P=!0;else throw S}else if(Z.finalized===!1&&X)W=await X(Z);if(W&&(Z.finalized===!1||P))Z.res=W;return Z}}};var W$=Symbol();var P$=async($,J=Object.create(null))=>{let{all:X=!1,dot:Z=!1}=J,z=($ instanceof S0?$.raw.headers:$.headers).get("Content-Type");if(z?.startsWith("multipart/form-data")||z?.startsWith("application/x-www-form-urlencoded"))return q5($,{all:X,dot:Z});return{}};async function q5($,J){let X=await $.formData();if(X)return N5(X,J);return{}}function N5($,J){let X=Object.create(null);if($.forEach((Z,Y)=>{if(!(J.all||Y.endsWith("[]")))X[Y]=Z;else f5(X,Y,Z)}),J.dot)Object.entries(X).forEach(([Z,Y])=>{if(Z.includes("."))A5(X,Z,Y),delete X[Z]});return X}var f5=($,J,X)=>{if($[J]!==void 0)if(Array.isArray($[J]))$[J].push(X);else $[J]=[$[J],X];else if(!J.endsWith("[]"))$[J]=X;else $[J]=[X]},A5=($,J,X)=>{let Z=$,Y=J.split(".");Y.forEach((z,E)=>{if(E===Y.length-1)Z[z]=X;else{if(!Z[z]||typeof Z[z]!=="object"||Array.isArray(Z[z])||Z[z]instanceof File)Z[z]=Object.create(null);Z=Z[z]}})};var l0=($)=>{let J=$.split("/");if(J[0]==="")J.shift();return J},B$=($)=>{let{groups:J,path:X}=D5($),Z=l0(X);return x5(Z,J)},D5=($)=>{let J=[];return $=$.replace(/\{[^}]+\}/g,(X,Z)=>{let Y=`@${Z}`;return J.push([Y,X]),Y}),{groups:J,path:$}},x5=($,J)=>{for(let X=J.length-1;X>=0;X--){let[Z]=J[X];for(let Y=$.length-1;Y>=0;Y--)if($[Y].includes(Z)){$[Y]=$[Y].replace(Z,J[X][1]);break}}return $},U0={},S$=($,J)=>{if($==="*")return"*";let X=$.match(/^\:([^\{\}]+)(?:\{(.+)\})?$/);if(X){let Z=`${$}#${J}`;if(!U0[Z])if(X[2])U0[Z]=J&&J[0]!==":"&&J[0]!=="*"?[Z,X[1],new RegExp(`^${X[2]}(?=/${J})`)]:[$,X[1],new RegExp(`^${X[2]}$`)];else U0[Z]=[$,X[1],!0];return U0[Z]}return null},K0=($,J)=>{try{return J($)}catch{return $.replace(/(?:%[0-9A-Fa-f]{2})+/g,(X)=>{try{return J(X)}catch{return X}})}},O5=($)=>K0($,decodeURI),s0=($)=>{let J=$.url,X=J.indexOf("/",J.indexOf(":")+4),Z=X;for(;Z<J.length;Z++){let Y=J.charCodeAt(Z);if(Y===37){let z=J.indexOf("?",Z),E=J.slice(X,z===-1?void 0:z);return O5(E.includes("%25")?E.replace(/%25/g,"%2525"):E)}else if(Y===63)break}return J.slice(X,Z)};var U$=($)=>{let J=s0($);return J.length>1&&J.at(-1)==="/"?J.slice(0,-1):J},b=($,J,...X)=>{if(X.length)J=b(J,...X);return`${$?.[0]==="/"?"":"/"}${$}${J==="/"?"":`${$?.at(-1)==="/"?"":"/"}${J?.[0]==="/"?J.slice(1):J}`}`},G0=($)=>{if($.charCodeAt($.length-1)!==63||!$.includes(":"))return null;let J=$.split("/"),X=[],Z="";return J.forEach((Y)=>{if(Y!==""&&!/\:/.test(Y))Z+="/"+Y;else if(/\:/.test(Y))if(/\?/.test(Y)){if(X.length===0&&Z==="")X.push("/");else X.push(Z);let z=Y.replace("?","");Z+="/"+z,X.push(Z)}else Z+="/"+Y}),X.filter((Y,z,E)=>E.indexOf(Y)===z)},c0=($)=>{if(!/[%+]/.test($))return $;if($.indexOf("+")!==-1)$=$.replace(/\+/g," ");return $.indexOf("%")!==-1?K0($,m0):$},K$=($,J,X)=>{let Z;if(!X&&J&&!/[%+]/.test(J)){let E=$.indexOf("?",8);if(E===-1)return;if(!$.startsWith(J,E+1))E=$.indexOf(`&${J}`,E+1);while(E!==-1){let Q=$.charCodeAt(E+J.length+1);if(Q===61){let W=E+J.length+2,P=$.indexOf("&",W);return c0($.slice(W,P===-1?void 0:P))}else if(Q==38||isNaN(Q))return"";E=$.indexOf(`&${J}`,E+1)}if(Z=/[%+]/.test($),!Z)return}let Y={};Z??=/[%+]/.test($);let z=$.indexOf("?",8);while(z!==-1){let E=$.indexOf("&",z+1),Q=$.indexOf("=",z);if(Q>E&&E!==-1)Q=-1;let W=$.slice(z+1,Q===-1?E===-1?void 0:E:Q);if(Z)W=c0(W);if(z=E,W==="")continue;let P;if(Q===-1)P="";else if(P=$.slice(Q+1,E===-1?void 0:E),Z)P=c0(P);if(X){if(!(Y[W]&&Array.isArray(Y[W])))Y[W]=[];Y[W].push(P)}else Y[W]??=P}return J?Y[J]:Y},G$=K$,R$=($,J)=>{return K$($,J,!0)},m0=decodeURIComponent;var L$=($)=>K0($,m0),S0=class{raw;#$;#J;routeIndex=0;path;bodyCache={};constructor($,J="/",X=[[]]){this.raw=$,this.path=J,this.#J=X,this.#$={}}param($){return $?this.#X($):this.#z()}#X($){let J=this.#J[0][this.routeIndex][1][$],X=this.#Y(J);return X&&/\%/.test(X)?L$(X):X}#z(){let $={},J=Object.keys(this.#J[0][this.routeIndex][1]);for(let X of J){let Z=this.#Y(this.#J[0][this.routeIndex][1][X]);if(Z!==void 0)$[X]=/\%/.test(Z)?L$(Z):Z}return $}#Y($){return this.#J[1]?this.#J[1][$]:$}query($){return G$(this.url,$)}queries($){return R$(this.url,$)}header($){if($)return this.raw.headers.get($)??void 0;let J={};return this.raw.headers.forEach((X,Z)=>{J[Z]=X}),J}async parseBody($){return this.bodyCache.parsedBody??=await P$(this,$)}#Z=($)=>{let{bodyCache:J,raw:X}=this,Z=J[$];if(Z)return Z;let Y=Object.keys(J)[0];if(Y)return J[Y].then((z)=>{if(Y==="json")z=JSON.stringify(z);return new Response(z)[$]()});return J[$]=X[$]()};json(){return this.#Z("text").then(($)=>JSON.parse($))}text(){return this.#Z("text")}arrayBuffer(){return this.#Z("arrayBuffer")}blob(){return this.#Z("blob")}formData(){return this.#Z("formData")}addValidatedData($,J){this.#$[$]=J}valid($){return this.#$[$]}get url(){return this.raw.url}get method(){return this.raw.method}get[W$](){return this.#J}get matchedRoutes(){return this.#J[0].map(([[,$]])=>$)}get routePath(){return this.#J[0].map(([[,$]])=>$)[this.routeIndex].path}};var T$={Stringify:1,BeforeStream:2,Stream:3},w5=($,J)=>{let X=new String($);return X.isEscaped=!0,X.callbacks=J,X};var i0=async($,J,X,Z,Y)=>{if(typeof $==="object"&&!($ instanceof String)){if(!($ instanceof Promise))$=$.toString();if($ instanceof Promise)$=await $}let z=$.callbacks;if(!z?.length)return Promise.resolve($);if(Y)Y[0]+=$;else Y=[$];let E=Promise.all(z.map((Q)=>Q({phase:J,buffer:Y,context:Z}))).then((Q)=>Promise.all(Q.filter(Boolean).map((W)=>i0(W,J,!1,Z,Y))).then(()=>Y[0]));if(X)return w5(await E,z);else return E};var y5="text/plain; charset=UTF-8",d0=($,J)=>{return{"Content-Type":$,...J}},j$=class{#$;#J;env={};#X;finalized=!1;error;#z;#Y;#Z;#B;#W;#P;#Q;#S;#U;constructor($,J){if(this.#$=$,J)this.#Y=J.executionCtx,this.env=J.env,this.#P=J.notFoundHandler,this.#U=J.path,this.#S=J.matchResult}get req(){return this.#J??=new S0(this.#$,this.#U,this.#S),this.#J}get event(){if(this.#Y&&"respondWith"in this.#Y)return this.#Y;else throw Error("This context has no FetchEvent")}get executionCtx(){if(this.#Y)return this.#Y;else throw Error("This context has no ExecutionContext")}get res(){return this.#Z||=new Response(null,{headers:this.#Q??=new Headers})}set res($){if(this.#Z&&$){$=new Response($.body,$);for(let[J,X]of this.#Z.headers.entries()){if(J==="content-type")continue;if(J==="set-cookie"){let Z=this.#Z.headers.getSetCookie();$.headers.delete("set-cookie");for(let Y of Z)$.headers.append("set-cookie",Y)}else $.headers.set(J,X)}}this.#Z=$,this.finalized=!0}render=(...$)=>{return this.#W??=(J)=>this.html(J),this.#W(...$)};setLayout=($)=>this.#B=$;getLayout=()=>this.#B;setRenderer=($)=>{this.#W=$};header=($,J,X)=>{if(this.finalized)this.#Z=new Response(this.#Z.body,this.#Z);let Z=this.#Z?this.#Z.headers:this.#Q??=new Headers;if(J===void 0)Z.delete($);else if(X?.append)Z.append($,J);else Z.set($,J)};status=($)=>{this.#z=$};set=($,J)=>{this.#X??=new Map,this.#X.set($,J)};get=($)=>{return this.#X?this.#X.get($):void 0};get var(){if(!this.#X)return{};return Object.fromEntries(this.#X)}#E($,J,X){let Z=this.#Z?new Headers(this.#Z.headers):this.#Q??new Headers;if(typeof J==="object"&&"headers"in J){let z=J.headers instanceof Headers?J.headers:new Headers(J.headers);for(let[E,Q]of z)if(E.toLowerCase()==="set-cookie")Z.append(E,Q);else Z.set(E,Q)}if(X)for(let[z,E]of Object.entries(X))if(typeof E==="string")Z.set(z,E);else{Z.delete(z);for(let Q of E)Z.append(z,Q)}let Y=typeof J==="number"?J:J?.status??this.#z;return new Response($,{status:Y,headers:Z})}newResponse=(...$)=>this.#E(...$);body=($,J,X)=>this.#E($,J,X);text=($,J,X)=>{return!this.#Q&&!this.#z&&!J&&!X&&!this.finalized?new Response($):this.#E($,J,d0(y5,X))};json=($,J,X)=>{return this.#E(JSON.stringify($),J,d0("application/json",X))};html=($,J,X)=>{let Z=(Y)=>this.#E(Y,J,d0("text/html; charset=UTF-8",X));return typeof $==="object"?i0($,T$.Stringify,!1,{}).then(Z):Z($)};redirect=($,J)=>{let X=String($);return this.header("Location",!/[^\x00-\xFF]/.test(X)?X:encodeURI(X)),this.newResponse(null,J??302)};notFound=()=>{return this.#P??=()=>new Response,this.#P(this)}};var G="ALL",I$="all",_$=["get","post","put","delete","options","patch"],R0="Can not add a route since the matcher is already built.",L0=class extends Error{};var V$="__COMPOSED_HANDLER";var C5=($)=>{return $.text("404 Not Found",404)},M$=($,J)=>{if("getResponse"in $){let X=$.getResponse();return J.newResponse(X.body,X)}return console.error($),J.text("Internal Server Error",500)},H$=class ${get;post;put;delete;options;patch;all;on;use;router;getPath;_basePath="/";#$="/";routes=[];constructor(J={}){[..._$,I$].forEach((z)=>{this[z]=(E,...Q)=>{if(typeof E==="string")this.#$=E;else this.#z(z,this.#$,E);return Q.forEach((W)=>{this.#z(z,this.#$,W)}),this}}),this.on=(z,E,...Q)=>{for(let W of[E].flat()){this.#$=W;for(let P of[z].flat())Q.map((B)=>{this.#z(P.toUpperCase(),this.#$,B)})}return this},this.use=(z,...E)=>{if(typeof z==="string")this.#$=z;else this.#$="*",E.unshift(z);return E.forEach((Q)=>{this.#z(G,this.#$,Q)}),this};let{strict:Z,...Y}=J;Object.assign(this,Y),this.getPath=Z??!0?J.getPath??s0:U$}#J(){let J=new $({router:this.router,getPath:this.getPath});return J.errorHandler=this.errorHandler,J.#X=this.#X,J.routes=this.routes,J}#X=C5;errorHandler=M$;route(J,X){let Z=this.basePath(J);return X.routes.map((Y)=>{let z;if(X.errorHandler===M$)z=Y.handler;else z=async(E,Q)=>(await u0([],X.errorHandler)(E,()=>Y.handler(E,Q))).res,z[V$]=Y.handler;Z.#z(Y.method,Y.path,z)}),this}basePath(J){let X=this.#J();return X._basePath=b(this._basePath,J),X}onError=(J)=>{return this.errorHandler=J,this};notFound=(J)=>{return this.#X=J,this};mount(J,X,Z){let Y,z;if(Z)if(typeof Z==="function")z=Z;else if(z=Z.optionHandler,Z.replaceRequest===!1)Y=(W)=>W;else Y=Z.replaceRequest;let E=z?(W)=>{let P=z(W);return Array.isArray(P)?P:[P]}:(W)=>{let P=void 0;try{P=W.executionCtx}catch{}return[W.env,P]};Y||=(()=>{let W=b(this._basePath,J),P=W==="/"?0:W.length;return(B)=>{let S=new URL(B.url);return S.pathname=S.pathname.slice(P)||"/",new Request(S,B)}})();let Q=async(W,P)=>{let B=await X(Y(W.req.raw),...E(W));if(B)return B;await P()};return this.#z(G,b(J,"*"),Q),this}#z(J,X,Z){J=J.toUpperCase(),X=b(this._basePath,X);let Y={basePath:this._basePath,path:X,method:J,handler:Z};this.router.add(J,X,[Z,Y]),this.routes.push(Y)}#Y(J,X){if(J instanceof Error)return this.errorHandler(J,X);throw J}#Z(J,X,Z,Y){if(Y==="HEAD")return(async()=>new Response(null,await this.#Z(J,X,Z,"GET")))();let z=this.getPath(J,{env:Z}),E=this.router.match(Y,z),Q=new j$(J,{path:z,matchResult:E,env:Z,executionCtx:X,notFoundHandler:this.#X});if(E[0].length===1){let P;try{P=E[0][0][0][0](Q,async()=>{Q.res=await this.#X(Q)})}catch(B){return this.#Y(B,Q)}return P instanceof Promise?P.then((B)=>B||(Q.finalized?Q.res:this.#X(Q))).catch((B)=>this.#Y(B,Q)):P??this.#X(Q)}let W=u0(E[0],this.errorHandler,this.#X);return(async()=>{try{let P=await W(Q);if(!P.finalized)throw Error("Context is not finalized. Did you forget to return a Response object or `await next()`?");return P.res}catch(P){return this.#Y(P,Q)}})()}fetch=(J,...X)=>{return this.#Z(J,X[1],X[0],J.method)};request=(J,X,Z,Y)=>{if(J instanceof Request)return this.fetch(X?new Request(J,X):J,Z,Y);return J=J.toString(),this.fetch(new Request(/^https?:\/\//.test(J)?J:`http://localhost${b("/",J)}`,X),Z,Y)};fire=()=>{addEventListener("fetch",(J)=>{J.respondWith(this.#Z(J.request,J,void 0,J.request.method))})}};var m=[];function T0($,J){let X=this.buildAllMatchers(),Z=(Y,z)=>{let E=X[Y]||X[G],Q=E[2][z];if(Q)return Q;let W=z.match(E[0]);if(!W)return[[],m];let P=W.indexOf("",1);return[E[1][P],W]};return this.match=Z,Z($,J)}var j0="[^/]+",i=".*",d="(?:|/.*)",v=Symbol(),k5=new Set(".\\+*[^]$()");function b5($,J){if($.length===1)return J.length===1?$<J?-1:1:-1;if(J.length===1)return 1;if($===i||$===d)return 1;else if(J===i||J===d)return-1;if($===j0)return 1;else if(J===j0)return-1;return $.length===J.length?$<J?-1:1:J.length-$.length}var F$=class ${#$;#J;#X=Object.create(null);insert(J,X,Z,Y,z){if(J.length===0){if(this.#$!==void 0)throw v;if(z)return;this.#$=X;return}let[E,...Q]=J,W=E==="*"?Q.length===0?["","",i]:["","",j0]:E==="/*"?["","",d]:E.match(/^\:([^\{\}]+)(?:\{(.+)\})?$/),P;if(W){let B=W[1],S=W[2]||j0;if(B&&W[2]){if(S===".*")throw v;if(S=S.replace(/^\((?!\?:)(?=[^)]+\)$)/,"(?:"),/\((?!\?:)/.test(S))throw v}if(P=this.#X[S],!P){if(Object.keys(this.#X).some((K)=>K!==i&&K!==d))throw v;if(z)return;if(P=this.#X[S]=new $,B!=="")P.#J=Y.varIndex++}if(!z&&B!=="")Z.push([B,P.#J])}else if(P=this.#X[E],!P){if(Object.keys(this.#X).some((B)=>B.length>1&&B!==i&&B!==d))throw v;if(z)return;P=this.#X[E]=new $}P.insert(Q,X,Z,Y,z)}buildRegExpStr(){let X=Object.keys(this.#X).sort(b5).map((Z)=>{let Y=this.#X[Z];return(typeof Y.#J==="number"?`(${Z})@${Y.#J}`:k5.has(Z)?`\\${Z}`:Z)+Y.buildRegExpStr()});if(typeof this.#$==="number")X.unshift(`#${this.#$}`);if(X.length===0)return"";if(X.length===1)return X[0];return"(?:"+X.join("|")+")"}};var q$=class{#$={varIndex:0};#J=new F$;insert($,J,X){let Z=[],Y=[];for(let E=0;;){let Q=!1;if($=$.replace(/\{[^}]+\}/g,(W)=>{let P=`@\\${E}`;return Y[E]=[P,W],E++,Q=!0,P}),!Q)break}let z=$.match(/(?::[^\/]+)|(?:\/\*$)|./g)||[];for(let E=Y.length-1;E>=0;E--){let[Q]=Y[E];for(let W=z.length-1;W>=0;W--)if(z[W].indexOf(Q)!==-1){z[W]=z[W].replace(Q,Y[E][1]);break}}return this.#J.insert(z,J,Z,this.#$,X),Z}buildRegExp(){let $=this.#J.buildRegExpStr();if($==="")return[/^$/,[],[]];let J=0,X=[],Z=[];return $=$.replace(/#(\d+)|@(\d+)|\.\*\$/g,(Y,z,E)=>{if(z!==void 0)return X[++J]=Number(z),"$()";if(E!==void 0)return Z[Number(E)]=++J,"";return""}),[new RegExp(`^${$}`),X,Z]}};var v5=[/^$/,[],Object.create(null)],N$=Object.create(null);function f$($){return N$[$]??=new RegExp($==="*"?"":`^${$.replace(/\/\*$|([.\\+*[^\]$()])/g,(J,X)=>X?`\\${X}`:"(?:|/.*)")}$`)}function h5(){N$=Object.create(null)}function g5($){let J=new q$,X=[];if($.length===0)return v5;let Z=$.map((P)=>[!/\*|\/:/.test(P[0]),...P]).sort(([P,B],[S,K])=>P?1:S?-1:B.length-K.length),Y=Object.create(null);for(let P=0,B=-1,S=Z.length;P<S;P++){let[K,U,j]=Z[P];if(K)Y[U]=[j.map(([V])=>[V,Object.create(null)]),m];else B++;let R;try{R=J.insert(U,B,K)}catch(V){throw V===v?new L0(U):V}if(K)continue;X[B]=j.map(([V,D])=>{let p=Object.create(null);D-=1;for(;D>=0;D--){let[n,q]=R[D];p[n]=q}return[V,p]})}let[z,E,Q]=J.buildRegExp();for(let P=0,B=X.length;P<B;P++)for(let S=0,K=X[P].length;S<K;S++){let U=X[P][S]?.[1];if(!U)continue;let j=Object.keys(U);for(let R=0,V=j.length;R<V;R++)U[j[R]]=Q[U[j[R]]]}let W=[];for(let P in E)W[P]=X[E[P]];return[z,W,Y]}function u($,J){if(!$)return;for(let X of Object.keys($).sort((Z,Y)=>Y.length-Z.length))if(f$(X).test(J))return[...$[X]];return}var I0=class{name="RegExpRouter";#$;#J;constructor(){this.#$={[G]:Object.create(null)},this.#J={[G]:Object.create(null)}}add($,J,X){let Z=this.#$,Y=this.#J;if(!Z||!Y)throw Error(R0);if(!Z[$])[Z,Y].forEach((Q)=>{Q[$]=Object.create(null),Object.keys(Q[G]).forEach((W)=>{Q[$][W]=[...Q[G][W]]})});if(J==="/*")J="*";let z=(J.match(/\/:/g)||[]).length;if(/\*$/.test(J)){let Q=f$(J);if($===G)Object.keys(Z).forEach((W)=>{Z[W][J]||=u(Z[W],J)||u(Z[G],J)||[]});else Z[$][J]||=u(Z[$],J)||u(Z[G],J)||[];Object.keys(Z).forEach((W)=>{if($===G||$===W)Object.keys(Z[W]).forEach((P)=>{Q.test(P)&&Z[W][P].push([X,z])})}),Object.keys(Y).forEach((W)=>{if($===G||$===W)Object.keys(Y[W]).forEach((P)=>Q.test(P)&&Y[W][P].push([X,z]))});return}let E=G0(J)||[J];for(let Q=0,W=E.length;Q<W;Q++){let P=E[Q];Object.keys(Y).forEach((B)=>{if($===G||$===B)Y[B][P]||=[...u(Z[B],P)||u(Z[G],P)||[]],Y[B][P].push([X,z-W+Q+1])})}}match=T0;buildAllMatchers(){let $=Object.create(null);return Object.keys(this.#J).concat(Object.keys(this.#$)).forEach((J)=>{$[J]||=this.#X(J)}),this.#$=this.#J=void 0,h5(),$}#X($){let J=[],X=$===G;if([this.#$,this.#J].forEach((Z)=>{let Y=Z[$]?Object.keys(Z[$]).map((z)=>[z,Z[$][z]]):[];if(Y.length!==0)X||=!0,J.push(...Y);else if($!==G)J.push(...Object.keys(Z[G]).map((z)=>[z,Z[G][z]]))}),!X)return null;else return g5(J)}};var u5=class{name="PreparedRegExpRouter";#$;#J;constructor($,J){this.#$=$,this.#J=J}#X($,J){let X=this.#$[$];X[1].forEach((Z)=>Z&&Z.push(J)),Object.values(X[2]).forEach((Z)=>Z[0].push(J))}#z($,J,X,Z,Y){let z=this.#$[$];if(!Y)z[2][J][0].push([X,{}]);else Z.forEach((E)=>{if(typeof E==="number")z[1][E].push([X,Y]);else z[2][E||J][0].push([X,Y])})}add($,J,X){if(!this.#$[$]){let Y=this.#$[G],z={};for(let E in Y[2])z[E]=[Y[2][E][0].slice(),m];this.#$[$]=[Y[0],Y[1].map((E)=>Array.isArray(E)?E.slice():0),z]}if(J==="/*"||J==="*"){let Y=[X,{}];if($===G)for(let z in this.#$)this.#X(z,Y);else this.#X($,Y);return}let Z=this.#J[J];if(!Z)throw Error(`Path ${J} is not registered`);for(let[Y,z]of Z)if($===G)for(let E in this.#$)this.#z(E,J,X,Y,z);else this.#z($,J,X,Y,z)}buildAllMatchers(){return this.#$}match=T0};var r0=class{name="SmartRouter";#$=[];#J=[];constructor($){this.#$=$.routers}add($,J,X){if(!this.#J)throw Error(R0);this.#J.push([$,J,X])}match($,J){if(!this.#J)throw Error("Fatal error");let X=this.#$,Z=this.#J,Y=X.length,z=0,E;for(;z<Y;z++){let Q=X[z];try{for(let W=0,P=Z.length;W<P;W++)Q.add(...Z[W]);E=Q.match($,J)}catch(W){if(W instanceof L0)continue;throw W}this.match=Q.match.bind(Q),this.#$=[Q],this.#J=void 0;break}if(z===Y)throw Error("Fatal error");return this.name=`SmartRouter + ${this.activeRouter.name}`,E}get activeRouter(){if(this.#J||this.#$.length!==1)throw Error("No active router has been determined yet.");return this.#$[0]}};var r=Object.create(null),A$=class ${#$;#J;#X;#z=0;#Y=r;constructor(J,X,Z){if(this.#J=Z||Object.create(null),this.#$=[],J&&X){let Y=Object.create(null);Y[J]={handler:X,possibleKeys:[],score:0},this.#$=[Y]}this.#X=[]}insert(J,X,Z){this.#z=++this.#z;let Y=this,z=B$(X),E=[];for(let Q=0,W=z.length;Q<W;Q++){let P=z[Q],B=z[Q+1],S=S$(P,B),K=Array.isArray(S)?S[0]:P;if(K in Y.#J){if(Y=Y.#J[K],S)E.push(S[1]);continue}if(Y.#J[K]=new $,S)Y.#X.push(S),E.push(S[1]);Y=Y.#J[K]}return Y.#$.push({[J]:{handler:Z,possibleKeys:E.filter((Q,W,P)=>P.indexOf(Q)===W),score:this.#z}}),Y}#Z(J,X,Z,Y){let z=[];for(let E=0,Q=J.#$.length;E<Q;E++){let W=J.#$[E],P=W[X]||W[G],B={};if(P!==void 0){if(P.params=Object.create(null),z.push(P),Z!==r||Y&&Y!==r)for(let S=0,K=P.possibleKeys.length;S<K;S++){let U=P.possibleKeys[S],j=B[P.score];P.params[U]=Y?.[U]&&!j?Y[U]:Z[U]??Y?.[U],B[P.score]=!0}}}return z}search(J,X){let Z=[];this.#Y=r;let z=[this],E=l0(X),Q=[];for(let W=0,P=E.length;W<P;W++){let B=E[W],S=W===P-1,K=[];for(let U=0,j=z.length;U<j;U++){let R=z[U],V=R.#J[B];if(V)if(V.#Y=R.#Y,S){if(V.#J["*"])Z.push(...this.#Z(V.#J["*"],J,R.#Y));Z.push(...this.#Z(V,J,R.#Y))}else K.push(V);for(let D=0,p=R.#X.length;D<p;D++){let n=R.#X[D],q=R.#Y===r?{}:{...R.#Y};if(n==="*"){let x=R.#J["*"];if(x)Z.push(...this.#Z(x,J,R.#Y)),x.#Y=q,K.push(x);continue}let[k$,t0,c]=n;if(!B&&!(c instanceof RegExp))continue;let f=R.#J[k$],b$=E.slice(W).join("/");if(c instanceof RegExp){let x=c.exec(b$);if(x){if(q[t0]=x[0],Z.push(...this.#Z(f,J,R.#Y,q)),Object.keys(f.#J).length){f.#Y=q;let v$=x[0].match(/\//)?.length??0;(Q[v$]||=[]).push(f)}continue}}if(c===!0||c.test(B))if(q[t0]=B,S){if(Z.push(...this.#Z(f,J,q,R.#Y)),f.#J["*"])Z.push(...this.#Z(f.#J["*"],J,q,R.#Y))}else f.#Y=q,K.push(f)}}z=K.concat(Q.shift()??[])}if(Z.length>1)Z.sort((W,P)=>{return W.score-P.score});return[Z.map(({handler:W,params:P})=>[W,P])]}};var p0=class{name="TrieRouter";#$;constructor(){this.#$=new A$}add($,J,X){let Z=G0(J);if(Z){for(let Y=0,z=Z.length;Y<z;Y++)this.#$.insert($,Z[Y],X);return}this.#$.insert($,J,X)}match($,J){return this.#$.search($,J)}};var n0=class extends H${constructor($={}){super($);this.router=$.router??new r0({routers:[new I0,new p0]})}};var _0=new Map,c5={windowMs:60000,maxRequests:100};function D$($,J=c5){let X=Date.now(),Z=_0.get($);if(!Z||X-Z.windowStart>=J.windowMs)return _0.set($,{count:1,windowStart:X}),{allowed:!0,remaining:J.maxRequests-1,resetMs:J.windowMs};if(Z.count>=J.maxRequests)return{allowed:!1,remaining:0,resetMs:J.windowMs-(X-Z.windowStart)};return Z.count++,{allowed:!0,remaining:J.maxRequests-Z.count,resetMs:J.windowMs-(X-Z.windowStart)}}function l5($=300000){let J=Date.now(),X=0;for(let[Z,Y]of _0.entries())if(J-Y.windowStart>$)_0.delete(Z),X++;return X}var s5=setInterval(()=>{l5()},300000);s5.unref();var x$={windowMs:60000,maxRequests:100},O$=["whatsapp","telegram","email","discord","slack","signal","webchat"];function w$($){let J=$.req.header("x-forwarded-for");if(J){let X=J.split(",")[0]?.trim();if(X)return X}return $.req.header("x-real-ip")||"unknown"}function V0($){return O$.includes($)}function M0($,J){let X=process.env.WASP_API_TOKEN,Z=w$($);if(!X){if(!(Z==="127.0.0.1"||Z==="::1"||Z==="localhost"||Z==="unknown"))return $.json({error:"Admin endpoints require authentication. Set WASP_API_TOKEN or access from localhost."},401);return J()}let Y=$.req.header("authorization");if(!Y)return $.json({error:"Authorization header required"},401);if((Y.startsWith("Bearer ")?Y.slice(7):Y)!==X)return $.json({error:"Invalid API token"},401);return J()}function m5(){let $=new n0;return $.get("/health",(J)=>{return J.json({ok:!0,timestamp:new Date().toISOString()})}),$.post("/check",async(J)=>{let X=w$(J),Z=D$(`check:${X}`,x$);if(J.header("X-RateLimit-Limit",String(x$.maxRequests)),J.header("X-RateLimit-Remaining",String(Z.remaining)),J.header("X-RateLimit-Reset",String(Math.ceil(Z.resetMs/1000))),!Z.allowed)return J.json({error:"Rate limit exceeded",retryAfterMs:Z.resetMs},429);let Y;try{Y=await J.req.json()}catch{return J.json({error:"Invalid JSON body"},400)}let{identifier:z,platform:E="whatsapp"}=Y;if(!z)return J.json({error:"identifier is required"},400);if(!V0(E))return J.json({error:`Invalid platform. Must be one of: ${O$.join(", ")}`},400);let Q=P0(z,E),W=!Q.allowed?"deny":Q.trust==="limited"?"limited":"allow";return B0(z,E,W,Q.reason),J.json(Q)}),$.get("/contacts",M0,(J)=>{let X=J.req.query("platform"),Z=J.req.query("trust");if(X&&!V0(X))return J.json({error:"Invalid platform filter"},400);let Y=W0(X,Z);return J.json({contacts:Y})}),$.post("/contacts",M0,async(J)=>{let X;try{X=await J.req.json()}catch{return J.json({error:"Invalid JSON body"},400)}let{identifier:Z,platform:Y="whatsapp",trust:z="trusted",name:E,notes:Q}=X;if(!Z)return J.json({error:"identifier is required"},400);if(!V0(Y))return J.json({error:"Invalid platform"},400);let W=["sovereign","trusted","limited"];if(!W.includes(z))return J.json({error:`Invalid trust level. Must be one of: ${W.join(", ")}`},400);let P=k(Z,Y,z,E,Q);return J.json({contact:P})}),$.delete("/contacts/:identifier",M0,(J)=>{let X=J.req.param("identifier");if(!X)return J.json({error:"Missing identifier"},400);let Z=decodeURIComponent(X),Y=J.req.query("platform")||"whatsapp";if(!V0(Y))return J.json({error:"Invalid platform"},400);let z=Q0(Z,Y);return J.json({removed:z})}),$.get("/audit",M0,(J)=>{let X=J.req.query("limit"),Z=X?parseInt(X,10):100;if(Number.isNaN(Z)||Z<1||Z>1000)return J.json({error:"limit must be between 1 and 1000"},400);let Y=J.req.query("decision");if(Y&&!["allow","deny","limited"].includes(Y))return J.json({error:"Invalid decision filter"},400);let z=g({limit:Z,decision:Y});return J.json({entries:z})}),$}function y$($=3847){let J=m5(),X=!!process.env.WASP_API_TOKEN;if(console.log(`wasp server listening on http://localhost:${$}`),console.log(""),console.log("Public endpoints:"),console.log("  POST /check         - Check if contact is allowed"),console.log("  GET  /health        - Health check"),console.log(""),console.log("Admin endpoints (protected):"),console.log("  GET  /contacts      - List contacts"),console.log("  POST /contacts      - Add contact"),console.log("  DELETE /contacts/:id - Remove contact"),console.log("  GET  /audit         - View audit log"),console.log(""),X)console.log("Authentication: API token required (WASP_API_TOKEN is set)");else console.log("Authentication: Localhost-only (set WASP_API_TOKEN for remote access)");Bun.serve({port:$,fetch:J.fetch})}function C$($){if(!h())console.error("wasp is not initialized. Run `wasp init` first."),process.exit(1);let J=$.port||3847;y$(J)}var i5="0.2.2";H.name("wasp").description("Security whitelist layer for Moltbot and agentic systems").version(i5);H.command("init").description("Initialize wasp database").option("-f, --force","Reinitialize even if already initialized").action(($)=>{a1($.force)});H.command("add <identifier>").description("Add a contact to the whitelist").option("-p, --platform <platform>","Platform (whatsapp, telegram, email, discord, slack, signal)","whatsapp").option("-t, --trust <level>","Trust level (sovereign, trusted, limited)","trusted").option("-n, --name <name>","Contact name").option("--notes <notes>","Notes about this contact").action(($,J)=>{O(),t1($,J)});H.command("remove <identifier>").description("Remove a contact from the whitelist").option("-p, --platform <platform>","Platform","whatsapp").action(($,J)=>{O(),J$($,J.platform)});H.command("list").description("List all contacts").option("-p, --platform <platform>","Filter by platform").option("-t, --trust <level>","Filter by trust level").option("-j, --json","Output as JSON").action(($)=>{O(),e1($)});H.command("check <identifier>").description("Check if a contact is allowed").option("-p, --platform <platform>","Platform","whatsapp").option("-j, --json","Output as JSON").option("-q, --quiet","Exit code only, no output").action(($,J)=>{O(),o1($,J)});H.command("log").description("View audit log").option("-l, --limit <number>","Number of entries to show","50").option("-d, --denied","Show only denied entries").option("-j, --json","Output as JSON").action(($)=>{O(),$$({...$,limit:parseInt($.limit,10)})});H.command("serve").description("Start HTTP server for Moltbot integration").option("-p, --port <number>","Port to listen on","3847").action(($)=>{O(),C$({port:parseInt($.port,10)})});H.command("review").description("Review quarantined messages and first-time contacts").option("--approve <identifier>","Approve sender and release messages").option("--deny <identifier>","Block sender and delete messages").option("-i, --interactive","Interactive review mode").action(async($)=>{O(),await E$($)});H.command("blocked").description("Show recently blocked contacts").option("-l, --limit <number>","Number to show","20").action(($)=>{O(),Q$(parseInt($.limit,10))});function O(){if(!h())console.log("wasp is not initialized. Initializing now..."),E0(),console.log("")}H.parseAsync().then(()=>{h0(),process.exit(0)}).catch(($)=>{console.error($),h0(),process.exit(1)});
