#!/usr/bin/env node
// @bun
var h$=Object.create;var{getPrototypeOf:g$,defineProperty:o0,getOwnPropertyNames:u$}=Object;var c$=Object.prototype.hasOwnProperty;var l$=($,J,E)=>{E=$!=null?h$(g$($)):{};let X=J||!$||!$.__esModule?o0(E,"default",{value:$,enumerable:!0}):E;for(let Z of u$($))if(!c$.call(X,Z))o0(X,Z,{get:()=>$[Z],enumerable:!0});return X};var R=($,J)=>()=>(J||$((J={exports:{}}).exports,J),J.exports);var V=import.meta.require;var l=R((s$)=>{class F0 extends Error{constructor($,J,E){super(E);Error.captureStackTrace(this,this.constructor),this.name=this.constructor.name,this.code=J,this.exitCode=$,this.nestedError=void 0}}class a0 extends F0{constructor($){super(1,"commander.invalidArgument",$);Error.captureStackTrace(this,this.constructor),this.name=this.constructor.name}}s$.CommanderError=F0;s$.InvalidArgumentError=a0});var n=R((p$)=>{var{InvalidArgumentError:d$}=l();class e0{constructor($,J){switch(this.description=J||"",this.variadic=!1,this.parseArg=void 0,this.defaultValue=void 0,this.defaultValueDescription=void 0,this.argChoices=void 0,$[0]){case"<":this.required=!0,this._name=$.slice(1,-1);break;case"[":this.required=!1,this._name=$.slice(1,-1);break;default:this.required=!0,this._name=$;break}if(this._name.length>3&&this._name.slice(-3)==="...")this.variadic=!0,this._name=this._name.slice(0,-3)}name(){return this._name}_concatValue($,J){if(J===this.defaultValue||!Array.isArray(J))return[$];return J.concat($)}default($,J){return this.defaultValue=$,this.defaultValueDescription=J,this}argParser($){return this.parseArg=$,this}choices($){return this.argChoices=$.slice(),this.parseArg=(J,E)=>{if(!this.argChoices.includes(J))throw new d$(`Allowed choices are ${this.argChoices.join(", ")}.`);if(this.variadic)return this._concatValue(J,E);return J},this}argRequired(){return this.required=!0,this}argOptional(){return this.required=!1,this}}function r$($){let J=$.name()+($.variadic===!0?"...":"");return $.required?"<"+J+">":"["+J+"]"}p$.Argument=e0;p$.humanReadableArgName=r$});var q0=R((a$)=>{var{humanReadableArgName:o$}=n();class $1{constructor(){this.helpWidth=void 0,this.sortSubcommands=!1,this.sortOptions=!1,this.showGlobalOptions=!1}visibleCommands($){let J=$.commands.filter((X)=>!X._hidden),E=$._getHelpCommand();if(E&&!E._hidden)J.push(E);if(this.sortSubcommands)J.sort((X,Z)=>{return X.name().localeCompare(Z.name())});return J}compareOptions($,J){let E=(X)=>{return X.short?X.short.replace(/^-/,""):X.long.replace(/^--/,"")};return E($).localeCompare(E(J))}visibleOptions($){let J=$.options.filter((X)=>!X.hidden),E=$._getHelpOption();if(E&&!E.hidden){let X=E.short&&$._findOption(E.short),Z=E.long&&$._findOption(E.long);if(!X&&!Z)J.push(E);else if(E.long&&!Z)J.push($.createOption(E.long,E.description));else if(E.short&&!X)J.push($.createOption(E.short,E.description))}if(this.sortOptions)J.sort(this.compareOptions);return J}visibleGlobalOptions($){if(!this.showGlobalOptions)return[];let J=[];for(let E=$.parent;E;E=E.parent){let X=E.options.filter((Z)=>!Z.hidden);J.push(...X)}if(this.sortOptions)J.sort(this.compareOptions);return J}visibleArguments($){if($._argsDescription)$.registeredArguments.forEach((J)=>{J.description=J.description||$._argsDescription[J.name()]||""});if($.registeredArguments.find((J)=>J.description))return $.registeredArguments;return[]}subcommandTerm($){let J=$.registeredArguments.map((E)=>o$(E)).join(" ");return $._name+($._aliases[0]?"|"+$._aliases[0]:"")+($.options.length?" [options]":"")+(J?" "+J:"")}optionTerm($){return $.flags}argumentTerm($){return $.name()}longestSubcommandTermLength($,J){return J.visibleCommands($).reduce((E,X)=>{return Math.max(E,J.subcommandTerm(X).length)},0)}longestOptionTermLength($,J){return J.visibleOptions($).reduce((E,X)=>{return Math.max(E,J.optionTerm(X).length)},0)}longestGlobalOptionTermLength($,J){return J.visibleGlobalOptions($).reduce((E,X)=>{return Math.max(E,J.optionTerm(X).length)},0)}longestArgumentTermLength($,J){return J.visibleArguments($).reduce((E,X)=>{return Math.max(E,J.argumentTerm(X).length)},0)}commandUsage($){let J=$._name;if($._aliases[0])J=J+"|"+$._aliases[0];let E="";for(let X=$.parent;X;X=X.parent)E=X.name()+" "+E;return E+J+" "+$.usage()}commandDescription($){return $.description()}subcommandDescription($){return $.summary()||$.description()}optionDescription($){let J=[];if($.argChoices)J.push(`choices: ${$.argChoices.map((E)=>JSON.stringify(E)).join(", ")}`);if($.defaultValue!==void 0){if($.required||$.optional||$.isBoolean()&&typeof $.defaultValue==="boolean")J.push(`default: ${$.defaultValueDescription||JSON.stringify($.defaultValue)}`)}if($.presetArg!==void 0&&$.optional)J.push(`preset: ${JSON.stringify($.presetArg)}`);if($.envVar!==void 0)J.push(`env: ${$.envVar}`);if(J.length>0)return`${$.description} (${J.join(", ")})`;return $.description}argumentDescription($){let J=[];if($.argChoices)J.push(`choices: ${$.argChoices.map((E)=>JSON.stringify(E)).join(", ")}`);if($.defaultValue!==void 0)J.push(`default: ${$.defaultValueDescription||JSON.stringify($.defaultValue)}`);if(J.length>0){let E=`(${J.join(", ")})`;if($.description)return`${$.description} ${E}`;return E}return $.description}formatHelp($,J){let E=J.padWidth($,J),X=J.helpWidth||80,Z=2,Y=2;function z(K,T){if(T){let L=`${K.padEnd(E+2)}${T}`;return J.wrap(L,X-2,E+2)}return K}function Q(K){return K.join(`
`).replace(/^/gm," ".repeat(2))}let W=[`Usage: ${J.commandUsage($)}`,""],P=J.commandDescription($);if(P.length>0)W=W.concat([J.wrap(P,X,0),""]);let U=J.visibleArguments($).map((K)=>{return z(J.argumentTerm(K),J.argumentDescription(K))});if(U.length>0)W=W.concat(["Arguments:",Q(U),""]);let S=J.visibleOptions($).map((K)=>{return z(J.optionTerm(K),J.optionDescription(K))});if(S.length>0)W=W.concat(["Options:",Q(S),""]);if(this.showGlobalOptions){let K=J.visibleGlobalOptions($).map((T)=>{return z(J.optionTerm(T),J.optionDescription(T))});if(K.length>0)W=W.concat(["Global Options:",Q(K),""])}let B=J.visibleCommands($).map((K)=>{return z(J.subcommandTerm(K),J.subcommandDescription(K))});if(B.length>0)W=W.concat(["Commands:",Q(B),""]);return W.join(`
`)}padWidth($,J){return Math.max(J.longestOptionTermLength($,J),J.longestGlobalOptionTermLength($,J),J.longestSubcommandTermLength($,J),J.longestArgumentTermLength($,J))}wrap($,J,E,X=40){let Y=new RegExp(`[\\n][${" \\f\\t\\v\xA0\u1680\u2000-\u200A\u202F\u205F\u3000\uFEFF"}]+`);if($.match(Y))return $;let z=J-E;if(z<X)return $;let Q=$.slice(0,E),W=$.slice(E).replace(`\r
`,`
`),P=" ".repeat(E),S=`\\s${"\u200B"}`,B=new RegExp(`
|.{1,${z-1}}([${S}]|$)|[^${S}]+?([${S}]|$)`,"g"),K=W.match(B)||[];return Q+K.map((T,L)=>{if(T===`
`)return"";return(L>0?P:"")+T.trimEnd()}).join(`
`)}}a$.Help=$1});var f0=R((X2)=>{var{InvalidArgumentError:$2}=l();class J1{constructor($,J){this.flags=$,this.description=J||"",this.required=$.includes("<"),this.optional=$.includes("["),this.variadic=/\w\.\.\.[>\]]$/.test($),this.mandatory=!1;let E=E2($);if(this.short=E.shortFlag,this.long=E.longFlag,this.negate=!1,this.long)this.negate=this.long.startsWith("--no-");this.defaultValue=void 0,this.defaultValueDescription=void 0,this.presetArg=void 0,this.envVar=void 0,this.parseArg=void 0,this.hidden=!1,this.argChoices=void 0,this.conflictsWith=[],this.implied=void 0}default($,J){return this.defaultValue=$,this.defaultValueDescription=J,this}preset($){return this.presetArg=$,this}conflicts($){return this.conflictsWith=this.conflictsWith.concat($),this}implies($){let J=$;if(typeof $==="string")J={[$]:!0};return this.implied=Object.assign(this.implied||{},J),this}env($){return this.envVar=$,this}argParser($){return this.parseArg=$,this}makeOptionMandatory($=!0){return this.mandatory=!!$,this}hideHelp($=!0){return this.hidden=!!$,this}_concatValue($,J){if(J===this.defaultValue||!Array.isArray(J))return[$];return J.concat($)}choices($){return this.argChoices=$.slice(),this.parseArg=(J,E)=>{if(!this.argChoices.includes(J))throw new $2(`Allowed choices are ${this.argChoices.join(", ")}.`);if(this.variadic)return this._concatValue(J,E);return J},this}name(){if(this.long)return this.long.replace(/^--/,"");return this.short.replace(/^-/,"")}attributeName(){return J2(this.name().replace(/^no-/,""))}is($){return this.short===$||this.long===$}isBoolean(){return!this.required&&!this.optional&&!this.negate}}class E1{constructor($){this.positiveOptions=new Map,this.negativeOptions=new Map,this.dualOptions=new Set,$.forEach((J)=>{if(J.negate)this.negativeOptions.set(J.attributeName(),J);else this.positiveOptions.set(J.attributeName(),J)}),this.negativeOptions.forEach((J,E)=>{if(this.positiveOptions.has(E))this.dualOptions.add(E)})}valueFromOption($,J){let E=J.attributeName();if(!this.dualOptions.has(E))return!0;let X=this.negativeOptions.get(E).presetArg,Z=X!==void 0?X:!1;return J.negate===(Z===$)}}function J2($){return $.split("-").reduce((J,E)=>{return J+E[0].toUpperCase()+E.slice(1)})}function E2($){let J,E,X=$.split(/[ |,]+/);if(X.length>1&&!/^[[<]/.test(X[1]))J=X.shift();if(E=X.shift(),!J&&/^-[^-]$/.test(E))J=E,E=void 0;return{shortFlag:J,longFlag:E}}X2.Option=J1;X2.DualOptions=E1});var X1=R((W2)=>{function z2($,J){if(Math.abs($.length-J.length)>3)return Math.max($.length,J.length);let E=[];for(let X=0;X<=$.length;X++)E[X]=[X];for(let X=0;X<=J.length;X++)E[0][X]=X;for(let X=1;X<=J.length;X++)for(let Z=1;Z<=$.length;Z++){let Y=1;if($[Z-1]===J[X-1])Y=0;else Y=1;if(E[Z][X]=Math.min(E[Z-1][X]+1,E[Z][X-1]+1,E[Z-1][X-1]+Y),Z>1&&X>1&&$[Z-1]===J[X-2]&&$[Z-2]===J[X-1])E[Z][X]=Math.min(E[Z][X],E[Z-2][X-2]+1)}return E[$.length][J.length]}function Q2($,J){if(!J||J.length===0)return"";J=Array.from(new Set(J));let E=$.startsWith("--");if(E)$=$.slice(2),J=J.map((z)=>z.slice(2));let X=[],Z=3,Y=0.4;if(J.forEach((z)=>{if(z.length<=1)return;let Q=z2($,z),W=Math.max($.length,z.length);if((W-Q)/W>Y){if(Q<Z)Z=Q,X=[z];else if(Q===Z)X.push(z)}}),X.sort((z,Q)=>z.localeCompare(Q)),E)X=X.map((z)=>`--${z}`);if(X.length>1)return`
(Did you mean one of ${X.join(", ")}?)`;if(X.length===1)return`
(Did you mean ${X[0]}?)`;return""}W2.suggestSimilar=Q2});var Q1=R((L2)=>{var U2=V("events").EventEmitter,N0=V("child_process"),D=V("path"),D0=V("fs"),j=V("process"),{Argument:S2,humanReadableArgName:K2}=n(),{CommanderError:x0}=l(),{Help:B2}=q0(),{Option:Z1,DualOptions:G2}=f0(),{suggestSimilar:Y1}=X1();class A0 extends U2{constructor($){super();this.commands=[],this.options=[],this.parent=null,this._allowUnknownOption=!1,this._allowExcessArguments=!0,this.registeredArguments=[],this._args=this.registeredArguments,this.args=[],this.rawArgs=[],this.processedArgs=[],this._scriptPath=null,this._name=$||"",this._optionValues={},this._optionValueSources={},this._storeOptionsAsProperties=!1,this._actionHandler=null,this._executableHandler=!1,this._executableFile=null,this._executableDir=null,this._defaultCommandName=null,this._exitCallback=null,this._aliases=[],this._combineFlagAndOptionalValue=!0,this._description="",this._summary="",this._argsDescription=void 0,this._enablePositionalOptions=!1,this._passThroughOptions=!1,this._lifeCycleHooks={},this._showHelpAfterError=!1,this._showSuggestionAfterError=!0,this._outputConfiguration={writeOut:(J)=>j.stdout.write(J),writeErr:(J)=>j.stderr.write(J),getOutHelpWidth:()=>j.stdout.isTTY?j.stdout.columns:void 0,getErrHelpWidth:()=>j.stderr.isTTY?j.stderr.columns:void 0,outputError:(J,E)=>E(J)},this._hidden=!1,this._helpOption=void 0,this._addImplicitHelpCommand=void 0,this._helpCommand=void 0,this._helpConfiguration={}}copyInheritedSettings($){return this._outputConfiguration=$._outputConfiguration,this._helpOption=$._helpOption,this._helpCommand=$._helpCommand,this._helpConfiguration=$._helpConfiguration,this._exitCallback=$._exitCallback,this._storeOptionsAsProperties=$._storeOptionsAsProperties,this._combineFlagAndOptionalValue=$._combineFlagAndOptionalValue,this._allowExcessArguments=$._allowExcessArguments,this._enablePositionalOptions=$._enablePositionalOptions,this._showHelpAfterError=$._showHelpAfterError,this._showSuggestionAfterError=$._showSuggestionAfterError,this}_getCommandAndAncestors(){let $=[];for(let J=this;J;J=J.parent)$.push(J);return $}command($,J,E){let X=J,Z=E;if(typeof X==="object"&&X!==null)Z=X,X=null;Z=Z||{};let[,Y,z]=$.match(/([^ ]+) *(.*)/),Q=this.createCommand(Y);if(X)Q.description(X),Q._executableHandler=!0;if(Z.isDefault)this._defaultCommandName=Q._name;if(Q._hidden=!!(Z.noHelp||Z.hidden),Q._executableFile=Z.executableFile||null,z)Q.arguments(z);if(this._registerCommand(Q),Q.parent=this,Q.copyInheritedSettings(this),X)return this;return Q}createCommand($){return new A0($)}createHelp(){return Object.assign(new B2,this.configureHelp())}configureHelp($){if($===void 0)return this._helpConfiguration;return this._helpConfiguration=$,this}configureOutput($){if($===void 0)return this._outputConfiguration;return Object.assign(this._outputConfiguration,$),this}showHelpAfterError($=!0){if(typeof $!=="string")$=!!$;return this._showHelpAfterError=$,this}showSuggestionAfterError($=!0){return this._showSuggestionAfterError=!!$,this}addCommand($,J){if(!$._name)throw Error(`Command passed to .addCommand() must have a name
- specify the name in Command constructor or using .name()`);if(J=J||{},J.isDefault)this._defaultCommandName=$._name;if(J.noHelp||J.hidden)$._hidden=!0;return this._registerCommand($),$.parent=this,$._checkForBrokenPassThrough(),this}createArgument($,J){return new S2($,J)}argument($,J,E,X){let Z=this.createArgument($,J);if(typeof E==="function")Z.default(X).argParser(E);else Z.default(E);return this.addArgument(Z),this}arguments($){return $.trim().split(/ +/).forEach((J)=>{this.argument(J)}),this}addArgument($){let J=this.registeredArguments.slice(-1)[0];if(J&&J.variadic)throw Error(`only the last argument can be variadic '${J.name()}'`);if($.required&&$.defaultValue!==void 0&&$.parseArg===void 0)throw Error(`a default value for a required argument is never used: '${$.name()}'`);return this.registeredArguments.push($),this}helpCommand($,J){if(typeof $==="boolean")return this._addImplicitHelpCommand=$,this;$=$??"help [command]";let[,E,X]=$.match(/([^ ]+) *(.*)/),Z=J??"display help for command",Y=this.createCommand(E);if(Y.helpOption(!1),X)Y.arguments(X);if(Z)Y.description(Z);return this._addImplicitHelpCommand=!0,this._helpCommand=Y,this}addHelpCommand($,J){if(typeof $!=="object")return this.helpCommand($,J),this;return this._addImplicitHelpCommand=!0,this._helpCommand=$,this}_getHelpCommand(){if(this._addImplicitHelpCommand??(this.commands.length&&!this._actionHandler&&!this._findCommand("help"))){if(this._helpCommand===void 0)this.helpCommand(void 0,void 0);return this._helpCommand}return null}hook($,J){let E=["preSubcommand","preAction","postAction"];if(!E.includes($))throw Error(`Unexpected value for event passed to hook : '${$}'.
Expecting one of '${E.join("', '")}'`);if(this._lifeCycleHooks[$])this._lifeCycleHooks[$].push(J);else this._lifeCycleHooks[$]=[J];return this}exitOverride($){if($)this._exitCallback=$;else this._exitCallback=(J)=>{if(J.code!=="commander.executeSubCommandAsync")throw J};return this}_exit($,J,E){if(this._exitCallback)this._exitCallback(new x0($,J,E));j.exit($)}action($){let J=(E)=>{let X=this.registeredArguments.length,Z=E.slice(0,X);if(this._storeOptionsAsProperties)Z[X]=this;else Z[X]=this.opts();return Z.push(this),$.apply(this,Z)};return this._actionHandler=J,this}createOption($,J){return new Z1($,J)}_callParseArg($,J,E,X){try{return $.parseArg(J,E)}catch(Z){if(Z.code==="commander.invalidArgument"){let Y=`${X} ${Z.message}`;this.error(Y,{exitCode:Z.exitCode,code:Z.code})}throw Z}}_registerOption($){let J=$.short&&this._findOption($.short)||$.long&&this._findOption($.long);if(J){let E=$.long&&this._findOption($.long)?$.long:$.short;throw Error(`Cannot add option '${$.flags}'${this._name&&` to command '${this._name}'`} due to conflicting flag '${E}'
-  already used by option '${J.flags}'`)}this.options.push($)}_registerCommand($){let J=(X)=>{return[X.name()].concat(X.aliases())},E=J($).find((X)=>this._findCommand(X));if(E){let X=J(this._findCommand(E)).join("|"),Z=J($).join("|");throw Error(`cannot add command '${Z}' as already have command '${X}'`)}this.commands.push($)}addOption($){this._registerOption($);let J=$.name(),E=$.attributeName();if($.negate){let Z=$.long.replace(/^--no-/,"--");if(!this._findOption(Z))this.setOptionValueWithSource(E,$.defaultValue===void 0?!0:$.defaultValue,"default")}else if($.defaultValue!==void 0)this.setOptionValueWithSource(E,$.defaultValue,"default");let X=(Z,Y,z)=>{if(Z==null&&$.presetArg!==void 0)Z=$.presetArg;let Q=this.getOptionValue(E);if(Z!==null&&$.parseArg)Z=this._callParseArg($,Z,Q,Y);else if(Z!==null&&$.variadic)Z=$._concatValue(Z,Q);if(Z==null)if($.negate)Z=!1;else if($.isBoolean()||$.optional)Z=!0;else Z="";this.setOptionValueWithSource(E,Z,z)};if(this.on("option:"+J,(Z)=>{let Y=`error: option '${$.flags}' argument '${Z}' is invalid.`;X(Z,Y,"cli")}),$.envVar)this.on("optionEnv:"+J,(Z)=>{let Y=`error: option '${$.flags}' value '${Z}' from env '${$.envVar}' is invalid.`;X(Z,Y,"env")});return this}_optionEx($,J,E,X,Z){if(typeof J==="object"&&J instanceof Z1)throw Error("To add an Option object use addOption() instead of option() or requiredOption()");let Y=this.createOption(J,E);if(Y.makeOptionMandatory(!!$.mandatory),typeof X==="function")Y.default(Z).argParser(X);else if(X instanceof RegExp){let z=X;X=(Q,W)=>{let P=z.exec(Q);return P?P[0]:W},Y.default(Z).argParser(X)}else Y.default(X);return this.addOption(Y)}option($,J,E,X){return this._optionEx({},$,J,E,X)}requiredOption($,J,E,X){return this._optionEx({mandatory:!0},$,J,E,X)}combineFlagAndOptionalValue($=!0){return this._combineFlagAndOptionalValue=!!$,this}allowUnknownOption($=!0){return this._allowUnknownOption=!!$,this}allowExcessArguments($=!0){return this._allowExcessArguments=!!$,this}enablePositionalOptions($=!0){return this._enablePositionalOptions=!!$,this}passThroughOptions($=!0){return this._passThroughOptions=!!$,this._checkForBrokenPassThrough(),this}_checkForBrokenPassThrough(){if(this.parent&&this._passThroughOptions&&!this.parent._enablePositionalOptions)throw Error(`passThroughOptions cannot be used for '${this._name}' without turning on enablePositionalOptions for parent command(s)`)}storeOptionsAsProperties($=!0){if(this.options.length)throw Error("call .storeOptionsAsProperties() before adding options");if(Object.keys(this._optionValues).length)throw Error("call .storeOptionsAsProperties() before setting option values");return this._storeOptionsAsProperties=!!$,this}getOptionValue($){if(this._storeOptionsAsProperties)return this[$];return this._optionValues[$]}setOptionValue($,J){return this.setOptionValueWithSource($,J,void 0)}setOptionValueWithSource($,J,E){if(this._storeOptionsAsProperties)this[$]=J;else this._optionValues[$]=J;return this._optionValueSources[$]=E,this}getOptionValueSource($){return this._optionValueSources[$]}getOptionValueSourceWithGlobals($){let J;return this._getCommandAndAncestors().forEach((E)=>{if(E.getOptionValueSource($)!==void 0)J=E.getOptionValueSource($)}),J}_prepareUserArgs($,J){if($!==void 0&&!Array.isArray($))throw Error("first parameter to parse must be array or undefined");if(J=J||{},$===void 0&&J.from===void 0){if(j.versions?.electron)J.from="electron";let X=j.execArgv??[];if(X.includes("-e")||X.includes("--eval")||X.includes("-p")||X.includes("--print"))J.from="eval"}if($===void 0)$=j.argv;this.rawArgs=$.slice();let E;switch(J.from){case void 0:case"node":this._scriptPath=$[1],E=$.slice(2);break;case"electron":if(j.defaultApp)this._scriptPath=$[1],E=$.slice(2);else E=$.slice(1);break;case"user":E=$.slice(0);break;case"eval":E=$.slice(1);break;default:throw Error(`unexpected parse option { from: '${J.from}' }`)}if(!this._name&&this._scriptPath)this.nameFromFilename(this._scriptPath);return this._name=this._name||"program",E}parse($,J){let E=this._prepareUserArgs($,J);return this._parseCommand([],E),this}async parseAsync($,J){let E=this._prepareUserArgs($,J);return await this._parseCommand([],E),this}_executeSubCommand($,J){J=J.slice();let E=!1,X=[".js",".ts",".tsx",".mjs",".cjs"];function Z(P,U){let S=D.resolve(P,U);if(D0.existsSync(S))return S;if(X.includes(D.extname(U)))return;let B=X.find((K)=>D0.existsSync(`${S}${K}`));if(B)return`${S}${B}`;return}this._checkForMissingMandatoryOptions(),this._checkForConflictingOptions();let Y=$._executableFile||`${this._name}-${$._name}`,z=this._executableDir||"";if(this._scriptPath){let P;try{P=D0.realpathSync(this._scriptPath)}catch(U){P=this._scriptPath}z=D.resolve(D.dirname(P),z)}if(z){let P=Z(z,Y);if(!P&&!$._executableFile&&this._scriptPath){let U=D.basename(this._scriptPath,D.extname(this._scriptPath));if(U!==this._name)P=Z(z,`${U}-${$._name}`)}Y=P||Y}E=X.includes(D.extname(Y));let Q;if(j.platform!=="win32")if(E)J.unshift(Y),J=z1(j.execArgv).concat(J),Q=N0.spawn(j.argv[0],J,{stdio:"inherit"});else Q=N0.spawn(Y,J,{stdio:"inherit"});else J.unshift(Y),J=z1(j.execArgv).concat(J),Q=N0.spawn(j.execPath,J,{stdio:"inherit"});if(!Q.killed)["SIGUSR1","SIGUSR2","SIGTERM","SIGINT","SIGHUP"].forEach((U)=>{j.on(U,()=>{if(Q.killed===!1&&Q.exitCode===null)Q.kill(U)})});let W=this._exitCallback;Q.on("close",(P)=>{if(P=P??1,!W)j.exit(P);else W(new x0(P,"commander.executeSubCommandAsync","(close)"))}),Q.on("error",(P)=>{if(P.code==="ENOENT"){let U=z?`searched for local subcommand relative to directory '${z}'`:"no directory for search for local subcommand, use .executableDir() to supply a custom directory",S=`'${Y}' does not exist
 - if '${$._name}' is not meant to be an executable command, remove description parameter from '.command()' and use '.description()' instead
 - if the default executable name is not suitable, use the executableFile option to supply a custom name or path
 - ${U}`;throw Error(S)}else if(P.code==="EACCES")throw Error(`'${Y}' not executable`);if(!W)j.exit(1);else{let U=new x0(1,"commander.executeSubCommandAsync","(error)");U.nestedError=P,W(U)}}),this.runningCommand=Q}_dispatchSubcommand($,J,E){let X=this._findCommand($);if(!X)this.help({error:!0});let Z;return Z=this._chainOrCallSubCommandHook(Z,X,"preSubcommand"),Z=this._chainOrCall(Z,()=>{if(X._executableHandler)this._executeSubCommand(X,J.concat(E));else return X._parseCommand(J,E)}),Z}_dispatchHelpCommand($){if(!$)this.help();let J=this._findCommand($);if(J&&!J._executableHandler)J.help();return this._dispatchSubcommand($,[],[this._getHelpOption()?.long??this._getHelpOption()?.short??"--help"])}_checkNumberOfArguments(){if(this.registeredArguments.forEach(($,J)=>{if($.required&&this.args[J]==null)this.missingArgument($.name())}),this.registeredArguments.length>0&&this.registeredArguments[this.registeredArguments.length-1].variadic)return;if(this.args.length>this.registeredArguments.length)this._excessArguments(this.args)}_processArguments(){let $=(E,X,Z)=>{let Y=X;if(X!==null&&E.parseArg){let z=`error: command-argument value '${X}' is invalid for argument '${E.name()}'.`;Y=this._callParseArg(E,X,Z,z)}return Y};this._checkNumberOfArguments();let J=[];this.registeredArguments.forEach((E,X)=>{let Z=E.defaultValue;if(E.variadic){if(X<this.args.length){if(Z=this.args.slice(X),E.parseArg)Z=Z.reduce((Y,z)=>{return $(E,z,Y)},E.defaultValue)}else if(Z===void 0)Z=[]}else if(X<this.args.length){if(Z=this.args[X],E.parseArg)Z=$(E,Z,E.defaultValue)}J[X]=Z}),this.processedArgs=J}_chainOrCall($,J){if($&&$.then&&typeof $.then==="function")return $.then(()=>J());return J()}_chainOrCallHooks($,J){let E=$,X=[];if(this._getCommandAndAncestors().reverse().filter((Z)=>Z._lifeCycleHooks[J]!==void 0).forEach((Z)=>{Z._lifeCycleHooks[J].forEach((Y)=>{X.push({hookedCommand:Z,callback:Y})})}),J==="postAction")X.reverse();return X.forEach((Z)=>{E=this._chainOrCall(E,()=>{return Z.callback(Z.hookedCommand,this)})}),E}_chainOrCallSubCommandHook($,J,E){let X=$;if(this._lifeCycleHooks[E]!==void 0)this._lifeCycleHooks[E].forEach((Z)=>{X=this._chainOrCall(X,()=>{return Z(this,J)})});return X}_parseCommand($,J){let E=this.parseOptions(J);if(this._parseOptionsEnv(),this._parseOptionsImplied(),$=$.concat(E.operands),J=E.unknown,this.args=$.concat(J),$&&this._findCommand($[0]))return this._dispatchSubcommand($[0],$.slice(1),J);if(this._getHelpCommand()&&$[0]===this._getHelpCommand().name())return this._dispatchHelpCommand($[1]);if(this._defaultCommandName)return this._outputHelpIfRequested(J),this._dispatchSubcommand(this._defaultCommandName,$,J);if(this.commands.length&&this.args.length===0&&!this._actionHandler&&!this._defaultCommandName)this.help({error:!0});this._outputHelpIfRequested(E.unknown),this._checkForMissingMandatoryOptions(),this._checkForConflictingOptions();let X=()=>{if(E.unknown.length>0)this.unknownOption(E.unknown[0])},Z=`command:${this.name()}`;if(this._actionHandler){X(),this._processArguments();let Y;if(Y=this._chainOrCallHooks(Y,"preAction"),Y=this._chainOrCall(Y,()=>this._actionHandler(this.processedArgs)),this.parent)Y=this._chainOrCall(Y,()=>{this.parent.emit(Z,$,J)});return Y=this._chainOrCallHooks(Y,"postAction"),Y}if(this.parent&&this.parent.listenerCount(Z))X(),this._processArguments(),this.parent.emit(Z,$,J);else if($.length){if(this._findCommand("*"))return this._dispatchSubcommand("*",$,J);if(this.listenerCount("command:*"))this.emit("command:*",$,J);else if(this.commands.length)this.unknownCommand();else X(),this._processArguments()}else if(this.commands.length)X(),this.help({error:!0});else X(),this._processArguments()}_findCommand($){if(!$)return;return this.commands.find((J)=>J._name===$||J._aliases.includes($))}_findOption($){return this.options.find((J)=>J.is($))}_checkForMissingMandatoryOptions(){this._getCommandAndAncestors().forEach(($)=>{$.options.forEach((J)=>{if(J.mandatory&&$.getOptionValue(J.attributeName())===void 0)$.missingMandatoryOptionValue(J)})})}_checkForConflictingLocalOptions(){let $=this.options.filter((E)=>{let X=E.attributeName();if(this.getOptionValue(X)===void 0)return!1;return this.getOptionValueSource(X)!=="default"});$.filter((E)=>E.conflictsWith.length>0).forEach((E)=>{let X=$.find((Z)=>E.conflictsWith.includes(Z.attributeName()));if(X)this._conflictingOption(E,X)})}_checkForConflictingOptions(){this._getCommandAndAncestors().forEach(($)=>{$._checkForConflictingLocalOptions()})}parseOptions($){let J=[],E=[],X=J,Z=$.slice();function Y(Q){return Q.length>1&&Q[0]==="-"}let z=null;while(Z.length){let Q=Z.shift();if(Q==="--"){if(X===E)X.push(Q);X.push(...Z);break}if(z&&!Y(Q)){this.emit(`option:${z.name()}`,Q);continue}if(z=null,Y(Q)){let W=this._findOption(Q);if(W){if(W.required){let P=Z.shift();if(P===void 0)this.optionMissingArgument(W);this.emit(`option:${W.name()}`,P)}else if(W.optional){let P=null;if(Z.length>0&&!Y(Z[0]))P=Z.shift();this.emit(`option:${W.name()}`,P)}else this.emit(`option:${W.name()}`);z=W.variadic?W:null;continue}}if(Q.length>2&&Q[0]==="-"&&Q[1]!=="-"){let W=this._findOption(`-${Q[1]}`);if(W){if(W.required||W.optional&&this._combineFlagAndOptionalValue)this.emit(`option:${W.name()}`,Q.slice(2));else this.emit(`option:${W.name()}`),Z.unshift(`-${Q.slice(2)}`);continue}}if(/^--[^=]+=/.test(Q)){let W=Q.indexOf("="),P=this._findOption(Q.slice(0,W));if(P&&(P.required||P.optional)){this.emit(`option:${P.name()}`,Q.slice(W+1));continue}}if(Y(Q))X=E;if((this._enablePositionalOptions||this._passThroughOptions)&&J.length===0&&E.length===0){if(this._findCommand(Q)){if(J.push(Q),Z.length>0)E.push(...Z);break}else if(this._getHelpCommand()&&Q===this._getHelpCommand().name()){if(J.push(Q),Z.length>0)J.push(...Z);break}else if(this._defaultCommandName){if(E.push(Q),Z.length>0)E.push(...Z);break}}if(this._passThroughOptions){if(X.push(Q),Z.length>0)X.push(...Z);break}X.push(Q)}return{operands:J,unknown:E}}opts(){if(this._storeOptionsAsProperties){let $={},J=this.options.length;for(let E=0;E<J;E++){let X=this.options[E].attributeName();$[X]=X===this._versionOptionName?this._version:this[X]}return $}return this._optionValues}optsWithGlobals(){return this._getCommandAndAncestors().reduce(($,J)=>Object.assign($,J.opts()),{})}error($,J){if(this._outputConfiguration.outputError(`${$}
`,this._outputConfiguration.writeErr),typeof this._showHelpAfterError==="string")this._outputConfiguration.writeErr(`${this._showHelpAfterError}
`);else if(this._showHelpAfterError)this._outputConfiguration.writeErr(`
`),this.outputHelp({error:!0});let E=J||{},X=E.exitCode||1,Z=E.code||"commander.error";this._exit(X,Z,$)}_parseOptionsEnv(){this.options.forEach(($)=>{if($.envVar&&$.envVar in j.env){let J=$.attributeName();if(this.getOptionValue(J)===void 0||["default","config","env"].includes(this.getOptionValueSource(J)))if($.required||$.optional)this.emit(`optionEnv:${$.name()}`,j.env[$.envVar]);else this.emit(`optionEnv:${$.name()}`)}})}_parseOptionsImplied(){let $=new G2(this.options),J=(E)=>{return this.getOptionValue(E)!==void 0&&!["default","implied"].includes(this.getOptionValueSource(E))};this.options.filter((E)=>E.implied!==void 0&&J(E.attributeName())&&$.valueFromOption(this.getOptionValue(E.attributeName()),E)).forEach((E)=>{Object.keys(E.implied).filter((X)=>!J(X)).forEach((X)=>{this.setOptionValueWithSource(X,E.implied[X],"implied")})})}missingArgument($){let J=`error: missing required argument '${$}'`;this.error(J,{code:"commander.missingArgument"})}optionMissingArgument($){let J=`error: option '${$.flags}' argument missing`;this.error(J,{code:"commander.optionMissingArgument"})}missingMandatoryOptionValue($){let J=`error: required option '${$.flags}' not specified`;this.error(J,{code:"commander.missingMandatoryOptionValue"})}_conflictingOption($,J){let E=(Y)=>{let z=Y.attributeName(),Q=this.getOptionValue(z),W=this.options.find((U)=>U.negate&&z===U.attributeName()),P=this.options.find((U)=>!U.negate&&z===U.attributeName());if(W&&(W.presetArg===void 0&&Q===!1||W.presetArg!==void 0&&Q===W.presetArg))return W;return P||Y},X=(Y)=>{let z=E(Y),Q=z.attributeName();if(this.getOptionValueSource(Q)==="env")return`environment variable '${z.envVar}'`;return`option '${z.flags}'`},Z=`error: ${X($)} cannot be used with ${X(J)}`;this.error(Z,{code:"commander.conflictingOption"})}unknownOption($){if(this._allowUnknownOption)return;let J="";if($.startsWith("--")&&this._showSuggestionAfterError){let X=[],Z=this;do{let Y=Z.createHelp().visibleOptions(Z).filter((z)=>z.long).map((z)=>z.long);X=X.concat(Y),Z=Z.parent}while(Z&&!Z._enablePositionalOptions);J=Y1($,X)}let E=`error: unknown option '${$}'${J}`;this.error(E,{code:"commander.unknownOption"})}_excessArguments($){if(this._allowExcessArguments)return;let J=this.registeredArguments.length,E=J===1?"":"s",Z=`error: too many arguments${this.parent?` for '${this.name()}'`:""}. Expected ${J} argument${E} but got ${$.length}.`;this.error(Z,{code:"commander.excessArguments"})}unknownCommand(){let $=this.args[0],J="";if(this._showSuggestionAfterError){let X=[];this.createHelp().visibleCommands(this).forEach((Z)=>{if(X.push(Z.name()),Z.alias())X.push(Z.alias())}),J=Y1($,X)}let E=`error: unknown command '${$}'${J}`;this.error(E,{code:"commander.unknownCommand"})}version($,J,E){if($===void 0)return this._version;this._version=$,J=J||"-V, --version",E=E||"output the version number";let X=this.createOption(J,E);return this._versionOptionName=X.attributeName(),this._registerOption(X),this.on("option:"+X.name(),()=>{this._outputConfiguration.writeOut(`${$}
`),this._exit(0,"commander.version",$)}),this}description($,J){if($===void 0&&J===void 0)return this._description;if(this._description=$,J)this._argsDescription=J;return this}summary($){if($===void 0)return this._summary;return this._summary=$,this}alias($){if($===void 0)return this._aliases[0];let J=this;if(this.commands.length!==0&&this.commands[this.commands.length-1]._executableHandler)J=this.commands[this.commands.length-1];if($===J._name)throw Error("Command alias can't be the same as its name");let E=this.parent?._findCommand($);if(E){let X=[E.name()].concat(E.aliases()).join("|");throw Error(`cannot add alias '${$}' to command '${this.name()}' as already have command '${X}'`)}return J._aliases.push($),this}aliases($){if($===void 0)return this._aliases;return $.forEach((J)=>this.alias(J)),this}usage($){if($===void 0){if(this._usage)return this._usage;let J=this.registeredArguments.map((E)=>{return K2(E)});return[].concat(this.options.length||this._helpOption!==null?"[options]":[],this.commands.length?"[command]":[],this.registeredArguments.length?J:[]).join(" ")}return this._usage=$,this}name($){if($===void 0)return this._name;return this._name=$,this}nameFromFilename($){return this._name=D.basename($,D.extname($)),this}executableDir($){if($===void 0)return this._executableDir;return this._executableDir=$,this}helpInformation($){let J=this.createHelp();if(J.helpWidth===void 0)J.helpWidth=$&&$.error?this._outputConfiguration.getErrHelpWidth():this._outputConfiguration.getOutHelpWidth();return J.formatHelp(this,J)}_getHelpContext($){$=$||{};let J={error:!!$.error},E;if(J.error)E=(X)=>this._outputConfiguration.writeErr(X);else E=(X)=>this._outputConfiguration.writeOut(X);return J.write=$.write||E,J.command=this,J}outputHelp($){let J;if(typeof $==="function")J=$,$=void 0;let E=this._getHelpContext($);this._getCommandAndAncestors().reverse().forEach((Z)=>Z.emit("beforeAllHelp",E)),this.emit("beforeHelp",E);let X=this.helpInformation(E);if(J){if(X=J(X),typeof X!=="string"&&!Buffer.isBuffer(X))throw Error("outputHelp callback must return a string or a Buffer")}if(E.write(X),this._getHelpOption()?.long)this.emit(this._getHelpOption().long);this.emit("afterHelp",E),this._getCommandAndAncestors().forEach((Z)=>Z.emit("afterAllHelp",E))}helpOption($,J){if(typeof $==="boolean"){if($)this._helpOption=this._helpOption??void 0;else this._helpOption=null;return this}return $=$??"-h, --help",J=J??"display help for command",this._helpOption=this.createOption($,J),this}_getHelpOption(){if(this._helpOption===void 0)this.helpOption(void 0,void 0);return this._helpOption}addHelpOption($){return this._helpOption=$,this}help($){this.outputHelp($);let J=j.exitCode||0;if(J===0&&$&&typeof $!=="function"&&$.error)J=1;this._exit(J,"commander.help","(outputHelp)")}addHelpText($,J){let E=["beforeAll","before","after","afterAll"];if(!E.includes($))throw Error(`Unexpected value for position to addHelpText.
Expecting one of '${E.join("', '")}'`);let X=`${$}Help`;return this.on(X,(Z)=>{let Y;if(typeof J==="function")Y=J({error:Z.error,command:Z.command});else Y=J;if(Y)Z.write(`${Y}
`)}),this}_outputHelpIfRequested($){let J=this._getHelpOption();if(J&&$.find((X)=>J.is(X)))this.outputHelp(),this._exit(0,"commander.helpDisplayed","(outputHelp)")}}function z1($){return $.map((J)=>{if(!J.startsWith("--inspect"))return J;let E,X="127.0.0.1",Z="9229",Y;if((Y=J.match(/^(--inspect(-brk)?)$/))!==null)E=Y[1];else if((Y=J.match(/^(--inspect(-brk|-port)?)=([^:]+)$/))!==null)if(E=Y[1],/^\d+$/.test(Y[3]))Z=Y[3];else X=Y[3];else if((Y=J.match(/^(--inspect(-brk|-port)?)=([^:]+):(\d+)$/))!==null)E=Y[1],X=Y[3],Z=Y[4];if(E&&Z!=="0")return`${E}=${X}:${parseInt(Z)+1}`;return J})}L2.Command=A0});var S1=R((V2)=>{var{Argument:W1}=n(),{Command:O0}=Q1(),{CommanderError:j2,InvalidArgumentError:P1}=l(),{Help:T2}=q0(),{Option:U1}=f0();V2.program=new O0;V2.createCommand=($)=>new O0($);V2.createOption=($,J)=>new U1($,J);V2.createArgument=($,J)=>new W1($,J);V2.Command=O0;V2.Option=U1;V2.Argument=W1;V2.Help=T2;V2.CommanderError=j2;V2.InvalidArgumentError=P1;V2.InvalidOptionArgumentError=P1});var f=R((O2)=>{O2.getBooleanOption=($,J)=>{let E=!1;if(J in $&&typeof(E=$[J])!=="boolean")throw TypeError(`Expected the "${J}" option to be a boolean`);return E};O2.cppdb=Symbol();O2.inspect=Symbol.for("nodejs.util.inspect.custom")});var y0=R((G6,B1)=>{var w0={value:"SqliteError",writable:!0,enumerable:!1,configurable:!0};function w($,J){if(new.target!==w)return new w($,J);if(typeof J!=="string")throw TypeError("Expected second argument to be a string");Error.call(this,$),w0.value=""+$,Object.defineProperty(this,"message",w0),Error.captureStackTrace(this,w),this.code=J}Object.setPrototypeOf(w,Error);Object.setPrototypeOf(w.prototype,Error.prototype);Object.defineProperty(w.prototype,"name",w0);B1.exports=w});var L1=R((L6,G1)=>{var o=V("path").sep||"/";G1.exports=k2;function k2($){if(typeof $!="string"||$.length<=7||$.substring(0,7)!="file://")throw TypeError("must pass in a file:// URI to convert to a file path");var J=decodeURI($.substring(7)),E=J.indexOf("/"),X=J.substring(0,E),Z=J.substring(E+1);if(X=="localhost")X="";if(X)X=o+o+X;if(Z=Z.replace(/^(.+)\|/,"$1:"),o=="\\")Z=Z.replace(/\//g,"\\");if(/^.+\:/.test(Z));else Z=o+Z;return X+Z}});var V1=R(($0,T1)=>{var __filename="/home/mrkai/code/wasp/node_modules/bindings/bindings.js",C0=V("fs"),e=V("path"),b2=L1(),a=e.join,v2=e.dirname,R1=C0.accessSync&&function($){try{C0.accessSync($)}catch(J){return!1}return!0}||C0.existsSync||e.existsSync,j1={arrow:process.env.NODE_BINDINGS_ARROW||" \u2192 ",compiled:process.env.NODE_BINDINGS_COMPILED_DIR||"compiled",platform:process.platform,arch:process.arch,nodePreGyp:"node-v"+process.versions.modules+"-"+process.platform+"-"+process.arch,version:process.versions.node,bindings:"bindings.node",try:[["module_root","build","bindings"],["module_root","build","Debug","bindings"],["module_root","build","Release","bindings"],["module_root","out","Debug","bindings"],["module_root","Debug","bindings"],["module_root","out","Release","bindings"],["module_root","Release","bindings"],["module_root","build","default","bindings"],["module_root","compiled","version","platform","arch","bindings"],["module_root","addon-build","release","install-root","bindings"],["module_root","addon-build","debug","install-root","bindings"],["module_root","addon-build","default","install-root","bindings"],["module_root","lib","binding","nodePreGyp","bindings"]]};function h2($){if(typeof $=="string")$={bindings:$};else if(!$)$={};if(Object.keys(j1).map(function(W){if(!(W in $))$[W]=j1[W]}),!$.module_root)$.module_root=$0.getRoot($0.getFileName());if(e.extname($.bindings)!=".node")$.bindings+=".node";var J=typeof __webpack_require__==="function"?__non_webpack_require__:V,E=[],X=0,Z=$.try.length,Y,z,Q;for(;X<Z;X++){Y=a.apply(null,$.try[X].map(function(W){return $[W]||W})),E.push(Y);try{if(z=$.path?J.resolve(Y):J(Y),!$.path)z.path=Y;return z}catch(W){if(W.code!=="MODULE_NOT_FOUND"&&W.code!=="QUALIFIED_PATH_RESOLUTION_FAILED"&&!/not find/i.test(W.message))throw W}}throw Q=Error(`Could not locate the bindings file. Tried:
`+E.map(function(W){return $.arrow+W}).join(`
`)),Q.tries=E,Q}T1.exports=$0=h2;$0.getFileName=function(J){var{prepareStackTrace:E,stackTraceLimit:X}=Error,Z={},Y;Error.stackTraceLimit=10,Error.prepareStackTrace=function(Q,W){for(var P=0,U=W.length;P<U;P++)if(Y=W[P].getFileName(),Y!==__filename)if(J){if(Y!==J)return}else return},Error.captureStackTrace(Z),Z.stack,Error.prepareStackTrace=E,Error.stackTraceLimit=X;var z="file://";if(Y.indexOf(z)===0)Y=b2(Y);return Y};$0.getRoot=function(J){var E=v2(J),X;while(!0){if(E===".")E=process.cwd();if(R1(a(E,"package.json"))||R1(a(E,"node_modules")))return E;if(X===E)throw Error('Could not find module root given file: "'+J+'". Do you have a `package.json` file? ');X=E,E=a(E,"..")}}});var I1=R((g2)=>{var{cppdb:F}=f();g2.prepare=function(J){return this[F].prepare(J,this,!1)};g2.exec=function(J){return this[F].exec(J),this};g2.close=function(){return this[F].close(),this};g2.loadExtension=function(...J){return this[F].loadExtension(...J),this};g2.defaultSafeIntegers=function(...J){return this[F].defaultSafeIntegers(...J),this};g2.unsafeMode=function(...J){return this[F].unsafeMode(...J),this};g2.getters={name:{get:function(){return this[F].name},enumerable:!0},open:{get:function(){return this[F].open},enumerable:!0},inTransaction:{get:function(){return this[F].inTransaction},enumerable:!0},readonly:{get:function(){return this[F].readonly},enumerable:!0},memory:{get:function(){return this[F].memory},enumerable:!0}}});var H1=R((I6,_1)=>{var{cppdb:r2}=f(),M1=new WeakMap;_1.exports=function(J){if(typeof J!=="function")throw TypeError("Expected first argument to be a function");let E=this[r2],X=p2(E,this),{apply:Z}=Function.prototype,Y={default:{value:J0(Z,J,E,X.default)},deferred:{value:J0(Z,J,E,X.deferred)},immediate:{value:J0(Z,J,E,X.immediate)},exclusive:{value:J0(Z,J,E,X.exclusive)},database:{value:this,enumerable:!0}};return Object.defineProperties(Y.default.value,Y),Object.defineProperties(Y.deferred.value,Y),Object.defineProperties(Y.immediate.value,Y),Object.defineProperties(Y.exclusive.value,Y),Y.default.value};var p2=($,J)=>{let E=M1.get($);if(!E){let X={commit:$.prepare("COMMIT",J,!1),rollback:$.prepare("ROLLBACK",J,!1),savepoint:$.prepare("SAVEPOINT `\t_bs3.\t`",J,!1),release:$.prepare("RELEASE `\t_bs3.\t`",J,!1),rollbackTo:$.prepare("ROLLBACK TO `\t_bs3.\t`",J,!1)};M1.set($,E={default:Object.assign({begin:$.prepare("BEGIN",J,!1)},X),deferred:Object.assign({begin:$.prepare("BEGIN DEFERRED",J,!1)},X),immediate:Object.assign({begin:$.prepare("BEGIN IMMEDIATE",J,!1)},X),exclusive:Object.assign({begin:$.prepare("BEGIN EXCLUSIVE",J,!1)},X)})}return E},J0=($,J,E,{begin:X,commit:Z,rollback:Y,savepoint:z,release:Q,rollbackTo:W})=>function(){let U,S,B;if(E.inTransaction)U=z,S=Q,B=W;else U=X,S=Z,B=Y;U.run();try{let K=$.call(J,this,arguments);if(K&&typeof K.then==="function")throw TypeError("Transaction function cannot return a promise");return S.run(),K}catch(K){if(E.inTransaction){if(B.run(),B!==Y)S.run()}throw K}}});var q1=R((M6,F1)=>{var{getBooleanOption:t2,cppdb:n2}=f();F1.exports=function(J,E){if(E==null)E={};if(typeof J!=="string")throw TypeError("Expected first argument to be a string");if(typeof E!=="object")throw TypeError("Expected second argument to be an options object");let X=t2(E,"simple"),Z=this[n2].prepare(`PRAGMA ${J}`,this,!0);return X?Z.pluck().get():Z.all()}});var D1=R((_6,N1)=>{var o2=V("fs"),a2=V("path"),{promisify:e2}=V("util"),{cppdb:$5}=f(),f1=e2(o2.access);N1.exports=async function(J,E){if(E==null)E={};if(typeof J!=="string")throw TypeError("Expected first argument to be a string");if(typeof E!=="object")throw TypeError("Expected second argument to be an options object");J=J.trim();let X="attached"in E?E.attached:"main",Z="progress"in E?E.progress:null;if(!J)throw TypeError("Backup filename cannot be an empty string");if(J===":memory:")throw TypeError('Invalid backup filename ":memory:"');if(typeof X!=="string")throw TypeError('Expected the "attached" option to be a string');if(!X)throw TypeError('The "attached" option cannot be an empty string');if(Z!=null&&typeof Z!=="function")throw TypeError('Expected the "progress" option to be a function');await f1(a2.dirname(J)).catch(()=>{throw TypeError("Cannot save backup because the directory does not exist")});let Y=await f1(J).then(()=>!1,()=>!0);return J5(this[$5].backup(this,X,J,Y),Z||null)};var J5=($,J)=>{let E=0,X=!0;return new Promise((Z,Y)=>{setImmediate(function z(){try{let Q=$.transfer(E);if(!Q.remainingPages){$.close(),Z(Q);return}if(X)X=!1,E=100;if(J){let W=J(Q);if(W!==void 0)if(typeof W==="number"&&W===W)E=Math.max(0,Math.min(2147483647,Math.round(W)));else throw TypeError("Expected progress callback to return a number or undefined")}setImmediate(z)}catch(Q){$.close(),Y(Q)}})})}});var A1=R((H6,x1)=>{var{cppdb:E5}=f();x1.exports=function(J){if(J==null)J={};if(typeof J!=="object")throw TypeError("Expected first argument to be an options object");let E="attached"in J?J.attached:"main";if(typeof E!=="string")throw TypeError('Expected the "attached" option to be a string');if(!E)throw TypeError('The "attached" option cannot be an empty string');return this[E5].serialize(E)}});var w1=R((F6,O1)=>{var{getBooleanOption:E0,cppdb:X5}=f();O1.exports=function(J,E,X){if(E==null)E={};if(typeof E==="function")X=E,E={};if(typeof J!=="string")throw TypeError("Expected first argument to be a string");if(typeof X!=="function")throw TypeError("Expected last argument to be a function");if(typeof E!=="object")throw TypeError("Expected second argument to be an options object");if(!J)throw TypeError("User-defined function name cannot be an empty string");let Z="safeIntegers"in E?+E0(E,"safeIntegers"):2,Y=E0(E,"deterministic"),z=E0(E,"directOnly"),Q=E0(E,"varargs"),W=-1;if(!Q){if(W=X.length,!Number.isInteger(W)||W<0)throw TypeError("Expected function.length to be a positive integer");if(W>100)throw RangeError("User-defined functions cannot have more than 100 arguments")}return this[X5].function(X,J,W,Z,Y,z),this}});var k1=R((q6,C1)=>{var{getBooleanOption:X0,cppdb:Z5}=f();C1.exports=function(J,E){if(typeof J!=="string")throw TypeError("Expected first argument to be a string");if(typeof E!=="object"||E===null)throw TypeError("Expected second argument to be an options object");if(!J)throw TypeError("User-defined function name cannot be an empty string");let X="start"in E?E.start:null,Z=k0(E,"step",!0),Y=k0(E,"inverse",!1),z=k0(E,"result",!1),Q="safeIntegers"in E?+X0(E,"safeIntegers"):2,W=X0(E,"deterministic"),P=X0(E,"directOnly"),U=X0(E,"varargs"),S=-1;if(!U){if(S=Math.max(y1(Z),Y?y1(Y):0),S>0)S-=1;if(S>100)throw RangeError("User-defined functions cannot have more than 100 arguments")}return this[Z5].aggregate(X,Z,Y,z,J,S,Q,W,P),this};var k0=($,J,E)=>{let X=J in $?$[J]:null;if(typeof X==="function")return X;if(X!=null)throw TypeError(`Expected the "${J}" option to be a function`);if(E)throw TypeError(`Missing required option "${J}"`);return null},y1=({length:$})=>{if(Number.isInteger($)&&$>=0)return $;throw TypeError("Expected function.length to be a positive integer")}});var g1=R((f6,h1)=>{var{cppdb:Y5}=f();h1.exports=function(J,E){if(typeof J!=="string")throw TypeError("Expected first argument to be a string");if(!J)throw TypeError("Virtual table module name cannot be an empty string");let X=!1;if(typeof E==="object"&&E!==null)X=!0,E=B5(v1(E,"used",J));else{if(typeof E!=="function")throw TypeError("Expected second argument to be a function or a table definition object");E=z5(E)}return this[Y5].table(E,J,X),this};function z5($){return function(E,X,Z,...Y){let z={module:E,database:X,table:Z},Q=S5.call($,z,Y);if(typeof Q!=="object"||Q===null)throw TypeError(`Virtual table module "${E}" did not return a table definition object`);return v1(Q,"returned",E)}}function v1($,J,E){if(!s.call($,"rows"))throw TypeError(`Virtual table module "${E}" ${J} a table definition without a "rows" property`);if(!s.call($,"columns"))throw TypeError(`Virtual table module "${E}" ${J} a table definition without a "columns" property`);let X=$.rows;if(typeof X!=="function"||Object.getPrototypeOf(X)!==K5)throw TypeError(`Virtual table module "${E}" ${J} a table definition with an invalid "rows" property (should be a generator function)`);let Z=$.columns;if(!Array.isArray(Z)||!(Z=[...Z]).every((P)=>typeof P==="string"))throw TypeError(`Virtual table module "${E}" ${J} a table definition with an invalid "columns" property (should be an array of strings)`);if(Z.length!==new Set(Z).size)throw TypeError(`Virtual table module "${E}" ${J} a table definition with duplicate column names`);if(!Z.length)throw RangeError(`Virtual table module "${E}" ${J} a table definition with zero columns`);let Y;if(s.call($,"parameters")){if(Y=$.parameters,!Array.isArray(Y)||!(Y=[...Y]).every((P)=>typeof P==="string"))throw TypeError(`Virtual table module "${E}" ${J} a table definition with an invalid "parameters" property (should be an array of strings)`)}else Y=U5(X);if(Y.length!==new Set(Y).size)throw TypeError(`Virtual table module "${E}" ${J} a table definition with duplicate parameter names`);if(Y.length>32)throw RangeError(`Virtual table module "${E}" ${J} a table definition with more than the maximum number of 32 parameters`);for(let P of Y)if(Z.includes(P))throw TypeError(`Virtual table module "${E}" ${J} a table definition with column "${P}" which was ambiguously defined as both a column and parameter`);let z=2;if(s.call($,"safeIntegers")){let P=$.safeIntegers;if(typeof P!=="boolean")throw TypeError(`Virtual table module "${E}" ${J} a table definition with an invalid "safeIntegers" property (should be a boolean)`);z=+P}let Q=!1;if(s.call($,"directOnly")){if(Q=$.directOnly,typeof Q!=="boolean")throw TypeError(`Virtual table module "${E}" ${J} a table definition with an invalid "directOnly" property (should be a boolean)`)}return[`CREATE TABLE x(${[...Y.map(b1).map((P)=>`${P} HIDDEN`),...Z.map(b1)].join(", ")});`,Q5(X,new Map(Z.map((P,U)=>[P,Y.length+U])),E),Y,z,Q]}function Q5($,J,E){return function*(...Z){let Y=Z.map((z)=>Buffer.isBuffer(z)?Buffer.from(z):z);for(let z=0;z<J.size;++z)Y.push(null);for(let z of $(...Z))if(Array.isArray(z))W5(z,Y,J.size,E),yield Y;else if(typeof z==="object"&&z!==null)P5(z,Y,J,E),yield Y;else throw TypeError(`Virtual table module "${E}" yielded something that isn't a valid row object`)}}function W5($,J,E,X){if($.length!==E)throw TypeError(`Virtual table module "${X}" yielded a row with an incorrect number of columns`);let Z=J.length-E;for(let Y=0;Y<E;++Y)J[Y+Z]=$[Y]}function P5($,J,E,X){let Z=0;for(let Y of Object.keys($)){let z=E.get(Y);if(z===void 0)throw TypeError(`Virtual table module "${X}" yielded a row with an undeclared column "${Y}"`);J[z]=$[Y],Z+=1}if(Z!==E.size)throw TypeError(`Virtual table module "${X}" yielded a row with missing columns`)}function U5({length:$}){if(!Number.isInteger($)||$<0)throw TypeError("Expected function.length to be a positive integer");let J=[];for(let E=0;E<$;++E)J.push(`$${E+1}`);return J}var{hasOwnProperty:s}=Object.prototype,{apply:S5}=Function.prototype,K5=Object.getPrototypeOf(function*(){}),b1=($)=>`"${$.replace(/"/g,'""')}"`,B5=($)=>()=>$});var c1=R((N6,u1)=>{var G5=function(){};u1.exports=function(J,E){return Object.assign(new G5,this)}});var i1=R((D6,m1)=>{var L5=V("fs"),l1=V("path"),Z0=f(),R5=y0(),s1;function I($,J){if(new.target==null)return new I($,J);let E;if(Buffer.isBuffer($))E=$,$=":memory:";if($==null)$="";if(J==null)J={};if(typeof $!=="string")throw TypeError("Expected first argument to be a string");if(typeof J!=="object")throw TypeError("Expected second argument to be an options object");if("readOnly"in J)throw TypeError('Misspelled option "readOnly" should be "readonly"');if("memory"in J)throw TypeError('Option "memory" was removed in v7.0.0 (use ":memory:" filename instead)');let X=$.trim(),Z=X===""||X===":memory:",Y=Z0.getBooleanOption(J,"readonly"),z=Z0.getBooleanOption(J,"fileMustExist"),Q="timeout"in J?J.timeout:5000,W="verbose"in J?J.verbose:null,P="nativeBinding"in J?J.nativeBinding:null;if(Y&&Z&&!E)throw TypeError("In-memory/temporary databases cannot be readonly");if(!Number.isInteger(Q)||Q<0)throw TypeError('Expected the "timeout" option to be a positive integer');if(Q>2147483647)throw RangeError('Option "timeout" cannot be greater than 2147483647');if(W!=null&&typeof W!=="function")throw TypeError('Expected the "verbose" option to be a function');if(P!=null&&typeof P!=="string"&&typeof P!=="object")throw TypeError('Expected the "nativeBinding" option to be a string or addon object');let U;if(P==null)U=s1||(s1=V1()("better_sqlite3.node"));else if(typeof P==="string")U=(typeof __non_webpack_require__==="function"?__non_webpack_require__:V)(l1.resolve(P).replace(/(\.node)?$/,".node"));else U=P;if(!U.isInitialized)U.setErrorConstructor(R5),U.isInitialized=!0;if(!Z&&!X.startsWith("file:")&&!L5.existsSync(l1.dirname(X)))throw TypeError("Cannot open database because the directory does not exist");Object.defineProperties(this,{[Z0.cppdb]:{value:new U.Database(X,$,Z,Y,z,Q,W||null,E||null)},...y.getters})}var y=I1();I.prototype.prepare=y.prepare;I.prototype.transaction=H1();I.prototype.pragma=q1();I.prototype.backup=D1();I.prototype.serialize=A1();I.prototype.function=w1();I.prototype.aggregate=k1();I.prototype.table=g1();I.prototype.loadExtension=y.loadExtension;I.prototype.exec=y.exec;I.prototype.close=y.close;I.prototype.defaultSafeIntegers=y.defaultSafeIntegers;I.prototype.unsafeMode=y.unsafeMode;I.prototype[Z0.inspect]=c1();m1.exports=I});var d1=R((A6,b0)=>{b0.exports=i1();b0.exports.SqliteError=y0()});var K1=l$(S1(),1),{program:H,createCommand:E6,createArgument:X6,createOption:Z6,CommanderError:Y6,InvalidArgumentError:z6,InvalidOptionArgumentError:Q6,Command:W6,Argument:P6,Option:U6,Help:S6}=K1.default;import{createRequire as s5}from"module";var j5=typeof globalThis.Bun<"u",Y0;if(j5)Y0=($)=>{let{Database:J}=V("bun:sqlite"),E=new J($);return{exec:(X)=>E.exec(X),prepare:(X)=>{let Z=E.prepare(X);return{run:(...Y)=>Z.run(...Y),get:(...Y)=>Z.get(...Y),all:(...Y)=>Z.all(...Y)}},close:()=>E.close()}};else Y0=($)=>{let E=new(d1())($);return{exec:(X)=>E.exec(X),prepare:(X)=>{let Z=E.prepare(X);return{run:(...Y)=>Z.run(...Y),get:(...Y)=>Z.get(...Y),all:(...Y)=>Z.all(...Y)}},close:()=>E.close()}};import{existsSync as r1,mkdirSync as T5}from"fs";import{homedir as V5}from"os";import{join as p1}from"path";var z0=process.env.WASP_DATA_DIR||p1(V5(),".wasp"),t1=p1(z0,"wasp.db"),C=null;function v0(){return z0}function h(){return r1(t1)}function _(){if(!C){if(!r1(z0))T5(z0,{recursive:!0});C=Y0(t1),C.exec("PRAGMA journal_mode = WAL")}return C}function Q0(){_().exec(`
    CREATE TABLE IF NOT EXISTS contacts (
      id INTEGER PRIMARY KEY AUTOINCREMENT,
      identifier TEXT NOT NULL,
      platform TEXT NOT NULL DEFAULT 'whatsapp',
      name TEXT,
      trust TEXT NOT NULL DEFAULT 'trusted',
      added_at TEXT NOT NULL DEFAULT (datetime('now')),
      notes TEXT,
      UNIQUE(identifier, platform)
    );

    CREATE TABLE IF NOT EXISTS audit_log (
      id INTEGER PRIMARY KEY AUTOINCREMENT,
      timestamp TEXT NOT NULL DEFAULT (datetime('now')),
      identifier TEXT NOT NULL,
      platform TEXT NOT NULL,
      decision TEXT NOT NULL,
      reason TEXT
    );

    CREATE TABLE IF NOT EXISTS quarantine (
      id INTEGER PRIMARY KEY AUTOINCREMENT,
      identifier TEXT NOT NULL,
      platform TEXT NOT NULL DEFAULT 'whatsapp',
      message_preview TEXT,
      full_message TEXT,
      timestamp TEXT NOT NULL DEFAULT (datetime('now')),
      reviewed INTEGER NOT NULL DEFAULT 0
    );

    CREATE INDEX IF NOT EXISTS idx_contacts_identifier ON contacts(identifier);
    CREATE INDEX IF NOT EXISTS idx_audit_timestamp ON audit_log(timestamp);
    CREATE INDEX IF NOT EXISTS idx_quarantine_identifier ON quarantine(identifier);
    CREATE INDEX IF NOT EXISTS idx_quarantine_reviewed ON quarantine(reviewed);
  `)}function h0(){if(C)C.close(),C=null}function n1($=!1){if(h()&&!$){console.log("wasp is already initialized."),console.log(`Data directory: ${v0()}`),console.log("Use --force to reinitialize.");return}Q0(),console.log("wasp initialized successfully."),console.log(`Data directory: ${v0()}`),console.log(""),console.log("Next steps:"),console.log('  wasp add "+440123456789" --name "Your Name" --trust sovereign'),console.log("  wasp list"),console.log("  wasp serve")}function g0($){return{id:$.id,identifier:$.identifier,platform:$.platform,name:$.name,trust:$.trust,addedAt:$.added_at,notes:$.notes}}function k($,J="whatsapp",E="trusted",X,Z){let Y=_();Y.prepare(`
    INSERT INTO contacts (identifier, platform, trust, name, notes)
    VALUES (?, ?, ?, ?, ?)
    ON CONFLICT(identifier, platform) DO UPDATE SET
      trust = excluded.trust,
      name = COALESCE(excluded.name, contacts.name),
      notes = COALESCE(excluded.notes, contacts.notes)
  `).run($,J,E,X||null,Z||null);let Q=Y.prepare("SELECT * FROM contacts WHERE identifier = ? AND platform = ?").get($,J);if(!Q)throw Error(`Failed to retrieve contact after insert: ${$}`);return g0(Q)}function W0($,J="whatsapp"){return _().prepare("DELETE FROM contacts WHERE identifier = ? AND platform = ?").run($,J).changes>0}function I5($,J="whatsapp"){let Z=_().prepare("SELECT * FROM contacts WHERE identifier = ? AND platform = ?").get($,J);if(!Z)return null;return g0(Z)}function P0($,J){let E=_(),X="SELECT * FROM contacts WHERE 1=1",Z=[];if($)X+=" AND platform = ?",Z.push($);if(J)X+=" AND trust = ?",Z.push(J);return X+=" ORDER BY added_at DESC",E.prepare(X).all(...Z).map(g0)}function U0($,J="whatsapp"){let E=I5($,J);if(!E)return{allowed:!1,trust:null,name:null,reason:"Contact not in whitelist"};if(E.trust==="limited")return{allowed:!0,trust:"limited",name:E.name,reason:"Limited trust - agent may view but should not act"};return{allowed:!0,trust:E.trust,name:E.name,reason:"Contact is trusted"}}function o1($,J){let E=k($,J.platform||"whatsapp",J.trust||"trusted",J.name,J.notes);if(console.log("Contact added/updated:"),console.log(`  Identifier: ${E.identifier}`),console.log(`  Platform:   ${E.platform}`),console.log(`  Trust:      ${E.trust}`),E.name)console.log(`  Name:       ${E.name}`);if(E.notes)console.log(`  Notes:      ${E.notes}`)}function a1($,J="whatsapp"){if(W0($,J))console.log(`Removed: ${$} (${J})`);else console.log(`Not found: ${$} (${J})`)}function e1($){let J=P0($.platform,$.trust);if(J.length===0){console.log("No contacts found.");return}if($.json){console.log(JSON.stringify(J,null,2));return}console.log(`Found ${J.length} contact(s):
`);for(let E of J){let X=E.name?` (${E.name})`:"";if(console.log(`  ${E.identifier}${X}`),console.log(`    Platform: ${E.platform} | Trust: ${E.trust}`),E.notes)console.log(`    Notes: ${E.notes}`);console.log("")}}function M5($){return{id:$.id,timestamp:$.timestamp,identifier:$.identifier,platform:$.platform,decision:$.decision,reason:$.reason||""}}function S0($,J,E,X){_().prepare(`
    INSERT INTO audit_log (identifier, platform, decision, reason)
    VALUES (?, ?, ?, ?)
  `).run($,J,E,X)}function g($){let J=_(),E="SELECT * FROM audit_log WHERE 1=1",X=[];if($.decision)E+=" AND decision = ?",X.push($.decision);if($.since)E+=" AND timestamp >= ?",X.push($.since);if(E+=" ORDER BY timestamp DESC",$.limit)E+=" LIMIT ?",X.push($.limit);return J.prepare(E).all(...X).map(M5)}function $$($,J){let E=J.platform||"whatsapp",X=U0($,E),Z=!X.allowed?"deny":X.trust==="limited"?"limited":"allow";if(S0($,E,Z,X.reason),J.json){console.log(JSON.stringify(X)),process.exit(X.allowed?0:1);return}if(J.quiet){process.exit(X.allowed?0:1);return}if(X.allowed){let Y=X.name?` (${X.name})`:"";if(console.log(`ALLOWED: ${$}${Y}`),console.log(`  Trust level: ${X.trust}`),X.trust==="limited")console.log("  Note: Limited trust - agent may view but should not act")}else console.log(`DENIED: ${$}`),console.log(`  Reason: ${X.reason}`);process.exit(X.allowed?0:1)}function J$($){let J=g({limit:$.limit||50,decision:$.denied?"deny":void 0});if(J.length===0){console.log("No audit entries found.");return}if($.json){console.log(JSON.stringify(J,null,2));return}console.log(`Last ${J.length} audit entries:
`);for(let E of J){let X=E.decision==="allow"?"\u2713":E.decision==="limited"?"~":"\u2717";console.log(`  ${X} ${E.timestamp} | ${E.identifier} (${E.platform})`),console.log(`    Decision: ${E.decision} - ${E.reason}`),console.log("")}}var u0=($,J,E)=>{return(X,Z)=>{let Y=-1;return z(0);async function z(Q){if(Q<=Y)throw Error("next() called multiple times");Y=Q;let W,P=!1,U;if($[Q])U=$[Q][0][0],X.req.routeIndex=Q;else U=Q===$.length&&Z||void 0;if(U)try{W=await U(X,()=>z(Q+1))}catch(S){if(S instanceof Error&&J)X.error=S,W=await J(S,X),P=!0;else throw S}else if(X.finalized===!1&&E)W=await E(X);if(W&&(X.finalized===!1||P))X.res=W;return X}}};var E$=Symbol();var X$=async($,J=Object.create(null))=>{let{all:E=!1,dot:X=!1}=J,Y=($ instanceof K0?$.raw.headers:$.headers).get("Content-Type");if(Y?.startsWith("multipart/form-data")||Y?.startsWith("application/x-www-form-urlencoded"))return _5($,{all:E,dot:X});return{}};async function _5($,J){let E=await $.formData();if(E)return H5(E,J);return{}}function H5($,J){let E=Object.create(null);if($.forEach((X,Z)=>{if(!(J.all||Z.endsWith("[]")))E[Z]=X;else F5(E,Z,X)}),J.dot)Object.entries(E).forEach(([X,Z])=>{if(X.includes("."))q5(E,X,Z),delete E[X]});return E}var F5=($,J,E)=>{if($[J]!==void 0)if(Array.isArray($[J]))$[J].push(E);else $[J]=[$[J],E];else if(!J.endsWith("[]"))$[J]=E;else $[J]=[E]},q5=($,J,E)=>{let X=$,Z=J.split(".");Z.forEach((Y,z)=>{if(z===Z.length-1)X[Y]=E;else{if(!X[Y]||typeof X[Y]!=="object"||Array.isArray(X[Y])||X[Y]instanceof File)X[Y]=Object.create(null);X=X[Y]}})};var l0=($)=>{let J=$.split("/");if(J[0]==="")J.shift();return J},Z$=($)=>{let{groups:J,path:E}=f5($),X=l0(E);return N5(X,J)},f5=($)=>{let J=[];return $=$.replace(/\{[^}]+\}/g,(E,X)=>{let Z=`@${X}`;return J.push([Z,E]),Z}),{groups:J,path:$}},N5=($,J)=>{for(let E=J.length-1;E>=0;E--){let[X]=J[E];for(let Z=$.length-1;Z>=0;Z--)if($[Z].includes(X)){$[Z]=$[Z].replace(X,J[E][1]);break}}return $},B0={},Y$=($,J)=>{if($==="*")return"*";let E=$.match(/^\:([^\{\}]+)(?:\{(.+)\})?$/);if(E){let X=`${$}#${J}`;if(!B0[X])if(E[2])B0[X]=J&&J[0]!==":"&&J[0]!=="*"?[X,E[1],new RegExp(`^${E[2]}(?=/${J})`)]:[$,E[1],new RegExp(`^${E[2]}$`)];else B0[X]=[$,E[1],!0];return B0[X]}return null},G0=($,J)=>{try{return J($)}catch{return $.replace(/(?:%[0-9A-Fa-f]{2})+/g,(E)=>{try{return J(E)}catch{return E}})}},D5=($)=>G0($,decodeURI),s0=($)=>{let J=$.url,E=J.indexOf("/",J.indexOf(":")+4),X=E;for(;X<J.length;X++){let Z=J.charCodeAt(X);if(Z===37){let Y=J.indexOf("?",X),z=J.slice(E,Y===-1?void 0:Y);return D5(z.includes("%25")?z.replace(/%25/g,"%2525"):z)}else if(Z===63)break}return J.slice(E,X)};var z$=($)=>{let J=s0($);return J.length>1&&J.at(-1)==="/"?J.slice(0,-1):J},b=($,J,...E)=>{if(E.length)J=b(J,...E);return`${$?.[0]==="/"?"":"/"}${$}${J==="/"?"":`${$?.at(-1)==="/"?"":"/"}${J?.[0]==="/"?J.slice(1):J}`}`},L0=($)=>{if($.charCodeAt($.length-1)!==63||!$.includes(":"))return null;let J=$.split("/"),E=[],X="";return J.forEach((Z)=>{if(Z!==""&&!/\:/.test(Z))X+="/"+Z;else if(/\:/.test(Z))if(/\?/.test(Z)){if(E.length===0&&X==="")E.push("/");else E.push(X);let Y=Z.replace("?","");X+="/"+Y,E.push(X)}else X+="/"+Z}),E.filter((Z,Y,z)=>z.indexOf(Z)===Y)},c0=($)=>{if(!/[%+]/.test($))return $;if($.indexOf("+")!==-1)$=$.replace(/\+/g," ");return $.indexOf("%")!==-1?G0($,m0):$},Q$=($,J,E)=>{let X;if(!E&&J&&!/[%+]/.test(J)){let z=$.indexOf("?",8);if(z===-1)return;if(!$.startsWith(J,z+1))z=$.indexOf(`&${J}`,z+1);while(z!==-1){let Q=$.charCodeAt(z+J.length+1);if(Q===61){let W=z+J.length+2,P=$.indexOf("&",W);return c0($.slice(W,P===-1?void 0:P))}else if(Q==38||isNaN(Q))return"";z=$.indexOf(`&${J}`,z+1)}if(X=/[%+]/.test($),!X)return}let Z={};X??=/[%+]/.test($);let Y=$.indexOf("?",8);while(Y!==-1){let z=$.indexOf("&",Y+1),Q=$.indexOf("=",Y);if(Q>z&&z!==-1)Q=-1;let W=$.slice(Y+1,Q===-1?z===-1?void 0:z:Q);if(X)W=c0(W);if(Y=z,W==="")continue;let P;if(Q===-1)P="";else if(P=$.slice(Q+1,z===-1?void 0:z),X)P=c0(P);if(E){if(!(Z[W]&&Array.isArray(Z[W])))Z[W]=[];Z[W].push(P)}else Z[W]??=P}return J?Z[J]:Z},W$=Q$,P$=($,J)=>{return Q$($,J,!0)},m0=decodeURIComponent;var U$=($)=>G0($,m0),K0=class{raw;#$;#J;routeIndex=0;path;bodyCache={};constructor($,J="/",E=[[]]){this.raw=$,this.path=J,this.#J=E,this.#$={}}param($){return $?this.#E($):this.#Y()}#E($){let J=this.#J[0][this.routeIndex][1][$],E=this.#Z(J);return E&&/\%/.test(E)?U$(E):E}#Y(){let $={},J=Object.keys(this.#J[0][this.routeIndex][1]);for(let E of J){let X=this.#Z(this.#J[0][this.routeIndex][1][E]);if(X!==void 0)$[E]=/\%/.test(X)?U$(X):X}return $}#Z($){return this.#J[1]?this.#J[1][$]:$}query($){return W$(this.url,$)}queries($){return P$(this.url,$)}header($){if($)return this.raw.headers.get($)??void 0;let J={};return this.raw.headers.forEach((E,X)=>{J[X]=E}),J}async parseBody($){return this.bodyCache.parsedBody??=await X$(this,$)}#X=($)=>{let{bodyCache:J,raw:E}=this,X=J[$];if(X)return X;let Z=Object.keys(J)[0];if(Z)return J[Z].then((Y)=>{if(Z==="json")Y=JSON.stringify(Y);return new Response(Y)[$]()});return J[$]=E[$]()};json(){return this.#X("text").then(($)=>JSON.parse($))}text(){return this.#X("text")}arrayBuffer(){return this.#X("arrayBuffer")}blob(){return this.#X("blob")}formData(){return this.#X("formData")}addValidatedData($,J){this.#$[$]=J}valid($){return this.#$[$]}get url(){return this.raw.url}get method(){return this.raw.method}get[E$](){return this.#J}get matchedRoutes(){return this.#J[0].map(([[,$]])=>$)}get routePath(){return this.#J[0].map(([[,$]])=>$)[this.routeIndex].path}};var S$={Stringify:1,BeforeStream:2,Stream:3},x5=($,J)=>{let E=new String($);return E.isEscaped=!0,E.callbacks=J,E};var i0=async($,J,E,X,Z)=>{if(typeof $==="object"&&!($ instanceof String)){if(!($ instanceof Promise))$=$.toString();if($ instanceof Promise)$=await $}let Y=$.callbacks;if(!Y?.length)return Promise.resolve($);if(Z)Z[0]+=$;else Z=[$];let z=Promise.all(Y.map((Q)=>Q({phase:J,buffer:Z,context:X}))).then((Q)=>Promise.all(Q.filter(Boolean).map((W)=>i0(W,J,!1,X,Z))).then(()=>Z[0]));if(E)return x5(await z,Y);else return z};var A5="text/plain; charset=UTF-8",d0=($,J)=>{return{"Content-Type":$,...J}},K$=class{#$;#J;env={};#E;finalized=!1;error;#Y;#Z;#X;#U;#W;#P;#Q;#S;#K;constructor($,J){if(this.#$=$,J)this.#Z=J.executionCtx,this.env=J.env,this.#P=J.notFoundHandler,this.#K=J.path,this.#S=J.matchResult}get req(){return this.#J??=new K0(this.#$,this.#K,this.#S),this.#J}get event(){if(this.#Z&&"respondWith"in this.#Z)return this.#Z;else throw Error("This context has no FetchEvent")}get executionCtx(){if(this.#Z)return this.#Z;else throw Error("This context has no ExecutionContext")}get res(){return this.#X||=new Response(null,{headers:this.#Q??=new Headers})}set res($){if(this.#X&&$){$=new Response($.body,$);for(let[J,E]of this.#X.headers.entries()){if(J==="content-type")continue;if(J==="set-cookie"){let X=this.#X.headers.getSetCookie();$.headers.delete("set-cookie");for(let Z of X)$.headers.append("set-cookie",Z)}else $.headers.set(J,E)}}this.#X=$,this.finalized=!0}render=(...$)=>{return this.#W??=(J)=>this.html(J),this.#W(...$)};setLayout=($)=>this.#U=$;getLayout=()=>this.#U;setRenderer=($)=>{this.#W=$};header=($,J,E)=>{if(this.finalized)this.#X=new Response(this.#X.body,this.#X);let X=this.#X?this.#X.headers:this.#Q??=new Headers;if(J===void 0)X.delete($);else if(E?.append)X.append($,J);else X.set($,J)};status=($)=>{this.#Y=$};set=($,J)=>{this.#E??=new Map,this.#E.set($,J)};get=($)=>{return this.#E?this.#E.get($):void 0};get var(){if(!this.#E)return{};return Object.fromEntries(this.#E)}#z($,J,E){let X=this.#X?new Headers(this.#X.headers):this.#Q??new Headers;if(typeof J==="object"&&"headers"in J){let Y=J.headers instanceof Headers?J.headers:new Headers(J.headers);for(let[z,Q]of Y)if(z.toLowerCase()==="set-cookie")X.append(z,Q);else X.set(z,Q)}if(E)for(let[Y,z]of Object.entries(E))if(typeof z==="string")X.set(Y,z);else{X.delete(Y);for(let Q of z)X.append(Y,Q)}let Z=typeof J==="number"?J:J?.status??this.#Y;return new Response($,{status:Z,headers:X})}newResponse=(...$)=>this.#z(...$);body=($,J,E)=>this.#z($,J,E);text=($,J,E)=>{return!this.#Q&&!this.#Y&&!J&&!E&&!this.finalized?new Response($):this.#z($,J,d0(A5,E))};json=($,J,E)=>{return this.#z(JSON.stringify($),J,d0("application/json",E))};html=($,J,E)=>{let X=(Z)=>this.#z(Z,J,d0("text/html; charset=UTF-8",E));return typeof $==="object"?i0($,S$.Stringify,!1,{}).then(X):X($)};redirect=($,J)=>{let E=String($);return this.header("Location",!/[^\x00-\xFF]/.test(E)?E:encodeURI(E)),this.newResponse(null,J??302)};notFound=()=>{return this.#P??=()=>new Response,this.#P(this)}};var G="ALL",B$="all",G$=["get","post","put","delete","options","patch"],R0="Can not add a route since the matcher is already built.",j0=class extends Error{};var L$="__COMPOSED_HANDLER";var O5=($)=>{return $.text("404 Not Found",404)},R$=($,J)=>{if("getResponse"in $){let E=$.getResponse();return J.newResponse(E.body,E)}return console.error($),J.text("Internal Server Error",500)},j$=class ${get;post;put;delete;options;patch;all;on;use;router;getPath;_basePath="/";#$="/";routes=[];constructor(J={}){[...G$,B$].forEach((Y)=>{this[Y]=(z,...Q)=>{if(typeof z==="string")this.#$=z;else this.#Y(Y,this.#$,z);return Q.forEach((W)=>{this.#Y(Y,this.#$,W)}),this}}),this.on=(Y,z,...Q)=>{for(let W of[z].flat()){this.#$=W;for(let P of[Y].flat())Q.map((U)=>{this.#Y(P.toUpperCase(),this.#$,U)})}return this},this.use=(Y,...z)=>{if(typeof Y==="string")this.#$=Y;else this.#$="*",z.unshift(Y);return z.forEach((Q)=>{this.#Y(G,this.#$,Q)}),this};let{strict:X,...Z}=J;Object.assign(this,Z),this.getPath=X??!0?J.getPath??s0:z$}#J(){let J=new $({router:this.router,getPath:this.getPath});return J.errorHandler=this.errorHandler,J.#E=this.#E,J.routes=this.routes,J}#E=O5;errorHandler=R$;route(J,E){let X=this.basePath(J);return E.routes.map((Z)=>{let Y;if(E.errorHandler===R$)Y=Z.handler;else Y=async(z,Q)=>(await u0([],E.errorHandler)(z,()=>Z.handler(z,Q))).res,Y[L$]=Z.handler;X.#Y(Z.method,Z.path,Y)}),this}basePath(J){let E=this.#J();return E._basePath=b(this._basePath,J),E}onError=(J)=>{return this.errorHandler=J,this};notFound=(J)=>{return this.#E=J,this};mount(J,E,X){let Z,Y;if(X)if(typeof X==="function")Y=X;else if(Y=X.optionHandler,X.replaceRequest===!1)Z=(W)=>W;else Z=X.replaceRequest;let z=Y?(W)=>{let P=Y(W);return Array.isArray(P)?P:[P]}:(W)=>{let P=void 0;try{P=W.executionCtx}catch{}return[W.env,P]};Z||=(()=>{let W=b(this._basePath,J),P=W==="/"?0:W.length;return(U)=>{let S=new URL(U.url);return S.pathname=S.pathname.slice(P)||"/",new Request(S,U)}})();let Q=async(W,P)=>{let U=await E(Z(W.req.raw),...z(W));if(U)return U;await P()};return this.#Y(G,b(J,"*"),Q),this}#Y(J,E,X){J=J.toUpperCase(),E=b(this._basePath,E);let Z={basePath:this._basePath,path:E,method:J,handler:X};this.router.add(J,E,[X,Z]),this.routes.push(Z)}#Z(J,E){if(J instanceof Error)return this.errorHandler(J,E);throw J}#X(J,E,X,Z){if(Z==="HEAD")return(async()=>new Response(null,await this.#X(J,E,X,"GET")))();let Y=this.getPath(J,{env:X}),z=this.router.match(Z,Y),Q=new K$(J,{path:Y,matchResult:z,env:X,executionCtx:E,notFoundHandler:this.#E});if(z[0].length===1){let P;try{P=z[0][0][0][0](Q,async()=>{Q.res=await this.#E(Q)})}catch(U){return this.#Z(U,Q)}return P instanceof Promise?P.then((U)=>U||(Q.finalized?Q.res:this.#E(Q))).catch((U)=>this.#Z(U,Q)):P??this.#E(Q)}let W=u0(z[0],this.errorHandler,this.#E);return(async()=>{try{let P=await W(Q);if(!P.finalized)throw Error("Context is not finalized. Did you forget to return a Response object or `await next()`?");return P.res}catch(P){return this.#Z(P,Q)}})()}fetch=(J,...E)=>{return this.#X(J,E[1],E[0],J.method)};request=(J,E,X,Z)=>{if(J instanceof Request)return this.fetch(E?new Request(J,E):J,X,Z);return J=J.toString(),this.fetch(new Request(/^https?:\/\//.test(J)?J:`http://localhost${b("/",J)}`,E),X,Z)};fire=()=>{addEventListener("fetch",(J)=>{J.respondWith(this.#X(J.request,J,void 0,J.request.method))})}};var m=[];function T0($,J){let E=this.buildAllMatchers(),X=(Z,Y)=>{let z=E[Z]||E[G],Q=z[2][Y];if(Q)return Q;let W=Y.match(z[0]);if(!W)return[[],m];let P=W.indexOf("",1);return[z[1][P],W]};return this.match=X,X($,J)}var V0="[^/]+",i=".*",d="(?:|/.*)",v=Symbol(),w5=new Set(".\\+*[^]$()");function y5($,J){if($.length===1)return J.length===1?$<J?-1:1:-1;if(J.length===1)return 1;if($===i||$===d)return 1;else if(J===i||J===d)return-1;if($===V0)return 1;else if(J===V0)return-1;return $.length===J.length?$<J?-1:1:J.length-$.length}var T$=class ${#$;#J;#E=Object.create(null);insert(J,E,X,Z,Y){if(J.length===0){if(this.#$!==void 0)throw v;if(Y)return;this.#$=E;return}let[z,...Q]=J,W=z==="*"?Q.length===0?["","",i]:["","",V0]:z==="/*"?["","",d]:z.match(/^\:([^\{\}]+)(?:\{(.+)\})?$/),P;if(W){let U=W[1],S=W[2]||V0;if(U&&W[2]){if(S===".*")throw v;if(S=S.replace(/^\((?!\?:)(?=[^)]+\)$)/,"(?:"),/\((?!\?:)/.test(S))throw v}if(P=this.#E[S],!P){if(Object.keys(this.#E).some((B)=>B!==i&&B!==d))throw v;if(Y)return;if(P=this.#E[S]=new $,U!=="")P.#J=Z.varIndex++}if(!Y&&U!=="")X.push([U,P.#J])}else if(P=this.#E[z],!P){if(Object.keys(this.#E).some((U)=>U.length>1&&U!==i&&U!==d))throw v;if(Y)return;P=this.#E[z]=new $}P.insert(Q,E,X,Z,Y)}buildRegExpStr(){let E=Object.keys(this.#E).sort(y5).map((X)=>{let Z=this.#E[X];return(typeof Z.#J==="number"?`(${X})@${Z.#J}`:w5.has(X)?`\\${X}`:X)+Z.buildRegExpStr()});if(typeof this.#$==="number")E.unshift(`#${this.#$}`);if(E.length===0)return"";if(E.length===1)return E[0];return"(?:"+E.join("|")+")"}};var V$=class{#$={varIndex:0};#J=new T$;insert($,J,E){let X=[],Z=[];for(let z=0;;){let Q=!1;if($=$.replace(/\{[^}]+\}/g,(W)=>{let P=`@\\${z}`;return Z[z]=[P,W],z++,Q=!0,P}),!Q)break}let Y=$.match(/(?::[^\/]+)|(?:\/\*$)|./g)||[];for(let z=Z.length-1;z>=0;z--){let[Q]=Z[z];for(let W=Y.length-1;W>=0;W--)if(Y[W].indexOf(Q)!==-1){Y[W]=Y[W].replace(Q,Z[z][1]);break}}return this.#J.insert(Y,J,X,this.#$,E),X}buildRegExp(){let $=this.#J.buildRegExpStr();if($==="")return[/^$/,[],[]];let J=0,E=[],X=[];return $=$.replace(/#(\d+)|@(\d+)|\.\*\$/g,(Z,Y,z)=>{if(Y!==void 0)return E[++J]=Number(Y),"$()";if(z!==void 0)return X[Number(z)]=++J,"";return""}),[new RegExp(`^${$}`),E,X]}};var C5=[/^$/,[],Object.create(null)],I$=Object.create(null);function M$($){return I$[$]??=new RegExp($==="*"?"":`^${$.replace(/\/\*$|([.\\+*[^\]$()])/g,(J,E)=>E?`\\${E}`:"(?:|/.*)")}$`)}function k5(){I$=Object.create(null)}function b5($){let J=new V$,E=[];if($.length===0)return C5;let X=$.map((P)=>[!/\*|\/:/.test(P[0]),...P]).sort(([P,U],[S,B])=>P?1:S?-1:U.length-B.length),Z=Object.create(null);for(let P=0,U=-1,S=X.length;P<S;P++){let[B,K,T]=X[P];if(B)Z[K]=[T.map(([M])=>[M,Object.create(null)]),m];else U++;let L;try{L=J.insert(K,U,B)}catch(M){throw M===v?new j0(K):M}if(B)continue;E[U]=T.map(([M,x])=>{let p=Object.create(null);x-=1;for(;x>=0;x--){let[t,q]=L[x];p[t]=q}return[M,p]})}let[Y,z,Q]=J.buildRegExp();for(let P=0,U=E.length;P<U;P++)for(let S=0,B=E[P].length;S<B;S++){let K=E[P][S]?.[1];if(!K)continue;let T=Object.keys(K);for(let L=0,M=T.length;L<M;L++)K[T[L]]=Q[K[T[L]]]}let W=[];for(let P in z)W[P]=E[z[P]];return[Y,W,Z]}function u($,J){if(!$)return;for(let E of Object.keys($).sort((X,Z)=>Z.length-X.length))if(M$(E).test(J))return[...$[E]];return}var I0=class{name="RegExpRouter";#$;#J;constructor(){this.#$={[G]:Object.create(null)},this.#J={[G]:Object.create(null)}}add($,J,E){let X=this.#$,Z=this.#J;if(!X||!Z)throw Error(R0);if(!X[$])[X,Z].forEach((Q)=>{Q[$]=Object.create(null),Object.keys(Q[G]).forEach((W)=>{Q[$][W]=[...Q[G][W]]})});if(J==="/*")J="*";let Y=(J.match(/\/:/g)||[]).length;if(/\*$/.test(J)){let Q=M$(J);if($===G)Object.keys(X).forEach((W)=>{X[W][J]||=u(X[W],J)||u(X[G],J)||[]});else X[$][J]||=u(X[$],J)||u(X[G],J)||[];Object.keys(X).forEach((W)=>{if($===G||$===W)Object.keys(X[W]).forEach((P)=>{Q.test(P)&&X[W][P].push([E,Y])})}),Object.keys(Z).forEach((W)=>{if($===G||$===W)Object.keys(Z[W]).forEach((P)=>Q.test(P)&&Z[W][P].push([E,Y]))});return}let z=L0(J)||[J];for(let Q=0,W=z.length;Q<W;Q++){let P=z[Q];Object.keys(Z).forEach((U)=>{if($===G||$===U)Z[U][P]||=[...u(X[U],P)||u(X[G],P)||[]],Z[U][P].push([E,Y-W+Q+1])})}}match=T0;buildAllMatchers(){let $=Object.create(null);return Object.keys(this.#J).concat(Object.keys(this.#$)).forEach((J)=>{$[J]||=this.#E(J)}),this.#$=this.#J=void 0,k5(),$}#E($){let J=[],E=$===G;if([this.#$,this.#J].forEach((X)=>{let Z=X[$]?Object.keys(X[$]).map((Y)=>[Y,X[$][Y]]):[];if(Z.length!==0)E||=!0,J.push(...Z);else if($!==G)J.push(...Object.keys(X[G]).map((Y)=>[Y,X[G][Y]]))}),!E)return null;else return b5(J)}};var v5=class{name="PreparedRegExpRouter";#$;#J;constructor($,J){this.#$=$,this.#J=J}#E($,J){let E=this.#$[$];E[1].forEach((X)=>X&&X.push(J)),Object.values(E[2]).forEach((X)=>X[0].push(J))}#Y($,J,E,X,Z){let Y=this.#$[$];if(!Z)Y[2][J][0].push([E,{}]);else X.forEach((z)=>{if(typeof z==="number")Y[1][z].push([E,Z]);else Y[2][z||J][0].push([E,Z])})}add($,J,E){if(!this.#$[$]){let Z=this.#$[G],Y={};for(let z in Z[2])Y[z]=[Z[2][z][0].slice(),m];this.#$[$]=[Z[0],Z[1].map((z)=>Array.isArray(z)?z.slice():0),Y]}if(J==="/*"||J==="*"){let Z=[E,{}];if($===G)for(let Y in this.#$)this.#E(Y,Z);else this.#E($,Z);return}let X=this.#J[J];if(!X)throw Error(`Path ${J} is not registered`);for(let[Z,Y]of X)if($===G)for(let z in this.#$)this.#Y(z,J,E,Z,Y);else this.#Y($,J,E,Z,Y)}buildAllMatchers(){return this.#$}match=T0};var r0=class{name="SmartRouter";#$=[];#J=[];constructor($){this.#$=$.routers}add($,J,E){if(!this.#J)throw Error(R0);this.#J.push([$,J,E])}match($,J){if(!this.#J)throw Error("Fatal error");let E=this.#$,X=this.#J,Z=E.length,Y=0,z;for(;Y<Z;Y++){let Q=E[Y];try{for(let W=0,P=X.length;W<P;W++)Q.add(...X[W]);z=Q.match($,J)}catch(W){if(W instanceof j0)continue;throw W}this.match=Q.match.bind(Q),this.#$=[Q],this.#J=void 0;break}if(Y===Z)throw Error("Fatal error");return this.name=`SmartRouter + ${this.activeRouter.name}`,z}get activeRouter(){if(this.#J||this.#$.length!==1)throw Error("No active router has been determined yet.");return this.#$[0]}};var r=Object.create(null),_$=class ${#$;#J;#E;#Y=0;#Z=r;constructor(J,E,X){if(this.#J=X||Object.create(null),this.#$=[],J&&E){let Z=Object.create(null);Z[J]={handler:E,possibleKeys:[],score:0},this.#$=[Z]}this.#E=[]}insert(J,E,X){this.#Y=++this.#Y;let Z=this,Y=Z$(E),z=[];for(let Q=0,W=Y.length;Q<W;Q++){let P=Y[Q],U=Y[Q+1],S=Y$(P,U),B=Array.isArray(S)?S[0]:P;if(B in Z.#J){if(Z=Z.#J[B],S)z.push(S[1]);continue}if(Z.#J[B]=new $,S)Z.#E.push(S),z.push(S[1]);Z=Z.#J[B]}return Z.#$.push({[J]:{handler:X,possibleKeys:z.filter((Q,W,P)=>P.indexOf(Q)===W),score:this.#Y}}),Z}#X(J,E,X,Z){let Y=[];for(let z=0,Q=J.#$.length;z<Q;z++){let W=J.#$[z],P=W[E]||W[G],U={};if(P!==void 0){if(P.params=Object.create(null),Y.push(P),X!==r||Z&&Z!==r)for(let S=0,B=P.possibleKeys.length;S<B;S++){let K=P.possibleKeys[S],T=U[P.score];P.params[K]=Z?.[K]&&!T?Z[K]:X[K]??Z?.[K],U[P.score]=!0}}}return Y}search(J,E){let X=[];this.#Z=r;let Y=[this],z=l0(E),Q=[];for(let W=0,P=z.length;W<P;W++){let U=z[W],S=W===P-1,B=[];for(let K=0,T=Y.length;K<T;K++){let L=Y[K],M=L.#J[U];if(M)if(M.#Z=L.#Z,S){if(M.#J["*"])X.push(...this.#X(M.#J["*"],J,L.#Z));X.push(...this.#X(M,J,L.#Z))}else B.push(M);for(let x=0,p=L.#E.length;x<p;x++){let t=L.#E[x],q=L.#Z===r?{}:{...L.#Z};if(t==="*"){let A=L.#J["*"];if(A)X.push(...this.#X(A,J,L.#Z)),A.#Z=q,B.push(A);continue}let[k$,n0,c]=t;if(!U&&!(c instanceof RegExp))continue;let N=L.#J[k$],b$=z.slice(W).join("/");if(c instanceof RegExp){let A=c.exec(b$);if(A){if(q[n0]=A[0],X.push(...this.#X(N,J,L.#Z,q)),Object.keys(N.#J).length){N.#Z=q;let v$=A[0].match(/\//)?.length??0;(Q[v$]||=[]).push(N)}continue}}if(c===!0||c.test(U))if(q[n0]=U,S){if(X.push(...this.#X(N,J,q,L.#Z)),N.#J["*"])X.push(...this.#X(N.#J["*"],J,q,L.#Z))}else N.#Z=q,B.push(N)}}Y=B.concat(Q.shift()??[])}if(X.length>1)X.sort((W,P)=>{return W.score-P.score});return[X.map(({handler:W,params:P})=>[W,P])]}};var p0=class{name="TrieRouter";#$;constructor(){this.#$=new _$}add($,J,E){let X=L0(J);if(X){for(let Z=0,Y=X.length;Z<Y;Z++)this.#$.insert($,X[Z],E);return}this.#$.insert($,J,E)}match($,J){return this.#$.search($,J)}};var t0=class extends j${constructor($={}){super($);this.router=$.router??new r0({routers:[new I0,new p0]})}};var M0=new Map,h5={windowMs:60000,maxRequests:100};function H$($,J=h5){let E=Date.now(),X=M0.get($);if(!X||E-X.windowStart>=J.windowMs)return M0.set($,{count:1,windowStart:E}),{allowed:!0,remaining:J.maxRequests-1,resetMs:J.windowMs};if(X.count>=J.maxRequests)return{allowed:!1,remaining:0,resetMs:J.windowMs-(E-X.windowStart)};return X.count++,{allowed:!0,remaining:J.maxRequests-X.count,resetMs:J.windowMs-(E-X.windowStart)}}function g5($=300000){let J=Date.now(),E=0;for(let[X,Z]of M0.entries())if(J-Z.windowStart>$)M0.delete(X),E++;return E}var u5=setInterval(()=>{g5()},300000);u5.unref();var F$={windowMs:60000,maxRequests:100},q$=["whatsapp","telegram","email","discord","slack","signal","webchat"];function f$($){let J=$.req.header("x-forwarded-for");if(J){let E=J.split(",")[0]?.trim();if(E)return E}return $.req.header("x-real-ip")||"unknown"}function _0($){return q$.includes($)}function H0($,J){let E=process.env.WASP_API_TOKEN,X=f$($);if(!E){if(!(X==="127.0.0.1"||X==="::1"||X==="localhost"||X==="unknown"))return $.json({error:"Admin endpoints require authentication. Set WASP_API_TOKEN or access from localhost."},401);return J()}let Z=$.req.header("authorization");if(!Z)return $.json({error:"Authorization header required"},401);if((Z.startsWith("Bearer ")?Z.slice(7):Z)!==E)return $.json({error:"Invalid API token"},401);return J()}function c5(){let $=new t0;return $.get("/health",(J)=>{return J.json({ok:!0,timestamp:new Date().toISOString()})}),$.post("/check",async(J)=>{let E=f$(J),X=H$(`check:${E}`,F$);if(J.header("X-RateLimit-Limit",String(F$.maxRequests)),J.header("X-RateLimit-Remaining",String(X.remaining)),J.header("X-RateLimit-Reset",String(Math.ceil(X.resetMs/1000))),!X.allowed)return J.json({error:"Rate limit exceeded",retryAfterMs:X.resetMs},429);let Z;try{Z=await J.req.json()}catch{return J.json({error:"Invalid JSON body"},400)}let{identifier:Y,platform:z="whatsapp"}=Z;if(!Y)return J.json({error:"identifier is required"},400);if(!_0(z))return J.json({error:`Invalid platform. Must be one of: ${q$.join(", ")}`},400);let Q=U0(Y,z),W=!Q.allowed?"deny":Q.trust==="limited"?"limited":"allow";return S0(Y,z,W,Q.reason),J.json(Q)}),$.get("/contacts",H0,(J)=>{let E=J.req.query("platform"),X=J.req.query("trust");if(E&&!_0(E))return J.json({error:"Invalid platform filter"},400);let Z=P0(E,X);return J.json({contacts:Z})}),$.post("/contacts",H0,async(J)=>{let E;try{E=await J.req.json()}catch{return J.json({error:"Invalid JSON body"},400)}let{identifier:X,platform:Z="whatsapp",trust:Y="trusted",name:z,notes:Q}=E;if(!X)return J.json({error:"identifier is required"},400);if(!_0(Z))return J.json({error:"Invalid platform"},400);let W=["sovereign","trusted","limited"];if(!W.includes(Y))return J.json({error:`Invalid trust level. Must be one of: ${W.join(", ")}`},400);let P=k(X,Z,Y,z,Q);return J.json({contact:P})}),$.delete("/contacts/:identifier",H0,(J)=>{let E=decodeURIComponent(J.req.param("identifier")),X=J.req.query("platform")||"whatsapp";if(!_0(X))return J.json({error:"Invalid platform"},400);let Z=W0(E,X);return J.json({removed:Z})}),$.get("/audit",H0,(J)=>{let E=J.req.query("limit"),X=E?parseInt(E,10):100;if(isNaN(X)||X<1||X>1000)return J.json({error:"limit must be between 1 and 1000"},400);let Z=J.req.query("decision");if(Z&&!["allow","deny","limited"].includes(Z))return J.json({error:"Invalid decision filter"},400);let Y=g({limit:X,decision:Z});return J.json({entries:Y})}),$}function N$($=3847){let J=c5(),E=!!process.env.WASP_API_TOKEN;if(console.log(`wasp server listening on http://localhost:${$}`),console.log(""),console.log("Public endpoints:"),console.log("  POST /check         - Check if contact is allowed"),console.log("  GET  /health        - Health check"),console.log(""),console.log("Admin endpoints (protected):"),console.log("  GET  /contacts      - List contacts"),console.log("  POST /contacts      - Add contact"),console.log("  DELETE /contacts/:id - Remove contact"),console.log("  GET  /audit         - View audit log"),console.log(""),E)console.log("Authentication: API token required (WASP_API_TOKEN is set)");else console.log("Authentication: Localhost-only (set WASP_API_TOKEN for remote access)");Bun.serve({port:$,fetch:J.fetch})}function D$($){if(!h())console.error("wasp is not initialized. Run `wasp init` first."),process.exit(1);let J=$.port||3847;N$(J)}function x$($){return{id:$.id,identifier:$.identifier,platform:$.platform,messagePreview:$.message_preview||"",fullMessage:$.full_message||"",timestamp:$.timestamp,reviewed:!!$.reviewed}}function A$($=50){return _().prepare(`
    SELECT * FROM quarantine 
    WHERE reviewed = 0 
    ORDER BY timestamp DESC 
    LIMIT ?
  `).all($).map(x$)}function l5($,J="whatsapp"){return _().prepare(`
    SELECT * FROM quarantine 
    WHERE identifier = ? AND platform = ? AND reviewed = 0
    ORDER BY timestamp ASC
  `).all($,J).map(x$)}function O$($,J="whatsapp"){let E=l5($,J);if(E.length>0)_().prepare(`
      UPDATE quarantine SET reviewed = 1 
      WHERE identifier = ? AND platform = ?
    `).run($,J);return E}function w$($,J="whatsapp"){return _().prepare(`
    DELETE FROM quarantine WHERE identifier = ? AND platform = ?
  `).run($,J).changes}async function y$($){if($.approve){let Z=O$($.approve);if(Z.length>0)k(Z[0].identifier,Z[0].platform,"trusted"),console.log(`\u2713 Approved ${Z[0].identifier}`),console.log(`  Released ${Z.length} quarantined message(s)`);else console.log(`No quarantined messages for: ${$.approve}`);return}if($.deny){let Z=w$($.deny);if(Z>0)k($.deny,"whatsapp","limited"),console.log(`\u2717 Denied ${$.deny}`),console.log(`  Deleted ${Z} message(s)`);else console.log(`No quarantined messages for: ${$.deny}`);return}let J=A$(50);if(J.length===0){console.log(`
\uD83D\uDC1D Quarantine is empty - no messages awaiting review
`);return}let E=new Map;for(let Z of J){let Y=`${Z.identifier}|${Z.platform}`;if(!E.has(Y))E.set(Y,[]);E.get(Y).push(Z)}console.log(`
\uD83D\uDC1D Quarantine Review
`),console.log(`${E.size} sender(s), ${J.length} message(s) awaiting review
`),console.log("\u2500".repeat(60)+`
`);let X=1;for(let[Z,Y]of E){let[z,Q]=Z.split("|");console.log(`${X}. ${z} (${Q})`),console.log(`   ${Y.length} message(s)`),console.log("");let W=Y[0];console.log(`   First: "${W.messagePreview}"`),console.log(`   Time:  ${W.timestamp}`),console.log(""),X++}if(console.log("\u2500".repeat(60)),console.log(`
Actions:`),console.log("  wasp review --approve <identifier>   Add to trusted, release messages"),console.log("  wasp review --deny <identifier>      Block sender, delete messages"),console.log(""),$.interactive)console.log("Interactive mode not yet implemented."),console.log("Use --approve or --deny flags for now.")}function C$($=20){let J=g({limit:100,decision:"deny"}),E=new Set,X=[];for(let Z of J){let Y=`${Z.identifier}|${Z.platform}`;if(!E.has(Y)){if(E.add(Y),X.push(Z),X.length>=$)break}}if(X.length===0){console.log(`
No blocked contacts in recent history.
`);return}console.log(`
\uD83D\uDC1D Recently Blocked Contacts
`),console.log("\u2500".repeat(60)+`
`);for(let Z of X)console.log(`  ${Z.identifier} (${Z.platform})`),console.log(`    Last seen: ${Z.timestamp}`),console.log(`    Reason: ${Z.reason}`),console.log("");console.log("\u2500".repeat(60)),console.log(`
To allow a contact:`),console.log('  wasp add "<identifier>" --trust trusted'),console.log("")}var m5=s5(import.meta.url),i5=m5("../package.json"),d5=i5.version;H.name("wasp").description("Security whitelist layer for Moltbot and agentic systems").version(d5);H.command("init").description("Initialize wasp database").option("-f, --force","Reinitialize even if already initialized").action(($)=>{n1($.force)});H.command("add <identifier>").description("Add a contact to the whitelist").option("-p, --platform <platform>","Platform (whatsapp, telegram, email, discord, slack, signal)","whatsapp").option("-t, --trust <level>","Trust level (sovereign, trusted, limited)","trusted").option("-n, --name <name>","Contact name").option("--notes <notes>","Notes about this contact").action(($,J)=>{O(),o1($,J)});H.command("remove <identifier>").description("Remove a contact from the whitelist").option("-p, --platform <platform>","Platform","whatsapp").action(($,J)=>{O(),a1($,J.platform)});H.command("list").description("List all contacts").option("-p, --platform <platform>","Filter by platform").option("-t, --trust <level>","Filter by trust level").option("-j, --json","Output as JSON").action(($)=>{O(),e1($)});H.command("check <identifier>").description("Check if a contact is allowed").option("-p, --platform <platform>","Platform","whatsapp").option("-j, --json","Output as JSON").option("-q, --quiet","Exit code only, no output").action(($,J)=>{O(),$$($,J)});H.command("log").description("View audit log").option("-l, --limit <number>","Number of entries to show","50").option("-d, --denied","Show only denied entries").option("-j, --json","Output as JSON").action(($)=>{O(),J$({...$,limit:parseInt($.limit)})});H.command("serve").description("Start HTTP server for Moltbot integration").option("-p, --port <number>","Port to listen on","3847").action(($)=>{O(),D$({port:parseInt($.port)})});H.command("review").description("Review quarantined messages and first-time contacts").option("--approve <identifier>","Approve sender and release messages").option("--deny <identifier>","Block sender and delete messages").option("-i, --interactive","Interactive review mode").action(async($)=>{O(),await y$($)});H.command("blocked").description("Show recently blocked contacts").option("-l, --limit <number>","Number to show","20").action(($)=>{O(),C$(parseInt($.limit))});function O(){if(!h())console.log("wasp is not initialized. Initializing now..."),Q0(),console.log("")}H.parseAsync().then(()=>{h0(),process.exit(0)}).catch(($)=>{console.error($),h0(),process.exit(1)});
