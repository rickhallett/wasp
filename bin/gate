#!/usr/bin/env bash
# The Gate - must pass before any task is "done"
# Returns non-zero on failure with verbose output

set -e

echo "ğŸš¦ Running gate..."
echo ""

FAILED=0

# Type check (TypeScript)
if [ -f "tsconfig.json" ]; then
    echo "ğŸ“˜ Type checking..."
    if bun run typecheck 2>/dev/null; then
        echo "   âœ… Types OK"
    else
        echo "   âŒ Type errors"
        FAILED=1
    fi
    echo ""
fi

# Lint (Biome)
echo "ğŸ” Linting..."
if bun run lint 2>/dev/null; then
    echo "   âœ… Lint OK"
else
    echo "   âŒ Lint errors"
    FAILED=1
fi
echo ""

# Test
echo "ğŸ§ª Testing..."
if bun test 2>/dev/null; then
    echo "   âœ… Tests OK"
else
    echo "   âŒ Test failures"
    FAILED=1
fi
echo ""

# Summary
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
if [ $FAILED -eq 0 ]; then
    echo "âœ… Gate passed. Ready to ship."
    exit 0
else
    echo "âŒ Gate failed. Fix issues above."
    exit 1
fi
